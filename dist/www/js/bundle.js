var KiwixJSBundle = (function () {
  'use strict';

  var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;
  function _newArrowCheck(n, r) {
    if (n !== r) throw new TypeError("Cannot instantiate an arrow function");
  }
  function _typeof(o) {
    "@babel/helpers - typeof";

    return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
      return typeof o;
    } : function (o) {
      return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
    }, _typeof(o);
  }

  var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

  var check = function (it) {
    return it && it.Math == Math && it;
  };

  // https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
  var global$Q =
    // eslint-disable-next-line es/no-global-this -- safe
    check(typeof globalThis == 'object' && globalThis) ||
    check(typeof window == 'object' && window) ||
    // eslint-disable-next-line no-restricted-globals -- safe
    check(typeof self == 'object' && self) ||
    check(typeof commonjsGlobal == 'object' && commonjsGlobal) ||
    // eslint-disable-next-line no-new-func -- fallback
    (function () { return this; })() || commonjsGlobal || Function('return this')();

  var objectGetOwnPropertyDescriptor = {};

  var fails$V = function (exec) {
    try {
      return !!exec();
    } catch (error) {
      return true;
    }
  };

  var fails$U = fails$V;

  // Detect IE8's incomplete defineProperty implementation
  var descriptors = !fails$U(function () {
    // eslint-disable-next-line es/no-object-defineproperty -- required for testing
    return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;
  });

  var fails$T = fails$V;

  var functionBindNative = !fails$T(function () {
    // eslint-disable-next-line es/no-function-prototype-bind -- safe
    var test = (function () { /* empty */ }).bind();
    // eslint-disable-next-line no-prototype-builtins -- safe
    return typeof test != 'function' || test.hasOwnProperty('prototype');
  });

  var NATIVE_BIND$3 = functionBindNative;

  var call$B = Function.prototype.call;

  var functionCall = NATIVE_BIND$3 ? call$B.bind(call$B) : function () {
    return call$B.apply(call$B, arguments);
  };

  var objectPropertyIsEnumerable = {};

  var $propertyIsEnumerable$2 = {}.propertyIsEnumerable;
  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var getOwnPropertyDescriptor$6 = Object.getOwnPropertyDescriptor;

  // Nashorn ~ JDK8 bug
  var NASHORN_BUG = getOwnPropertyDescriptor$6 && !$propertyIsEnumerable$2.call({ 1: 2 }, 1);

  // `Object.prototype.propertyIsEnumerable` method implementation
  // https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable
  objectPropertyIsEnumerable.f = NASHORN_BUG ? function propertyIsEnumerable(V) {
    var descriptor = getOwnPropertyDescriptor$6(this, V);
    return !!descriptor && descriptor.enumerable;
  } : $propertyIsEnumerable$2;

  var createPropertyDescriptor$a = function (bitmap, value) {
    return {
      enumerable: !(bitmap & 1),
      configurable: !(bitmap & 2),
      writable: !(bitmap & 4),
      value: value
    };
  };

  var NATIVE_BIND$2 = functionBindNative;

  var FunctionPrototype$3 = Function.prototype;
  var call$A = FunctionPrototype$3.call;
  var uncurryThisWithBind = NATIVE_BIND$2 && FunctionPrototype$3.bind.bind(call$A, call$A);

  var functionUncurryThis = NATIVE_BIND$2 ? uncurryThisWithBind : function (fn) {
    return function () {
      return call$A.apply(fn, arguments);
    };
  };

  var uncurryThis$X = functionUncurryThis;

  var toString$p = uncurryThis$X({}.toString);
  var stringSlice$e = uncurryThis$X(''.slice);

  var classofRaw$2 = function (it) {
    return stringSlice$e(toString$p(it), 8, -1);
  };

  var uncurryThis$W = functionUncurryThis;
  var fails$S = fails$V;
  var classof$k = classofRaw$2;

  var $Object$4 = Object;
  var split$3 = uncurryThis$W(''.split);

  // fallback for non-array-like ES3 and non-enumerable old V8 strings
  var indexedObject = fails$S(function () {
    // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346
    // eslint-disable-next-line no-prototype-builtins -- safe
    return !$Object$4('z').propertyIsEnumerable(0);
  }) ? function (it) {
    return classof$k(it) == 'String' ? split$3(it, '') : $Object$4(it);
  } : $Object$4;

  // we can't use just `it == null` since of `document.all` special case
  // https://tc39.es/ecma262/#sec-IsHTMLDDA-internal-slot-aec
  var isNullOrUndefined$b = function (it) {
    return it === null || it === undefined;
  };

  var isNullOrUndefined$a = isNullOrUndefined$b;

  var $TypeError$o = TypeError;

  // `RequireObjectCoercible` abstract operation
  // https://tc39.es/ecma262/#sec-requireobjectcoercible
  var requireObjectCoercible$c = function (it) {
    if (isNullOrUndefined$a(it)) throw $TypeError$o("Can't call method on " + it);
    return it;
  };

  // toObject with fallback for non-array-like ES3 strings
  var IndexedObject$5 = indexedObject;
  var requireObjectCoercible$b = requireObjectCoercible$c;

  var toIndexedObject$c = function (it) {
    return IndexedObject$5(requireObjectCoercible$b(it));
  };

  var documentAll$2 = typeof document == 'object' && document.all;

  // https://tc39.es/ecma262/#sec-IsHTMLDDA-internal-slot
  // eslint-disable-next-line unicorn/no-typeof-undefined -- required for testing
  var IS_HTMLDDA = typeof documentAll$2 == 'undefined' && documentAll$2 !== undefined;

  var documentAll_1 = {
    all: documentAll$2,
    IS_HTMLDDA: IS_HTMLDDA
  };

  var $documentAll$1 = documentAll_1;

  var documentAll$1 = $documentAll$1.all;

  // `IsCallable` abstract operation
  // https://tc39.es/ecma262/#sec-iscallable
  var isCallable$x = $documentAll$1.IS_HTMLDDA ? function (argument) {
    return typeof argument == 'function' || argument === documentAll$1;
  } : function (argument) {
    return typeof argument == 'function';
  };

  var isCallable$w = isCallable$x;
  var $documentAll = documentAll_1;

  var documentAll = $documentAll.all;

  var isObject$l = $documentAll.IS_HTMLDDA ? function (it) {
    return typeof it == 'object' ? it !== null : isCallable$w(it) || it === documentAll;
  } : function (it) {
    return typeof it == 'object' ? it !== null : isCallable$w(it);
  };

  var global$P = global$Q;
  var isCallable$v = isCallable$x;

  var aFunction = function (argument) {
    return isCallable$v(argument) ? argument : undefined;
  };

  var getBuiltIn$f = function (namespace, method) {
    return arguments.length < 2 ? aFunction(global$P[namespace]) : global$P[namespace] && global$P[namespace][method];
  };

  var uncurryThis$V = functionUncurryThis;

  var objectIsPrototypeOf = uncurryThis$V({}.isPrototypeOf);

  var engineUserAgent = typeof navigator != 'undefined' && String(navigator.userAgent) || '';

  var global$O = global$Q;
  var userAgent$5 = engineUserAgent;

  var process$4 = global$O.process;
  var Deno$1 = global$O.Deno;
  var versions = process$4 && process$4.versions || Deno$1 && Deno$1.version;
  var v8 = versions && versions.v8;
  var match, version;

  if (v8) {
    match = v8.split('.');
    // in old Chrome, versions of V8 isn't V8 = Chrome / 10
    // but their correct versions are not interesting for us
    version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);
  }

  // BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`
  // so check `userAgent` even if `.v8` exists, but 0
  if (!version && userAgent$5) {
    match = userAgent$5.match(/Edge\/(\d+)/);
    if (!match || match[1] >= 74) {
      match = userAgent$5.match(/Chrome\/(\d+)/);
      if (match) version = +match[1];
    }
  }

  var engineV8Version = version;

  /* eslint-disable es/no-symbol -- required for testing */

  var V8_VERSION$3 = engineV8Version;
  var fails$R = fails$V;
  var global$N = global$Q;

  var $String$7 = global$N.String;

  // eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing
  var symbolConstructorDetection = !!Object.getOwnPropertySymbols && !fails$R(function () {
    var symbol = Symbol();
    // Chrome 38 Symbol has incorrect toString conversion
    // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances
    // nb: Do not call `String` directly to avoid this being optimized out to `symbol+''` which will,
    // of course, fail.
    return !$String$7(symbol) || !(Object(symbol) instanceof Symbol) ||
      // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances
      !Symbol.sham && V8_VERSION$3 && V8_VERSION$3 < 41;
  });

  /* eslint-disable es/no-symbol -- required for testing */

  var NATIVE_SYMBOL$6 = symbolConstructorDetection;

  var useSymbolAsUid = NATIVE_SYMBOL$6
    && !Symbol.sham
    && typeof Symbol.iterator == 'symbol';

  var getBuiltIn$e = getBuiltIn$f;
  var isCallable$u = isCallable$x;
  var isPrototypeOf$a = objectIsPrototypeOf;
  var USE_SYMBOL_AS_UID$1 = useSymbolAsUid;

  var $Object$3 = Object;

  var isSymbol$6 = USE_SYMBOL_AS_UID$1 ? function (it) {
    return typeof it == 'symbol';
  } : function (it) {
    var $Symbol = getBuiltIn$e('Symbol');
    return isCallable$u($Symbol) && isPrototypeOf$a($Symbol.prototype, $Object$3(it));
  };

  var $String$6 = String;

  var tryToString$7 = function (argument) {
    try {
      return $String$6(argument);
    } catch (error) {
      return 'Object';
    }
  };

  var isCallable$t = isCallable$x;
  var tryToString$6 = tryToString$7;

  var $TypeError$n = TypeError;

  // `Assert: IsCallable(argument) is true`
  var aCallable$h = function (argument) {
    if (isCallable$t(argument)) return argument;
    throw $TypeError$n(tryToString$6(argument) + ' is not a function');
  };

  var aCallable$g = aCallable$h;
  var isNullOrUndefined$9 = isNullOrUndefined$b;

  // `GetMethod` abstract operation
  // https://tc39.es/ecma262/#sec-getmethod
  var getMethod$9 = function (V, P) {
    var func = V[P];
    return isNullOrUndefined$9(func) ? undefined : aCallable$g(func);
  };

  var call$z = functionCall;
  var isCallable$s = isCallable$x;
  var isObject$k = isObject$l;

  var $TypeError$m = TypeError;

  // `OrdinaryToPrimitive` abstract operation
  // https://tc39.es/ecma262/#sec-ordinarytoprimitive
  var ordinaryToPrimitive$1 = function (input, pref) {
    var fn, val;
    if (pref === 'string' && isCallable$s(fn = input.toString) && !isObject$k(val = call$z(fn, input))) return val;
    if (isCallable$s(fn = input.valueOf) && !isObject$k(val = call$z(fn, input))) return val;
    if (pref !== 'string' && isCallable$s(fn = input.toString) && !isObject$k(val = call$z(fn, input))) return val;
    throw $TypeError$m("Can't convert object to primitive value");
  };

  var shared$7 = {exports: {}};

  var isPure = false;

  var global$M = global$Q;

  // eslint-disable-next-line es/no-object-defineproperty -- safe
  var defineProperty$d = Object.defineProperty;

  var defineGlobalProperty$3 = function (key, value) {
    try {
      defineProperty$d(global$M, key, { value: value, configurable: true, writable: true });
    } catch (error) {
      global$M[key] = value;
    } return value;
  };

  var global$L = global$Q;
  var defineGlobalProperty$2 = defineGlobalProperty$3;

  var SHARED = '__core-js_shared__';
  var store$3 = global$L[SHARED] || defineGlobalProperty$2(SHARED, {});

  var sharedStore = store$3;

  var store$2 = sharedStore;

  (shared$7.exports = function (key, value) {
    return store$2[key] || (store$2[key] = value !== undefined ? value : {});
  })('versions', []).push({
    version: '3.30.2',
    mode: 'global',
    copyright: '© 2014-2023 Denis Pushkarev (zloirock.ru)',
    license: 'https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE',
    source: 'https://github.com/zloirock/core-js'
  });

  var sharedExports = shared$7.exports;

  var requireObjectCoercible$a = requireObjectCoercible$c;

  var $Object$2 = Object;

  // `ToObject` abstract operation
  // https://tc39.es/ecma262/#sec-toobject
  var toObject$h = function (argument) {
    return $Object$2(requireObjectCoercible$a(argument));
  };

  var uncurryThis$U = functionUncurryThis;
  var toObject$g = toObject$h;

  var hasOwnProperty = uncurryThis$U({}.hasOwnProperty);

  // `HasOwnProperty` abstract operation
  // https://tc39.es/ecma262/#sec-hasownproperty
  // eslint-disable-next-line es/no-object-hasown -- safe
  var hasOwnProperty_1 = Object.hasOwn || function hasOwn(it, key) {
    return hasOwnProperty(toObject$g(it), key);
  };

  var uncurryThis$T = functionUncurryThis;

  var id$1 = 0;
  var postfix = Math.random();
  var toString$o = uncurryThis$T(1.0.toString);

  var uid$5 = function (key) {
    return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString$o(++id$1 + postfix, 36);
  };

  var global$K = global$Q;
  var shared$6 = sharedExports;
  var hasOwn$r = hasOwnProperty_1;
  var uid$4 = uid$5;
  var NATIVE_SYMBOL$5 = symbolConstructorDetection;
  var USE_SYMBOL_AS_UID = useSymbolAsUid;

  var Symbol$3 = global$K.Symbol;
  var WellKnownSymbolsStore$1 = shared$6('wks');
  var createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol$3['for'] || Symbol$3 : Symbol$3 && Symbol$3.withoutSetter || uid$4;

  var wellKnownSymbol$x = function (name) {
    if (!hasOwn$r(WellKnownSymbolsStore$1, name)) {
      WellKnownSymbolsStore$1[name] = NATIVE_SYMBOL$5 && hasOwn$r(Symbol$3, name)
        ? Symbol$3[name]
        : createWellKnownSymbol('Symbol.' + name);
    } return WellKnownSymbolsStore$1[name];
  };

  var call$y = functionCall;
  var isObject$j = isObject$l;
  var isSymbol$5 = isSymbol$6;
  var getMethod$8 = getMethod$9;
  var ordinaryToPrimitive = ordinaryToPrimitive$1;
  var wellKnownSymbol$w = wellKnownSymbol$x;

  var $TypeError$l = TypeError;
  var TO_PRIMITIVE = wellKnownSymbol$w('toPrimitive');

  // `ToPrimitive` abstract operation
  // https://tc39.es/ecma262/#sec-toprimitive
  var toPrimitive$3 = function (input, pref) {
    if (!isObject$j(input) || isSymbol$5(input)) return input;
    var exoticToPrim = getMethod$8(input, TO_PRIMITIVE);
    var result;
    if (exoticToPrim) {
      if (pref === undefined) pref = 'default';
      result = call$y(exoticToPrim, input, pref);
      if (!isObject$j(result) || isSymbol$5(result)) return result;
      throw $TypeError$l("Can't convert object to primitive value");
    }
    if (pref === undefined) pref = 'number';
    return ordinaryToPrimitive(input, pref);
  };

  var toPrimitive$2 = toPrimitive$3;
  var isSymbol$4 = isSymbol$6;

  // `ToPropertyKey` abstract operation
  // https://tc39.es/ecma262/#sec-topropertykey
  var toPropertyKey$5 = function (argument) {
    var key = toPrimitive$2(argument, 'string');
    return isSymbol$4(key) ? key : key + '';
  };

  var global$J = global$Q;
  var isObject$i = isObject$l;

  var document$3 = global$J.document;
  // typeof document.createElement is 'object' in old IE
  var EXISTS$1 = isObject$i(document$3) && isObject$i(document$3.createElement);

  var documentCreateElement$2 = function (it) {
    return EXISTS$1 ? document$3.createElement(it) : {};
  };

  var DESCRIPTORS$x = descriptors;
  var fails$Q = fails$V;
  var createElement$1 = documentCreateElement$2;

  // Thanks to IE8 for its funny defineProperty
  var ie8DomDefine = !DESCRIPTORS$x && !fails$Q(function () {
    // eslint-disable-next-line es/no-object-defineproperty -- required for testing
    return Object.defineProperty(createElement$1('div'), 'a', {
      get: function () { return 7; }
    }).a != 7;
  });

  var DESCRIPTORS$w = descriptors;
  var call$x = functionCall;
  var propertyIsEnumerableModule$2 = objectPropertyIsEnumerable;
  var createPropertyDescriptor$9 = createPropertyDescriptor$a;
  var toIndexedObject$b = toIndexedObject$c;
  var toPropertyKey$4 = toPropertyKey$5;
  var hasOwn$q = hasOwnProperty_1;
  var IE8_DOM_DEFINE$1 = ie8DomDefine;

  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var $getOwnPropertyDescriptor$2 = Object.getOwnPropertyDescriptor;

  // `Object.getOwnPropertyDescriptor` method
  // https://tc39.es/ecma262/#sec-object.getownpropertydescriptor
  objectGetOwnPropertyDescriptor.f = DESCRIPTORS$w ? $getOwnPropertyDescriptor$2 : function getOwnPropertyDescriptor(O, P) {
    O = toIndexedObject$b(O);
    P = toPropertyKey$4(P);
    if (IE8_DOM_DEFINE$1) try {
      return $getOwnPropertyDescriptor$2(O, P);
    } catch (error) { /* empty */ }
    if (hasOwn$q(O, P)) return createPropertyDescriptor$9(!call$x(propertyIsEnumerableModule$2.f, O, P), O[P]);
  };

  var objectDefineProperty = {};

  var DESCRIPTORS$v = descriptors;
  var fails$P = fails$V;

  // V8 ~ Chrome 36-
  // https://bugs.chromium.org/p/v8/issues/detail?id=3334
  var v8PrototypeDefineBug = DESCRIPTORS$v && fails$P(function () {
    // eslint-disable-next-line es/no-object-defineproperty -- required for testing
    return Object.defineProperty(function () { /* empty */ }, 'prototype', {
      value: 42,
      writable: false
    }).prototype != 42;
  });

  var isObject$h = isObject$l;

  var $String$5 = String;
  var $TypeError$k = TypeError;

  // `Assert: Type(argument) is Object`
  var anObject$s = function (argument) {
    if (isObject$h(argument)) return argument;
    throw $TypeError$k($String$5(argument) + ' is not an object');
  };

  var DESCRIPTORS$u = descriptors;
  var IE8_DOM_DEFINE = ie8DomDefine;
  var V8_PROTOTYPE_DEFINE_BUG$1 = v8PrototypeDefineBug;
  var anObject$r = anObject$s;
  var toPropertyKey$3 = toPropertyKey$5;

  var $TypeError$j = TypeError;
  // eslint-disable-next-line es/no-object-defineproperty -- safe
  var $defineProperty$1 = Object.defineProperty;
  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var $getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;
  var ENUMERABLE = 'enumerable';
  var CONFIGURABLE$1 = 'configurable';
  var WRITABLE = 'writable';

  // `Object.defineProperty` method
  // https://tc39.es/ecma262/#sec-object.defineproperty
  objectDefineProperty.f = DESCRIPTORS$u ? V8_PROTOTYPE_DEFINE_BUG$1 ? function defineProperty(O, P, Attributes) {
    anObject$r(O);
    P = toPropertyKey$3(P);
    anObject$r(Attributes);
    if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {
      var current = $getOwnPropertyDescriptor$1(O, P);
      if (current && current[WRITABLE]) {
        O[P] = Attributes.value;
        Attributes = {
          configurable: CONFIGURABLE$1 in Attributes ? Attributes[CONFIGURABLE$1] : current[CONFIGURABLE$1],
          enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],
          writable: false
        };
      }
    } return $defineProperty$1(O, P, Attributes);
  } : $defineProperty$1 : function defineProperty(O, P, Attributes) {
    anObject$r(O);
    P = toPropertyKey$3(P);
    anObject$r(Attributes);
    if (IE8_DOM_DEFINE) try {
      return $defineProperty$1(O, P, Attributes);
    } catch (error) { /* empty */ }
    if ('get' in Attributes || 'set' in Attributes) throw $TypeError$j('Accessors not supported');
    if ('value' in Attributes) O[P] = Attributes.value;
    return O;
  };

  var DESCRIPTORS$t = descriptors;
  var definePropertyModule$6 = objectDefineProperty;
  var createPropertyDescriptor$8 = createPropertyDescriptor$a;

  var createNonEnumerableProperty$f = DESCRIPTORS$t ? function (object, key, value) {
    return definePropertyModule$6.f(object, key, createPropertyDescriptor$8(1, value));
  } : function (object, key, value) {
    object[key] = value;
    return object;
  };

  var makeBuiltIn$3 = {exports: {}};

  var DESCRIPTORS$s = descriptors;
  var hasOwn$p = hasOwnProperty_1;

  var FunctionPrototype$2 = Function.prototype;
  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var getDescriptor = DESCRIPTORS$s && Object.getOwnPropertyDescriptor;

  var EXISTS = hasOwn$p(FunctionPrototype$2, 'name');
  // additional protection from minified / mangled / dropped function names
  var PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';
  var CONFIGURABLE = EXISTS && (!DESCRIPTORS$s || (DESCRIPTORS$s && getDescriptor(FunctionPrototype$2, 'name').configurable));

  var functionName = {
    EXISTS: EXISTS,
    PROPER: PROPER,
    CONFIGURABLE: CONFIGURABLE
  };

  var uncurryThis$S = functionUncurryThis;
  var isCallable$r = isCallable$x;
  var store$1 = sharedStore;

  var functionToString$1 = uncurryThis$S(Function.toString);

  // this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper
  if (!isCallable$r(store$1.inspectSource)) {
    store$1.inspectSource = function (it) {
      return functionToString$1(it);
    };
  }

  var inspectSource$3 = store$1.inspectSource;

  var global$I = global$Q;
  var isCallable$q = isCallable$x;

  var WeakMap$2 = global$I.WeakMap;

  var weakMapBasicDetection = isCallable$q(WeakMap$2) && /native code/.test(String(WeakMap$2));

  var shared$5 = sharedExports;
  var uid$3 = uid$5;

  var keys$2 = shared$5('keys');

  var sharedKey$4 = function (key) {
    return keys$2[key] || (keys$2[key] = uid$3(key));
  };

  var hiddenKeys$6 = {};

  var NATIVE_WEAK_MAP = weakMapBasicDetection;
  var global$H = global$Q;
  var isObject$g = isObject$l;
  var createNonEnumerableProperty$e = createNonEnumerableProperty$f;
  var hasOwn$o = hasOwnProperty_1;
  var shared$4 = sharedStore;
  var sharedKey$3 = sharedKey$4;
  var hiddenKeys$5 = hiddenKeys$6;

  var OBJECT_ALREADY_INITIALIZED = 'Object already initialized';
  var TypeError$8 = global$H.TypeError;
  var WeakMap$1 = global$H.WeakMap;
  var set$2, get$1, has;

  var enforce = function (it) {
    return has(it) ? get$1(it) : set$2(it, {});
  };

  var getterFor$1 = function (TYPE) {
    return function (it) {
      var state;
      if (!isObject$g(it) || (state = get$1(it)).type !== TYPE) {
        throw TypeError$8('Incompatible receiver, ' + TYPE + ' required');
      } return state;
    };
  };

  if (NATIVE_WEAK_MAP || shared$4.state) {
    var store = shared$4.state || (shared$4.state = new WeakMap$1());
    /* eslint-disable no-self-assign -- prototype methods protection */
    store.get = store.get;
    store.has = store.has;
    store.set = store.set;
    /* eslint-enable no-self-assign -- prototype methods protection */
    set$2 = function (it, metadata) {
      if (store.has(it)) throw TypeError$8(OBJECT_ALREADY_INITIALIZED);
      metadata.facade = it;
      store.set(it, metadata);
      return metadata;
    };
    get$1 = function (it) {
      return store.get(it) || {};
    };
    has = function (it) {
      return store.has(it);
    };
  } else {
    var STATE = sharedKey$3('state');
    hiddenKeys$5[STATE] = true;
    set$2 = function (it, metadata) {
      if (hasOwn$o(it, STATE)) throw TypeError$8(OBJECT_ALREADY_INITIALIZED);
      metadata.facade = it;
      createNonEnumerableProperty$e(it, STATE, metadata);
      return metadata;
    };
    get$1 = function (it) {
      return hasOwn$o(it, STATE) ? it[STATE] : {};
    };
    has = function (it) {
      return hasOwn$o(it, STATE);
    };
  }

  var internalState = {
    set: set$2,
    get: get$1,
    has: has,
    enforce: enforce,
    getterFor: getterFor$1
  };

  var uncurryThis$R = functionUncurryThis;
  var fails$O = fails$V;
  var isCallable$p = isCallable$x;
  var hasOwn$n = hasOwnProperty_1;
  var DESCRIPTORS$r = descriptors;
  var CONFIGURABLE_FUNCTION_NAME$2 = functionName.CONFIGURABLE;
  var inspectSource$2 = inspectSource$3;
  var InternalStateModule$c = internalState;

  var enforceInternalState$3 = InternalStateModule$c.enforce;
  var getInternalState$9 = InternalStateModule$c.get;
  var $String$4 = String;
  // eslint-disable-next-line es/no-object-defineproperty -- safe
  var defineProperty$c = Object.defineProperty;
  var stringSlice$d = uncurryThis$R(''.slice);
  var replace$b = uncurryThis$R(''.replace);
  var join$4 = uncurryThis$R([].join);

  var CONFIGURABLE_LENGTH = DESCRIPTORS$r && !fails$O(function () {
    return defineProperty$c(function () { /* empty */ }, 'length', { value: 8 }).length !== 8;
  });

  var TEMPLATE = String(String).split('String');

  var makeBuiltIn$2 = makeBuiltIn$3.exports = function (value, name, options) {
    if (stringSlice$d($String$4(name), 0, 7) === 'Symbol(') {
      name = '[' + replace$b($String$4(name), /^Symbol\(([^)]*)\)/, '$1') + ']';
    }
    if (options && options.getter) name = 'get ' + name;
    if (options && options.setter) name = 'set ' + name;
    if (!hasOwn$n(value, 'name') || (CONFIGURABLE_FUNCTION_NAME$2 && value.name !== name)) {
      if (DESCRIPTORS$r) defineProperty$c(value, 'name', { value: name, configurable: true });
      else value.name = name;
    }
    if (CONFIGURABLE_LENGTH && options && hasOwn$n(options, 'arity') && value.length !== options.arity) {
      defineProperty$c(value, 'length', { value: options.arity });
    }
    try {
      if (options && hasOwn$n(options, 'constructor') && options.constructor) {
        if (DESCRIPTORS$r) defineProperty$c(value, 'prototype', { writable: false });
      // in V8 ~ Chrome 53, prototypes of some methods, like `Array.prototype.values`, are non-writable
      } else if (value.prototype) value.prototype = undefined;
    } catch (error) { /* empty */ }
    var state = enforceInternalState$3(value);
    if (!hasOwn$n(state, 'source')) {
      state.source = join$4(TEMPLATE, typeof name == 'string' ? name : '');
    } return value;
  };

  // add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative
  // eslint-disable-next-line no-extend-native -- required
  Function.prototype.toString = makeBuiltIn$2(function toString() {
    return isCallable$p(this) && getInternalState$9(this).source || inspectSource$2(this);
  }, 'toString');

  var makeBuiltInExports = makeBuiltIn$3.exports;

  var isCallable$o = isCallable$x;
  var definePropertyModule$5 = objectDefineProperty;
  var makeBuiltIn$1 = makeBuiltInExports;
  var defineGlobalProperty$1 = defineGlobalProperty$3;

  var defineBuiltIn$h = function (O, key, value, options) {
    if (!options) options = {};
    var simple = options.enumerable;
    var name = options.name !== undefined ? options.name : key;
    if (isCallable$o(value)) makeBuiltIn$1(value, name, options);
    if (options.global) {
      if (simple) O[key] = value;
      else defineGlobalProperty$1(key, value);
    } else {
      try {
        if (!options.unsafe) delete O[key];
        else if (O[key]) simple = true;
      } catch (error) { /* empty */ }
      if (simple) O[key] = value;
      else definePropertyModule$5.f(O, key, {
        value: value,
        enumerable: false,
        configurable: !options.nonConfigurable,
        writable: !options.nonWritable
      });
    } return O;
  };

  var objectGetOwnPropertyNames = {};

  var ceil = Math.ceil;
  var floor$9 = Math.floor;

  // `Math.trunc` method
  // https://tc39.es/ecma262/#sec-math.trunc
  // eslint-disable-next-line es/no-math-trunc -- safe
  var mathTrunc = Math.trunc || function trunc(x) {
    var n = +x;
    return (n > 0 ? floor$9 : ceil)(n);
  };

  var trunc$1 = mathTrunc;

  // `ToIntegerOrInfinity` abstract operation
  // https://tc39.es/ecma262/#sec-tointegerorinfinity
  var toIntegerOrInfinity$e = function (argument) {
    var number = +argument;
    // eslint-disable-next-line no-self-compare -- NaN check
    return number !== number || number === 0 ? 0 : trunc$1(number);
  };

  var toIntegerOrInfinity$d = toIntegerOrInfinity$e;

  var max$5 = Math.max;
  var min$8 = Math.min;

  // Helper for a popular repeating case of the spec:
  // Let integer be ? ToInteger(index).
  // If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).
  var toAbsoluteIndex$8 = function (index, length) {
    var integer = toIntegerOrInfinity$d(index);
    return integer < 0 ? max$5(integer + length, 0) : min$8(integer, length);
  };

  var toIntegerOrInfinity$c = toIntegerOrInfinity$e;

  var min$7 = Math.min;

  // `ToLength` abstract operation
  // https://tc39.es/ecma262/#sec-tolength
  var toLength$a = function (argument) {
    return argument > 0 ? min$7(toIntegerOrInfinity$c(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991
  };

  var toLength$9 = toLength$a;

  // `LengthOfArrayLike` abstract operation
  // https://tc39.es/ecma262/#sec-lengthofarraylike
  var lengthOfArrayLike$m = function (obj) {
    return toLength$9(obj.length);
  };

  var toIndexedObject$a = toIndexedObject$c;
  var toAbsoluteIndex$7 = toAbsoluteIndex$8;
  var lengthOfArrayLike$l = lengthOfArrayLike$m;

  // `Array.prototype.{ indexOf, includes }` methods implementation
  var createMethod$6 = function (IS_INCLUDES) {
    return function ($this, el, fromIndex) {
      var O = toIndexedObject$a($this);
      var length = lengthOfArrayLike$l(O);
      var index = toAbsoluteIndex$7(fromIndex, length);
      var value;
      // Array#includes uses SameValueZero equality algorithm
      // eslint-disable-next-line no-self-compare -- NaN check
      if (IS_INCLUDES && el != el) while (length > index) {
        value = O[index++];
        // eslint-disable-next-line no-self-compare -- NaN check
        if (value != value) return true;
      // Array#indexOf ignores holes, Array#includes - not
      } else for (;length > index; index++) {
        if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;
      } return !IS_INCLUDES && -1;
    };
  };

  var arrayIncludes = {
    // `Array.prototype.includes` method
    // https://tc39.es/ecma262/#sec-array.prototype.includes
    includes: createMethod$6(true),
    // `Array.prototype.indexOf` method
    // https://tc39.es/ecma262/#sec-array.prototype.indexof
    indexOf: createMethod$6(false)
  };

  var uncurryThis$Q = functionUncurryThis;
  var hasOwn$m = hasOwnProperty_1;
  var toIndexedObject$9 = toIndexedObject$c;
  var indexOf$2 = arrayIncludes.indexOf;
  var hiddenKeys$4 = hiddenKeys$6;

  var push$a = uncurryThis$Q([].push);

  var objectKeysInternal = function (object, names) {
    var O = toIndexedObject$9(object);
    var i = 0;
    var result = [];
    var key;
    for (key in O) !hasOwn$m(hiddenKeys$4, key) && hasOwn$m(O, key) && push$a(result, key);
    // Don't enum bug & hidden keys
    while (names.length > i) if (hasOwn$m(O, key = names[i++])) {
      ~indexOf$2(result, key) || push$a(result, key);
    }
    return result;
  };

  // IE8- don't enum bug keys
  var enumBugKeys$3 = [
    'constructor',
    'hasOwnProperty',
    'isPrototypeOf',
    'propertyIsEnumerable',
    'toLocaleString',
    'toString',
    'valueOf'
  ];

  var internalObjectKeys$1 = objectKeysInternal;
  var enumBugKeys$2 = enumBugKeys$3;

  var hiddenKeys$3 = enumBugKeys$2.concat('length', 'prototype');

  // `Object.getOwnPropertyNames` method
  // https://tc39.es/ecma262/#sec-object.getownpropertynames
  // eslint-disable-next-line es/no-object-getownpropertynames -- safe
  objectGetOwnPropertyNames.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {
    return internalObjectKeys$1(O, hiddenKeys$3);
  };

  var objectGetOwnPropertySymbols = {};

  // eslint-disable-next-line es/no-object-getownpropertysymbols -- safe
  objectGetOwnPropertySymbols.f = Object.getOwnPropertySymbols;

  var getBuiltIn$d = getBuiltIn$f;
  var uncurryThis$P = functionUncurryThis;
  var getOwnPropertyNamesModule$2 = objectGetOwnPropertyNames;
  var getOwnPropertySymbolsModule$3 = objectGetOwnPropertySymbols;
  var anObject$q = anObject$s;

  var concat$2 = uncurryThis$P([].concat);

  // all object keys, includes non-enumerable and symbols
  var ownKeys$1 = getBuiltIn$d('Reflect', 'ownKeys') || function ownKeys(it) {
    var keys = getOwnPropertyNamesModule$2.f(anObject$q(it));
    var getOwnPropertySymbols = getOwnPropertySymbolsModule$3.f;
    return getOwnPropertySymbols ? concat$2(keys, getOwnPropertySymbols(it)) : keys;
  };

  var hasOwn$l = hasOwnProperty_1;
  var ownKeys = ownKeys$1;
  var getOwnPropertyDescriptorModule$2 = objectGetOwnPropertyDescriptor;
  var definePropertyModule$4 = objectDefineProperty;

  var copyConstructorProperties$4 = function (target, source, exceptions) {
    var keys = ownKeys(source);
    var defineProperty = definePropertyModule$4.f;
    var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule$2.f;
    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      if (!hasOwn$l(target, key) && !(exceptions && hasOwn$l(exceptions, key))) {
        defineProperty(target, key, getOwnPropertyDescriptor(source, key));
      }
    }
  };

  var fails$N = fails$V;
  var isCallable$n = isCallable$x;

  var replacement = /#|\.prototype\./;

  var isForced$5 = function (feature, detection) {
    var value = data[normalize(feature)];
    return value == POLYFILL ? true
      : value == NATIVE ? false
      : isCallable$n(detection) ? fails$N(detection)
      : !!detection;
  };

  var normalize = isForced$5.normalize = function (string) {
    return String(string).replace(replacement, '.').toLowerCase();
  };

  var data = isForced$5.data = {};
  var NATIVE = isForced$5.NATIVE = 'N';
  var POLYFILL = isForced$5.POLYFILL = 'P';

  var isForced_1 = isForced$5;

  var global$G = global$Q;
  var getOwnPropertyDescriptor$5 = objectGetOwnPropertyDescriptor.f;
  var createNonEnumerableProperty$d = createNonEnumerableProperty$f;
  var defineBuiltIn$g = defineBuiltIn$h;
  var defineGlobalProperty = defineGlobalProperty$3;
  var copyConstructorProperties$3 = copyConstructorProperties$4;
  var isForced$4 = isForced_1;

  /*
    options.target         - name of the target object
    options.global         - target is the global object
    options.stat           - export as static methods of target
    options.proto          - export as prototype methods of target
    options.real           - real prototype method for the `pure` version
    options.forced         - export even if the native feature is available
    options.bind           - bind methods to the target, required for the `pure` version
    options.wrap           - wrap constructors to preventing global pollution, required for the `pure` version
    options.unsafe         - use the simple assignment of property instead of delete + defineProperty
    options.sham           - add a flag to not completely full polyfills
    options.enumerable     - export as enumerable property
    options.dontCallGetSet - prevent calling a getter on target
    options.name           - the .name of the function if it does not match the key
  */
  var _export = function (options, source) {
    var TARGET = options.target;
    var GLOBAL = options.global;
    var STATIC = options.stat;
    var FORCED, target, key, targetProperty, sourceProperty, descriptor;
    if (GLOBAL) {
      target = global$G;
    } else if (STATIC) {
      target = global$G[TARGET] || defineGlobalProperty(TARGET, {});
    } else {
      target = (global$G[TARGET] || {}).prototype;
    }
    if (target) for (key in source) {
      sourceProperty = source[key];
      if (options.dontCallGetSet) {
        descriptor = getOwnPropertyDescriptor$5(target, key);
        targetProperty = descriptor && descriptor.value;
      } else targetProperty = target[key];
      FORCED = isForced$4(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);
      // contained in target
      if (!FORCED && targetProperty !== undefined) {
        if (typeof sourceProperty == typeof targetProperty) continue;
        copyConstructorProperties$3(sourceProperty, targetProperty);
      }
      // add a flag to not completely full polyfills
      if (options.sham || (targetProperty && targetProperty.sham)) {
        createNonEnumerableProperty$d(sourceProperty, 'sham', true);
      }
      defineBuiltIn$g(target, key, sourceProperty, options);
    }
  };

  var wellKnownSymbol$v = wellKnownSymbol$x;

  var TO_STRING_TAG$6 = wellKnownSymbol$v('toStringTag');
  var test$3 = {};

  test$3[TO_STRING_TAG$6] = 'z';

  var toStringTagSupport = String(test$3) === '[object z]';

  var TO_STRING_TAG_SUPPORT$2 = toStringTagSupport;
  var isCallable$m = isCallable$x;
  var classofRaw$1 = classofRaw$2;
  var wellKnownSymbol$u = wellKnownSymbol$x;

  var TO_STRING_TAG$5 = wellKnownSymbol$u('toStringTag');
  var $Object$1 = Object;

  // ES3 wrong here
  var CORRECT_ARGUMENTS = classofRaw$1(function () { return arguments; }()) == 'Arguments';

  // fallback for IE11 Script Access Denied error
  var tryGet = function (it, key) {
    try {
      return it[key];
    } catch (error) { /* empty */ }
  };

  // getting tag from ES6+ `Object.prototype.toString`
  var classof$j = TO_STRING_TAG_SUPPORT$2 ? classofRaw$1 : function (it) {
    var O, tag, result;
    return it === undefined ? 'Undefined' : it === null ? 'Null'
      // @@toStringTag case
      : typeof (tag = tryGet(O = $Object$1(it), TO_STRING_TAG$5)) == 'string' ? tag
      // builtinTag case
      : CORRECT_ARGUMENTS ? classofRaw$1(O)
      // ES3 arguments fallback
      : (result = classofRaw$1(O)) == 'Object' && isCallable$m(O.callee) ? 'Arguments' : result;
  };

  var classof$i = classof$j;

  var $String$3 = String;

  var toString$n = function (argument) {
    if (classof$i(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');
    return $String$3(argument);
  };

  var objectDefineProperties = {};

  var internalObjectKeys = objectKeysInternal;
  var enumBugKeys$1 = enumBugKeys$3;

  // `Object.keys` method
  // https://tc39.es/ecma262/#sec-object.keys
  // eslint-disable-next-line es/no-object-keys -- safe
  var objectKeys$4 = Object.keys || function keys(O) {
    return internalObjectKeys(O, enumBugKeys$1);
  };

  var DESCRIPTORS$q = descriptors;
  var V8_PROTOTYPE_DEFINE_BUG = v8PrototypeDefineBug;
  var definePropertyModule$3 = objectDefineProperty;
  var anObject$p = anObject$s;
  var toIndexedObject$8 = toIndexedObject$c;
  var objectKeys$3 = objectKeys$4;

  // `Object.defineProperties` method
  // https://tc39.es/ecma262/#sec-object.defineproperties
  // eslint-disable-next-line es/no-object-defineproperties -- safe
  objectDefineProperties.f = DESCRIPTORS$q && !V8_PROTOTYPE_DEFINE_BUG ? Object.defineProperties : function defineProperties(O, Properties) {
    anObject$p(O);
    var props = toIndexedObject$8(Properties);
    var keys = objectKeys$3(Properties);
    var length = keys.length;
    var index = 0;
    var key;
    while (length > index) definePropertyModule$3.f(O, key = keys[index++], props[key]);
    return O;
  };

  var getBuiltIn$c = getBuiltIn$f;

  var html$2 = getBuiltIn$c('document', 'documentElement');

  /* global ActiveXObject -- old IE, WSH */

  var anObject$o = anObject$s;
  var definePropertiesModule$1 = objectDefineProperties;
  var enumBugKeys = enumBugKeys$3;
  var hiddenKeys$2 = hiddenKeys$6;
  var html$1 = html$2;
  var documentCreateElement$1 = documentCreateElement$2;
  var sharedKey$2 = sharedKey$4;

  var GT = '>';
  var LT = '<';
  var PROTOTYPE$2 = 'prototype';
  var SCRIPT = 'script';
  var IE_PROTO$1 = sharedKey$2('IE_PROTO');

  var EmptyConstructor = function () { /* empty */ };

  var scriptTag = function (content) {
    return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;
  };

  // Create object with fake `null` prototype: use ActiveX Object with cleared prototype
  var NullProtoObjectViaActiveX = function (activeXDocument) {
    activeXDocument.write(scriptTag(''));
    activeXDocument.close();
    var temp = activeXDocument.parentWindow.Object;
    activeXDocument = null; // avoid memory leak
    return temp;
  };

  // Create object with fake `null` prototype: use iframe Object with cleared prototype
  var NullProtoObjectViaIFrame = function () {
    // Thrash, waste and sodomy: IE GC bug
    var iframe = documentCreateElement$1('iframe');
    var JS = 'java' + SCRIPT + ':';
    var iframeDocument;
    iframe.style.display = 'none';
    html$1.appendChild(iframe);
    // https://github.com/zloirock/core-js/issues/475
    iframe.src = String(JS);
    iframeDocument = iframe.contentWindow.document;
    iframeDocument.open();
    iframeDocument.write(scriptTag('document.F=Object'));
    iframeDocument.close();
    return iframeDocument.F;
  };

  // Check for document.domain and active x support
  // No need to use active x approach when document.domain is not set
  // see https://github.com/es-shims/es5-shim/issues/150
  // variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346
  // avoid IE GC bug
  var activeXDocument;
  var NullProtoObject = function () {
    try {
      activeXDocument = new ActiveXObject('htmlfile');
    } catch (error) { /* ignore */ }
    NullProtoObject = typeof document != 'undefined'
      ? document.domain && activeXDocument
        ? NullProtoObjectViaActiveX(activeXDocument) // old IE
        : NullProtoObjectViaIFrame()
      : NullProtoObjectViaActiveX(activeXDocument); // WSH
    var length = enumBugKeys.length;
    while (length--) delete NullProtoObject[PROTOTYPE$2][enumBugKeys[length]];
    return NullProtoObject();
  };

  hiddenKeys$2[IE_PROTO$1] = true;

  // `Object.create` method
  // https://tc39.es/ecma262/#sec-object.create
  // eslint-disable-next-line es/no-object-create -- safe
  var objectCreate = Object.create || function create(O, Properties) {
    var result;
    if (O !== null) {
      EmptyConstructor[PROTOTYPE$2] = anObject$o(O);
      result = new EmptyConstructor();
      EmptyConstructor[PROTOTYPE$2] = null;
      // add "__proto__" for Object.getPrototypeOf polyfill
      result[IE_PROTO$1] = O;
    } else result = NullProtoObject();
    return Properties === undefined ? result : definePropertiesModule$1.f(result, Properties);
  };

  var objectGetOwnPropertyNamesExternal = {};

  var toPropertyKey$2 = toPropertyKey$5;
  var definePropertyModule$2 = objectDefineProperty;
  var createPropertyDescriptor$7 = createPropertyDescriptor$a;

  var createProperty$5 = function (object, key, value) {
    var propertyKey = toPropertyKey$2(key);
    if (propertyKey in object) definePropertyModule$2.f(object, propertyKey, createPropertyDescriptor$7(0, value));
    else object[propertyKey] = value;
  };

  var toAbsoluteIndex$6 = toAbsoluteIndex$8;
  var lengthOfArrayLike$k = lengthOfArrayLike$m;
  var createProperty$4 = createProperty$5;

  var $Array$4 = Array;
  var max$4 = Math.max;

  var arraySliceSimple = function (O, start, end) {
    var length = lengthOfArrayLike$k(O);
    var k = toAbsoluteIndex$6(start, length);
    var fin = toAbsoluteIndex$6(end === undefined ? length : end, length);
    var result = $Array$4(max$4(fin - k, 0));
    for (var n = 0; k < fin; k++, n++) createProperty$4(result, n, O[k]);
    result.length = n;
    return result;
  };

  /* eslint-disable es/no-object-getownpropertynames -- safe */

  var classof$h = classofRaw$2;
  var toIndexedObject$7 = toIndexedObject$c;
  var $getOwnPropertyNames$1 = objectGetOwnPropertyNames.f;
  var arraySlice$a = arraySliceSimple;

  var windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames
    ? Object.getOwnPropertyNames(window) : [];

  var getWindowNames = function (it) {
    try {
      return $getOwnPropertyNames$1(it);
    } catch (error) {
      return arraySlice$a(windowNames);
    }
  };

  // fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
  objectGetOwnPropertyNamesExternal.f = function getOwnPropertyNames(it) {
    return windowNames && classof$h(it) == 'Window'
      ? getWindowNames(it)
      : $getOwnPropertyNames$1(toIndexedObject$7(it));
  };

  var makeBuiltIn = makeBuiltInExports;
  var defineProperty$b = objectDefineProperty;

  var defineBuiltInAccessor$g = function (target, name, descriptor) {
    if (descriptor.get) makeBuiltIn(descriptor.get, name, { getter: true });
    if (descriptor.set) makeBuiltIn(descriptor.set, name, { setter: true });
    return defineProperty$b.f(target, name, descriptor);
  };

  var wellKnownSymbolWrapped = {};

  var wellKnownSymbol$t = wellKnownSymbol$x;

  wellKnownSymbolWrapped.f = wellKnownSymbol$t;

  var global$F = global$Q;

  var path$2 = global$F;

  var path$1 = path$2;
  var hasOwn$k = hasOwnProperty_1;
  var wrappedWellKnownSymbolModule$1 = wellKnownSymbolWrapped;
  var defineProperty$a = objectDefineProperty.f;

  var wellKnownSymbolDefine = function (NAME) {
    var Symbol = path$1.Symbol || (path$1.Symbol = {});
    if (!hasOwn$k(Symbol, NAME)) defineProperty$a(Symbol, NAME, {
      value: wrappedWellKnownSymbolModule$1.f(NAME)
    });
  };

  var call$w = functionCall;
  var getBuiltIn$b = getBuiltIn$f;
  var wellKnownSymbol$s = wellKnownSymbol$x;
  var defineBuiltIn$f = defineBuiltIn$h;

  var symbolDefineToPrimitive = function () {
    var Symbol = getBuiltIn$b('Symbol');
    var SymbolPrototype = Symbol && Symbol.prototype;
    var valueOf = SymbolPrototype && SymbolPrototype.valueOf;
    var TO_PRIMITIVE = wellKnownSymbol$s('toPrimitive');

    if (SymbolPrototype && !SymbolPrototype[TO_PRIMITIVE]) {
      // `Symbol.prototype[@@toPrimitive]` method
      // https://tc39.es/ecma262/#sec-symbol.prototype-@@toprimitive
      // eslint-disable-next-line no-unused-vars -- required for .length
      defineBuiltIn$f(SymbolPrototype, TO_PRIMITIVE, function (hint) {
        return call$w(valueOf, this);
      }, { arity: 1 });
    }
  };

  var defineProperty$9 = objectDefineProperty.f;
  var hasOwn$j = hasOwnProperty_1;
  var wellKnownSymbol$r = wellKnownSymbol$x;

  var TO_STRING_TAG$4 = wellKnownSymbol$r('toStringTag');

  var setToStringTag$9 = function (target, TAG, STATIC) {
    if (target && !STATIC) target = target.prototype;
    if (target && !hasOwn$j(target, TO_STRING_TAG$4)) {
      defineProperty$9(target, TO_STRING_TAG$4, { configurable: true, value: TAG });
    }
  };

  var classofRaw = classofRaw$2;
  var uncurryThis$O = functionUncurryThis;

  var functionUncurryThisClause = function (fn) {
    // Nashorn bug:
    //   https://github.com/zloirock/core-js/issues/1128
    //   https://github.com/zloirock/core-js/issues/1130
    if (classofRaw(fn) === 'Function') return uncurryThis$O(fn);
  };

  var uncurryThis$N = functionUncurryThisClause;
  var aCallable$f = aCallable$h;
  var NATIVE_BIND$1 = functionBindNative;

  var bind$b = uncurryThis$N(uncurryThis$N.bind);

  // optional / simple context binding
  var functionBindContext = function (fn, that) {
    aCallable$f(fn);
    return that === undefined ? fn : NATIVE_BIND$1 ? bind$b(fn, that) : function (/* ...args */) {
      return fn.apply(that, arguments);
    };
  };

  var classof$g = classofRaw$2;

  // `IsArray` abstract operation
  // https://tc39.es/ecma262/#sec-isarray
  // eslint-disable-next-line es/no-array-isarray -- safe
  var isArray$6 = Array.isArray || function isArray(argument) {
    return classof$g(argument) == 'Array';
  };

  var uncurryThis$M = functionUncurryThis;
  var fails$M = fails$V;
  var isCallable$l = isCallable$x;
  var classof$f = classof$j;
  var getBuiltIn$a = getBuiltIn$f;
  var inspectSource$1 = inspectSource$3;

  var noop = function () { /* empty */ };
  var empty = [];
  var construct = getBuiltIn$a('Reflect', 'construct');
  var constructorRegExp = /^\s*(?:class|function)\b/;
  var exec$8 = uncurryThis$M(constructorRegExp.exec);
  var INCORRECT_TO_STRING$2 = !constructorRegExp.exec(noop);

  var isConstructorModern = function isConstructor(argument) {
    if (!isCallable$l(argument)) return false;
    try {
      construct(noop, empty, argument);
      return true;
    } catch (error) {
      return false;
    }
  };

  var isConstructorLegacy = function isConstructor(argument) {
    if (!isCallable$l(argument)) return false;
    switch (classof$f(argument)) {
      case 'AsyncFunction':
      case 'GeneratorFunction':
      case 'AsyncGeneratorFunction': return false;
    }
    try {
      // we can't check .prototype since constructors produced by .bind haven't it
      // `Function#toString` throws on some built-it function in some legacy engines
      // (for example, `DOMQuad` and similar in FF41-)
      return INCORRECT_TO_STRING$2 || !!exec$8(constructorRegExp, inspectSource$1(argument));
    } catch (error) {
      return true;
    }
  };

  isConstructorLegacy.sham = true;

  // `IsConstructor` abstract operation
  // https://tc39.es/ecma262/#sec-isconstructor
  var isConstructor$4 = !construct || fails$M(function () {
    var called;
    return isConstructorModern(isConstructorModern.call)
      || !isConstructorModern(Object)
      || !isConstructorModern(function () { called = true; })
      || called;
  }) ? isConstructorLegacy : isConstructorModern;

  var isArray$5 = isArray$6;
  var isConstructor$3 = isConstructor$4;
  var isObject$f = isObject$l;
  var wellKnownSymbol$q = wellKnownSymbol$x;

  var SPECIES$6 = wellKnownSymbol$q('species');
  var $Array$3 = Array;

  // a part of `ArraySpeciesCreate` abstract operation
  // https://tc39.es/ecma262/#sec-arrayspeciescreate
  var arraySpeciesConstructor$1 = function (originalArray) {
    var C;
    if (isArray$5(originalArray)) {
      C = originalArray.constructor;
      // cross-realm fallback
      if (isConstructor$3(C) && (C === $Array$3 || isArray$5(C.prototype))) C = undefined;
      else if (isObject$f(C)) {
        C = C[SPECIES$6];
        if (C === null) C = undefined;
      }
    } return C === undefined ? $Array$3 : C;
  };

  var arraySpeciesConstructor = arraySpeciesConstructor$1;

  // `ArraySpeciesCreate` abstract operation
  // https://tc39.es/ecma262/#sec-arrayspeciescreate
  var arraySpeciesCreate$3 = function (originalArray, length) {
    return new (arraySpeciesConstructor(originalArray))(length === 0 ? 0 : length);
  };

  var bind$a = functionBindContext;
  var uncurryThis$L = functionUncurryThis;
  var IndexedObject$4 = indexedObject;
  var toObject$f = toObject$h;
  var lengthOfArrayLike$j = lengthOfArrayLike$m;
  var arraySpeciesCreate$2 = arraySpeciesCreate$3;

  var push$9 = uncurryThis$L([].push);

  // `Array.prototype.{ forEach, map, filter, some, every, find, findIndex, filterReject }` methods implementation
  var createMethod$5 = function (TYPE) {
    var IS_MAP = TYPE == 1;
    var IS_FILTER = TYPE == 2;
    var IS_SOME = TYPE == 3;
    var IS_EVERY = TYPE == 4;
    var IS_FIND_INDEX = TYPE == 6;
    var IS_FILTER_REJECT = TYPE == 7;
    var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;
    return function ($this, callbackfn, that, specificCreate) {
      var O = toObject$f($this);
      var self = IndexedObject$4(O);
      var boundFunction = bind$a(callbackfn, that);
      var length = lengthOfArrayLike$j(self);
      var index = 0;
      var create = specificCreate || arraySpeciesCreate$2;
      var target = IS_MAP ? create($this, length) : IS_FILTER || IS_FILTER_REJECT ? create($this, 0) : undefined;
      var value, result;
      for (;length > index; index++) if (NO_HOLES || index in self) {
        value = self[index];
        result = boundFunction(value, index, O);
        if (TYPE) {
          if (IS_MAP) target[index] = result; // map
          else if (result) switch (TYPE) {
            case 3: return true;              // some
            case 5: return value;             // find
            case 6: return index;             // findIndex
            case 2: push$9(target, value);      // filter
          } else switch (TYPE) {
            case 4: return false;             // every
            case 7: push$9(target, value);      // filterReject
          }
        }
      }
      return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : target;
    };
  };

  var arrayIteration = {
    // `Array.prototype.forEach` method
    // https://tc39.es/ecma262/#sec-array.prototype.foreach
    forEach: createMethod$5(0),
    // `Array.prototype.map` method
    // https://tc39.es/ecma262/#sec-array.prototype.map
    map: createMethod$5(1),
    // `Array.prototype.filter` method
    // https://tc39.es/ecma262/#sec-array.prototype.filter
    filter: createMethod$5(2),
    // `Array.prototype.some` method
    // https://tc39.es/ecma262/#sec-array.prototype.some
    some: createMethod$5(3),
    // `Array.prototype.every` method
    // https://tc39.es/ecma262/#sec-array.prototype.every
    every: createMethod$5(4),
    // `Array.prototype.find` method
    // https://tc39.es/ecma262/#sec-array.prototype.find
    find: createMethod$5(5),
    // `Array.prototype.findIndex` method
    // https://tc39.es/ecma262/#sec-array.prototype.findIndex
    findIndex: createMethod$5(6)};

  var $$11 = _export;
  var global$E = global$Q;
  var call$v = functionCall;
  var uncurryThis$K = functionUncurryThis;
  var DESCRIPTORS$p = descriptors;
  var NATIVE_SYMBOL$4 = symbolConstructorDetection;
  var fails$L = fails$V;
  var hasOwn$i = hasOwnProperty_1;
  var isPrototypeOf$9 = objectIsPrototypeOf;
  var anObject$n = anObject$s;
  var toIndexedObject$6 = toIndexedObject$c;
  var toPropertyKey$1 = toPropertyKey$5;
  var $toString$3 = toString$n;
  var createPropertyDescriptor$6 = createPropertyDescriptor$a;
  var nativeObjectCreate = objectCreate;
  var objectKeys$2 = objectKeys$4;
  var getOwnPropertyNamesModule$1 = objectGetOwnPropertyNames;
  var getOwnPropertyNamesExternal = objectGetOwnPropertyNamesExternal;
  var getOwnPropertySymbolsModule$2 = objectGetOwnPropertySymbols;
  var getOwnPropertyDescriptorModule$1 = objectGetOwnPropertyDescriptor;
  var definePropertyModule$1 = objectDefineProperty;
  var definePropertiesModule = objectDefineProperties;
  var propertyIsEnumerableModule$1 = objectPropertyIsEnumerable;
  var defineBuiltIn$e = defineBuiltIn$h;
  var defineBuiltInAccessor$f = defineBuiltInAccessor$g;
  var shared$3 = sharedExports;
  var sharedKey$1 = sharedKey$4;
  var hiddenKeys$1 = hiddenKeys$6;
  var uid$2 = uid$5;
  var wellKnownSymbol$p = wellKnownSymbol$x;
  var wrappedWellKnownSymbolModule = wellKnownSymbolWrapped;
  var defineWellKnownSymbol = wellKnownSymbolDefine;
  var defineSymbolToPrimitive = symbolDefineToPrimitive;
  var setToStringTag$8 = setToStringTag$9;
  var InternalStateModule$b = internalState;
  var $forEach$2 = arrayIteration.forEach;

  var HIDDEN = sharedKey$1('hidden');
  var SYMBOL = 'Symbol';
  var PROTOTYPE$1 = 'prototype';

  var setInternalState$a = InternalStateModule$b.set;
  var getInternalState$8 = InternalStateModule$b.getterFor(SYMBOL);

  var ObjectPrototype$3 = Object[PROTOTYPE$1];
  var $Symbol = global$E.Symbol;
  var SymbolPrototype$1 = $Symbol && $Symbol[PROTOTYPE$1];
  var TypeError$7 = global$E.TypeError;
  var QObject = global$E.QObject;
  var nativeGetOwnPropertyDescriptor$1 = getOwnPropertyDescriptorModule$1.f;
  var nativeDefineProperty$1 = definePropertyModule$1.f;
  var nativeGetOwnPropertyNames = getOwnPropertyNamesExternal.f;
  var nativePropertyIsEnumerable = propertyIsEnumerableModule$1.f;
  var push$8 = uncurryThis$K([].push);

  var AllSymbols = shared$3('symbols');
  var ObjectPrototypeSymbols = shared$3('op-symbols');
  var WellKnownSymbolsStore = shared$3('wks');

  // Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173
  var USE_SETTER = !QObject || !QObject[PROTOTYPE$1] || !QObject[PROTOTYPE$1].findChild;

  // fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687
  var setSymbolDescriptor = DESCRIPTORS$p && fails$L(function () {
    return nativeObjectCreate(nativeDefineProperty$1({}, 'a', {
      get: function () { return nativeDefineProperty$1(this, 'a', { value: 7 }).a; }
    })).a != 7;
  }) ? function (O, P, Attributes) {
    var ObjectPrototypeDescriptor = nativeGetOwnPropertyDescriptor$1(ObjectPrototype$3, P);
    if (ObjectPrototypeDescriptor) delete ObjectPrototype$3[P];
    nativeDefineProperty$1(O, P, Attributes);
    if (ObjectPrototypeDescriptor && O !== ObjectPrototype$3) {
      nativeDefineProperty$1(ObjectPrototype$3, P, ObjectPrototypeDescriptor);
    }
  } : nativeDefineProperty$1;

  var wrap = function (tag, description) {
    var symbol = AllSymbols[tag] = nativeObjectCreate(SymbolPrototype$1);
    setInternalState$a(symbol, {
      type: SYMBOL,
      tag: tag,
      description: description
    });
    if (!DESCRIPTORS$p) symbol.description = description;
    return symbol;
  };

  var $defineProperty = function defineProperty(O, P, Attributes) {
    if (O === ObjectPrototype$3) $defineProperty(ObjectPrototypeSymbols, P, Attributes);
    anObject$n(O);
    var key = toPropertyKey$1(P);
    anObject$n(Attributes);
    if (hasOwn$i(AllSymbols, key)) {
      if (!Attributes.enumerable) {
        if (!hasOwn$i(O, HIDDEN)) nativeDefineProperty$1(O, HIDDEN, createPropertyDescriptor$6(1, {}));
        O[HIDDEN][key] = true;
      } else {
        if (hasOwn$i(O, HIDDEN) && O[HIDDEN][key]) O[HIDDEN][key] = false;
        Attributes = nativeObjectCreate(Attributes, { enumerable: createPropertyDescriptor$6(0, false) });
      } return setSymbolDescriptor(O, key, Attributes);
    } return nativeDefineProperty$1(O, key, Attributes);
  };

  var $defineProperties = function defineProperties(O, Properties) {
    anObject$n(O);
    var properties = toIndexedObject$6(Properties);
    var keys = objectKeys$2(properties).concat($getOwnPropertySymbols(properties));
    $forEach$2(keys, function (key) {
      if (!DESCRIPTORS$p || call$v($propertyIsEnumerable$1, properties, key)) $defineProperty(O, key, properties[key]);
    });
    return O;
  };

  var $create = function create(O, Properties) {
    return Properties === undefined ? nativeObjectCreate(O) : $defineProperties(nativeObjectCreate(O), Properties);
  };

  var $propertyIsEnumerable$1 = function propertyIsEnumerable(V) {
    var P = toPropertyKey$1(V);
    var enumerable = call$v(nativePropertyIsEnumerable, this, P);
    if (this === ObjectPrototype$3 && hasOwn$i(AllSymbols, P) && !hasOwn$i(ObjectPrototypeSymbols, P)) return false;
    return enumerable || !hasOwn$i(this, P) || !hasOwn$i(AllSymbols, P) || hasOwn$i(this, HIDDEN) && this[HIDDEN][P]
      ? enumerable : true;
  };

  var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(O, P) {
    var it = toIndexedObject$6(O);
    var key = toPropertyKey$1(P);
    if (it === ObjectPrototype$3 && hasOwn$i(AllSymbols, key) && !hasOwn$i(ObjectPrototypeSymbols, key)) return;
    var descriptor = nativeGetOwnPropertyDescriptor$1(it, key);
    if (descriptor && hasOwn$i(AllSymbols, key) && !(hasOwn$i(it, HIDDEN) && it[HIDDEN][key])) {
      descriptor.enumerable = true;
    }
    return descriptor;
  };

  var $getOwnPropertyNames = function getOwnPropertyNames(O) {
    var names = nativeGetOwnPropertyNames(toIndexedObject$6(O));
    var result = [];
    $forEach$2(names, function (key) {
      if (!hasOwn$i(AllSymbols, key) && !hasOwn$i(hiddenKeys$1, key)) push$8(result, key);
    });
    return result;
  };

  var $getOwnPropertySymbols = function (O) {
    var IS_OBJECT_PROTOTYPE = O === ObjectPrototype$3;
    var names = nativeGetOwnPropertyNames(IS_OBJECT_PROTOTYPE ? ObjectPrototypeSymbols : toIndexedObject$6(O));
    var result = [];
    $forEach$2(names, function (key) {
      if (hasOwn$i(AllSymbols, key) && (!IS_OBJECT_PROTOTYPE || hasOwn$i(ObjectPrototype$3, key))) {
        push$8(result, AllSymbols[key]);
      }
    });
    return result;
  };

  // `Symbol` constructor
  // https://tc39.es/ecma262/#sec-symbol-constructor
  if (!NATIVE_SYMBOL$4) {
    $Symbol = function Symbol() {
      if (isPrototypeOf$9(SymbolPrototype$1, this)) throw TypeError$7('Symbol is not a constructor');
      var description = !arguments.length || arguments[0] === undefined ? undefined : $toString$3(arguments[0]);
      var tag = uid$2(description);
      var setter = function (value) {
        if (this === ObjectPrototype$3) call$v(setter, ObjectPrototypeSymbols, value);
        if (hasOwn$i(this, HIDDEN) && hasOwn$i(this[HIDDEN], tag)) this[HIDDEN][tag] = false;
        setSymbolDescriptor(this, tag, createPropertyDescriptor$6(1, value));
      };
      if (DESCRIPTORS$p && USE_SETTER) setSymbolDescriptor(ObjectPrototype$3, tag, { configurable: true, set: setter });
      return wrap(tag, description);
    };

    SymbolPrototype$1 = $Symbol[PROTOTYPE$1];

    defineBuiltIn$e(SymbolPrototype$1, 'toString', function toString() {
      return getInternalState$8(this).tag;
    });

    defineBuiltIn$e($Symbol, 'withoutSetter', function (description) {
      return wrap(uid$2(description), description);
    });

    propertyIsEnumerableModule$1.f = $propertyIsEnumerable$1;
    definePropertyModule$1.f = $defineProperty;
    definePropertiesModule.f = $defineProperties;
    getOwnPropertyDescriptorModule$1.f = $getOwnPropertyDescriptor;
    getOwnPropertyNamesModule$1.f = getOwnPropertyNamesExternal.f = $getOwnPropertyNames;
    getOwnPropertySymbolsModule$2.f = $getOwnPropertySymbols;

    wrappedWellKnownSymbolModule.f = function (name) {
      return wrap(wellKnownSymbol$p(name), name);
    };

    if (DESCRIPTORS$p) {
      // https://github.com/tc39/proposal-Symbol-description
      defineBuiltInAccessor$f(SymbolPrototype$1, 'description', {
        configurable: true,
        get: function description() {
          return getInternalState$8(this).description;
        }
      });
      {
        defineBuiltIn$e(ObjectPrototype$3, 'propertyIsEnumerable', $propertyIsEnumerable$1, { unsafe: true });
      }
    }
  }

  $$11({ global: true, constructor: true, wrap: true, forced: !NATIVE_SYMBOL$4, sham: !NATIVE_SYMBOL$4 }, {
    Symbol: $Symbol
  });

  $forEach$2(objectKeys$2(WellKnownSymbolsStore), function (name) {
    defineWellKnownSymbol(name);
  });

  $$11({ target: SYMBOL, stat: true, forced: !NATIVE_SYMBOL$4 }, {
    useSetter: function () { USE_SETTER = true; },
    useSimple: function () { USE_SETTER = false; }
  });

  $$11({ target: 'Object', stat: true, forced: !NATIVE_SYMBOL$4, sham: !DESCRIPTORS$p }, {
    // `Object.create` method
    // https://tc39.es/ecma262/#sec-object.create
    create: $create,
    // `Object.defineProperty` method
    // https://tc39.es/ecma262/#sec-object.defineproperty
    defineProperty: $defineProperty,
    // `Object.defineProperties` method
    // https://tc39.es/ecma262/#sec-object.defineproperties
    defineProperties: $defineProperties,
    // `Object.getOwnPropertyDescriptor` method
    // https://tc39.es/ecma262/#sec-object.getownpropertydescriptors
    getOwnPropertyDescriptor: $getOwnPropertyDescriptor
  });

  $$11({ target: 'Object', stat: true, forced: !NATIVE_SYMBOL$4 }, {
    // `Object.getOwnPropertyNames` method
    // https://tc39.es/ecma262/#sec-object.getownpropertynames
    getOwnPropertyNames: $getOwnPropertyNames
  });

  // `Symbol.prototype[@@toPrimitive]` method
  // https://tc39.es/ecma262/#sec-symbol.prototype-@@toprimitive
  defineSymbolToPrimitive();

  // `Symbol.prototype[@@toStringTag]` property
  // https://tc39.es/ecma262/#sec-symbol.prototype-@@tostringtag
  setToStringTag$8($Symbol, SYMBOL);

  hiddenKeys$1[HIDDEN] = true;

  var NATIVE_SYMBOL$3 = symbolConstructorDetection;

  /* eslint-disable es/no-symbol -- safe */
  var symbolRegistryDetection = NATIVE_SYMBOL$3 && !!Symbol['for'] && !!Symbol.keyFor;

  var $$10 = _export;
  var getBuiltIn$9 = getBuiltIn$f;
  var hasOwn$h = hasOwnProperty_1;
  var toString$m = toString$n;
  var shared$2 = sharedExports;
  var NATIVE_SYMBOL_REGISTRY$1 = symbolRegistryDetection;

  var StringToSymbolRegistry = shared$2('string-to-symbol-registry');
  var SymbolToStringRegistry$1 = shared$2('symbol-to-string-registry');

  // `Symbol.for` method
  // https://tc39.es/ecma262/#sec-symbol.for
  $$10({ target: 'Symbol', stat: true, forced: !NATIVE_SYMBOL_REGISTRY$1 }, {
    'for': function (key) {
      var string = toString$m(key);
      if (hasOwn$h(StringToSymbolRegistry, string)) return StringToSymbolRegistry[string];
      var symbol = getBuiltIn$9('Symbol')(string);
      StringToSymbolRegistry[string] = symbol;
      SymbolToStringRegistry$1[symbol] = string;
      return symbol;
    }
  });

  var $$$ = _export;
  var hasOwn$g = hasOwnProperty_1;
  var isSymbol$3 = isSymbol$6;
  var tryToString$5 = tryToString$7;
  var shared$1 = sharedExports;
  var NATIVE_SYMBOL_REGISTRY = symbolRegistryDetection;

  var SymbolToStringRegistry = shared$1('symbol-to-string-registry');

  // `Symbol.keyFor` method
  // https://tc39.es/ecma262/#sec-symbol.keyfor
  $$$({ target: 'Symbol', stat: true, forced: !NATIVE_SYMBOL_REGISTRY }, {
    keyFor: function keyFor(sym) {
      if (!isSymbol$3(sym)) throw TypeError(tryToString$5(sym) + ' is not a symbol');
      if (hasOwn$g(SymbolToStringRegistry, sym)) return SymbolToStringRegistry[sym];
    }
  });

  var NATIVE_BIND = functionBindNative;

  var FunctionPrototype$1 = Function.prototype;
  var apply$9 = FunctionPrototype$1.apply;
  var call$u = FunctionPrototype$1.call;

  // eslint-disable-next-line es/no-reflect -- safe
  var functionApply = typeof Reflect == 'object' && Reflect.apply || (NATIVE_BIND ? call$u.bind(apply$9) : function () {
    return call$u.apply(apply$9, arguments);
  });

  var uncurryThis$J = functionUncurryThis;

  var arraySlice$9 = uncurryThis$J([].slice);

  var uncurryThis$I = functionUncurryThis;
  var isArray$4 = isArray$6;
  var isCallable$k = isCallable$x;
  var classof$e = classofRaw$2;
  var toString$l = toString$n;

  var push$7 = uncurryThis$I([].push);

  var getJsonReplacerFunction = function (replacer) {
    if (isCallable$k(replacer)) return replacer;
    if (!isArray$4(replacer)) return;
    var rawLength = replacer.length;
    var keys = [];
    for (var i = 0; i < rawLength; i++) {
      var element = replacer[i];
      if (typeof element == 'string') push$7(keys, element);
      else if (typeof element == 'number' || classof$e(element) == 'Number' || classof$e(element) == 'String') push$7(keys, toString$l(element));
    }
    var keysLength = keys.length;
    var root = true;
    return function (key, value) {
      if (root) {
        root = false;
        return value;
      }
      if (isArray$4(this)) return value;
      for (var j = 0; j < keysLength; j++) if (keys[j] === key) return value;
    };
  };

  var $$_ = _export;
  var getBuiltIn$8 = getBuiltIn$f;
  var apply$8 = functionApply;
  var call$t = functionCall;
  var uncurryThis$H = functionUncurryThis;
  var fails$K = fails$V;
  var isCallable$j = isCallable$x;
  var isSymbol$2 = isSymbol$6;
  var arraySlice$8 = arraySlice$9;
  var getReplacerFunction = getJsonReplacerFunction;
  var NATIVE_SYMBOL$2 = symbolConstructorDetection;

  var $String$2 = String;
  var $stringify = getBuiltIn$8('JSON', 'stringify');
  var exec$7 = uncurryThis$H(/./.exec);
  var charAt$a = uncurryThis$H(''.charAt);
  var charCodeAt$3 = uncurryThis$H(''.charCodeAt);
  var replace$a = uncurryThis$H(''.replace);
  var numberToString$1 = uncurryThis$H(1.0.toString);

  var tester = /[\uD800-\uDFFF]/g;
  var low = /^[\uD800-\uDBFF]$/;
  var hi = /^[\uDC00-\uDFFF]$/;

  var WRONG_SYMBOLS_CONVERSION = !NATIVE_SYMBOL$2 || fails$K(function () {
    var symbol = getBuiltIn$8('Symbol')();
    // MS Edge converts symbol values to JSON as {}
    return $stringify([symbol]) != '[null]'
      // WebKit converts symbol values to JSON as null
      || $stringify({ a: symbol }) != '{}'
      // V8 throws on boxed symbols
      || $stringify(Object(symbol)) != '{}';
  });

  // https://github.com/tc39/proposal-well-formed-stringify
  var ILL_FORMED_UNICODE = fails$K(function () {
    return $stringify('\uDF06\uD834') !== '"\\udf06\\ud834"'
      || $stringify('\uDEAD') !== '"\\udead"';
  });

  var stringifyWithSymbolsFix = function (it, replacer) {
    var args = arraySlice$8(arguments);
    var $replacer = getReplacerFunction(replacer);
    if (!isCallable$j($replacer) && (it === undefined || isSymbol$2(it))) return; // IE8 returns string on undefined
    args[1] = function (key, value) {
      // some old implementations (like WebKit) could pass numbers as keys
      if (isCallable$j($replacer)) value = call$t($replacer, this, $String$2(key), value);
      if (!isSymbol$2(value)) return value;
    };
    return apply$8($stringify, null, args);
  };

  var fixIllFormed = function (match, offset, string) {
    var prev = charAt$a(string, offset - 1);
    var next = charAt$a(string, offset + 1);
    if ((exec$7(low, match) && !exec$7(hi, next)) || (exec$7(hi, match) && !exec$7(low, prev))) {
      return '\\u' + numberToString$1(charCodeAt$3(match, 0), 16);
    } return match;
  };

  if ($stringify) {
    // `JSON.stringify` method
    // https://tc39.es/ecma262/#sec-json.stringify
    $$_({ target: 'JSON', stat: true, arity: 3, forced: WRONG_SYMBOLS_CONVERSION || ILL_FORMED_UNICODE }, {
      // eslint-disable-next-line no-unused-vars -- required for `.length`
      stringify: function stringify(it, replacer, space) {
        var args = arraySlice$8(arguments);
        var result = apply$8(WRONG_SYMBOLS_CONVERSION ? stringifyWithSymbolsFix : $stringify, null, args);
        return ILL_FORMED_UNICODE && typeof result == 'string' ? replace$a(result, tester, fixIllFormed) : result;
      }
    });
  }

  var $$Z = _export;
  var NATIVE_SYMBOL$1 = symbolConstructorDetection;
  var fails$J = fails$V;
  var getOwnPropertySymbolsModule$1 = objectGetOwnPropertySymbols;
  var toObject$e = toObject$h;

  // V8 ~ Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives
  // https://bugs.chromium.org/p/v8/issues/detail?id=3443
  var FORCED$f = !NATIVE_SYMBOL$1 || fails$J(function () { getOwnPropertySymbolsModule$1.f(1); });

  // `Object.getOwnPropertySymbols` method
  // https://tc39.es/ecma262/#sec-object.getownpropertysymbols
  $$Z({ target: 'Object', stat: true, forced: FORCED$f }, {
    getOwnPropertySymbols: function getOwnPropertySymbols(it) {
      var $getOwnPropertySymbols = getOwnPropertySymbolsModule$1.f;
      return $getOwnPropertySymbols ? $getOwnPropertySymbols(toObject$e(it)) : [];
    }
  });

  var $$Y = _export;
  var DESCRIPTORS$o = descriptors;
  var global$D = global$Q;
  var uncurryThis$G = functionUncurryThis;
  var hasOwn$f = hasOwnProperty_1;
  var isCallable$i = isCallable$x;
  var isPrototypeOf$8 = objectIsPrototypeOf;
  var toString$k = toString$n;
  var defineBuiltInAccessor$e = defineBuiltInAccessor$g;
  var copyConstructorProperties$2 = copyConstructorProperties$4;

  var NativeSymbol = global$D.Symbol;
  var SymbolPrototype = NativeSymbol && NativeSymbol.prototype;

  if (DESCRIPTORS$o && isCallable$i(NativeSymbol) && (!('description' in SymbolPrototype) ||
    // Safari 12 bug
    NativeSymbol().description !== undefined
  )) {
    var EmptyStringDescriptionStore = {};
    // wrap Symbol constructor for correct work with undefined description
    var SymbolWrapper = function Symbol() {
      var description = arguments.length < 1 || arguments[0] === undefined ? undefined : toString$k(arguments[0]);
      var result = isPrototypeOf$8(SymbolPrototype, this)
        ? new NativeSymbol(description)
        // in Edge 13, String(Symbol(undefined)) === 'Symbol(undefined)'
        : description === undefined ? NativeSymbol() : NativeSymbol(description);
      if (description === '') EmptyStringDescriptionStore[result] = true;
      return result;
    };

    copyConstructorProperties$2(SymbolWrapper, NativeSymbol);
    SymbolWrapper.prototype = SymbolPrototype;
    SymbolPrototype.constructor = SymbolWrapper;

    var NATIVE_SYMBOL = String(NativeSymbol('test')) == 'Symbol(test)';
    var thisSymbolValue = uncurryThis$G(SymbolPrototype.valueOf);
    var symbolDescriptiveString = uncurryThis$G(SymbolPrototype.toString);
    var regexp = /^Symbol\((.*)\)[^)]+$/;
    var replace$9 = uncurryThis$G(''.replace);
    var stringSlice$c = uncurryThis$G(''.slice);

    defineBuiltInAccessor$e(SymbolPrototype, 'description', {
      configurable: true,
      get: function description() {
        var symbol = thisSymbolValue(this);
        if (hasOwn$f(EmptyStringDescriptionStore, symbol)) return '';
        var string = symbolDescriptiveString(symbol);
        var desc = NATIVE_SYMBOL ? stringSlice$c(string, 7, -1) : replace$9(string, regexp, '$1');
        return desc === '' ? undefined : desc;
      }
    });

    $$Y({ global: true, constructor: true, forced: true }, {
      Symbol: SymbolWrapper
    });
  }

  var uncurryThis$F = functionUncurryThis;
  var aCallable$e = aCallable$h;

  var functionUncurryThisAccessor = function (object, key, method) {
    try {
      // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
      return uncurryThis$F(aCallable$e(Object.getOwnPropertyDescriptor(object, key)[method]));
    } catch (error) { /* empty */ }
  };

  var isCallable$h = isCallable$x;

  var $String$1 = String;
  var $TypeError$i = TypeError;

  var aPossiblePrototype$1 = function (argument) {
    if (typeof argument == 'object' || isCallable$h(argument)) return argument;
    throw $TypeError$i("Can't set " + $String$1(argument) + ' as a prototype');
  };

  /* eslint-disable no-proto -- safe */

  var uncurryThisAccessor$2 = functionUncurryThisAccessor;
  var anObject$m = anObject$s;
  var aPossiblePrototype = aPossiblePrototype$1;

  // `Object.setPrototypeOf` method
  // https://tc39.es/ecma262/#sec-object.setprototypeof
  // Works with __proto__ only. Old v8 can't work with null proto objects.
  // eslint-disable-next-line es/no-object-setprototypeof -- safe
  var objectSetPrototypeOf = Object.setPrototypeOf || ('__proto__' in {} ? function () {
    var CORRECT_SETTER = false;
    var test = {};
    var setter;
    try {
      setter = uncurryThisAccessor$2(Object.prototype, '__proto__', 'set');
      setter(test, []);
      CORRECT_SETTER = test instanceof Array;
    } catch (error) { /* empty */ }
    return function setPrototypeOf(O, proto) {
      anObject$m(O);
      aPossiblePrototype(proto);
      if (CORRECT_SETTER) setter(O, proto);
      else O.__proto__ = proto;
      return O;
    };
  }() : undefined);

  var defineProperty$8 = objectDefineProperty.f;

  var proxyAccessor$2 = function (Target, Source, key) {
    key in Target || defineProperty$8(Target, key, {
      configurable: true,
      get: function () { return Source[key]; },
      set: function (it) { Source[key] = it; }
    });
  };

  var isCallable$g = isCallable$x;
  var isObject$e = isObject$l;
  var setPrototypeOf$6 = objectSetPrototypeOf;

  // makes subclassing work correct for wrapped built-ins
  var inheritIfRequired$6 = function ($this, dummy, Wrapper) {
    var NewTarget, NewTargetPrototype;
    if (
      // it can work only with native `setPrototypeOf`
      setPrototypeOf$6 &&
      // we haven't completely correct pre-ES6 way for getting `new.target`, so use this
      isCallable$g(NewTarget = dummy.constructor) &&
      NewTarget !== Wrapper &&
      isObject$e(NewTargetPrototype = NewTarget.prototype) &&
      NewTargetPrototype !== Wrapper.prototype
    ) setPrototypeOf$6($this, NewTargetPrototype);
    return $this;
  };

  var toString$j = toString$n;

  var normalizeStringArgument$4 = function (argument, $default) {
    return argument === undefined ? arguments.length < 2 ? '' : $default : toString$j(argument);
  };

  var isObject$d = isObject$l;
  var createNonEnumerableProperty$c = createNonEnumerableProperty$f;

  // `InstallErrorCause` abstract operation
  // https://tc39.es/proposal-error-cause/#sec-errorobjects-install-error-cause
  var installErrorCause$1 = function (O, options) {
    if (isObject$d(options) && 'cause' in options) {
      createNonEnumerableProperty$c(O, 'cause', options.cause);
    }
  };

  var uncurryThis$E = functionUncurryThis;

  var $Error = Error;
  var replace$8 = uncurryThis$E(''.replace);

  var TEST = (function (arg) { return String($Error(arg).stack); })('zxcasd');
  // eslint-disable-next-line redos/no-vulnerable -- safe
  var V8_OR_CHAKRA_STACK_ENTRY = /\n\s*at [^:]*:[^\n]*/;
  var IS_V8_OR_CHAKRA_STACK = V8_OR_CHAKRA_STACK_ENTRY.test(TEST);

  var errorStackClear = function (stack, dropEntries) {
    if (IS_V8_OR_CHAKRA_STACK && typeof stack == 'string' && !$Error.prepareStackTrace) {
      while (dropEntries--) stack = replace$8(stack, V8_OR_CHAKRA_STACK_ENTRY, '');
    } return stack;
  };

  var fails$I = fails$V;
  var createPropertyDescriptor$5 = createPropertyDescriptor$a;

  var errorStackInstallable = !fails$I(function () {
    var error = Error('a');
    if (!('stack' in error)) return true;
    // eslint-disable-next-line es/no-object-defineproperty -- safe
    Object.defineProperty(error, 'stack', createPropertyDescriptor$5(1, 7));
    return error.stack !== 7;
  });

  var createNonEnumerableProperty$b = createNonEnumerableProperty$f;
  var clearErrorStack$2 = errorStackClear;
  var ERROR_STACK_INSTALLABLE = errorStackInstallable;

  // non-standard V8
  var captureStackTrace = Error.captureStackTrace;

  var errorStackInstall = function (error, C, stack, dropEntries) {
    if (ERROR_STACK_INSTALLABLE) {
      if (captureStackTrace) captureStackTrace(error, C);
      else createNonEnumerableProperty$b(error, 'stack', clearErrorStack$2(stack, dropEntries));
    }
  };

  var getBuiltIn$7 = getBuiltIn$f;
  var hasOwn$e = hasOwnProperty_1;
  var createNonEnumerableProperty$a = createNonEnumerableProperty$f;
  var isPrototypeOf$7 = objectIsPrototypeOf;
  var setPrototypeOf$5 = objectSetPrototypeOf;
  var copyConstructorProperties$1 = copyConstructorProperties$4;
  var proxyAccessor$1 = proxyAccessor$2;
  var inheritIfRequired$5 = inheritIfRequired$6;
  var normalizeStringArgument$3 = normalizeStringArgument$4;
  var installErrorCause = installErrorCause$1;
  var installErrorStack = errorStackInstall;
  var DESCRIPTORS$n = descriptors;

  var wrapErrorConstructorWithCause$1 = function (FULL_NAME, wrapper, FORCED, IS_AGGREGATE_ERROR) {
    var STACK_TRACE_LIMIT = 'stackTraceLimit';
    var OPTIONS_POSITION = IS_AGGREGATE_ERROR ? 2 : 1;
    var path = FULL_NAME.split('.');
    var ERROR_NAME = path[path.length - 1];
    var OriginalError = getBuiltIn$7.apply(null, path);

    if (!OriginalError) return;

    var OriginalErrorPrototype = OriginalError.prototype;

    // V8 9.3- bug https://bugs.chromium.org/p/v8/issues/detail?id=12006
    if (hasOwn$e(OriginalErrorPrototype, 'cause')) delete OriginalErrorPrototype.cause;

    if (!FORCED) return OriginalError;

    var BaseError = getBuiltIn$7('Error');

    var WrappedError = wrapper(function (a, b) {
      var message = normalizeStringArgument$3(IS_AGGREGATE_ERROR ? b : a, undefined);
      var result = IS_AGGREGATE_ERROR ? new OriginalError(a) : new OriginalError();
      if (message !== undefined) createNonEnumerableProperty$a(result, 'message', message);
      installErrorStack(result, WrappedError, result.stack, 2);
      if (this && isPrototypeOf$7(OriginalErrorPrototype, this)) inheritIfRequired$5(result, this, WrappedError);
      if (arguments.length > OPTIONS_POSITION) installErrorCause(result, arguments[OPTIONS_POSITION]);
      return result;
    });

    WrappedError.prototype = OriginalErrorPrototype;

    if (ERROR_NAME !== 'Error') {
      if (setPrototypeOf$5) setPrototypeOf$5(WrappedError, BaseError);
      else copyConstructorProperties$1(WrappedError, BaseError, { name: true });
    } else if (DESCRIPTORS$n && STACK_TRACE_LIMIT in OriginalError) {
      proxyAccessor$1(WrappedError, OriginalError, STACK_TRACE_LIMIT);
      proxyAccessor$1(WrappedError, OriginalError, 'prepareStackTrace');
    }

    copyConstructorProperties$1(WrappedError, OriginalError);

    try {
      // Safari 13- bug: WebAssembly errors does not have a proper `.name`
      if (OriginalErrorPrototype.name !== ERROR_NAME) {
        createNonEnumerableProperty$a(OriginalErrorPrototype, 'name', ERROR_NAME);
      }
      OriginalErrorPrototype.constructor = WrappedError;
    } catch (error) { /* empty */ }

    return WrappedError;
  };

  /* eslint-disable no-unused-vars -- required for functions `.length` */

  var $$X = _export;
  var global$C = global$Q;
  var apply$7 = functionApply;
  var wrapErrorConstructorWithCause = wrapErrorConstructorWithCause$1;

  var WEB_ASSEMBLY = 'WebAssembly';
  var WebAssembly$1 = global$C[WEB_ASSEMBLY];

  var FORCED$e = Error('e', { cause: 7 }).cause !== 7;

  var exportGlobalErrorCauseWrapper = function (ERROR_NAME, wrapper) {
    var O = {};
    O[ERROR_NAME] = wrapErrorConstructorWithCause(ERROR_NAME, wrapper, FORCED$e);
    $$X({ global: true, constructor: true, arity: 1, forced: FORCED$e }, O);
  };

  var exportWebAssemblyErrorCauseWrapper = function (ERROR_NAME, wrapper) {
    if (WebAssembly$1 && WebAssembly$1[ERROR_NAME]) {
      var O = {};
      O[ERROR_NAME] = wrapErrorConstructorWithCause(WEB_ASSEMBLY + '.' + ERROR_NAME, wrapper, FORCED$e);
      $$X({ target: WEB_ASSEMBLY, stat: true, constructor: true, arity: 1, forced: FORCED$e }, O);
    }
  };

  // https://tc39.es/ecma262/#sec-nativeerror
  // https://github.com/tc39/proposal-error-cause
  exportGlobalErrorCauseWrapper('Error', function (init) {
    return function Error(message) { return apply$7(init, this, arguments); };
  });
  exportGlobalErrorCauseWrapper('EvalError', function (init) {
    return function EvalError(message) { return apply$7(init, this, arguments); };
  });
  exportGlobalErrorCauseWrapper('RangeError', function (init) {
    return function RangeError(message) { return apply$7(init, this, arguments); };
  });
  exportGlobalErrorCauseWrapper('ReferenceError', function (init) {
    return function ReferenceError(message) { return apply$7(init, this, arguments); };
  });
  exportGlobalErrorCauseWrapper('SyntaxError', function (init) {
    return function SyntaxError(message) { return apply$7(init, this, arguments); };
  });
  exportGlobalErrorCauseWrapper('TypeError', function (init) {
    return function TypeError(message) { return apply$7(init, this, arguments); };
  });
  exportGlobalErrorCauseWrapper('URIError', function (init) {
    return function URIError(message) { return apply$7(init, this, arguments); };
  });
  exportWebAssemblyErrorCauseWrapper('CompileError', function (init) {
    return function CompileError(message) { return apply$7(init, this, arguments); };
  });
  exportWebAssemblyErrorCauseWrapper('LinkError', function (init) {
    return function LinkError(message) { return apply$7(init, this, arguments); };
  });
  exportWebAssemblyErrorCauseWrapper('RuntimeError', function (init) {
    return function RuntimeError(message) { return apply$7(init, this, arguments); };
  });

  var fails$H = fails$V;
  var wellKnownSymbol$o = wellKnownSymbol$x;
  var V8_VERSION$2 = engineV8Version;

  var SPECIES$5 = wellKnownSymbol$o('species');

  var arrayMethodHasSpeciesSupport$5 = function (METHOD_NAME) {
    // We can't use this feature detection in V8 since it causes
    // deoptimization and serious performance degradation
    // https://github.com/zloirock/core-js/issues/677
    return V8_VERSION$2 >= 51 || !fails$H(function () {
      var array = [];
      var constructor = array.constructor = {};
      constructor[SPECIES$5] = function () {
        return { foo: 1 };
      };
      return array[METHOD_NAME](Boolean).foo !== 1;
    });
  };

  var $$W = _export;
  var $filter$1 = arrayIteration.filter;
  var arrayMethodHasSpeciesSupport$4 = arrayMethodHasSpeciesSupport$5;

  var HAS_SPECIES_SUPPORT$3 = arrayMethodHasSpeciesSupport$4('filter');

  // `Array.prototype.filter` method
  // https://tc39.es/ecma262/#sec-array.prototype.filter
  // with adding support of @@species
  $$W({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT$3 }, {
    filter: function filter(callbackfn /* , thisArg */) {
      return $filter$1(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);
    }
  });

  var call$s = functionCall;
  var anObject$l = anObject$s;
  var getMethod$7 = getMethod$9;

  var iteratorClose$3 = function (iterator, kind, value) {
    var innerResult, innerError;
    anObject$l(iterator);
    try {
      innerResult = getMethod$7(iterator, 'return');
      if (!innerResult) {
        if (kind === 'throw') throw value;
        return value;
      }
      innerResult = call$s(innerResult, iterator);
    } catch (error) {
      innerError = true;
      innerResult = error;
    }
    if (kind === 'throw') throw value;
    if (innerError) throw innerResult;
    anObject$l(innerResult);
    return value;
  };

  var anObject$k = anObject$s;
  var iteratorClose$2 = iteratorClose$3;

  // call something on iterator step with safe closing on error
  var callWithSafeIterationClosing$3 = function (iterator, fn, value, ENTRIES) {
    try {
      return ENTRIES ? fn(anObject$k(value)[0], value[1]) : fn(value);
    } catch (error) {
      iteratorClose$2(iterator, 'throw', error);
    }
  };

  var iterators = {};

  var wellKnownSymbol$n = wellKnownSymbol$x;
  var Iterators$4 = iterators;

  var ITERATOR$a = wellKnownSymbol$n('iterator');
  var ArrayPrototype$1 = Array.prototype;

  // check on default Array iterator
  var isArrayIteratorMethod$3 = function (it) {
    return it !== undefined && (Iterators$4.Array === it || ArrayPrototype$1[ITERATOR$a] === it);
  };

  var classof$d = classof$j;
  var getMethod$6 = getMethod$9;
  var isNullOrUndefined$8 = isNullOrUndefined$b;
  var Iterators$3 = iterators;
  var wellKnownSymbol$m = wellKnownSymbol$x;

  var ITERATOR$9 = wellKnownSymbol$m('iterator');

  var getIteratorMethod$5 = function (it) {
    if (!isNullOrUndefined$8(it)) return getMethod$6(it, ITERATOR$9)
      || getMethod$6(it, '@@iterator')
      || Iterators$3[classof$d(it)];
  };

  var call$r = functionCall;
  var aCallable$d = aCallable$h;
  var anObject$j = anObject$s;
  var tryToString$4 = tryToString$7;
  var getIteratorMethod$4 = getIteratorMethod$5;

  var $TypeError$h = TypeError;

  var getIterator$4 = function (argument, usingIterator) {
    var iteratorMethod = arguments.length < 2 ? getIteratorMethod$4(argument) : usingIterator;
    if (aCallable$d(iteratorMethod)) return anObject$j(call$r(iteratorMethod, argument));
    throw $TypeError$h(tryToString$4(argument) + ' is not iterable');
  };

  var bind$9 = functionBindContext;
  var call$q = functionCall;
  var toObject$d = toObject$h;
  var callWithSafeIterationClosing$2 = callWithSafeIterationClosing$3;
  var isArrayIteratorMethod$2 = isArrayIteratorMethod$3;
  var isConstructor$2 = isConstructor$4;
  var lengthOfArrayLike$i = lengthOfArrayLike$m;
  var createProperty$3 = createProperty$5;
  var getIterator$3 = getIterator$4;
  var getIteratorMethod$3 = getIteratorMethod$5;

  var $Array$2 = Array;

  // `Array.from` method implementation
  // https://tc39.es/ecma262/#sec-array.from
  var arrayFrom$1 = function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {
    var O = toObject$d(arrayLike);
    var IS_CONSTRUCTOR = isConstructor$2(this);
    var argumentsLength = arguments.length;
    var mapfn = argumentsLength > 1 ? arguments[1] : undefined;
    var mapping = mapfn !== undefined;
    if (mapping) mapfn = bind$9(mapfn, argumentsLength > 2 ? arguments[2] : undefined);
    var iteratorMethod = getIteratorMethod$3(O);
    var index = 0;
    var length, result, step, iterator, next, value;
    // if the target is not iterable or it's an array with the default iterator - use a simple case
    if (iteratorMethod && !(this === $Array$2 && isArrayIteratorMethod$2(iteratorMethod))) {
      iterator = getIterator$3(O, iteratorMethod);
      next = iterator.next;
      result = IS_CONSTRUCTOR ? new this() : [];
      for (;!(step = call$q(next, iterator)).done; index++) {
        value = mapping ? callWithSafeIterationClosing$2(iterator, mapfn, [step.value, index], true) : step.value;
        createProperty$3(result, index, value);
      }
    } else {
      length = lengthOfArrayLike$i(O);
      result = IS_CONSTRUCTOR ? new this(length) : $Array$2(length);
      for (;length > index; index++) {
        value = mapping ? mapfn(O[index], index) : O[index];
        createProperty$3(result, index, value);
      }
    }
    result.length = index;
    return result;
  };

  var wellKnownSymbol$l = wellKnownSymbol$x;

  var ITERATOR$8 = wellKnownSymbol$l('iterator');
  var SAFE_CLOSING = false;

  try {
    var called = 0;
    var iteratorWithReturn = {
      next: function () {
        return { done: !!called++ };
      },
      'return': function () {
        SAFE_CLOSING = true;
      }
    };
    iteratorWithReturn[ITERATOR$8] = function () {
      return this;
    };
    // eslint-disable-next-line es/no-array-from, no-throw-literal -- required for testing
    Array.from(iteratorWithReturn, function () { throw 2; });
  } catch (error) { /* empty */ }

  var checkCorrectnessOfIteration$4 = function (exec, SKIP_CLOSING) {
    if (!SKIP_CLOSING && !SAFE_CLOSING) return false;
    var ITERATION_SUPPORT = false;
    try {
      var object = {};
      object[ITERATOR$8] = function () {
        return {
          next: function () {
            return { done: ITERATION_SUPPORT = true };
          }
        };
      };
      exec(object);
    } catch (error) { /* empty */ }
    return ITERATION_SUPPORT;
  };

  var $$V = _export;
  var from = arrayFrom$1;
  var checkCorrectnessOfIteration$3 = checkCorrectnessOfIteration$4;

  var INCORRECT_ITERATION = !checkCorrectnessOfIteration$3(function (iterable) {
    // eslint-disable-next-line es/no-array-from -- required for testing
    Array.from(iterable);
  });

  // `Array.from` method
  // https://tc39.es/ecma262/#sec-array.from
  $$V({ target: 'Array', stat: true, forced: INCORRECT_ITERATION }, {
    from: from
  });

  var wellKnownSymbol$k = wellKnownSymbol$x;
  var create$8 = objectCreate;
  var defineProperty$7 = objectDefineProperty.f;

  var UNSCOPABLES = wellKnownSymbol$k('unscopables');
  var ArrayPrototype = Array.prototype;

  // Array.prototype[@@unscopables]
  // https://tc39.es/ecma262/#sec-array.prototype-@@unscopables
  if (ArrayPrototype[UNSCOPABLES] == undefined) {
    defineProperty$7(ArrayPrototype, UNSCOPABLES, {
      configurable: true,
      value: create$8(null)
    });
  }

  // add a key to Array.prototype[@@unscopables]
  var addToUnscopables$3 = function (key) {
    ArrayPrototype[UNSCOPABLES][key] = true;
  };

  var $$U = _export;
  var $includes$1 = arrayIncludes.includes;
  var fails$G = fails$V;
  var addToUnscopables$2 = addToUnscopables$3;

  // FF99+ bug
  var BROKEN_ON_SPARSE = fails$G(function () {
    // eslint-disable-next-line es/no-array-prototype-includes -- detection
    return !Array(1).includes();
  });

  // `Array.prototype.includes` method
  // https://tc39.es/ecma262/#sec-array.prototype.includes
  $$U({ target: 'Array', proto: true, forced: BROKEN_ON_SPARSE }, {
    includes: function includes(el /* , fromIndex = 0 */) {
      return $includes$1(this, el, arguments.length > 1 ? arguments[1] : undefined);
    }
  });

  // https://tc39.es/ecma262/#sec-array.prototype-@@unscopables
  addToUnscopables$2('includes');

  var fails$F = fails$V;

  var correctPrototypeGetter = !fails$F(function () {
    function F() { /* empty */ }
    F.prototype.constructor = null;
    // eslint-disable-next-line es/no-object-getprototypeof -- required for testing
    return Object.getPrototypeOf(new F()) !== F.prototype;
  });

  var hasOwn$d = hasOwnProperty_1;
  var isCallable$f = isCallable$x;
  var toObject$c = toObject$h;
  var sharedKey = sharedKey$4;
  var CORRECT_PROTOTYPE_GETTER = correctPrototypeGetter;

  var IE_PROTO = sharedKey('IE_PROTO');
  var $Object = Object;
  var ObjectPrototype$2 = $Object.prototype;

  // `Object.getPrototypeOf` method
  // https://tc39.es/ecma262/#sec-object.getprototypeof
  // eslint-disable-next-line es/no-object-getprototypeof -- safe
  var objectGetPrototypeOf = CORRECT_PROTOTYPE_GETTER ? $Object.getPrototypeOf : function (O) {
    var object = toObject$c(O);
    if (hasOwn$d(object, IE_PROTO)) return object[IE_PROTO];
    var constructor = object.constructor;
    if (isCallable$f(constructor) && object instanceof constructor) {
      return constructor.prototype;
    } return object instanceof $Object ? ObjectPrototype$2 : null;
  };

  var fails$E = fails$V;
  var isCallable$e = isCallable$x;
  var isObject$c = isObject$l;
  var getPrototypeOf$3 = objectGetPrototypeOf;
  var defineBuiltIn$d = defineBuiltIn$h;
  var wellKnownSymbol$j = wellKnownSymbol$x;

  var ITERATOR$7 = wellKnownSymbol$j('iterator');
  var BUGGY_SAFARI_ITERATORS$1 = false;

  // `%IteratorPrototype%` object
  // https://tc39.es/ecma262/#sec-%iteratorprototype%-object
  var IteratorPrototype$4, PrototypeOfArrayIteratorPrototype, arrayIterator;

  /* eslint-disable es/no-array-prototype-keys -- safe */
  if ([].keys) {
    arrayIterator = [].keys();
    // Safari 8 has buggy iterators w/o `next`
    if (!('next' in arrayIterator)) BUGGY_SAFARI_ITERATORS$1 = true;
    else {
      PrototypeOfArrayIteratorPrototype = getPrototypeOf$3(getPrototypeOf$3(arrayIterator));
      if (PrototypeOfArrayIteratorPrototype !== Object.prototype) IteratorPrototype$4 = PrototypeOfArrayIteratorPrototype;
    }
  }

  var NEW_ITERATOR_PROTOTYPE = !isObject$c(IteratorPrototype$4) || fails$E(function () {
    var test = {};
    // FF44- legacy iterators case
    return IteratorPrototype$4[ITERATOR$7].call(test) !== test;
  });

  if (NEW_ITERATOR_PROTOTYPE) IteratorPrototype$4 = {};

  // `%IteratorPrototype%[@@iterator]()` method
  // https://tc39.es/ecma262/#sec-%iteratorprototype%-@@iterator
  if (!isCallable$e(IteratorPrototype$4[ITERATOR$7])) {
    defineBuiltIn$d(IteratorPrototype$4, ITERATOR$7, function () {
      return this;
    });
  }

  var iteratorsCore = {
    IteratorPrototype: IteratorPrototype$4,
    BUGGY_SAFARI_ITERATORS: BUGGY_SAFARI_ITERATORS$1
  };

  var IteratorPrototype$3 = iteratorsCore.IteratorPrototype;
  var create$7 = objectCreate;
  var createPropertyDescriptor$4 = createPropertyDescriptor$a;
  var setToStringTag$7 = setToStringTag$9;
  var Iterators$2 = iterators;

  var returnThis$1 = function () { return this; };

  var iteratorCreateConstructor = function (IteratorConstructor, NAME, next, ENUMERABLE_NEXT) {
    var TO_STRING_TAG = NAME + ' Iterator';
    IteratorConstructor.prototype = create$7(IteratorPrototype$3, { next: createPropertyDescriptor$4(+!ENUMERABLE_NEXT, next) });
    setToStringTag$7(IteratorConstructor, TO_STRING_TAG, false);
    Iterators$2[TO_STRING_TAG] = returnThis$1;
    return IteratorConstructor;
  };

  var $$T = _export;
  var call$p = functionCall;
  var FunctionName$1 = functionName;
  var isCallable$d = isCallable$x;
  var createIteratorConstructor$1 = iteratorCreateConstructor;
  var getPrototypeOf$2 = objectGetPrototypeOf;
  var setPrototypeOf$4 = objectSetPrototypeOf;
  var setToStringTag$6 = setToStringTag$9;
  var createNonEnumerableProperty$9 = createNonEnumerableProperty$f;
  var defineBuiltIn$c = defineBuiltIn$h;
  var wellKnownSymbol$i = wellKnownSymbol$x;
  var Iterators$1 = iterators;
  var IteratorsCore = iteratorsCore;

  var PROPER_FUNCTION_NAME$3 = FunctionName$1.PROPER;
  var CONFIGURABLE_FUNCTION_NAME$1 = FunctionName$1.CONFIGURABLE;
  var IteratorPrototype$2 = IteratorsCore.IteratorPrototype;
  var BUGGY_SAFARI_ITERATORS = IteratorsCore.BUGGY_SAFARI_ITERATORS;
  var ITERATOR$6 = wellKnownSymbol$i('iterator');
  var KEYS = 'keys';
  var VALUES = 'values';
  var ENTRIES = 'entries';

  var returnThis = function () { return this; };

  var iteratorDefine = function (Iterable, NAME, IteratorConstructor, next, DEFAULT, IS_SET, FORCED) {
    createIteratorConstructor$1(IteratorConstructor, NAME, next);

    var getIterationMethod = function (KIND) {
      if (KIND === DEFAULT && defaultIterator) return defaultIterator;
      if (!BUGGY_SAFARI_ITERATORS && KIND in IterablePrototype) return IterablePrototype[KIND];
      switch (KIND) {
        case KEYS: return function keys() { return new IteratorConstructor(this, KIND); };
        case VALUES: return function values() { return new IteratorConstructor(this, KIND); };
        case ENTRIES: return function entries() { return new IteratorConstructor(this, KIND); };
      } return function () { return new IteratorConstructor(this); };
    };

    var TO_STRING_TAG = NAME + ' Iterator';
    var INCORRECT_VALUES_NAME = false;
    var IterablePrototype = Iterable.prototype;
    var nativeIterator = IterablePrototype[ITERATOR$6]
      || IterablePrototype['@@iterator']
      || DEFAULT && IterablePrototype[DEFAULT];
    var defaultIterator = !BUGGY_SAFARI_ITERATORS && nativeIterator || getIterationMethod(DEFAULT);
    var anyNativeIterator = NAME == 'Array' ? IterablePrototype.entries || nativeIterator : nativeIterator;
    var CurrentIteratorPrototype, methods, KEY;

    // fix native
    if (anyNativeIterator) {
      CurrentIteratorPrototype = getPrototypeOf$2(anyNativeIterator.call(new Iterable()));
      if (CurrentIteratorPrototype !== Object.prototype && CurrentIteratorPrototype.next) {
        if (getPrototypeOf$2(CurrentIteratorPrototype) !== IteratorPrototype$2) {
          if (setPrototypeOf$4) {
            setPrototypeOf$4(CurrentIteratorPrototype, IteratorPrototype$2);
          } else if (!isCallable$d(CurrentIteratorPrototype[ITERATOR$6])) {
            defineBuiltIn$c(CurrentIteratorPrototype, ITERATOR$6, returnThis);
          }
        }
        // Set @@toStringTag to native iterators
        setToStringTag$6(CurrentIteratorPrototype, TO_STRING_TAG, true);
      }
    }

    // fix Array.prototype.{ values, @@iterator }.name in V8 / FF
    if (PROPER_FUNCTION_NAME$3 && DEFAULT == VALUES && nativeIterator && nativeIterator.name !== VALUES) {
      if (CONFIGURABLE_FUNCTION_NAME$1) {
        createNonEnumerableProperty$9(IterablePrototype, 'name', VALUES);
      } else {
        INCORRECT_VALUES_NAME = true;
        defaultIterator = function values() { return call$p(nativeIterator, this); };
      }
    }

    // export additional methods
    if (DEFAULT) {
      methods = {
        values: getIterationMethod(VALUES),
        keys: IS_SET ? defaultIterator : getIterationMethod(KEYS),
        entries: getIterationMethod(ENTRIES)
      };
      if (FORCED) for (KEY in methods) {
        if (BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME || !(KEY in IterablePrototype)) {
          defineBuiltIn$c(IterablePrototype, KEY, methods[KEY]);
        }
      } else $$T({ target: NAME, proto: true, forced: BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME }, methods);
    }

    // define iterator
    if (IterablePrototype[ITERATOR$6] !== defaultIterator) {
      defineBuiltIn$c(IterablePrototype, ITERATOR$6, defaultIterator, { name: DEFAULT });
    }
    Iterators$1[NAME] = defaultIterator;

    return methods;
  };

  // `CreateIterResultObject` abstract operation
  // https://tc39.es/ecma262/#sec-createiterresultobject
  var createIterResultObject$4 = function (value, done) {
    return { value: value, done: done };
  };

  var toIndexedObject$5 = toIndexedObject$c;
  var addToUnscopables$1 = addToUnscopables$3;
  var Iterators = iterators;
  var InternalStateModule$a = internalState;
  var defineProperty$6 = objectDefineProperty.f;
  var defineIterator$2 = iteratorDefine;
  var createIterResultObject$3 = createIterResultObject$4;
  var DESCRIPTORS$m = descriptors;

  var ARRAY_ITERATOR = 'Array Iterator';
  var setInternalState$9 = InternalStateModule$a.set;
  var getInternalState$7 = InternalStateModule$a.getterFor(ARRAY_ITERATOR);

  // `Array.prototype.entries` method
  // https://tc39.es/ecma262/#sec-array.prototype.entries
  // `Array.prototype.keys` method
  // https://tc39.es/ecma262/#sec-array.prototype.keys
  // `Array.prototype.values` method
  // https://tc39.es/ecma262/#sec-array.prototype.values
  // `Array.prototype[@@iterator]` method
  // https://tc39.es/ecma262/#sec-array.prototype-@@iterator
  // `CreateArrayIterator` internal method
  // https://tc39.es/ecma262/#sec-createarrayiterator
  var es_array_iterator = defineIterator$2(Array, 'Array', function (iterated, kind) {
    setInternalState$9(this, {
      type: ARRAY_ITERATOR,
      target: toIndexedObject$5(iterated), // target
      index: 0,                          // next index
      kind: kind                         // kind
    });
  // `%ArrayIteratorPrototype%.next` method
  // https://tc39.es/ecma262/#sec-%arrayiteratorprototype%.next
  }, function () {
    var state = getInternalState$7(this);
    var target = state.target;
    var kind = state.kind;
    var index = state.index++;
    if (!target || index >= target.length) {
      state.target = undefined;
      return createIterResultObject$3(undefined, true);
    }
    if (kind == 'keys') return createIterResultObject$3(index, false);
    if (kind == 'values') return createIterResultObject$3(target[index], false);
    return createIterResultObject$3([index, target[index]], false);
  }, 'values');

  // argumentsList[@@iterator] is %ArrayProto_values%
  // https://tc39.es/ecma262/#sec-createunmappedargumentsobject
  // https://tc39.es/ecma262/#sec-createmappedargumentsobject
  var values = Iterators.Arguments = Iterators.Array;

  // https://tc39.es/ecma262/#sec-array.prototype-@@unscopables
  addToUnscopables$1('keys');
  addToUnscopables$1('values');
  addToUnscopables$1('entries');

  // V8 ~ Chrome 45- bug
  if (DESCRIPTORS$m && values.name !== 'values') try {
    defineProperty$6(values, 'name', { value: 'values' });
  } catch (error) { /* empty */ }

  var fails$D = fails$V;

  var arrayMethodIsStrict$4 = function (METHOD_NAME, argument) {
    var method = [][METHOD_NAME];
    return !!method && fails$D(function () {
      // eslint-disable-next-line no-useless-call -- required for testing
      method.call(null, argument || function () { return 1; }, 1);
    });
  };

  var $$S = _export;
  var uncurryThis$D = functionUncurryThis;
  var IndexedObject$3 = indexedObject;
  var toIndexedObject$4 = toIndexedObject$c;
  var arrayMethodIsStrict$3 = arrayMethodIsStrict$4;

  var nativeJoin = uncurryThis$D([].join);

  var ES3_STRINGS = IndexedObject$3 != Object;
  var FORCED$d = ES3_STRINGS || !arrayMethodIsStrict$3('join', ',');

  // `Array.prototype.join` method
  // https://tc39.es/ecma262/#sec-array.prototype.join
  $$S({ target: 'Array', proto: true, forced: FORCED$d }, {
    join: function join(separator) {
      return nativeJoin(toIndexedObject$4(this), separator === undefined ? ',' : separator);
    }
  });

  var $$R = _export;
  var $map$1 = arrayIteration.map;
  var arrayMethodHasSpeciesSupport$3 = arrayMethodHasSpeciesSupport$5;

  var HAS_SPECIES_SUPPORT$2 = arrayMethodHasSpeciesSupport$3('map');

  // `Array.prototype.map` method
  // https://tc39.es/ecma262/#sec-array.prototype.map
  // with adding support of @@species
  $$R({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT$2 }, {
    map: function map(callbackfn /* , thisArg */) {
      return $map$1(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);
    }
  });

  var DESCRIPTORS$l = descriptors;
  var isArray$3 = isArray$6;

  var $TypeError$g = TypeError;
  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var getOwnPropertyDescriptor$4 = Object.getOwnPropertyDescriptor;

  // Safari < 13 does not throw an error in this case
  var SILENT_ON_NON_WRITABLE_LENGTH_SET = DESCRIPTORS$l && !function () {
    // makes no sense without proper strict mode support
    if (this !== undefined) return true;
    try {
      // eslint-disable-next-line es/no-object-defineproperty -- safe
      Object.defineProperty([], 'length', { writable: false }).length = 1;
    } catch (error) {
      return error instanceof TypeError;
    }
  }();

  var arraySetLength = SILENT_ON_NON_WRITABLE_LENGTH_SET ? function (O, length) {
    if (isArray$3(O) && !getOwnPropertyDescriptor$4(O, 'length').writable) {
      throw $TypeError$g('Cannot set read only .length');
    } return O.length = length;
  } : function (O, length) {
    return O.length = length;
  };

  var $TypeError$f = TypeError;
  var MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF; // 2 ** 53 - 1 == 9007199254740991

  var doesNotExceedSafeInteger$4 = function (it) {
    if (it > MAX_SAFE_INTEGER) throw $TypeError$f('Maximum allowed index exceeded');
    return it;
  };

  var $$Q = _export;
  var toObject$b = toObject$h;
  var lengthOfArrayLike$h = lengthOfArrayLike$m;
  var setArrayLength$2 = arraySetLength;
  var doesNotExceedSafeInteger$3 = doesNotExceedSafeInteger$4;
  var fails$C = fails$V;

  var INCORRECT_TO_LENGTH = fails$C(function () {
    return [].push.call({ length: 0x100000000 }, 1) !== 4294967297;
  });

  // V8 and Safari <= 15.4, FF < 23 throws InternalError
  // https://bugs.chromium.org/p/v8/issues/detail?id=12681
  var properErrorOnNonWritableLength$1 = function () {
    try {
      // eslint-disable-next-line es/no-object-defineproperty -- safe
      Object.defineProperty([], 'length', { writable: false }).push();
    } catch (error) {
      return error instanceof TypeError;
    }
  };

  var FORCED$c = INCORRECT_TO_LENGTH || !properErrorOnNonWritableLength$1();

  // `Array.prototype.push` method
  // https://tc39.es/ecma262/#sec-array.prototype.push
  $$Q({ target: 'Array', proto: true, arity: 1, forced: FORCED$c }, {
    // eslint-disable-next-line no-unused-vars -- required for `.length`
    push: function push(item) {
      var O = toObject$b(this);
      var len = lengthOfArrayLike$h(O);
      var argCount = arguments.length;
      doesNotExceedSafeInteger$3(len + argCount);
      for (var i = 0; i < argCount; i++) {
        O[len] = arguments[i];
        len++;
      }
      setArrayLength$2(O, len);
      return len;
    }
  });

  var $$P = _export;
  var isArray$2 = isArray$6;
  var isConstructor$1 = isConstructor$4;
  var isObject$b = isObject$l;
  var toAbsoluteIndex$5 = toAbsoluteIndex$8;
  var lengthOfArrayLike$g = lengthOfArrayLike$m;
  var toIndexedObject$3 = toIndexedObject$c;
  var createProperty$2 = createProperty$5;
  var wellKnownSymbol$h = wellKnownSymbol$x;
  var arrayMethodHasSpeciesSupport$2 = arrayMethodHasSpeciesSupport$5;
  var nativeSlice = arraySlice$9;

  var HAS_SPECIES_SUPPORT$1 = arrayMethodHasSpeciesSupport$2('slice');

  var SPECIES$4 = wellKnownSymbol$h('species');
  var $Array$1 = Array;
  var max$3 = Math.max;

  // `Array.prototype.slice` method
  // https://tc39.es/ecma262/#sec-array.prototype.slice
  // fallback for not array-like ES3 strings and DOM objects
  $$P({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT$1 }, {
    slice: function slice(start, end) {
      var O = toIndexedObject$3(this);
      var length = lengthOfArrayLike$g(O);
      var k = toAbsoluteIndex$5(start, length);
      var fin = toAbsoluteIndex$5(end === undefined ? length : end, length);
      // inline `ArraySpeciesCreate` for usage native `Array#slice` where it's possible
      var Constructor, result, n;
      if (isArray$2(O)) {
        Constructor = O.constructor;
        // cross-realm fallback
        if (isConstructor$1(Constructor) && (Constructor === $Array$1 || isArray$2(Constructor.prototype))) {
          Constructor = undefined;
        } else if (isObject$b(Constructor)) {
          Constructor = Constructor[SPECIES$4];
          if (Constructor === null) Constructor = undefined;
        }
        if (Constructor === $Array$1 || Constructor === undefined) {
          return nativeSlice(O, k, fin);
        }
      }
      result = new (Constructor === undefined ? $Array$1 : Constructor)(max$3(fin - k, 0));
      for (n = 0; k < fin; k++, n++) if (k in O) createProperty$2(result, n, O[k]);
      result.length = n;
      return result;
    }
  });

  var tryToString$3 = tryToString$7;

  var $TypeError$e = TypeError;

  var deletePropertyOrThrow$4 = function (O, P) {
    if (!delete O[P]) throw $TypeError$e('Cannot delete property ' + tryToString$3(P) + ' of ' + tryToString$3(O));
  };

  var $$O = _export;
  var toObject$a = toObject$h;
  var toAbsoluteIndex$4 = toAbsoluteIndex$8;
  var toIntegerOrInfinity$b = toIntegerOrInfinity$e;
  var lengthOfArrayLike$f = lengthOfArrayLike$m;
  var setArrayLength$1 = arraySetLength;
  var doesNotExceedSafeInteger$2 = doesNotExceedSafeInteger$4;
  var arraySpeciesCreate$1 = arraySpeciesCreate$3;
  var createProperty$1 = createProperty$5;
  var deletePropertyOrThrow$3 = deletePropertyOrThrow$4;
  var arrayMethodHasSpeciesSupport$1 = arrayMethodHasSpeciesSupport$5;

  var HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport$1('splice');

  var max$2 = Math.max;
  var min$6 = Math.min;

  // `Array.prototype.splice` method
  // https://tc39.es/ecma262/#sec-array.prototype.splice
  // with adding support of @@species
  $$O({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {
    splice: function splice(start, deleteCount /* , ...items */) {
      var O = toObject$a(this);
      var len = lengthOfArrayLike$f(O);
      var actualStart = toAbsoluteIndex$4(start, len);
      var argumentsLength = arguments.length;
      var insertCount, actualDeleteCount, A, k, from, to;
      if (argumentsLength === 0) {
        insertCount = actualDeleteCount = 0;
      } else if (argumentsLength === 1) {
        insertCount = 0;
        actualDeleteCount = len - actualStart;
      } else {
        insertCount = argumentsLength - 2;
        actualDeleteCount = min$6(max$2(toIntegerOrInfinity$b(deleteCount), 0), len - actualStart);
      }
      doesNotExceedSafeInteger$2(len + insertCount - actualDeleteCount);
      A = arraySpeciesCreate$1(O, actualDeleteCount);
      for (k = 0; k < actualDeleteCount; k++) {
        from = actualStart + k;
        if (from in O) createProperty$1(A, k, O[from]);
      }
      A.length = actualDeleteCount;
      if (insertCount < actualDeleteCount) {
        for (k = actualStart; k < len - actualDeleteCount; k++) {
          from = k + actualDeleteCount;
          to = k + insertCount;
          if (from in O) O[to] = O[from];
          else deletePropertyOrThrow$3(O, to);
        }
        for (k = len; k > len - actualDeleteCount + insertCount; k--) deletePropertyOrThrow$3(O, k - 1);
      } else if (insertCount > actualDeleteCount) {
        for (k = len - actualDeleteCount; k > actualStart; k--) {
          from = k + actualDeleteCount - 1;
          to = k + insertCount - 1;
          if (from in O) O[to] = O[from];
          else deletePropertyOrThrow$3(O, to);
        }
      }
      for (k = 0; k < insertCount; k++) {
        O[k + actualStart] = arguments[k + 2];
      }
      setArrayLength$1(O, len - actualDeleteCount + insertCount);
      return A;
    }
  });

  var $$N = _export;
  var toObject$9 = toObject$h;
  var lengthOfArrayLike$e = lengthOfArrayLike$m;
  var setArrayLength = arraySetLength;
  var deletePropertyOrThrow$2 = deletePropertyOrThrow$4;
  var doesNotExceedSafeInteger$1 = doesNotExceedSafeInteger$4;

  // IE8-
  var INCORRECT_RESULT = [].unshift(0) !== 1;

  // V8 ~ Chrome < 71 and Safari <= 15.4, FF < 23 throws InternalError
  var properErrorOnNonWritableLength = function () {
    try {
      // eslint-disable-next-line es/no-object-defineproperty -- safe
      Object.defineProperty([], 'length', { writable: false }).unshift();
    } catch (error) {
      return error instanceof TypeError;
    }
  };

  var FORCED$b = INCORRECT_RESULT || !properErrorOnNonWritableLength();

  // `Array.prototype.unshift` method
  // https://tc39.es/ecma262/#sec-array.prototype.unshift
  $$N({ target: 'Array', proto: true, arity: 1, forced: FORCED$b }, {
    // eslint-disable-next-line no-unused-vars -- required for `.length`
    unshift: function unshift(item) {
      var O = toObject$9(this);
      var len = lengthOfArrayLike$e(O);
      var argCount = arguments.length;
      if (argCount) {
        doesNotExceedSafeInteger$1(len + argCount);
        var k = len;
        while (k--) {
          var to = k + argCount;
          if (k in O) O[to] = O[k];
          else deletePropertyOrThrow$2(O, to);
        }
        for (var j = 0; j < argCount; j++) {
          O[j] = arguments[j];
        }
      } return setArrayLength(O, len + argCount);
    }
  });

  // eslint-disable-next-line es/no-typed-arrays -- safe
  var arrayBufferBasicDetection = typeof ArrayBuffer != 'undefined' && typeof DataView != 'undefined';

  var defineBuiltIn$b = defineBuiltIn$h;

  var defineBuiltIns$4 = function (target, src, options) {
    for (var key in src) defineBuiltIn$b(target, key, src[key], options);
    return target;
  };

  var isPrototypeOf$6 = objectIsPrototypeOf;

  var $TypeError$d = TypeError;

  var anInstance$a = function (it, Prototype) {
    if (isPrototypeOf$6(Prototype, it)) return it;
    throw $TypeError$d('Incorrect invocation');
  };

  var toIntegerOrInfinity$a = toIntegerOrInfinity$e;
  var toLength$8 = toLength$a;

  var $RangeError$6 = RangeError;

  // `ToIndex` abstract operation
  // https://tc39.es/ecma262/#sec-toindex
  var toIndex$3 = function (it) {
    if (it === undefined) return 0;
    var number = toIntegerOrInfinity$a(it);
    var length = toLength$8(number);
    if (number !== length) throw $RangeError$6('Wrong length or index');
    return length;
  };

  // IEEE754 conversions based on https://github.com/feross/ieee754
  var $Array = Array;
  var abs$1 = Math.abs;
  var pow$3 = Math.pow;
  var floor$8 = Math.floor;
  var log$2 = Math.log;
  var LN2 = Math.LN2;

  var pack = function (number, mantissaLength, bytes) {
    var buffer = $Array(bytes);
    var exponentLength = bytes * 8 - mantissaLength - 1;
    var eMax = (1 << exponentLength) - 1;
    var eBias = eMax >> 1;
    var rt = mantissaLength === 23 ? pow$3(2, -24) - pow$3(2, -77) : 0;
    var sign = number < 0 || number === 0 && 1 / number < 0 ? 1 : 0;
    var index = 0;
    var exponent, mantissa, c;
    number = abs$1(number);
    // eslint-disable-next-line no-self-compare -- NaN check
    if (number != number || number === Infinity) {
      // eslint-disable-next-line no-self-compare -- NaN check
      mantissa = number != number ? 1 : 0;
      exponent = eMax;
    } else {
      exponent = floor$8(log$2(number) / LN2);
      c = pow$3(2, -exponent);
      if (number * c < 1) {
        exponent--;
        c *= 2;
      }
      if (exponent + eBias >= 1) {
        number += rt / c;
      } else {
        number += rt * pow$3(2, 1 - eBias);
      }
      if (number * c >= 2) {
        exponent++;
        c /= 2;
      }
      if (exponent + eBias >= eMax) {
        mantissa = 0;
        exponent = eMax;
      } else if (exponent + eBias >= 1) {
        mantissa = (number * c - 1) * pow$3(2, mantissaLength);
        exponent = exponent + eBias;
      } else {
        mantissa = number * pow$3(2, eBias - 1) * pow$3(2, mantissaLength);
        exponent = 0;
      }
    }
    while (mantissaLength >= 8) {
      buffer[index++] = mantissa & 255;
      mantissa /= 256;
      mantissaLength -= 8;
    }
    exponent = exponent << mantissaLength | mantissa;
    exponentLength += mantissaLength;
    while (exponentLength > 0) {
      buffer[index++] = exponent & 255;
      exponent /= 256;
      exponentLength -= 8;
    }
    buffer[--index] |= sign * 128;
    return buffer;
  };

  var unpack = function (buffer, mantissaLength) {
    var bytes = buffer.length;
    var exponentLength = bytes * 8 - mantissaLength - 1;
    var eMax = (1 << exponentLength) - 1;
    var eBias = eMax >> 1;
    var nBits = exponentLength - 7;
    var index = bytes - 1;
    var sign = buffer[index--];
    var exponent = sign & 127;
    var mantissa;
    sign >>= 7;
    while (nBits > 0) {
      exponent = exponent * 256 + buffer[index--];
      nBits -= 8;
    }
    mantissa = exponent & (1 << -nBits) - 1;
    exponent >>= -nBits;
    nBits += mantissaLength;
    while (nBits > 0) {
      mantissa = mantissa * 256 + buffer[index--];
      nBits -= 8;
    }
    if (exponent === 0) {
      exponent = 1 - eBias;
    } else if (exponent === eMax) {
      return mantissa ? NaN : sign ? -Infinity : Infinity;
    } else {
      mantissa = mantissa + pow$3(2, mantissaLength);
      exponent = exponent - eBias;
    } return (sign ? -1 : 1) * mantissa * pow$3(2, exponent - mantissaLength);
  };

  var ieee754 = {
    pack: pack,
    unpack: unpack
  };

  var toObject$8 = toObject$h;
  var toAbsoluteIndex$3 = toAbsoluteIndex$8;
  var lengthOfArrayLike$d = lengthOfArrayLike$m;

  // `Array.prototype.fill` method implementation
  // https://tc39.es/ecma262/#sec-array.prototype.fill
  var arrayFill$1 = function fill(value /* , start = 0, end = @length */) {
    var O = toObject$8(this);
    var length = lengthOfArrayLike$d(O);
    var argumentsLength = arguments.length;
    var index = toAbsoluteIndex$3(argumentsLength > 1 ? arguments[1] : undefined, length);
    var end = argumentsLength > 2 ? arguments[2] : undefined;
    var endPos = end === undefined ? length : toAbsoluteIndex$3(end, length);
    while (endPos > index) O[index++] = value;
    return O;
  };

  var global$B = global$Q;
  var uncurryThis$C = functionUncurryThis;
  var DESCRIPTORS$k = descriptors;
  var NATIVE_ARRAY_BUFFER$1 = arrayBufferBasicDetection;
  var FunctionName = functionName;
  var createNonEnumerableProperty$8 = createNonEnumerableProperty$f;
  var defineBuiltInAccessor$d = defineBuiltInAccessor$g;
  var defineBuiltIns$3 = defineBuiltIns$4;
  var fails$B = fails$V;
  var anInstance$9 = anInstance$a;
  var toIntegerOrInfinity$9 = toIntegerOrInfinity$e;
  var toLength$7 = toLength$a;
  var toIndex$2 = toIndex$3;
  var IEEE754 = ieee754;
  var getPrototypeOf$1 = objectGetPrototypeOf;
  var setPrototypeOf$3 = objectSetPrototypeOf;
  var getOwnPropertyNames$3 = objectGetOwnPropertyNames.f;
  var arrayFill = arrayFill$1;
  var arraySlice$7 = arraySliceSimple;
  var setToStringTag$5 = setToStringTag$9;
  var InternalStateModule$9 = internalState;

  var PROPER_FUNCTION_NAME$2 = FunctionName.PROPER;
  var CONFIGURABLE_FUNCTION_NAME = FunctionName.CONFIGURABLE;
  var ARRAY_BUFFER$1 = 'ArrayBuffer';
  var DATA_VIEW = 'DataView';
  var PROTOTYPE = 'prototype';
  var WRONG_LENGTH$1 = 'Wrong length';
  var WRONG_INDEX = 'Wrong index';
  var getInternalArrayBufferState = InternalStateModule$9.getterFor(ARRAY_BUFFER$1);
  var getInternalDataViewState = InternalStateModule$9.getterFor(DATA_VIEW);
  var setInternalState$8 = InternalStateModule$9.set;
  var NativeArrayBuffer$1 = global$B[ARRAY_BUFFER$1];
  var $ArrayBuffer = NativeArrayBuffer$1;
  var ArrayBufferPrototype$3 = $ArrayBuffer && $ArrayBuffer[PROTOTYPE];
  var $DataView = global$B[DATA_VIEW];
  var DataViewPrototype$2 = $DataView && $DataView[PROTOTYPE];
  var ObjectPrototype$1 = Object.prototype;
  var Array$1 = global$B.Array;
  var RangeError$3 = global$B.RangeError;
  var fill = uncurryThis$C(arrayFill);
  var reverse = uncurryThis$C([].reverse);

  var packIEEE754 = IEEE754.pack;
  var unpackIEEE754 = IEEE754.unpack;

  var packInt8 = function (number) {
    return [number & 0xFF];
  };

  var packInt16 = function (number) {
    return [number & 0xFF, number >> 8 & 0xFF];
  };

  var packInt32 = function (number) {
    return [number & 0xFF, number >> 8 & 0xFF, number >> 16 & 0xFF, number >> 24 & 0xFF];
  };

  var unpackInt32 = function (buffer) {
    return buffer[3] << 24 | buffer[2] << 16 | buffer[1] << 8 | buffer[0];
  };

  var packFloat32 = function (number) {
    return packIEEE754(number, 23, 4);
  };

  var packFloat64 = function (number) {
    return packIEEE754(number, 52, 8);
  };

  var addGetter$1 = function (Constructor, key, getInternalState) {
    defineBuiltInAccessor$d(Constructor[PROTOTYPE], key, {
      configurable: true,
      get: function () {
        return getInternalState(this)[key];
      }
    });
  };

  var get = function (view, count, index, isLittleEndian) {
    var intIndex = toIndex$2(index);
    var store = getInternalDataViewState(view);
    if (intIndex + count > store.byteLength) throw RangeError$3(WRONG_INDEX);
    var bytes = store.bytes;
    var start = intIndex + store.byteOffset;
    var pack = arraySlice$7(bytes, start, start + count);
    return isLittleEndian ? pack : reverse(pack);
  };

  var set$1 = function (view, count, index, conversion, value, isLittleEndian) {
    var intIndex = toIndex$2(index);
    var store = getInternalDataViewState(view);
    if (intIndex + count > store.byteLength) throw RangeError$3(WRONG_INDEX);
    var bytes = store.bytes;
    var start = intIndex + store.byteOffset;
    var pack = conversion(+value);
    for (var i = 0; i < count; i++) bytes[start + i] = pack[isLittleEndian ? i : count - i - 1];
  };

  if (!NATIVE_ARRAY_BUFFER$1) {
    $ArrayBuffer = function ArrayBuffer(length) {
      anInstance$9(this, ArrayBufferPrototype$3);
      var byteLength = toIndex$2(length);
      setInternalState$8(this, {
        type: ARRAY_BUFFER$1,
        bytes: fill(Array$1(byteLength), 0),
        byteLength: byteLength
      });
      if (!DESCRIPTORS$k) {
        this.byteLength = byteLength;
        this.detached = false;
      }
    };

    ArrayBufferPrototype$3 = $ArrayBuffer[PROTOTYPE];

    $DataView = function DataView(buffer, byteOffset, byteLength) {
      anInstance$9(this, DataViewPrototype$2);
      anInstance$9(buffer, ArrayBufferPrototype$3);
      var bufferState = getInternalArrayBufferState(buffer);
      var bufferLength = bufferState.byteLength;
      var offset = toIntegerOrInfinity$9(byteOffset);
      if (offset < 0 || offset > bufferLength) throw RangeError$3('Wrong offset');
      byteLength = byteLength === undefined ? bufferLength - offset : toLength$7(byteLength);
      if (offset + byteLength > bufferLength) throw RangeError$3(WRONG_LENGTH$1);
      setInternalState$8(this, {
        type: DATA_VIEW,
        buffer: buffer,
        byteLength: byteLength,
        byteOffset: offset,
        bytes: bufferState.bytes
      });
      if (!DESCRIPTORS$k) {
        this.buffer = buffer;
        this.byteLength = byteLength;
        this.byteOffset = offset;
      }
    };

    DataViewPrototype$2 = $DataView[PROTOTYPE];

    if (DESCRIPTORS$k) {
      addGetter$1($ArrayBuffer, 'byteLength', getInternalArrayBufferState);
      addGetter$1($DataView, 'buffer', getInternalDataViewState);
      addGetter$1($DataView, 'byteLength', getInternalDataViewState);
      addGetter$1($DataView, 'byteOffset', getInternalDataViewState);
    }

    defineBuiltIns$3(DataViewPrototype$2, {
      getInt8: function getInt8(byteOffset) {
        return get(this, 1, byteOffset)[0] << 24 >> 24;
      },
      getUint8: function getUint8(byteOffset) {
        return get(this, 1, byteOffset)[0];
      },
      getInt16: function getInt16(byteOffset /* , littleEndian */) {
        var bytes = get(this, 2, byteOffset, arguments.length > 1 ? arguments[1] : undefined);
        return (bytes[1] << 8 | bytes[0]) << 16 >> 16;
      },
      getUint16: function getUint16(byteOffset /* , littleEndian */) {
        var bytes = get(this, 2, byteOffset, arguments.length > 1 ? arguments[1] : undefined);
        return bytes[1] << 8 | bytes[0];
      },
      getInt32: function getInt32(byteOffset /* , littleEndian */) {
        return unpackInt32(get(this, 4, byteOffset, arguments.length > 1 ? arguments[1] : undefined));
      },
      getUint32: function getUint32(byteOffset /* , littleEndian */) {
        return unpackInt32(get(this, 4, byteOffset, arguments.length > 1 ? arguments[1] : undefined)) >>> 0;
      },
      getFloat32: function getFloat32(byteOffset /* , littleEndian */) {
        return unpackIEEE754(get(this, 4, byteOffset, arguments.length > 1 ? arguments[1] : undefined), 23);
      },
      getFloat64: function getFloat64(byteOffset /* , littleEndian */) {
        return unpackIEEE754(get(this, 8, byteOffset, arguments.length > 1 ? arguments[1] : undefined), 52);
      },
      setInt8: function setInt8(byteOffset, value) {
        set$1(this, 1, byteOffset, packInt8, value);
      },
      setUint8: function setUint8(byteOffset, value) {
        set$1(this, 1, byteOffset, packInt8, value);
      },
      setInt16: function setInt16(byteOffset, value /* , littleEndian */) {
        set$1(this, 2, byteOffset, packInt16, value, arguments.length > 2 ? arguments[2] : undefined);
      },
      setUint16: function setUint16(byteOffset, value /* , littleEndian */) {
        set$1(this, 2, byteOffset, packInt16, value, arguments.length > 2 ? arguments[2] : undefined);
      },
      setInt32: function setInt32(byteOffset, value /* , littleEndian */) {
        set$1(this, 4, byteOffset, packInt32, value, arguments.length > 2 ? arguments[2] : undefined);
      },
      setUint32: function setUint32(byteOffset, value /* , littleEndian */) {
        set$1(this, 4, byteOffset, packInt32, value, arguments.length > 2 ? arguments[2] : undefined);
      },
      setFloat32: function setFloat32(byteOffset, value /* , littleEndian */) {
        set$1(this, 4, byteOffset, packFloat32, value, arguments.length > 2 ? arguments[2] : undefined);
      },
      setFloat64: function setFloat64(byteOffset, value /* , littleEndian */) {
        set$1(this, 8, byteOffset, packFloat64, value, arguments.length > 2 ? arguments[2] : undefined);
      }
    });
  } else {
    var INCORRECT_ARRAY_BUFFER_NAME = PROPER_FUNCTION_NAME$2 && NativeArrayBuffer$1.name !== ARRAY_BUFFER$1;
    /* eslint-disable no-new -- required for testing */
    if (!fails$B(function () {
      NativeArrayBuffer$1(1);
    }) || !fails$B(function () {
      new NativeArrayBuffer$1(-1);
    }) || fails$B(function () {
      new NativeArrayBuffer$1();
      new NativeArrayBuffer$1(1.5);
      new NativeArrayBuffer$1(NaN);
      return NativeArrayBuffer$1.length != 1 || INCORRECT_ARRAY_BUFFER_NAME && !CONFIGURABLE_FUNCTION_NAME;
    })) {
      /* eslint-enable no-new -- required for testing */
      $ArrayBuffer = function ArrayBuffer(length) {
        anInstance$9(this, ArrayBufferPrototype$3);
        return new NativeArrayBuffer$1(toIndex$2(length));
      };

      $ArrayBuffer[PROTOTYPE] = ArrayBufferPrototype$3;

      for (var keys$1 = getOwnPropertyNames$3(NativeArrayBuffer$1), j = 0, key$2; keys$1.length > j;) {
        if (!((key$2 = keys$1[j++]) in $ArrayBuffer)) {
          createNonEnumerableProperty$8($ArrayBuffer, key$2, NativeArrayBuffer$1[key$2]);
        }
      }

      ArrayBufferPrototype$3.constructor = $ArrayBuffer;
    } else if (INCORRECT_ARRAY_BUFFER_NAME && CONFIGURABLE_FUNCTION_NAME) {
      createNonEnumerableProperty$8(NativeArrayBuffer$1, 'name', ARRAY_BUFFER$1);
    }

    // WebKit bug - the same parent prototype for typed arrays and data view
    if (setPrototypeOf$3 && getPrototypeOf$1(DataViewPrototype$2) !== ObjectPrototype$1) {
      setPrototypeOf$3(DataViewPrototype$2, ObjectPrototype$1);
    }

    // iOS Safari 7.x bug
    var testView = new $DataView(new $ArrayBuffer(2));
    var $setInt8 = uncurryThis$C(DataViewPrototype$2.setInt8);
    testView.setInt8(0, 2147483648);
    testView.setInt8(1, 2147483649);
    if (testView.getInt8(0) || !testView.getInt8(1)) defineBuiltIns$3(DataViewPrototype$2, {
      setInt8: function setInt8(byteOffset, value) {
        $setInt8(this, byteOffset, value << 24 >> 24);
      },
      setUint8: function setUint8(byteOffset, value) {
        $setInt8(this, byteOffset, value << 24 >> 24);
      }
    }, { unsafe: true });
  }

  setToStringTag$5($ArrayBuffer, ARRAY_BUFFER$1);
  setToStringTag$5($DataView, DATA_VIEW);

  var arrayBuffer = {
    ArrayBuffer: $ArrayBuffer,
    DataView: $DataView
  };

  var getBuiltIn$6 = getBuiltIn$f;
  var defineBuiltInAccessor$c = defineBuiltInAccessor$g;
  var wellKnownSymbol$g = wellKnownSymbol$x;
  var DESCRIPTORS$j = descriptors;

  var SPECIES$3 = wellKnownSymbol$g('species');

  var setSpecies$5 = function (CONSTRUCTOR_NAME) {
    var Constructor = getBuiltIn$6(CONSTRUCTOR_NAME);

    if (DESCRIPTORS$j && Constructor && !Constructor[SPECIES$3]) {
      defineBuiltInAccessor$c(Constructor, SPECIES$3, {
        configurable: true,
        get: function () { return this; }
      });
    }
  };

  var $$M = _export;
  var global$A = global$Q;
  var arrayBufferModule = arrayBuffer;
  var setSpecies$4 = setSpecies$5;

  var ARRAY_BUFFER = 'ArrayBuffer';
  var ArrayBuffer$5 = arrayBufferModule[ARRAY_BUFFER];
  var NativeArrayBuffer = global$A[ARRAY_BUFFER];

  // `ArrayBuffer` constructor
  // https://tc39.es/ecma262/#sec-arraybuffer-constructor
  $$M({ global: true, constructor: true, forced: NativeArrayBuffer !== ArrayBuffer$5 }, {
    ArrayBuffer: ArrayBuffer$5
  });

  setSpecies$4(ARRAY_BUFFER);

  var isConstructor = isConstructor$4;
  var tryToString$2 = tryToString$7;

  var $TypeError$c = TypeError;

  // `Assert: IsConstructor(argument) is true`
  var aConstructor$2 = function (argument) {
    if (isConstructor(argument)) return argument;
    throw $TypeError$c(tryToString$2(argument) + ' is not a constructor');
  };

  var anObject$i = anObject$s;
  var aConstructor$1 = aConstructor$2;
  var isNullOrUndefined$7 = isNullOrUndefined$b;
  var wellKnownSymbol$f = wellKnownSymbol$x;

  var SPECIES$2 = wellKnownSymbol$f('species');

  // `SpeciesConstructor` abstract operation
  // https://tc39.es/ecma262/#sec-speciesconstructor
  var speciesConstructor$4 = function (O, defaultConstructor) {
    var C = anObject$i(O).constructor;
    var S;
    return C === undefined || isNullOrUndefined$7(S = anObject$i(C)[SPECIES$2]) ? defaultConstructor : aConstructor$1(S);
  };

  var $$L = _export;
  var uncurryThis$B = functionUncurryThisClause;
  var fails$A = fails$V;
  var ArrayBufferModule$1 = arrayBuffer;
  var anObject$h = anObject$s;
  var toAbsoluteIndex$2 = toAbsoluteIndex$8;
  var toLength$6 = toLength$a;
  var speciesConstructor$3 = speciesConstructor$4;

  var ArrayBuffer$4 = ArrayBufferModule$1.ArrayBuffer;
  var DataView$3 = ArrayBufferModule$1.DataView;
  var DataViewPrototype$1 = DataView$3.prototype;
  var nativeArrayBufferSlice = uncurryThis$B(ArrayBuffer$4.prototype.slice);
  var getUint8 = uncurryThis$B(DataViewPrototype$1.getUint8);
  var setUint8 = uncurryThis$B(DataViewPrototype$1.setUint8);

  var INCORRECT_SLICE = fails$A(function () {
    return !new ArrayBuffer$4(2).slice(1, undefined).byteLength;
  });

  // `ArrayBuffer.prototype.slice` method
  // https://tc39.es/ecma262/#sec-arraybuffer.prototype.slice
  $$L({ target: 'ArrayBuffer', proto: true, unsafe: true, forced: INCORRECT_SLICE }, {
    slice: function slice(start, end) {
      if (nativeArrayBufferSlice && end === undefined) {
        return nativeArrayBufferSlice(anObject$h(this), start); // FF fix
      }
      var length = anObject$h(this).byteLength;
      var first = toAbsoluteIndex$2(start, length);
      var fin = toAbsoluteIndex$2(end === undefined ? length : end, length);
      var result = new (speciesConstructor$3(this, ArrayBuffer$4))(toLength$6(fin - first));
      var viewSource = new DataView$3(this);
      var viewTarget = new DataView$3(result);
      var index = 0;
      while (first < fin) {
        setUint8(viewTarget, index++, getUint8(viewSource, first++));
      } return result;
    }
  });

  var DESCRIPTORS$i = descriptors;
  var FUNCTION_NAME_EXISTS = functionName.EXISTS;
  var uncurryThis$A = functionUncurryThis;
  var defineBuiltInAccessor$b = defineBuiltInAccessor$g;

  var FunctionPrototype = Function.prototype;
  var functionToString = uncurryThis$A(FunctionPrototype.toString);
  var nameRE = /function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/;
  var regExpExec$3 = uncurryThis$A(nameRE.exec);
  var NAME$1 = 'name';

  // Function instances `.name` property
  // https://tc39.es/ecma262/#sec-function-instances-name
  if (DESCRIPTORS$i && !FUNCTION_NAME_EXISTS) {
    defineBuiltInAccessor$b(FunctionPrototype, NAME$1, {
      configurable: true,
      get: function () {
        try {
          return regExpExec$3(nameRE, functionToString(this))[1];
        } catch (error) {
          return '';
        }
      }
    });
  }

  var internalMetadata = {exports: {}};

  // FF26- bug: ArrayBuffers are non-extensible, but Object.isExtensible does not report it
  var fails$z = fails$V;

  var arrayBufferNonExtensible = fails$z(function () {
    if (typeof ArrayBuffer == 'function') {
      var buffer = new ArrayBuffer(8);
      // eslint-disable-next-line es/no-object-isextensible, es/no-object-defineproperty -- safe
      if (Object.isExtensible(buffer)) Object.defineProperty(buffer, 'a', { value: 8 });
    }
  });

  var fails$y = fails$V;
  var isObject$a = isObject$l;
  var classof$c = classofRaw$2;
  var ARRAY_BUFFER_NON_EXTENSIBLE = arrayBufferNonExtensible;

  // eslint-disable-next-line es/no-object-isextensible -- safe
  var $isExtensible = Object.isExtensible;
  var FAILS_ON_PRIMITIVES = fails$y(function () { $isExtensible(1); });

  // `Object.isExtensible` method
  // https://tc39.es/ecma262/#sec-object.isextensible
  var objectIsExtensible = (FAILS_ON_PRIMITIVES || ARRAY_BUFFER_NON_EXTENSIBLE) ? function isExtensible(it) {
    if (!isObject$a(it)) return false;
    if (ARRAY_BUFFER_NON_EXTENSIBLE && classof$c(it) == 'ArrayBuffer') return false;
    return $isExtensible ? $isExtensible(it) : true;
  } : $isExtensible;

  var fails$x = fails$V;

  var freezing = !fails$x(function () {
    // eslint-disable-next-line es/no-object-isextensible, es/no-object-preventextensions -- required for testing
    return Object.isExtensible(Object.preventExtensions({}));
  });

  var $$K = _export;
  var uncurryThis$z = functionUncurryThis;
  var hiddenKeys = hiddenKeys$6;
  var isObject$9 = isObject$l;
  var hasOwn$c = hasOwnProperty_1;
  var defineProperty$5 = objectDefineProperty.f;
  var getOwnPropertyNamesModule = objectGetOwnPropertyNames;
  var getOwnPropertyNamesExternalModule = objectGetOwnPropertyNamesExternal;
  var isExtensible = objectIsExtensible;
  var uid$1 = uid$5;
  var FREEZING = freezing;

  var REQUIRED = false;
  var METADATA = uid$1('meta');
  var id = 0;

  var setMetadata = function (it) {
    defineProperty$5(it, METADATA, { value: {
      objectID: 'O' + id++, // object ID
      weakData: {}          // weak collections IDs
    } });
  };

  var fastKey$1 = function (it, create) {
    // return a primitive with prefix
    if (!isObject$9(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
    if (!hasOwn$c(it, METADATA)) {
      // can't set metadata to uncaught frozen object
      if (!isExtensible(it)) return 'F';
      // not necessary to add metadata
      if (!create) return 'E';
      // add missing metadata
      setMetadata(it);
    // return object ID
    } return it[METADATA].objectID;
  };

  var getWeakData = function (it, create) {
    if (!hasOwn$c(it, METADATA)) {
      // can't set metadata to uncaught frozen object
      if (!isExtensible(it)) return true;
      // not necessary to add metadata
      if (!create) return false;
      // add missing metadata
      setMetadata(it);
    // return the store of weak collections IDs
    } return it[METADATA].weakData;
  };

  // add metadata on freeze-family methods calling
  var onFreeze = function (it) {
    if (FREEZING && REQUIRED && isExtensible(it) && !hasOwn$c(it, METADATA)) setMetadata(it);
    return it;
  };

  var enable = function () {
    meta.enable = function () { /* empty */ };
    REQUIRED = true;
    var getOwnPropertyNames = getOwnPropertyNamesModule.f;
    var splice = uncurryThis$z([].splice);
    var test = {};
    test[METADATA] = 1;

    // prevent exposing of metadata key
    if (getOwnPropertyNames(test).length) {
      getOwnPropertyNamesModule.f = function (it) {
        var result = getOwnPropertyNames(it);
        for (var i = 0, length = result.length; i < length; i++) {
          if (result[i] === METADATA) {
            splice(result, i, 1);
            break;
          }
        } return result;
      };

      $$K({ target: 'Object', stat: true, forced: true }, {
        getOwnPropertyNames: getOwnPropertyNamesExternalModule.f
      });
    }
  };

  var meta = internalMetadata.exports = {
    enable: enable,
    fastKey: fastKey$1,
    getWeakData: getWeakData,
    onFreeze: onFreeze
  };

  hiddenKeys[METADATA] = true;

  var internalMetadataExports = internalMetadata.exports;

  var bind$8 = functionBindContext;
  var call$o = functionCall;
  var anObject$g = anObject$s;
  var tryToString$1 = tryToString$7;
  var isArrayIteratorMethod$1 = isArrayIteratorMethod$3;
  var lengthOfArrayLike$c = lengthOfArrayLike$m;
  var isPrototypeOf$5 = objectIsPrototypeOf;
  var getIterator$2 = getIterator$4;
  var getIteratorMethod$2 = getIteratorMethod$5;
  var iteratorClose$1 = iteratorClose$3;

  var $TypeError$b = TypeError;

  var Result = function (stopped, result) {
    this.stopped = stopped;
    this.result = result;
  };

  var ResultPrototype = Result.prototype;

  var iterate$6 = function (iterable, unboundFunction, options) {
    var that = options && options.that;
    var AS_ENTRIES = !!(options && options.AS_ENTRIES);
    var IS_RECORD = !!(options && options.IS_RECORD);
    var IS_ITERATOR = !!(options && options.IS_ITERATOR);
    var INTERRUPTED = !!(options && options.INTERRUPTED);
    var fn = bind$8(unboundFunction, that);
    var iterator, iterFn, index, length, result, next, step;

    var stop = function (condition) {
      if (iterator) iteratorClose$1(iterator, 'normal', condition);
      return new Result(true, condition);
    };

    var callFn = function (value) {
      if (AS_ENTRIES) {
        anObject$g(value);
        return INTERRUPTED ? fn(value[0], value[1], stop) : fn(value[0], value[1]);
      } return INTERRUPTED ? fn(value, stop) : fn(value);
    };

    if (IS_RECORD) {
      iterator = iterable.iterator;
    } else if (IS_ITERATOR) {
      iterator = iterable;
    } else {
      iterFn = getIteratorMethod$2(iterable);
      if (!iterFn) throw $TypeError$b(tryToString$1(iterable) + ' is not iterable');
      // optimisation for array iterators
      if (isArrayIteratorMethod$1(iterFn)) {
        for (index = 0, length = lengthOfArrayLike$c(iterable); length > index; index++) {
          result = callFn(iterable[index]);
          if (result && isPrototypeOf$5(ResultPrototype, result)) return result;
        } return new Result(false);
      }
      iterator = getIterator$2(iterable, iterFn);
    }

    next = IS_RECORD ? iterable.next : iterator.next;
    while (!(step = call$o(next, iterator)).done) {
      try {
        result = callFn(step.value);
      } catch (error) {
        iteratorClose$1(iterator, 'throw', error);
      }
      if (typeof result == 'object' && result && isPrototypeOf$5(ResultPrototype, result)) return result;
    } return new Result(false);
  };

  var $$J = _export;
  var global$z = global$Q;
  var uncurryThis$y = functionUncurryThis;
  var isForced$3 = isForced_1;
  var defineBuiltIn$a = defineBuiltIn$h;
  var InternalMetadataModule = internalMetadataExports;
  var iterate$5 = iterate$6;
  var anInstance$8 = anInstance$a;
  var isCallable$c = isCallable$x;
  var isNullOrUndefined$6 = isNullOrUndefined$b;
  var isObject$8 = isObject$l;
  var fails$w = fails$V;
  var checkCorrectnessOfIteration$2 = checkCorrectnessOfIteration$4;
  var setToStringTag$4 = setToStringTag$9;
  var inheritIfRequired$4 = inheritIfRequired$6;

  var collection$1 = function (CONSTRUCTOR_NAME, wrapper, common) {
    var IS_MAP = CONSTRUCTOR_NAME.indexOf('Map') !== -1;
    var IS_WEAK = CONSTRUCTOR_NAME.indexOf('Weak') !== -1;
    var ADDER = IS_MAP ? 'set' : 'add';
    var NativeConstructor = global$z[CONSTRUCTOR_NAME];
    var NativePrototype = NativeConstructor && NativeConstructor.prototype;
    var Constructor = NativeConstructor;
    var exported = {};

    var fixMethod = function (KEY) {
      var uncurriedNativeMethod = uncurryThis$y(NativePrototype[KEY]);
      defineBuiltIn$a(NativePrototype, KEY,
        KEY == 'add' ? function add(value) {
          uncurriedNativeMethod(this, value === 0 ? 0 : value);
          return this;
        } : KEY == 'delete' ? function (key) {
          return IS_WEAK && !isObject$8(key) ? false : uncurriedNativeMethod(this, key === 0 ? 0 : key);
        } : KEY == 'get' ? function get(key) {
          return IS_WEAK && !isObject$8(key) ? undefined : uncurriedNativeMethod(this, key === 0 ? 0 : key);
        } : KEY == 'has' ? function has(key) {
          return IS_WEAK && !isObject$8(key) ? false : uncurriedNativeMethod(this, key === 0 ? 0 : key);
        } : function set(key, value) {
          uncurriedNativeMethod(this, key === 0 ? 0 : key, value);
          return this;
        }
      );
    };

    var REPLACE = isForced$3(
      CONSTRUCTOR_NAME,
      !isCallable$c(NativeConstructor) || !(IS_WEAK || NativePrototype.forEach && !fails$w(function () {
        new NativeConstructor().entries().next();
      }))
    );

    if (REPLACE) {
      // create collection constructor
      Constructor = common.getConstructor(wrapper, CONSTRUCTOR_NAME, IS_MAP, ADDER);
      InternalMetadataModule.enable();
    } else if (isForced$3(CONSTRUCTOR_NAME, true)) {
      var instance = new Constructor();
      // early implementations not supports chaining
      var HASNT_CHAINING = instance[ADDER](IS_WEAK ? {} : -0, 1) != instance;
      // V8 ~ Chromium 40- weak-collections throws on primitives, but should return false
      var THROWS_ON_PRIMITIVES = fails$w(function () { instance.has(1); });
      // most early implementations doesn't supports iterables, most modern - not close it correctly
      // eslint-disable-next-line no-new -- required for testing
      var ACCEPT_ITERABLES = checkCorrectnessOfIteration$2(function (iterable) { new NativeConstructor(iterable); });
      // for early implementations -0 and +0 not the same
      var BUGGY_ZERO = !IS_WEAK && fails$w(function () {
        // V8 ~ Chromium 42- fails only with 5+ elements
        var $instance = new NativeConstructor();
        var index = 5;
        while (index--) $instance[ADDER](index, index);
        return !$instance.has(-0);
      });

      if (!ACCEPT_ITERABLES) {
        Constructor = wrapper(function (dummy, iterable) {
          anInstance$8(dummy, NativePrototype);
          var that = inheritIfRequired$4(new NativeConstructor(), dummy, Constructor);
          if (!isNullOrUndefined$6(iterable)) iterate$5(iterable, that[ADDER], { that: that, AS_ENTRIES: IS_MAP });
          return that;
        });
        Constructor.prototype = NativePrototype;
        NativePrototype.constructor = Constructor;
      }

      if (THROWS_ON_PRIMITIVES || BUGGY_ZERO) {
        fixMethod('delete');
        fixMethod('has');
        IS_MAP && fixMethod('get');
      }

      if (BUGGY_ZERO || HASNT_CHAINING) fixMethod(ADDER);

      // weak collections should not contains .clear method
      if (IS_WEAK && NativePrototype.clear) delete NativePrototype.clear;
    }

    exported[CONSTRUCTOR_NAME] = Constructor;
    $$J({ global: true, constructor: true, forced: Constructor != NativeConstructor }, exported);

    setToStringTag$4(Constructor, CONSTRUCTOR_NAME);

    if (!IS_WEAK) common.setStrong(Constructor, CONSTRUCTOR_NAME, IS_MAP);

    return Constructor;
  };

  var create$6 = objectCreate;
  var defineBuiltInAccessor$a = defineBuiltInAccessor$g;
  var defineBuiltIns$2 = defineBuiltIns$4;
  var bind$7 = functionBindContext;
  var anInstance$7 = anInstance$a;
  var isNullOrUndefined$5 = isNullOrUndefined$b;
  var iterate$4 = iterate$6;
  var defineIterator$1 = iteratorDefine;
  var createIterResultObject$2 = createIterResultObject$4;
  var setSpecies$3 = setSpecies$5;
  var DESCRIPTORS$h = descriptors;
  var fastKey = internalMetadataExports.fastKey;
  var InternalStateModule$8 = internalState;

  var setInternalState$7 = InternalStateModule$8.set;
  var internalStateGetterFor = InternalStateModule$8.getterFor;

  var collectionStrong$1 = {
    getConstructor: function (wrapper, CONSTRUCTOR_NAME, IS_MAP, ADDER) {
      var Constructor = wrapper(function (that, iterable) {
        anInstance$7(that, Prototype);
        setInternalState$7(that, {
          type: CONSTRUCTOR_NAME,
          index: create$6(null),
          first: undefined,
          last: undefined,
          size: 0
        });
        if (!DESCRIPTORS$h) that.size = 0;
        if (!isNullOrUndefined$5(iterable)) iterate$4(iterable, that[ADDER], { that: that, AS_ENTRIES: IS_MAP });
      });

      var Prototype = Constructor.prototype;

      var getInternalState = internalStateGetterFor(CONSTRUCTOR_NAME);

      var define = function (that, key, value) {
        var state = getInternalState(that);
        var entry = getEntry(that, key);
        var previous, index;
        // change existing entry
        if (entry) {
          entry.value = value;
        // create new entry
        } else {
          state.last = entry = {
            index: index = fastKey(key, true),
            key: key,
            value: value,
            previous: previous = state.last,
            next: undefined,
            removed: false
          };
          if (!state.first) state.first = entry;
          if (previous) previous.next = entry;
          if (DESCRIPTORS$h) state.size++;
          else that.size++;
          // add to index
          if (index !== 'F') state.index[index] = entry;
        } return that;
      };

      var getEntry = function (that, key) {
        var state = getInternalState(that);
        // fast case
        var index = fastKey(key);
        var entry;
        if (index !== 'F') return state.index[index];
        // frozen object case
        for (entry = state.first; entry; entry = entry.next) {
          if (entry.key == key) return entry;
        }
      };

      defineBuiltIns$2(Prototype, {
        // `{ Map, Set }.prototype.clear()` methods
        // https://tc39.es/ecma262/#sec-map.prototype.clear
        // https://tc39.es/ecma262/#sec-set.prototype.clear
        clear: function clear() {
          var that = this;
          var state = getInternalState(that);
          var data = state.index;
          var entry = state.first;
          while (entry) {
            entry.removed = true;
            if (entry.previous) entry.previous = entry.previous.next = undefined;
            delete data[entry.index];
            entry = entry.next;
          }
          state.first = state.last = undefined;
          if (DESCRIPTORS$h) state.size = 0;
          else that.size = 0;
        },
        // `{ Map, Set }.prototype.delete(key)` methods
        // https://tc39.es/ecma262/#sec-map.prototype.delete
        // https://tc39.es/ecma262/#sec-set.prototype.delete
        'delete': function (key) {
          var that = this;
          var state = getInternalState(that);
          var entry = getEntry(that, key);
          if (entry) {
            var next = entry.next;
            var prev = entry.previous;
            delete state.index[entry.index];
            entry.removed = true;
            if (prev) prev.next = next;
            if (next) next.previous = prev;
            if (state.first == entry) state.first = next;
            if (state.last == entry) state.last = prev;
            if (DESCRIPTORS$h) state.size--;
            else that.size--;
          } return !!entry;
        },
        // `{ Map, Set }.prototype.forEach(callbackfn, thisArg = undefined)` methods
        // https://tc39.es/ecma262/#sec-map.prototype.foreach
        // https://tc39.es/ecma262/#sec-set.prototype.foreach
        forEach: function forEach(callbackfn /* , that = undefined */) {
          var state = getInternalState(this);
          var boundFunction = bind$7(callbackfn, arguments.length > 1 ? arguments[1] : undefined);
          var entry;
          while (entry = entry ? entry.next : state.first) {
            boundFunction(entry.value, entry.key, this);
            // revert to the last existing entry
            while (entry && entry.removed) entry = entry.previous;
          }
        },
        // `{ Map, Set}.prototype.has(key)` methods
        // https://tc39.es/ecma262/#sec-map.prototype.has
        // https://tc39.es/ecma262/#sec-set.prototype.has
        has: function has(key) {
          return !!getEntry(this, key);
        }
      });

      defineBuiltIns$2(Prototype, IS_MAP ? {
        // `Map.prototype.get(key)` method
        // https://tc39.es/ecma262/#sec-map.prototype.get
        get: function get(key) {
          var entry = getEntry(this, key);
          return entry && entry.value;
        },
        // `Map.prototype.set(key, value)` method
        // https://tc39.es/ecma262/#sec-map.prototype.set
        set: function set(key, value) {
          return define(this, key === 0 ? 0 : key, value);
        }
      } : {
        // `Set.prototype.add(value)` method
        // https://tc39.es/ecma262/#sec-set.prototype.add
        add: function add(value) {
          return define(this, value = value === 0 ? 0 : value, value);
        }
      });
      if (DESCRIPTORS$h) defineBuiltInAccessor$a(Prototype, 'size', {
        configurable: true,
        get: function () {
          return getInternalState(this).size;
        }
      });
      return Constructor;
    },
    setStrong: function (Constructor, CONSTRUCTOR_NAME, IS_MAP) {
      var ITERATOR_NAME = CONSTRUCTOR_NAME + ' Iterator';
      var getInternalCollectionState = internalStateGetterFor(CONSTRUCTOR_NAME);
      var getInternalIteratorState = internalStateGetterFor(ITERATOR_NAME);
      // `{ Map, Set }.prototype.{ keys, values, entries, @@iterator }()` methods
      // https://tc39.es/ecma262/#sec-map.prototype.entries
      // https://tc39.es/ecma262/#sec-map.prototype.keys
      // https://tc39.es/ecma262/#sec-map.prototype.values
      // https://tc39.es/ecma262/#sec-map.prototype-@@iterator
      // https://tc39.es/ecma262/#sec-set.prototype.entries
      // https://tc39.es/ecma262/#sec-set.prototype.keys
      // https://tc39.es/ecma262/#sec-set.prototype.values
      // https://tc39.es/ecma262/#sec-set.prototype-@@iterator
      defineIterator$1(Constructor, CONSTRUCTOR_NAME, function (iterated, kind) {
        setInternalState$7(this, {
          type: ITERATOR_NAME,
          target: iterated,
          state: getInternalCollectionState(iterated),
          kind: kind,
          last: undefined
        });
      }, function () {
        var state = getInternalIteratorState(this);
        var kind = state.kind;
        var entry = state.last;
        // revert to the last existing entry
        while (entry && entry.removed) entry = entry.previous;
        // get next entry
        if (!state.target || !(state.last = entry = entry ? entry.next : state.state.first)) {
          // or finish the iteration
          state.target = undefined;
          return createIterResultObject$2(undefined, true);
        }
        // return step by kind
        if (kind == 'keys') return createIterResultObject$2(entry.key, false);
        if (kind == 'values') return createIterResultObject$2(entry.value, false);
        return createIterResultObject$2([entry.key, entry.value], false);
      }, IS_MAP ? 'entries' : 'values', !IS_MAP, true);

      // `{ Map, Set }.prototype[@@species]` accessors
      // https://tc39.es/ecma262/#sec-get-map-@@species
      // https://tc39.es/ecma262/#sec-get-set-@@species
      setSpecies$3(CONSTRUCTOR_NAME);
    }
  };

  var collection = collection$1;
  var collectionStrong = collectionStrong$1;

  // `Map` constructor
  // https://tc39.es/ecma262/#sec-map-objects
  collection('Map', function (init) {
    return function Map() { return init(this, arguments.length ? arguments[0] : undefined); };
  }, collectionStrong);

  var uncurryThis$x = functionUncurryThis;

  // `thisNumberValue` abstract operation
  // https://tc39.es/ecma262/#sec-thisnumbervalue
  var thisNumberValue$2 = uncurryThis$x(1.0.valueOf);

  var toIntegerOrInfinity$8 = toIntegerOrInfinity$e;
  var toString$i = toString$n;
  var requireObjectCoercible$9 = requireObjectCoercible$c;

  var $RangeError$5 = RangeError;

  // `String.prototype.repeat` method implementation
  // https://tc39.es/ecma262/#sec-string.prototype.repeat
  var stringRepeat = function repeat(count) {
    var str = toString$i(requireObjectCoercible$9(this));
    var result = '';
    var n = toIntegerOrInfinity$8(count);
    if (n < 0 || n == Infinity) throw $RangeError$5('Wrong number of repetitions');
    for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) result += str;
    return result;
  };

  var $$I = _export;
  var uncurryThis$w = functionUncurryThis;
  var toIntegerOrInfinity$7 = toIntegerOrInfinity$e;
  var thisNumberValue$1 = thisNumberValue$2;
  var $repeat = stringRepeat;
  var fails$v = fails$V;

  var $RangeError$4 = RangeError;
  var $String = String;
  var floor$7 = Math.floor;
  var repeat = uncurryThis$w($repeat);
  var stringSlice$b = uncurryThis$w(''.slice);
  var nativeToFixed = uncurryThis$w(1.0.toFixed);

  var pow$2 = function (x, n, acc) {
    return n === 0 ? acc : n % 2 === 1 ? pow$2(x, n - 1, acc * x) : pow$2(x * x, n / 2, acc);
  };

  var log$1 = function (x) {
    var n = 0;
    var x2 = x;
    while (x2 >= 4096) {
      n += 12;
      x2 /= 4096;
    }
    while (x2 >= 2) {
      n += 1;
      x2 /= 2;
    } return n;
  };

  var multiply = function (data, n, c) {
    var index = -1;
    var c2 = c;
    while (++index < 6) {
      c2 += n * data[index];
      data[index] = c2 % 1e7;
      c2 = floor$7(c2 / 1e7);
    }
  };

  var divide = function (data, n) {
    var index = 6;
    var c = 0;
    while (--index >= 0) {
      c += data[index];
      data[index] = floor$7(c / n);
      c = (c % n) * 1e7;
    }
  };

  var dataToString = function (data) {
    var index = 6;
    var s = '';
    while (--index >= 0) {
      if (s !== '' || index === 0 || data[index] !== 0) {
        var t = $String(data[index]);
        s = s === '' ? t : s + repeat('0', 7 - t.length) + t;
      }
    } return s;
  };

  var FORCED$a = fails$v(function () {
    return nativeToFixed(0.00008, 3) !== '0.000' ||
      nativeToFixed(0.9, 0) !== '1' ||
      nativeToFixed(1.255, 2) !== '1.25' ||
      nativeToFixed(1000000000000000128.0, 0) !== '1000000000000000128';
  }) || !fails$v(function () {
    // V8 ~ Android 4.3-
    nativeToFixed({});
  });

  // `Number.prototype.toFixed` method
  // https://tc39.es/ecma262/#sec-number.prototype.tofixed
  $$I({ target: 'Number', proto: true, forced: FORCED$a }, {
    toFixed: function toFixed(fractionDigits) {
      var number = thisNumberValue$1(this);
      var fractDigits = toIntegerOrInfinity$7(fractionDigits);
      var data = [0, 0, 0, 0, 0, 0];
      var sign = '';
      var result = '0';
      var e, z, j, k;

      // TODO: ES2018 increased the maximum number of fraction digits to 100, need to improve the implementation
      if (fractDigits < 0 || fractDigits > 20) throw $RangeError$4('Incorrect fraction digits');
      // eslint-disable-next-line no-self-compare -- NaN check
      if (number != number) return 'NaN';
      if (number <= -1e21 || number >= 1e21) return $String(number);
      if (number < 0) {
        sign = '-';
        number = -number;
      }
      if (number > 1e-21) {
        e = log$1(number * pow$2(2, 69, 1)) - 69;
        z = e < 0 ? number * pow$2(2, -e, 1) : number / pow$2(2, e, 1);
        z *= 0x10000000000000;
        e = 52 - e;
        if (e > 0) {
          multiply(data, 0, z);
          j = fractDigits;
          while (j >= 7) {
            multiply(data, 1e7, 0);
            j -= 7;
          }
          multiply(data, pow$2(10, j, 1), 0);
          j = e - 1;
          while (j >= 23) {
            divide(data, 1 << 23);
            j -= 23;
          }
          divide(data, 1 << j);
          multiply(data, 1, 1);
          divide(data, 2);
          result = dataToString(data);
        } else {
          multiply(data, 0, z);
          multiply(data, 1 << -e, 0);
          result = dataToString(data) + repeat('0', fractDigits);
        }
      }
      if (fractDigits > 0) {
        k = result.length;
        result = sign + (k <= fractDigits
          ? '0.' + repeat('0', fractDigits - k) + result
          : stringSlice$b(result, 0, k - fractDigits) + '.' + stringSlice$b(result, k - fractDigits));
      } else {
        result = sign + result;
      } return result;
    }
  });

  var TO_STRING_TAG_SUPPORT$1 = toStringTagSupport;
  var classof$b = classof$j;

  // `Object.prototype.toString` method implementation
  // https://tc39.es/ecma262/#sec-object.prototype.tostring
  var objectToString = TO_STRING_TAG_SUPPORT$1 ? {}.toString : function toString() {
    return '[object ' + classof$b(this) + ']';
  };

  var TO_STRING_TAG_SUPPORT = toStringTagSupport;
  var defineBuiltIn$9 = defineBuiltIn$h;
  var toString$h = objectToString;

  // `Object.prototype.toString` method
  // https://tc39.es/ecma262/#sec-object.prototype.tostring
  if (!TO_STRING_TAG_SUPPORT) {
    defineBuiltIn$9(Object.prototype, 'toString', toString$h, { unsafe: true });
  }

  // a string of all valid unicode whitespaces
  var whitespaces$5 = '\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u2000\u2001\u2002' +
    '\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF';

  var uncurryThis$v = functionUncurryThis;
  var requireObjectCoercible$8 = requireObjectCoercible$c;
  var toString$g = toString$n;
  var whitespaces$4 = whitespaces$5;

  var replace$7 = uncurryThis$v(''.replace);
  var ltrim = RegExp('^[' + whitespaces$4 + ']+');
  var rtrim = RegExp('(^|[^' + whitespaces$4 + '])[' + whitespaces$4 + ']+$');

  // `String.prototype.{ trim, trimStart, trimEnd, trimLeft, trimRight }` methods implementation
  var createMethod$4 = function (TYPE) {
    return function ($this) {
      var string = toString$g(requireObjectCoercible$8($this));
      if (TYPE & 1) string = replace$7(string, ltrim, '');
      if (TYPE & 2) string = replace$7(string, rtrim, '$1');
      return string;
    };
  };

  var stringTrim = {
    // `String.prototype.trim` method
    // https://tc39.es/ecma262/#sec-string.prototype.trim
    trim: createMethod$4(3)
  };

  var global$y = global$Q;
  var fails$u = fails$V;
  var uncurryThis$u = functionUncurryThis;
  var toString$f = toString$n;
  var trim$2 = stringTrim.trim;
  var whitespaces$3 = whitespaces$5;

  var $parseInt$1 = global$y.parseInt;
  var Symbol$2 = global$y.Symbol;
  var ITERATOR$5 = Symbol$2 && Symbol$2.iterator;
  var hex = /^[+-]?0x/i;
  var exec$6 = uncurryThis$u(hex.exec);
  var FORCED$9 = $parseInt$1(whitespaces$3 + '08') !== 8 || $parseInt$1(whitespaces$3 + '0x16') !== 22
    // MS Edge 18- broken with boxed symbols
    || (ITERATOR$5 && !fails$u(function () { $parseInt$1(Object(ITERATOR$5)); }));

  // `parseInt` method
  // https://tc39.es/ecma262/#sec-parseint-string-radix
  var numberParseInt = FORCED$9 ? function parseInt(string, radix) {
    var S = trim$2(toString$f(string));
    return $parseInt$1(S, (radix >>> 0) || (exec$6(hex, S) ? 16 : 10));
  } : $parseInt$1;

  var $$H = _export;
  var $parseInt = numberParseInt;

  // `parseInt` method
  // https://tc39.es/ecma262/#sec-parseint-string-radix
  $$H({ global: true, forced: parseInt != $parseInt }, {
    parseInt: $parseInt
  });

  var classof$a = classofRaw$2;

  var engineIsNode = typeof process != 'undefined' && classof$a(process) == 'process';

  var $TypeError$a = TypeError;

  var validateArgumentsLength$5 = function (passed, required) {
    if (passed < required) throw $TypeError$a('Not enough arguments');
    return passed;
  };

  var userAgent$4 = engineUserAgent;

  // eslint-disable-next-line redos/no-vulnerable -- safe
  var engineIsIos = /(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent$4);

  var global$x = global$Q;
  var apply$6 = functionApply;
  var bind$6 = functionBindContext;
  var isCallable$b = isCallable$x;
  var hasOwn$b = hasOwnProperty_1;
  var fails$t = fails$V;
  var html = html$2;
  var arraySlice$6 = arraySlice$9;
  var createElement = documentCreateElement$2;
  var validateArgumentsLength$4 = validateArgumentsLength$5;
  var IS_IOS$1 = engineIsIos;
  var IS_NODE$5 = engineIsNode;

  var set = global$x.setImmediate;
  var clear$1 = global$x.clearImmediate;
  var process$3 = global$x.process;
  var Dispatch = global$x.Dispatch;
  var Function$2 = global$x.Function;
  var MessageChannel$1 = global$x.MessageChannel;
  var String$1 = global$x.String;
  var counter = 0;
  var queue$2 = {};
  var ONREADYSTATECHANGE = 'onreadystatechange';
  var $location, defer, channel, port;

  fails$t(function () {
    // Deno throws a ReferenceError on `location` access without `--location` flag
    $location = global$x.location;
  });

  var run = function (id) {
    if (hasOwn$b(queue$2, id)) {
      var fn = queue$2[id];
      delete queue$2[id];
      fn();
    }
  };

  var runner = function (id) {
    return function () {
      run(id);
    };
  };

  var eventListener = function (event) {
    run(event.data);
  };

  var globalPostMessageDefer = function (id) {
    // old engines have not location.origin
    global$x.postMessage(String$1(id), $location.protocol + '//' + $location.host);
  };

  // Node.js 0.9+ & IE10+ has setImmediate, otherwise:
  if (!set || !clear$1) {
    set = function setImmediate(handler) {
      validateArgumentsLength$4(arguments.length, 1);
      var fn = isCallable$b(handler) ? handler : Function$2(handler);
      var args = arraySlice$6(arguments, 1);
      queue$2[++counter] = function () {
        apply$6(fn, undefined, args);
      };
      defer(counter);
      return counter;
    };
    clear$1 = function clearImmediate(id) {
      delete queue$2[id];
    };
    // Node.js 0.8-
    if (IS_NODE$5) {
      defer = function (id) {
        process$3.nextTick(runner(id));
      };
    // Sphere (JS game engine) Dispatch API
    } else if (Dispatch && Dispatch.now) {
      defer = function (id) {
        Dispatch.now(runner(id));
      };
    // Browsers with MessageChannel, includes WebWorkers
    // except iOS - https://github.com/zloirock/core-js/issues/624
    } else if (MessageChannel$1 && !IS_IOS$1) {
      channel = new MessageChannel$1();
      port = channel.port2;
      channel.port1.onmessage = eventListener;
      defer = bind$6(port.postMessage, port);
    // Browsers with postMessage, skip WebWorkers
    // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
    } else if (
      global$x.addEventListener &&
      isCallable$b(global$x.postMessage) &&
      !global$x.importScripts &&
      $location && $location.protocol !== 'file:' &&
      !fails$t(globalPostMessageDefer)
    ) {
      defer = globalPostMessageDefer;
      global$x.addEventListener('message', eventListener, false);
    // IE8-
    } else if (ONREADYSTATECHANGE in createElement('script')) {
      defer = function (id) {
        html.appendChild(createElement('script'))[ONREADYSTATECHANGE] = function () {
          html.removeChild(this);
          run(id);
        };
      };
    // Rest old browsers
    } else {
      defer = function (id) {
        setTimeout(runner(id), 0);
      };
    }
  }

  var task$1 = {
    set: set,
    clear: clear$1
  };

  var Queue$2 = function () {
    this.head = null;
    this.tail = null;
  };

  Queue$2.prototype = {
    add: function (item) {
      var entry = { item: item, next: null };
      var tail = this.tail;
      if (tail) tail.next = entry;
      else this.head = entry;
      this.tail = entry;
    },
    get: function () {
      var entry = this.head;
      if (entry) {
        var next = this.head = entry.next;
        if (next === null) this.tail = null;
        return entry.item;
      }
    }
  };

  var queue$1 = Queue$2;

  var userAgent$3 = engineUserAgent;

  var engineIsIosPebble = /ipad|iphone|ipod/i.test(userAgent$3) && typeof Pebble != 'undefined';

  var userAgent$2 = engineUserAgent;

  var engineIsWebosWebkit = /web0s(?!.*chrome)/i.test(userAgent$2);

  var global$w = global$Q;
  var bind$5 = functionBindContext;
  var getOwnPropertyDescriptor$3 = objectGetOwnPropertyDescriptor.f;
  var macrotask = task$1.set;
  var Queue$1 = queue$1;
  var IS_IOS = engineIsIos;
  var IS_IOS_PEBBLE = engineIsIosPebble;
  var IS_WEBOS_WEBKIT = engineIsWebosWebkit;
  var IS_NODE$4 = engineIsNode;

  var MutationObserver = global$w.MutationObserver || global$w.WebKitMutationObserver;
  var document$2 = global$w.document;
  var process$2 = global$w.process;
  var Promise$1 = global$w.Promise;
  // Node.js 11 shows ExperimentalWarning on getting `queueMicrotask`
  var queueMicrotaskDescriptor = getOwnPropertyDescriptor$3(global$w, 'queueMicrotask');
  var microtask$1 = queueMicrotaskDescriptor && queueMicrotaskDescriptor.value;
  var notify$1, toggle, node, promise, then;

  // modern engines have queueMicrotask method
  if (!microtask$1) {
    var queue = new Queue$1();

    var flush = function () {
      var parent, fn;
      if (IS_NODE$4 && (parent = process$2.domain)) parent.exit();
      while (fn = queue.get()) try {
        fn();
      } catch (error) {
        if (queue.head) notify$1();
        throw error;
      }
      if (parent) parent.enter();
    };

    // browsers with MutationObserver, except iOS - https://github.com/zloirock/core-js/issues/339
    // also except WebOS Webkit https://github.com/zloirock/core-js/issues/898
    if (!IS_IOS && !IS_NODE$4 && !IS_WEBOS_WEBKIT && MutationObserver && document$2) {
      toggle = true;
      node = document$2.createTextNode('');
      new MutationObserver(flush).observe(node, { characterData: true });
      notify$1 = function () {
        node.data = toggle = !toggle;
      };
    // environments with maybe non-completely correct, but existent Promise
    } else if (!IS_IOS_PEBBLE && Promise$1 && Promise$1.resolve) {
      // Promise.resolve without an argument throws an error in LG WebOS 2
      promise = Promise$1.resolve(undefined);
      // workaround of WebKit ~ iOS Safari 10.1 bug
      promise.constructor = Promise$1;
      then = bind$5(promise.then, promise);
      notify$1 = function () {
        then(flush);
      };
    // Node.js without promises
    } else if (IS_NODE$4) {
      notify$1 = function () {
        process$2.nextTick(flush);
      };
    // for other environments - macrotask based on:
    // - setImmediate
    // - MessageChannel
    // - window.postMessage
    // - onreadystatechange
    // - setTimeout
    } else {
      // `webpack` dev server bug on IE global methods - use bind(fn, global)
      macrotask = bind$5(macrotask, global$w);
      notify$1 = function () {
        macrotask(flush);
      };
    }

    microtask$1 = function (fn) {
      if (!queue.head) notify$1();
      queue.add(fn);
    };
  }

  var microtask_1 = microtask$1;

  var hostReportErrors$1 = function (a, b) {
    try {
      // eslint-disable-next-line no-console -- safe
      arguments.length == 1 ? console.error(a) : console.error(a, b);
    } catch (error) { /* empty */ }
  };

  var perform$3 = function (exec) {
    try {
      return { error: false, value: exec() };
    } catch (error) {
      return { error: true, value: error };
    }
  };

  var global$v = global$Q;

  var promiseNativeConstructor = global$v.Promise;

  /* global Deno -- Deno case */

  var engineIsDeno = typeof Deno == 'object' && Deno && typeof Deno.version == 'object';

  var IS_DENO$2 = engineIsDeno;
  var IS_NODE$3 = engineIsNode;

  var engineIsBrowser = !IS_DENO$2 && !IS_NODE$3
    && typeof window == 'object'
    && typeof document == 'object';

  var global$u = global$Q;
  var NativePromiseConstructor$3 = promiseNativeConstructor;
  var isCallable$a = isCallable$x;
  var isForced$2 = isForced_1;
  var inspectSource = inspectSource$3;
  var wellKnownSymbol$e = wellKnownSymbol$x;
  var IS_BROWSER$1 = engineIsBrowser;
  var IS_DENO$1 = engineIsDeno;
  var V8_VERSION$1 = engineV8Version;

  NativePromiseConstructor$3 && NativePromiseConstructor$3.prototype;
  var SPECIES$1 = wellKnownSymbol$e('species');
  var SUBCLASSING = false;
  var NATIVE_PROMISE_REJECTION_EVENT$1 = isCallable$a(global$u.PromiseRejectionEvent);

  var FORCED_PROMISE_CONSTRUCTOR$5 = isForced$2('Promise', function () {
    var PROMISE_CONSTRUCTOR_SOURCE = inspectSource(NativePromiseConstructor$3);
    var GLOBAL_CORE_JS_PROMISE = PROMISE_CONSTRUCTOR_SOURCE !== String(NativePromiseConstructor$3);
    // V8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables
    // https://bugs.chromium.org/p/chromium/issues/detail?id=830565
    // We can't detect it synchronously, so just check versions
    if (!GLOBAL_CORE_JS_PROMISE && V8_VERSION$1 === 66) return true;
    // We can't use @@species feature detection in V8 since it causes
    // deoptimization and performance degradation
    // https://github.com/zloirock/core-js/issues/679
    if (!V8_VERSION$1 || V8_VERSION$1 < 51 || !/native code/.test(PROMISE_CONSTRUCTOR_SOURCE)) {
      // Detect correctness of subclassing with @@species support
      var promise = new NativePromiseConstructor$3(function (resolve) { resolve(1); });
      var FakePromise = function (exec) {
        exec(function () { /* empty */ }, function () { /* empty */ });
      };
      var constructor = promise.constructor = {};
      constructor[SPECIES$1] = FakePromise;
      SUBCLASSING = promise.then(function () { /* empty */ }) instanceof FakePromise;
      if (!SUBCLASSING) return true;
    // Unhandled rejections tracking support, NodeJS Promise without it fails @@species test
    } return !GLOBAL_CORE_JS_PROMISE && (IS_BROWSER$1 || IS_DENO$1) && !NATIVE_PROMISE_REJECTION_EVENT$1;
  });

  var promiseConstructorDetection = {
    CONSTRUCTOR: FORCED_PROMISE_CONSTRUCTOR$5,
    REJECTION_EVENT: NATIVE_PROMISE_REJECTION_EVENT$1,
    SUBCLASSING: SUBCLASSING
  };

  var newPromiseCapability$2 = {};

  var aCallable$c = aCallable$h;

  var $TypeError$9 = TypeError;

  var PromiseCapability = function (C) {
    var resolve, reject;
    this.promise = new C(function ($$resolve, $$reject) {
      if (resolve !== undefined || reject !== undefined) throw $TypeError$9('Bad Promise constructor');
      resolve = $$resolve;
      reject = $$reject;
    });
    this.resolve = aCallable$c(resolve);
    this.reject = aCallable$c(reject);
  };

  // `NewPromiseCapability` abstract operation
  // https://tc39.es/ecma262/#sec-newpromisecapability
  newPromiseCapability$2.f = function (C) {
    return new PromiseCapability(C);
  };

  var $$G = _export;
  var IS_NODE$2 = engineIsNode;
  var global$t = global$Q;
  var call$n = functionCall;
  var defineBuiltIn$8 = defineBuiltIn$h;
  var setPrototypeOf$2 = objectSetPrototypeOf;
  var setToStringTag$3 = setToStringTag$9;
  var setSpecies$2 = setSpecies$5;
  var aCallable$b = aCallable$h;
  var isCallable$9 = isCallable$x;
  var isObject$7 = isObject$l;
  var anInstance$6 = anInstance$a;
  var speciesConstructor$2 = speciesConstructor$4;
  var task = task$1.set;
  var microtask = microtask_1;
  var hostReportErrors = hostReportErrors$1;
  var perform$2 = perform$3;
  var Queue = queue$1;
  var InternalStateModule$7 = internalState;
  var NativePromiseConstructor$2 = promiseNativeConstructor;
  var PromiseConstructorDetection = promiseConstructorDetection;
  var newPromiseCapabilityModule$3 = newPromiseCapability$2;

  var PROMISE = 'Promise';
  var FORCED_PROMISE_CONSTRUCTOR$4 = PromiseConstructorDetection.CONSTRUCTOR;
  var NATIVE_PROMISE_REJECTION_EVENT = PromiseConstructorDetection.REJECTION_EVENT;
  var NATIVE_PROMISE_SUBCLASSING = PromiseConstructorDetection.SUBCLASSING;
  var getInternalPromiseState = InternalStateModule$7.getterFor(PROMISE);
  var setInternalState$6 = InternalStateModule$7.set;
  var NativePromisePrototype$1 = NativePromiseConstructor$2 && NativePromiseConstructor$2.prototype;
  var PromiseConstructor = NativePromiseConstructor$2;
  var PromisePrototype = NativePromisePrototype$1;
  var TypeError$6 = global$t.TypeError;
  var document$1 = global$t.document;
  var process$1 = global$t.process;
  var newPromiseCapability$1 = newPromiseCapabilityModule$3.f;
  var newGenericPromiseCapability = newPromiseCapability$1;

  var DISPATCH_EVENT = !!(document$1 && document$1.createEvent && global$t.dispatchEvent);
  var UNHANDLED_REJECTION = 'unhandledrejection';
  var REJECTION_HANDLED = 'rejectionhandled';
  var PENDING = 0;
  var FULFILLED = 1;
  var REJECTED = 2;
  var HANDLED = 1;
  var UNHANDLED = 2;

  var Internal, OwnPromiseCapability, PromiseWrapper, nativeThen;

  // helpers
  var isThenable = function (it) {
    var then;
    return isObject$7(it) && isCallable$9(then = it.then) ? then : false;
  };

  var callReaction = function (reaction, state) {
    var value = state.value;
    var ok = state.state == FULFILLED;
    var handler = ok ? reaction.ok : reaction.fail;
    var resolve = reaction.resolve;
    var reject = reaction.reject;
    var domain = reaction.domain;
    var result, then, exited;
    try {
      if (handler) {
        if (!ok) {
          if (state.rejection === UNHANDLED) onHandleUnhandled(state);
          state.rejection = HANDLED;
        }
        if (handler === true) result = value;
        else {
          if (domain) domain.enter();
          result = handler(value); // can throw
          if (domain) {
            domain.exit();
            exited = true;
          }
        }
        if (result === reaction.promise) {
          reject(TypeError$6('Promise-chain cycle'));
        } else if (then = isThenable(result)) {
          call$n(then, result, resolve, reject);
        } else resolve(result);
      } else reject(value);
    } catch (error) {
      if (domain && !exited) domain.exit();
      reject(error);
    }
  };

  var notify = function (state, isReject) {
    if (state.notified) return;
    state.notified = true;
    microtask(function () {
      var reactions = state.reactions;
      var reaction;
      while (reaction = reactions.get()) {
        callReaction(reaction, state);
      }
      state.notified = false;
      if (isReject && !state.rejection) onUnhandled(state);
    });
  };

  var dispatchEvent = function (name, promise, reason) {
    var event, handler;
    if (DISPATCH_EVENT) {
      event = document$1.createEvent('Event');
      event.promise = promise;
      event.reason = reason;
      event.initEvent(name, false, true);
      global$t.dispatchEvent(event);
    } else event = { promise: promise, reason: reason };
    if (!NATIVE_PROMISE_REJECTION_EVENT && (handler = global$t['on' + name])) handler(event);
    else if (name === UNHANDLED_REJECTION) hostReportErrors('Unhandled promise rejection', reason);
  };

  var onUnhandled = function (state) {
    call$n(task, global$t, function () {
      var promise = state.facade;
      var value = state.value;
      var IS_UNHANDLED = isUnhandled(state);
      var result;
      if (IS_UNHANDLED) {
        result = perform$2(function () {
          if (IS_NODE$2) {
            process$1.emit('unhandledRejection', value, promise);
          } else dispatchEvent(UNHANDLED_REJECTION, promise, value);
        });
        // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should
        state.rejection = IS_NODE$2 || isUnhandled(state) ? UNHANDLED : HANDLED;
        if (result.error) throw result.value;
      }
    });
  };

  var isUnhandled = function (state) {
    return state.rejection !== HANDLED && !state.parent;
  };

  var onHandleUnhandled = function (state) {
    call$n(task, global$t, function () {
      var promise = state.facade;
      if (IS_NODE$2) {
        process$1.emit('rejectionHandled', promise);
      } else dispatchEvent(REJECTION_HANDLED, promise, state.value);
    });
  };

  var bind$4 = function (fn, state, unwrap) {
    return function (value) {
      fn(state, value, unwrap);
    };
  };

  var internalReject = function (state, value, unwrap) {
    if (state.done) return;
    state.done = true;
    if (unwrap) state = unwrap;
    state.value = value;
    state.state = REJECTED;
    notify(state, true);
  };

  var internalResolve = function (state, value, unwrap) {
    if (state.done) return;
    state.done = true;
    if (unwrap) state = unwrap;
    try {
      if (state.facade === value) throw TypeError$6("Promise can't be resolved itself");
      var then = isThenable(value);
      if (then) {
        microtask(function () {
          var wrapper = { done: false };
          try {
            call$n(then, value,
              bind$4(internalResolve, wrapper, state),
              bind$4(internalReject, wrapper, state)
            );
          } catch (error) {
            internalReject(wrapper, error, state);
          }
        });
      } else {
        state.value = value;
        state.state = FULFILLED;
        notify(state, false);
      }
    } catch (error) {
      internalReject({ done: false }, error, state);
    }
  };

  // constructor polyfill
  if (FORCED_PROMISE_CONSTRUCTOR$4) {
    // 25.4.3.1 Promise(executor)
    PromiseConstructor = function Promise(executor) {
      anInstance$6(this, PromisePrototype);
      aCallable$b(executor);
      call$n(Internal, this);
      var state = getInternalPromiseState(this);
      try {
        executor(bind$4(internalResolve, state), bind$4(internalReject, state));
      } catch (error) {
        internalReject(state, error);
      }
    };

    PromisePrototype = PromiseConstructor.prototype;

    // eslint-disable-next-line no-unused-vars -- required for `.length`
    Internal = function Promise(executor) {
      setInternalState$6(this, {
        type: PROMISE,
        done: false,
        notified: false,
        parent: false,
        reactions: new Queue(),
        rejection: false,
        state: PENDING,
        value: undefined
      });
    };

    // `Promise.prototype.then` method
    // https://tc39.es/ecma262/#sec-promise.prototype.then
    Internal.prototype = defineBuiltIn$8(PromisePrototype, 'then', function then(onFulfilled, onRejected) {
      var state = getInternalPromiseState(this);
      var reaction = newPromiseCapability$1(speciesConstructor$2(this, PromiseConstructor));
      state.parent = true;
      reaction.ok = isCallable$9(onFulfilled) ? onFulfilled : true;
      reaction.fail = isCallable$9(onRejected) && onRejected;
      reaction.domain = IS_NODE$2 ? process$1.domain : undefined;
      if (state.state == PENDING) state.reactions.add(reaction);
      else microtask(function () {
        callReaction(reaction, state);
      });
      return reaction.promise;
    });

    OwnPromiseCapability = function () {
      var promise = new Internal();
      var state = getInternalPromiseState(promise);
      this.promise = promise;
      this.resolve = bind$4(internalResolve, state);
      this.reject = bind$4(internalReject, state);
    };

    newPromiseCapabilityModule$3.f = newPromiseCapability$1 = function (C) {
      return C === PromiseConstructor || C === PromiseWrapper
        ? new OwnPromiseCapability(C)
        : newGenericPromiseCapability(C);
    };

    if (isCallable$9(NativePromiseConstructor$2) && NativePromisePrototype$1 !== Object.prototype) {
      nativeThen = NativePromisePrototype$1.then;

      if (!NATIVE_PROMISE_SUBCLASSING) {
        // make `Promise#then` return a polyfilled `Promise` for native promise-based APIs
        defineBuiltIn$8(NativePromisePrototype$1, 'then', function then(onFulfilled, onRejected) {
          var that = this;
          return new PromiseConstructor(function (resolve, reject) {
            call$n(nativeThen, that, resolve, reject);
          }).then(onFulfilled, onRejected);
        // https://github.com/zloirock/core-js/issues/640
        }, { unsafe: true });
      }

      // make `.constructor === Promise` work for native promise-based APIs
      try {
        delete NativePromisePrototype$1.constructor;
      } catch (error) { /* empty */ }

      // make `instanceof Promise` work for native promise-based APIs
      if (setPrototypeOf$2) {
        setPrototypeOf$2(NativePromisePrototype$1, PromisePrototype);
      }
    }
  }

  $$G({ global: true, constructor: true, wrap: true, forced: FORCED_PROMISE_CONSTRUCTOR$4 }, {
    Promise: PromiseConstructor
  });

  setToStringTag$3(PromiseConstructor, PROMISE, false);
  setSpecies$2(PROMISE);

  var NativePromiseConstructor$1 = promiseNativeConstructor;
  var checkCorrectnessOfIteration$1 = checkCorrectnessOfIteration$4;
  var FORCED_PROMISE_CONSTRUCTOR$3 = promiseConstructorDetection.CONSTRUCTOR;

  var promiseStaticsIncorrectIteration = FORCED_PROMISE_CONSTRUCTOR$3 || !checkCorrectnessOfIteration$1(function (iterable) {
    NativePromiseConstructor$1.all(iterable).then(undefined, function () { /* empty */ });
  });

  var $$F = _export;
  var call$m = functionCall;
  var aCallable$a = aCallable$h;
  var newPromiseCapabilityModule$2 = newPromiseCapability$2;
  var perform$1 = perform$3;
  var iterate$3 = iterate$6;
  var PROMISE_STATICS_INCORRECT_ITERATION$1 = promiseStaticsIncorrectIteration;

  // `Promise.all` method
  // https://tc39.es/ecma262/#sec-promise.all
  $$F({ target: 'Promise', stat: true, forced: PROMISE_STATICS_INCORRECT_ITERATION$1 }, {
    all: function all(iterable) {
      var C = this;
      var capability = newPromiseCapabilityModule$2.f(C);
      var resolve = capability.resolve;
      var reject = capability.reject;
      var result = perform$1(function () {
        var $promiseResolve = aCallable$a(C.resolve);
        var values = [];
        var counter = 0;
        var remaining = 1;
        iterate$3(iterable, function (promise) {
          var index = counter++;
          var alreadyCalled = false;
          remaining++;
          call$m($promiseResolve, C, promise).then(function (value) {
            if (alreadyCalled) return;
            alreadyCalled = true;
            values[index] = value;
            --remaining || resolve(values);
          }, reject);
        });
        --remaining || resolve(values);
      });
      if (result.error) reject(result.value);
      return capability.promise;
    }
  });

  var $$E = _export;
  var FORCED_PROMISE_CONSTRUCTOR$2 = promiseConstructorDetection.CONSTRUCTOR;
  var NativePromiseConstructor = promiseNativeConstructor;
  var getBuiltIn$5 = getBuiltIn$f;
  var isCallable$8 = isCallable$x;
  var defineBuiltIn$7 = defineBuiltIn$h;

  var NativePromisePrototype = NativePromiseConstructor && NativePromiseConstructor.prototype;

  // `Promise.prototype.catch` method
  // https://tc39.es/ecma262/#sec-promise.prototype.catch
  $$E({ target: 'Promise', proto: true, forced: FORCED_PROMISE_CONSTRUCTOR$2, real: true }, {
    'catch': function (onRejected) {
      return this.then(undefined, onRejected);
    }
  });

  // makes sure that native promise-based APIs `Promise#catch` properly works with patched `Promise#then`
  if (isCallable$8(NativePromiseConstructor)) {
    var method = getBuiltIn$5('Promise').prototype['catch'];
    if (NativePromisePrototype['catch'] !== method) {
      defineBuiltIn$7(NativePromisePrototype, 'catch', method, { unsafe: true });
    }
  }

  var $$D = _export;
  var call$l = functionCall;
  var aCallable$9 = aCallable$h;
  var newPromiseCapabilityModule$1 = newPromiseCapability$2;
  var perform = perform$3;
  var iterate$2 = iterate$6;
  var PROMISE_STATICS_INCORRECT_ITERATION = promiseStaticsIncorrectIteration;

  // `Promise.race` method
  // https://tc39.es/ecma262/#sec-promise.race
  $$D({ target: 'Promise', stat: true, forced: PROMISE_STATICS_INCORRECT_ITERATION }, {
    race: function race(iterable) {
      var C = this;
      var capability = newPromiseCapabilityModule$1.f(C);
      var reject = capability.reject;
      var result = perform(function () {
        var $promiseResolve = aCallable$9(C.resolve);
        iterate$2(iterable, function (promise) {
          call$l($promiseResolve, C, promise).then(capability.resolve, reject);
        });
      });
      if (result.error) reject(result.value);
      return capability.promise;
    }
  });

  var $$C = _export;
  var call$k = functionCall;
  var newPromiseCapabilityModule = newPromiseCapability$2;
  var FORCED_PROMISE_CONSTRUCTOR$1 = promiseConstructorDetection.CONSTRUCTOR;

  // `Promise.reject` method
  // https://tc39.es/ecma262/#sec-promise.reject
  $$C({ target: 'Promise', stat: true, forced: FORCED_PROMISE_CONSTRUCTOR$1 }, {
    reject: function reject(r) {
      var capability = newPromiseCapabilityModule.f(this);
      call$k(capability.reject, undefined, r);
      return capability.promise;
    }
  });

  var anObject$f = anObject$s;
  var isObject$6 = isObject$l;
  var newPromiseCapability = newPromiseCapability$2;

  var promiseResolve$1 = function (C, x) {
    anObject$f(C);
    if (isObject$6(x) && x.constructor === C) return x;
    var promiseCapability = newPromiseCapability.f(C);
    var resolve = promiseCapability.resolve;
    resolve(x);
    return promiseCapability.promise;
  };

  var $$B = _export;
  var getBuiltIn$4 = getBuiltIn$f;
  var FORCED_PROMISE_CONSTRUCTOR = promiseConstructorDetection.CONSTRUCTOR;
  var promiseResolve = promiseResolve$1;

  getBuiltIn$4('Promise');

  // `Promise.resolve` method
  // https://tc39.es/ecma262/#sec-promise.resolve
  $$B({ target: 'Promise', stat: true, forced: FORCED_PROMISE_CONSTRUCTOR }, {
    resolve: function resolve(x) {
      return promiseResolve(this, x);
    }
  });

  var isObject$5 = isObject$l;
  var classof$9 = classofRaw$2;
  var wellKnownSymbol$d = wellKnownSymbol$x;

  var MATCH$2 = wellKnownSymbol$d('match');

  // `IsRegExp` abstract operation
  // https://tc39.es/ecma262/#sec-isregexp
  var isRegexp = function (it) {
    var isRegExp;
    return isObject$5(it) && ((isRegExp = it[MATCH$2]) !== undefined ? !!isRegExp : classof$9(it) == 'RegExp');
  };

  var anObject$e = anObject$s;

  // `RegExp.prototype.flags` getter implementation
  // https://tc39.es/ecma262/#sec-get-regexp.prototype.flags
  var regexpFlags$1 = function () {
    var that = anObject$e(this);
    var result = '';
    if (that.hasIndices) result += 'd';
    if (that.global) result += 'g';
    if (that.ignoreCase) result += 'i';
    if (that.multiline) result += 'm';
    if (that.dotAll) result += 's';
    if (that.unicode) result += 'u';
    if (that.unicodeSets) result += 'v';
    if (that.sticky) result += 'y';
    return result;
  };

  var call$j = functionCall;
  var hasOwn$a = hasOwnProperty_1;
  var isPrototypeOf$4 = objectIsPrototypeOf;
  var regExpFlags = regexpFlags$1;

  var RegExpPrototype$5 = RegExp.prototype;

  var regexpGetFlags = function (R) {
    var flags = R.flags;
    return flags === undefined && !('flags' in RegExpPrototype$5) && !hasOwn$a(R, 'flags') && isPrototypeOf$4(RegExpPrototype$5, R)
      ? call$j(regExpFlags, R) : flags;
  };

  var fails$s = fails$V;
  var global$s = global$Q;

  // babel-minify and Closure Compiler transpiles RegExp('a', 'y') -> /a/y and it causes SyntaxError
  var $RegExp$2 = global$s.RegExp;

  var UNSUPPORTED_Y$3 = fails$s(function () {
    var re = $RegExp$2('a', 'y');
    re.lastIndex = 2;
    return re.exec('abcd') != null;
  });

  // UC Browser bug
  // https://github.com/zloirock/core-js/issues/1008
  var MISSED_STICKY$2 = UNSUPPORTED_Y$3 || fails$s(function () {
    return !$RegExp$2('a', 'y').sticky;
  });

  var BROKEN_CARET = UNSUPPORTED_Y$3 || fails$s(function () {
    // https://bugzilla.mozilla.org/show_bug.cgi?id=773687
    var re = $RegExp$2('^r', 'gy');
    re.lastIndex = 2;
    return re.exec('str') != null;
  });

  var regexpStickyHelpers = {
    BROKEN_CARET: BROKEN_CARET,
    MISSED_STICKY: MISSED_STICKY$2,
    UNSUPPORTED_Y: UNSUPPORTED_Y$3
  };

  var fails$r = fails$V;
  var global$r = global$Q;

  // babel-minify and Closure Compiler transpiles RegExp('.', 's') -> /./s and it causes SyntaxError
  var $RegExp$1 = global$r.RegExp;

  var regexpUnsupportedDotAll = fails$r(function () {
    var re = $RegExp$1('.', 's');
    return !(re.dotAll && re.exec('\n') && re.flags === 's');
  });

  var fails$q = fails$V;
  var global$q = global$Q;

  // babel-minify and Closure Compiler transpiles RegExp('(?<a>b)', 'g') -> /(?<a>b)/g and it causes SyntaxError
  var $RegExp = global$q.RegExp;

  var regexpUnsupportedNcg = fails$q(function () {
    var re = $RegExp('(?<a>b)', 'g');
    return re.exec('b').groups.a !== 'b' ||
      'b'.replace(re, '$<a>c') !== 'bc';
  });

  var DESCRIPTORS$g = descriptors;
  var global$p = global$Q;
  var uncurryThis$t = functionUncurryThis;
  var isForced$1 = isForced_1;
  var inheritIfRequired$3 = inheritIfRequired$6;
  var createNonEnumerableProperty$7 = createNonEnumerableProperty$f;
  var getOwnPropertyNames$2 = objectGetOwnPropertyNames.f;
  var isPrototypeOf$3 = objectIsPrototypeOf;
  var isRegExp$3 = isRegexp;
  var toString$e = toString$n;
  var getRegExpFlags$2 = regexpGetFlags;
  var stickyHelpers$2 = regexpStickyHelpers;
  var proxyAccessor = proxyAccessor$2;
  var defineBuiltIn$6 = defineBuiltIn$h;
  var fails$p = fails$V;
  var hasOwn$9 = hasOwnProperty_1;
  var enforceInternalState$2 = internalState.enforce;
  var setSpecies$1 = setSpecies$5;
  var wellKnownSymbol$c = wellKnownSymbol$x;
  var UNSUPPORTED_DOT_ALL$2 = regexpUnsupportedDotAll;
  var UNSUPPORTED_NCG$1 = regexpUnsupportedNcg;

  var MATCH$1 = wellKnownSymbol$c('match');
  var NativeRegExp = global$p.RegExp;
  var RegExpPrototype$4 = NativeRegExp.prototype;
  var SyntaxError = global$p.SyntaxError;
  var exec$5 = uncurryThis$t(RegExpPrototype$4.exec);
  var charAt$9 = uncurryThis$t(''.charAt);
  var replace$6 = uncurryThis$t(''.replace);
  var stringIndexOf$3 = uncurryThis$t(''.indexOf);
  var stringSlice$a = uncurryThis$t(''.slice);
  // TODO: Use only proper RegExpIdentifierName
  var IS_NCG = /^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/;
  var re1 = /a/g;
  var re2 = /a/g;

  // "new" should create a new object, old webkit bug
  var CORRECT_NEW = new NativeRegExp(re1) !== re1;

  var MISSED_STICKY$1 = stickyHelpers$2.MISSED_STICKY;
  var UNSUPPORTED_Y$2 = stickyHelpers$2.UNSUPPORTED_Y;

  var BASE_FORCED = DESCRIPTORS$g &&
    (!CORRECT_NEW || MISSED_STICKY$1 || UNSUPPORTED_DOT_ALL$2 || UNSUPPORTED_NCG$1 || fails$p(function () {
      re2[MATCH$1] = false;
      // RegExp constructor can alter flags and IsRegExp works correct with @@match
      return NativeRegExp(re1) != re1 || NativeRegExp(re2) == re2 || NativeRegExp(re1, 'i') != '/a/i';
    }));

  var handleDotAll = function (string) {
    var length = string.length;
    var index = 0;
    var result = '';
    var brackets = false;
    var chr;
    for (; index <= length; index++) {
      chr = charAt$9(string, index);
      if (chr === '\\') {
        result += chr + charAt$9(string, ++index);
        continue;
      }
      if (!brackets && chr === '.') {
        result += '[\\s\\S]';
      } else {
        if (chr === '[') {
          brackets = true;
        } else if (chr === ']') {
          brackets = false;
        } result += chr;
      }
    } return result;
  };

  var handleNCG = function (string) {
    var length = string.length;
    var index = 0;
    var result = '';
    var named = [];
    var names = {};
    var brackets = false;
    var ncg = false;
    var groupid = 0;
    var groupname = '';
    var chr;
    for (; index <= length; index++) {
      chr = charAt$9(string, index);
      if (chr === '\\') {
        chr = chr + charAt$9(string, ++index);
      } else if (chr === ']') {
        brackets = false;
      } else if (!brackets) switch (true) {
        case chr === '[':
          brackets = true;
          break;
        case chr === '(':
          if (exec$5(IS_NCG, stringSlice$a(string, index + 1))) {
            index += 2;
            ncg = true;
          }
          result += chr;
          groupid++;
          continue;
        case chr === '>' && ncg:
          if (groupname === '' || hasOwn$9(names, groupname)) {
            throw new SyntaxError('Invalid capture group name');
          }
          names[groupname] = true;
          named[named.length] = [groupname, groupid];
          ncg = false;
          groupname = '';
          continue;
      }
      if (ncg) groupname += chr;
      else result += chr;
    } return [result, named];
  };

  // `RegExp` constructor
  // https://tc39.es/ecma262/#sec-regexp-constructor
  if (isForced$1('RegExp', BASE_FORCED)) {
    var RegExpWrapper = function RegExp(pattern, flags) {
      var thisIsRegExp = isPrototypeOf$3(RegExpPrototype$4, this);
      var patternIsRegExp = isRegExp$3(pattern);
      var flagsAreUndefined = flags === undefined;
      var groups = [];
      var rawPattern = pattern;
      var rawFlags, dotAll, sticky, handled, result, state;

      if (!thisIsRegExp && patternIsRegExp && flagsAreUndefined && pattern.constructor === RegExpWrapper) {
        return pattern;
      }

      if (patternIsRegExp || isPrototypeOf$3(RegExpPrototype$4, pattern)) {
        pattern = pattern.source;
        if (flagsAreUndefined) flags = getRegExpFlags$2(rawPattern);
      }

      pattern = pattern === undefined ? '' : toString$e(pattern);
      flags = flags === undefined ? '' : toString$e(flags);
      rawPattern = pattern;

      if (UNSUPPORTED_DOT_ALL$2 && 'dotAll' in re1) {
        dotAll = !!flags && stringIndexOf$3(flags, 's') > -1;
        if (dotAll) flags = replace$6(flags, /s/g, '');
      }

      rawFlags = flags;

      if (MISSED_STICKY$1 && 'sticky' in re1) {
        sticky = !!flags && stringIndexOf$3(flags, 'y') > -1;
        if (sticky && UNSUPPORTED_Y$2) flags = replace$6(flags, /y/g, '');
      }

      if (UNSUPPORTED_NCG$1) {
        handled = handleNCG(pattern);
        pattern = handled[0];
        groups = handled[1];
      }

      result = inheritIfRequired$3(NativeRegExp(pattern, flags), thisIsRegExp ? this : RegExpPrototype$4, RegExpWrapper);

      if (dotAll || sticky || groups.length) {
        state = enforceInternalState$2(result);
        if (dotAll) {
          state.dotAll = true;
          state.raw = RegExpWrapper(handleDotAll(pattern), rawFlags);
        }
        if (sticky) state.sticky = true;
        if (groups.length) state.groups = groups;
      }

      if (pattern !== rawPattern) try {
        // fails in old engines, but we have no alternatives for unsupported regex syntax
        createNonEnumerableProperty$7(result, 'source', rawPattern === '' ? '(?:)' : rawPattern);
      } catch (error) { /* empty */ }

      return result;
    };

    for (var keys = getOwnPropertyNames$2(NativeRegExp), index$1 = 0; keys.length > index$1;) {
      proxyAccessor(RegExpWrapper, NativeRegExp, keys[index$1++]);
    }

    RegExpPrototype$4.constructor = RegExpWrapper;
    RegExpWrapper.prototype = RegExpPrototype$4;
    defineBuiltIn$6(global$p, 'RegExp', RegExpWrapper, { constructor: true });
  }

  // https://tc39.es/ecma262/#sec-get-regexp-@@species
  setSpecies$1('RegExp');

  var DESCRIPTORS$f = descriptors;
  var UNSUPPORTED_DOT_ALL$1 = regexpUnsupportedDotAll;
  var classof$8 = classofRaw$2;
  var defineBuiltInAccessor$9 = defineBuiltInAccessor$g;
  var getInternalState$6 = internalState.get;

  var RegExpPrototype$3 = RegExp.prototype;
  var $TypeError$8 = TypeError;

  // `RegExp.prototype.dotAll` getter
  // https://tc39.es/ecma262/#sec-get-regexp.prototype.dotall
  if (DESCRIPTORS$f && UNSUPPORTED_DOT_ALL$1) {
    defineBuiltInAccessor$9(RegExpPrototype$3, 'dotAll', {
      configurable: true,
      get: function dotAll() {
        if (this === RegExpPrototype$3) return undefined;
        // We can't use InternalStateModule.getterFor because
        // we don't add metadata for regexps created by a literal.
        if (classof$8(this) === 'RegExp') {
          return !!getInternalState$6(this).dotAll;
        }
        throw $TypeError$8('Incompatible receiver, RegExp required');
      }
    });
  }

  /* eslint-disable regexp/no-empty-capturing-group, regexp/no-empty-group, regexp/no-lazy-ends -- testing */
  /* eslint-disable regexp/no-useless-quantifier -- testing */
  var call$i = functionCall;
  var uncurryThis$s = functionUncurryThis;
  var toString$d = toString$n;
  var regexpFlags = regexpFlags$1;
  var stickyHelpers$1 = regexpStickyHelpers;
  var shared = sharedExports;
  var create$5 = objectCreate;
  var getInternalState$5 = internalState.get;
  var UNSUPPORTED_DOT_ALL = regexpUnsupportedDotAll;
  var UNSUPPORTED_NCG = regexpUnsupportedNcg;

  var nativeReplace = shared('native-string-replace', String.prototype.replace);
  var nativeExec = RegExp.prototype.exec;
  var patchedExec = nativeExec;
  var charAt$8 = uncurryThis$s(''.charAt);
  var indexOf$1 = uncurryThis$s(''.indexOf);
  var replace$5 = uncurryThis$s(''.replace);
  var stringSlice$9 = uncurryThis$s(''.slice);

  var UPDATES_LAST_INDEX_WRONG = (function () {
    var re1 = /a/;
    var re2 = /b*/g;
    call$i(nativeExec, re1, 'a');
    call$i(nativeExec, re2, 'a');
    return re1.lastIndex !== 0 || re2.lastIndex !== 0;
  })();

  var UNSUPPORTED_Y$1 = stickyHelpers$1.BROKEN_CARET;

  // nonparticipating capturing group, copied from es5-shim's String#split patch.
  var NPCG_INCLUDED = /()??/.exec('')[1] !== undefined;

  var PATCH = UPDATES_LAST_INDEX_WRONG || NPCG_INCLUDED || UNSUPPORTED_Y$1 || UNSUPPORTED_DOT_ALL || UNSUPPORTED_NCG;

  if (PATCH) {
    patchedExec = function exec(string) {
      var re = this;
      var state = getInternalState$5(re);
      var str = toString$d(string);
      var raw = state.raw;
      var result, reCopy, lastIndex, match, i, object, group;

      if (raw) {
        raw.lastIndex = re.lastIndex;
        result = call$i(patchedExec, raw, str);
        re.lastIndex = raw.lastIndex;
        return result;
      }

      var groups = state.groups;
      var sticky = UNSUPPORTED_Y$1 && re.sticky;
      var flags = call$i(regexpFlags, re);
      var source = re.source;
      var charsAdded = 0;
      var strCopy = str;

      if (sticky) {
        flags = replace$5(flags, 'y', '');
        if (indexOf$1(flags, 'g') === -1) {
          flags += 'g';
        }

        strCopy = stringSlice$9(str, re.lastIndex);
        // Support anchored sticky behavior.
        if (re.lastIndex > 0 && (!re.multiline || re.multiline && charAt$8(str, re.lastIndex - 1) !== '\n')) {
          source = '(?: ' + source + ')';
          strCopy = ' ' + strCopy;
          charsAdded++;
        }
        // ^(? + rx + ) is needed, in combination with some str slicing, to
        // simulate the 'y' flag.
        reCopy = new RegExp('^(?:' + source + ')', flags);
      }

      if (NPCG_INCLUDED) {
        reCopy = new RegExp('^' + source + '$(?!\\s)', flags);
      }
      if (UPDATES_LAST_INDEX_WRONG) lastIndex = re.lastIndex;

      match = call$i(nativeExec, sticky ? reCopy : re, strCopy);

      if (sticky) {
        if (match) {
          match.input = stringSlice$9(match.input, charsAdded);
          match[0] = stringSlice$9(match[0], charsAdded);
          match.index = re.lastIndex;
          re.lastIndex += match[0].length;
        } else re.lastIndex = 0;
      } else if (UPDATES_LAST_INDEX_WRONG && match) {
        re.lastIndex = re.global ? match.index + match[0].length : lastIndex;
      }
      if (NPCG_INCLUDED && match && match.length > 1) {
        // Fix browsers whose `exec` methods don't consistently return `undefined`
        // for NPCG, like IE8. NOTE: This doesn't work for /(.?)?/
        call$i(nativeReplace, match[0], reCopy, function () {
          for (i = 1; i < arguments.length - 2; i++) {
            if (arguments[i] === undefined) match[i] = undefined;
          }
        });
      }

      if (match && groups) {
        match.groups = object = create$5(null);
        for (i = 0; i < groups.length; i++) {
          group = groups[i];
          object[group[0]] = match[group[1]];
        }
      }

      return match;
    };
  }

  var regexpExec$3 = patchedExec;

  var $$A = _export;
  var exec$4 = regexpExec$3;

  // `RegExp.prototype.exec` method
  // https://tc39.es/ecma262/#sec-regexp.prototype.exec
  $$A({ target: 'RegExp', proto: true, forced: /./.exec !== exec$4 }, {
    exec: exec$4
  });

  var DESCRIPTORS$e = descriptors;
  var MISSED_STICKY = regexpStickyHelpers.MISSED_STICKY;
  var classof$7 = classofRaw$2;
  var defineBuiltInAccessor$8 = defineBuiltInAccessor$g;
  var getInternalState$4 = internalState.get;

  var RegExpPrototype$2 = RegExp.prototype;
  var $TypeError$7 = TypeError;

  // `RegExp.prototype.sticky` getter
  // https://tc39.es/ecma262/#sec-get-regexp.prototype.sticky
  if (DESCRIPTORS$e && MISSED_STICKY) {
    defineBuiltInAccessor$8(RegExpPrototype$2, 'sticky', {
      configurable: true,
      get: function sticky() {
        if (this === RegExpPrototype$2) return;
        // We can't use InternalStateModule.getterFor because
        // we don't add metadata for regexps created by a literal.
        if (classof$7(this) === 'RegExp') {
          return !!getInternalState$4(this).sticky;
        }
        throw $TypeError$7('Incompatible receiver, RegExp required');
      }
    });
  }

  // TODO: Remove from `core-js@4` since it's moved to entry points

  var $$z = _export;
  var call$h = functionCall;
  var isCallable$7 = isCallable$x;
  var anObject$d = anObject$s;
  var toString$c = toString$n;

  var DELEGATES_TO_EXEC = function () {
    var execCalled = false;
    var re = /[ac]/;
    re.exec = function () {
      execCalled = true;
      return /./.exec.apply(this, arguments);
    };
    return re.test('abc') === true && execCalled;
  }();

  var nativeTest = /./.test;

  // `RegExp.prototype.test` method
  // https://tc39.es/ecma262/#sec-regexp.prototype.test
  $$z({ target: 'RegExp', proto: true, forced: !DELEGATES_TO_EXEC }, {
    test: function (S) {
      var R = anObject$d(this);
      var string = toString$c(S);
      var exec = R.exec;
      if (!isCallable$7(exec)) return call$h(nativeTest, R, string);
      var result = call$h(exec, R, string);
      if (result === null) return false;
      anObject$d(result);
      return true;
    }
  });

  var PROPER_FUNCTION_NAME$1 = functionName.PROPER;
  var defineBuiltIn$5 = defineBuiltIn$h;
  var anObject$c = anObject$s;
  var $toString$2 = toString$n;
  var fails$o = fails$V;
  var getRegExpFlags$1 = regexpGetFlags;

  var TO_STRING = 'toString';
  var RegExpPrototype$1 = RegExp.prototype;
  var nativeToString = RegExpPrototype$1[TO_STRING];

  var NOT_GENERIC = fails$o(function () { return nativeToString.call({ source: 'a', flags: 'b' }) != '/a/b'; });
  // FF44- RegExp#toString has a wrong name
  var INCORRECT_NAME = PROPER_FUNCTION_NAME$1 && nativeToString.name != TO_STRING;

  // `RegExp.prototype.toString` method
  // https://tc39.es/ecma262/#sec-regexp.prototype.tostring
  if (NOT_GENERIC || INCORRECT_NAME) {
    defineBuiltIn$5(RegExp.prototype, TO_STRING, function toString() {
      var R = anObject$c(this);
      var pattern = $toString$2(R.source);
      var flags = $toString$2(getRegExpFlags$1(R));
      return '/' + pattern + '/' + flags;
    }, { unsafe: true });
  }

  var isRegExp$2 = isRegexp;

  var $TypeError$6 = TypeError;

  var notARegexp = function (it) {
    if (isRegExp$2(it)) {
      throw $TypeError$6("The method doesn't accept regular expressions");
    } return it;
  };

  var wellKnownSymbol$b = wellKnownSymbol$x;

  var MATCH = wellKnownSymbol$b('match');

  var correctIsRegexpLogic = function (METHOD_NAME) {
    var regexp = /./;
    try {
      '/./'[METHOD_NAME](regexp);
    } catch (error1) {
      try {
        regexp[MATCH] = false;
        return '/./'[METHOD_NAME](regexp);
      } catch (error2) { /* empty */ }
    } return false;
  };

  var $$y = _export;
  var uncurryThis$r = functionUncurryThis;
  var notARegExp$1 = notARegexp;
  var requireObjectCoercible$7 = requireObjectCoercible$c;
  var toString$b = toString$n;
  var correctIsRegExpLogic$1 = correctIsRegexpLogic;

  var stringIndexOf$2 = uncurryThis$r(''.indexOf);

  // `String.prototype.includes` method
  // https://tc39.es/ecma262/#sec-string.prototype.includes
  $$y({ target: 'String', proto: true, forced: !correctIsRegExpLogic$1('includes') }, {
    includes: function includes(searchString /* , position = 0 */) {
      return !!~stringIndexOf$2(
        toString$b(requireObjectCoercible$7(this)),
        toString$b(notARegExp$1(searchString)),
        arguments.length > 1 ? arguments[1] : undefined
      );
    }
  });

  var uncurryThis$q = functionUncurryThis;
  var toIntegerOrInfinity$6 = toIntegerOrInfinity$e;
  var toString$a = toString$n;
  var requireObjectCoercible$6 = requireObjectCoercible$c;

  var charAt$7 = uncurryThis$q(''.charAt);
  var charCodeAt$2 = uncurryThis$q(''.charCodeAt);
  var stringSlice$8 = uncurryThis$q(''.slice);

  var createMethod$3 = function (CONVERT_TO_STRING) {
    return function ($this, pos) {
      var S = toString$a(requireObjectCoercible$6($this));
      var position = toIntegerOrInfinity$6(pos);
      var size = S.length;
      var first, second;
      if (position < 0 || position >= size) return CONVERT_TO_STRING ? '' : undefined;
      first = charCodeAt$2(S, position);
      return first < 0xD800 || first > 0xDBFF || position + 1 === size
        || (second = charCodeAt$2(S, position + 1)) < 0xDC00 || second > 0xDFFF
          ? CONVERT_TO_STRING
            ? charAt$7(S, position)
            : first
          : CONVERT_TO_STRING
            ? stringSlice$8(S, position, position + 2)
            : (first - 0xD800 << 10) + (second - 0xDC00) + 0x10000;
    };
  };

  var stringMultibyte = {
    // `String.prototype.codePointAt` method
    // https://tc39.es/ecma262/#sec-string.prototype.codepointat
    codeAt: createMethod$3(false),
    // `String.prototype.at` method
    // https://github.com/mathiasbynens/String.prototype.at
    charAt: createMethod$3(true)
  };

  var charAt$6 = stringMultibyte.charAt;
  var toString$9 = toString$n;
  var InternalStateModule$6 = internalState;
  var defineIterator = iteratorDefine;
  var createIterResultObject$1 = createIterResultObject$4;

  var STRING_ITERATOR = 'String Iterator';
  var setInternalState$5 = InternalStateModule$6.set;
  var getInternalState$3 = InternalStateModule$6.getterFor(STRING_ITERATOR);

  // `String.prototype[@@iterator]` method
  // https://tc39.es/ecma262/#sec-string.prototype-@@iterator
  defineIterator(String, 'String', function (iterated) {
    setInternalState$5(this, {
      type: STRING_ITERATOR,
      string: toString$9(iterated),
      index: 0
    });
  // `%StringIteratorPrototype%.next` method
  // https://tc39.es/ecma262/#sec-%stringiteratorprototype%.next
  }, function next() {
    var state = getInternalState$3(this);
    var string = state.string;
    var index = state.index;
    var point;
    if (index >= string.length) return createIterResultObject$1(undefined, true);
    point = charAt$6(string, index);
    state.index += point.length;
    return createIterResultObject$1(point, false);
  });

  // TODO: Remove from `core-js@4` since it's moved to entry points

  var uncurryThis$p = functionUncurryThisClause;
  var defineBuiltIn$4 = defineBuiltIn$h;
  var regexpExec$2 = regexpExec$3;
  var fails$n = fails$V;
  var wellKnownSymbol$a = wellKnownSymbol$x;
  var createNonEnumerableProperty$6 = createNonEnumerableProperty$f;

  var SPECIES = wellKnownSymbol$a('species');
  var RegExpPrototype = RegExp.prototype;

  var fixRegexpWellKnownSymbolLogic = function (KEY, exec, FORCED, SHAM) {
    var SYMBOL = wellKnownSymbol$a(KEY);

    var DELEGATES_TO_SYMBOL = !fails$n(function () {
      // String methods call symbol-named RegEp methods
      var O = {};
      O[SYMBOL] = function () { return 7; };
      return ''[KEY](O) != 7;
    });

    var DELEGATES_TO_EXEC = DELEGATES_TO_SYMBOL && !fails$n(function () {
      // Symbol-named RegExp methods call .exec
      var execCalled = false;
      var re = /a/;

      if (KEY === 'split') {
        // We can't use real regex here since it causes deoptimization
        // and serious performance degradation in V8
        // https://github.com/zloirock/core-js/issues/306
        re = {};
        // RegExp[@@split] doesn't call the regex's exec method, but first creates
        // a new one. We need to return the patched regex when creating the new one.
        re.constructor = {};
        re.constructor[SPECIES] = function () { return re; };
        re.flags = '';
        re[SYMBOL] = /./[SYMBOL];
      }

      re.exec = function () { execCalled = true; return null; };

      re[SYMBOL]('');
      return !execCalled;
    });

    if (
      !DELEGATES_TO_SYMBOL ||
      !DELEGATES_TO_EXEC ||
      FORCED
    ) {
      var uncurriedNativeRegExpMethod = uncurryThis$p(/./[SYMBOL]);
      var methods = exec(SYMBOL, ''[KEY], function (nativeMethod, regexp, str, arg2, forceStringMethod) {
        var uncurriedNativeMethod = uncurryThis$p(nativeMethod);
        var $exec = regexp.exec;
        if ($exec === regexpExec$2 || $exec === RegExpPrototype.exec) {
          if (DELEGATES_TO_SYMBOL && !forceStringMethod) {
            // The native String method already delegates to @@method (this
            // polyfilled function), leasing to infinite recursion.
            // We avoid it by directly calling the native @@method method.
            return { done: true, value: uncurriedNativeRegExpMethod(regexp, str, arg2) };
          }
          return { done: true, value: uncurriedNativeMethod(str, regexp, arg2) };
        }
        return { done: false };
      });

      defineBuiltIn$4(String.prototype, KEY, methods[0]);
      defineBuiltIn$4(RegExpPrototype, SYMBOL, methods[1]);
    }

    if (SHAM) createNonEnumerableProperty$6(RegExpPrototype[SYMBOL], 'sham', true);
  };

  var charAt$5 = stringMultibyte.charAt;

  // `AdvanceStringIndex` abstract operation
  // https://tc39.es/ecma262/#sec-advancestringindex
  var advanceStringIndex$3 = function (S, index, unicode) {
    return index + (unicode ? charAt$5(S, index).length : 1);
  };

  var call$g = functionCall;
  var anObject$b = anObject$s;
  var isCallable$6 = isCallable$x;
  var classof$6 = classofRaw$2;
  var regexpExec$1 = regexpExec$3;

  var $TypeError$5 = TypeError;

  // `RegExpExec` abstract operation
  // https://tc39.es/ecma262/#sec-regexpexec
  var regexpExecAbstract = function (R, S) {
    var exec = R.exec;
    if (isCallable$6(exec)) {
      var result = call$g(exec, R, S);
      if (result !== null) anObject$b(result);
      return result;
    }
    if (classof$6(R) === 'RegExp') return call$g(regexpExec$1, R, S);
    throw $TypeError$5('RegExp#exec called on incompatible receiver');
  };

  var call$f = functionCall;
  var fixRegExpWellKnownSymbolLogic$3 = fixRegexpWellKnownSymbolLogic;
  var anObject$a = anObject$s;
  var isNullOrUndefined$4 = isNullOrUndefined$b;
  var toLength$5 = toLength$a;
  var toString$8 = toString$n;
  var requireObjectCoercible$5 = requireObjectCoercible$c;
  var getMethod$5 = getMethod$9;
  var advanceStringIndex$2 = advanceStringIndex$3;
  var regExpExec$2 = regexpExecAbstract;

  // @@match logic
  fixRegExpWellKnownSymbolLogic$3('match', function (MATCH, nativeMatch, maybeCallNative) {
    return [
      // `String.prototype.match` method
      // https://tc39.es/ecma262/#sec-string.prototype.match
      function match(regexp) {
        var O = requireObjectCoercible$5(this);
        var matcher = isNullOrUndefined$4(regexp) ? undefined : getMethod$5(regexp, MATCH);
        return matcher ? call$f(matcher, regexp, O) : new RegExp(regexp)[MATCH](toString$8(O));
      },
      // `RegExp.prototype[@@match]` method
      // https://tc39.es/ecma262/#sec-regexp.prototype-@@match
      function (string) {
        var rx = anObject$a(this);
        var S = toString$8(string);
        var res = maybeCallNative(nativeMatch, rx, S);

        if (res.done) return res.value;

        if (!rx.global) return regExpExec$2(rx, S);

        var fullUnicode = rx.unicode;
        rx.lastIndex = 0;
        var A = [];
        var n = 0;
        var result;
        while ((result = regExpExec$2(rx, S)) !== null) {
          var matchStr = toString$8(result[0]);
          A[n] = matchStr;
          if (matchStr === '') rx.lastIndex = advanceStringIndex$2(S, toLength$5(rx.lastIndex), fullUnicode);
          n++;
        }
        return n === 0 ? null : A;
      }
    ];
  });

  var uncurryThis$o = functionUncurryThis;
  var toObject$7 = toObject$h;

  var floor$6 = Math.floor;
  var charAt$4 = uncurryThis$o(''.charAt);
  var replace$4 = uncurryThis$o(''.replace);
  var stringSlice$7 = uncurryThis$o(''.slice);
  // eslint-disable-next-line redos/no-vulnerable -- safe
  var SUBSTITUTION_SYMBOLS = /\$([$&'`]|\d{1,2}|<[^>]*>)/g;
  var SUBSTITUTION_SYMBOLS_NO_NAMED = /\$([$&'`]|\d{1,2})/g;

  // `GetSubstitution` abstract operation
  // https://tc39.es/ecma262/#sec-getsubstitution
  var getSubstitution$2 = function (matched, str, position, captures, namedCaptures, replacement) {
    var tailPos = position + matched.length;
    var m = captures.length;
    var symbols = SUBSTITUTION_SYMBOLS_NO_NAMED;
    if (namedCaptures !== undefined) {
      namedCaptures = toObject$7(namedCaptures);
      symbols = SUBSTITUTION_SYMBOLS;
    }
    return replace$4(replacement, symbols, function (match, ch) {
      var capture;
      switch (charAt$4(ch, 0)) {
        case '$': return '$';
        case '&': return matched;
        case '`': return stringSlice$7(str, 0, position);
        case "'": return stringSlice$7(str, tailPos);
        case '<':
          capture = namedCaptures[stringSlice$7(ch, 1, -1)];
          break;
        default: // \d\d?
          var n = +ch;
          if (n === 0) return match;
          if (n > m) {
            var f = floor$6(n / 10);
            if (f === 0) return match;
            if (f <= m) return captures[f - 1] === undefined ? charAt$4(ch, 1) : captures[f - 1] + charAt$4(ch, 1);
            return match;
          }
          capture = captures[n - 1];
      }
      return capture === undefined ? '' : capture;
    });
  };

  var apply$5 = functionApply;
  var call$e = functionCall;
  var uncurryThis$n = functionUncurryThis;
  var fixRegExpWellKnownSymbolLogic$2 = fixRegexpWellKnownSymbolLogic;
  var fails$m = fails$V;
  var anObject$9 = anObject$s;
  var isCallable$5 = isCallable$x;
  var isNullOrUndefined$3 = isNullOrUndefined$b;
  var toIntegerOrInfinity$5 = toIntegerOrInfinity$e;
  var toLength$4 = toLength$a;
  var toString$7 = toString$n;
  var requireObjectCoercible$4 = requireObjectCoercible$c;
  var advanceStringIndex$1 = advanceStringIndex$3;
  var getMethod$4 = getMethod$9;
  var getSubstitution$1 = getSubstitution$2;
  var regExpExec$1 = regexpExecAbstract;
  var wellKnownSymbol$9 = wellKnownSymbol$x;

  var REPLACE$1 = wellKnownSymbol$9('replace');
  var max$1 = Math.max;
  var min$5 = Math.min;
  var concat$1 = uncurryThis$n([].concat);
  var push$6 = uncurryThis$n([].push);
  var stringIndexOf$1 = uncurryThis$n(''.indexOf);
  var stringSlice$6 = uncurryThis$n(''.slice);

  var maybeToString = function (it) {
    return it === undefined ? it : String(it);
  };

  // IE <= 11 replaces $0 with the whole match, as if it was $&
  // https://stackoverflow.com/questions/6024666/getting-ie-to-replace-a-regex-with-the-literal-string-0
  var REPLACE_KEEPS_$0 = (function () {
    // eslint-disable-next-line regexp/prefer-escape-replacement-dollar-char -- required for testing
    return 'a'.replace(/./, '$0') === '$0';
  })();

  // Safari <= 13.0.3(?) substitutes nth capture where n>m with an empty string
  var REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE = (function () {
    if (/./[REPLACE$1]) {
      return /./[REPLACE$1]('a', '$0') === '';
    }
    return false;
  })();

  var REPLACE_SUPPORTS_NAMED_GROUPS = !fails$m(function () {
    var re = /./;
    re.exec = function () {
      var result = [];
      result.groups = { a: '7' };
      return result;
    };
    // eslint-disable-next-line regexp/no-useless-dollar-replacements -- false positive
    return ''.replace(re, '$<a>') !== '7';
  });

  // @@replace logic
  fixRegExpWellKnownSymbolLogic$2('replace', function (_, nativeReplace, maybeCallNative) {
    var UNSAFE_SUBSTITUTE = REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE ? '$' : '$0';

    return [
      // `String.prototype.replace` method
      // https://tc39.es/ecma262/#sec-string.prototype.replace
      function replace(searchValue, replaceValue) {
        var O = requireObjectCoercible$4(this);
        var replacer = isNullOrUndefined$3(searchValue) ? undefined : getMethod$4(searchValue, REPLACE$1);
        return replacer
          ? call$e(replacer, searchValue, O, replaceValue)
          : call$e(nativeReplace, toString$7(O), searchValue, replaceValue);
      },
      // `RegExp.prototype[@@replace]` method
      // https://tc39.es/ecma262/#sec-regexp.prototype-@@replace
      function (string, replaceValue) {
        var rx = anObject$9(this);
        var S = toString$7(string);

        if (
          typeof replaceValue == 'string' &&
          stringIndexOf$1(replaceValue, UNSAFE_SUBSTITUTE) === -1 &&
          stringIndexOf$1(replaceValue, '$<') === -1
        ) {
          var res = maybeCallNative(nativeReplace, rx, S, replaceValue);
          if (res.done) return res.value;
        }

        var functionalReplace = isCallable$5(replaceValue);
        if (!functionalReplace) replaceValue = toString$7(replaceValue);

        var global = rx.global;
        if (global) {
          var fullUnicode = rx.unicode;
          rx.lastIndex = 0;
        }
        var results = [];
        while (true) {
          var result = regExpExec$1(rx, S);
          if (result === null) break;

          push$6(results, result);
          if (!global) break;

          var matchStr = toString$7(result[0]);
          if (matchStr === '') rx.lastIndex = advanceStringIndex$1(S, toLength$4(rx.lastIndex), fullUnicode);
        }

        var accumulatedResult = '';
        var nextSourcePosition = 0;
        for (var i = 0; i < results.length; i++) {
          result = results[i];

          var matched = toString$7(result[0]);
          var position = max$1(min$5(toIntegerOrInfinity$5(result.index), S.length), 0);
          var captures = [];
          // NOTE: This is equivalent to
          //   captures = result.slice(1).map(maybeToString)
          // but for some reason `nativeSlice.call(result, 1, result.length)` (called in
          // the slice polyfill when slicing native arrays) "doesn't work" in safari 9 and
          // causes a crash (https://pastebin.com/N21QzeQA) when trying to debug it.
          for (var j = 1; j < result.length; j++) push$6(captures, maybeToString(result[j]));
          var namedCaptures = result.groups;
          if (functionalReplace) {
            var replacerArgs = concat$1([matched], captures, position, S);
            if (namedCaptures !== undefined) push$6(replacerArgs, namedCaptures);
            var replacement = toString$7(apply$5(replaceValue, undefined, replacerArgs));
          } else {
            replacement = getSubstitution$1(matched, S, position, captures, namedCaptures, replaceValue);
          }
          if (position >= nextSourcePosition) {
            accumulatedResult += stringSlice$6(S, nextSourcePosition, position) + replacement;
            nextSourcePosition = position + matched.length;
          }
        }
        return accumulatedResult + stringSlice$6(S, nextSourcePosition);
      }
    ];
  }, !REPLACE_SUPPORTS_NAMED_GROUPS || !REPLACE_KEEPS_$0 || REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);

  var $$x = _export;
  var call$d = functionCall;
  var uncurryThis$m = functionUncurryThis;
  var requireObjectCoercible$3 = requireObjectCoercible$c;
  var isCallable$4 = isCallable$x;
  var isNullOrUndefined$2 = isNullOrUndefined$b;
  var isRegExp$1 = isRegexp;
  var toString$6 = toString$n;
  var getMethod$3 = getMethod$9;
  var getRegExpFlags = regexpGetFlags;
  var getSubstitution = getSubstitution$2;
  var wellKnownSymbol$8 = wellKnownSymbol$x;

  var REPLACE = wellKnownSymbol$8('replace');
  var $TypeError$4 = TypeError;
  var indexOf = uncurryThis$m(''.indexOf);
  uncurryThis$m(''.replace);
  var stringSlice$5 = uncurryThis$m(''.slice);
  var max = Math.max;

  var stringIndexOf = function (string, searchValue, fromIndex) {
    if (fromIndex > string.length) return -1;
    if (searchValue === '') return fromIndex;
    return indexOf(string, searchValue, fromIndex);
  };

  // `String.prototype.replaceAll` method
  // https://tc39.es/ecma262/#sec-string.prototype.replaceall
  $$x({ target: 'String', proto: true }, {
    replaceAll: function replaceAll(searchValue, replaceValue) {
      var O = requireObjectCoercible$3(this);
      var IS_REG_EXP, flags, replacer, string, searchString, functionalReplace, searchLength, advanceBy, replacement;
      var position = 0;
      var endOfLastMatch = 0;
      var result = '';
      if (!isNullOrUndefined$2(searchValue)) {
        IS_REG_EXP = isRegExp$1(searchValue);
        if (IS_REG_EXP) {
          flags = toString$6(requireObjectCoercible$3(getRegExpFlags(searchValue)));
          if (!~indexOf(flags, 'g')) throw $TypeError$4('`.replaceAll` does not allow non-global regexes');
        }
        replacer = getMethod$3(searchValue, REPLACE);
        if (replacer) {
          return call$d(replacer, searchValue, O, replaceValue);
        }
      }
      string = toString$6(O);
      searchString = toString$6(searchValue);
      functionalReplace = isCallable$4(replaceValue);
      if (!functionalReplace) replaceValue = toString$6(replaceValue);
      searchLength = searchString.length;
      advanceBy = max(1, searchLength);
      position = stringIndexOf(string, searchString, 0);
      while (position !== -1) {
        replacement = functionalReplace
          ? toString$6(replaceValue(searchString, position, string))
          : getSubstitution(searchString, string, position, [], undefined, replaceValue);
        result += stringSlice$5(string, endOfLastMatch, position) + replacement;
        endOfLastMatch = position + searchLength;
        position = stringIndexOf(string, searchString, position + advanceBy);
      }
      if (endOfLastMatch < string.length) {
        result += stringSlice$5(string, endOfLastMatch);
      }
      return result;
    }
  });

  // `SameValue` abstract operation
  // https://tc39.es/ecma262/#sec-samevalue
  // eslint-disable-next-line es/no-object-is -- safe
  var sameValue$1 = Object.is || function is(x, y) {
    // eslint-disable-next-line no-self-compare -- NaN check
    return x === y ? x !== 0 || 1 / x === 1 / y : x != x && y != y;
  };

  var call$c = functionCall;
  var fixRegExpWellKnownSymbolLogic$1 = fixRegexpWellKnownSymbolLogic;
  var anObject$8 = anObject$s;
  var isNullOrUndefined$1 = isNullOrUndefined$b;
  var requireObjectCoercible$2 = requireObjectCoercible$c;
  var sameValue = sameValue$1;
  var toString$5 = toString$n;
  var getMethod$2 = getMethod$9;
  var regExpExec = regexpExecAbstract;

  // @@search logic
  fixRegExpWellKnownSymbolLogic$1('search', function (SEARCH, nativeSearch, maybeCallNative) {
    return [
      // `String.prototype.search` method
      // https://tc39.es/ecma262/#sec-string.prototype.search
      function search(regexp) {
        var O = requireObjectCoercible$2(this);
        var searcher = isNullOrUndefined$1(regexp) ? undefined : getMethod$2(regexp, SEARCH);
        return searcher ? call$c(searcher, regexp, O) : new RegExp(regexp)[SEARCH](toString$5(O));
      },
      // `RegExp.prototype[@@search]` method
      // https://tc39.es/ecma262/#sec-regexp.prototype-@@search
      function (string) {
        var rx = anObject$8(this);
        var S = toString$5(string);
        var res = maybeCallNative(nativeSearch, rx, S);

        if (res.done) return res.value;

        var previousLastIndex = rx.lastIndex;
        if (!sameValue(previousLastIndex, 0)) rx.lastIndex = 0;
        var result = regExpExec(rx, S);
        if (!sameValue(rx.lastIndex, previousLastIndex)) rx.lastIndex = previousLastIndex;
        return result === null ? -1 : result.index;
      }
    ];
  });

  var $$w = _export;
  var uncurryThis$l = functionUncurryThisClause;
  var getOwnPropertyDescriptor$2 = objectGetOwnPropertyDescriptor.f;
  var toLength$3 = toLength$a;
  var toString$4 = toString$n;
  var notARegExp = notARegexp;
  var requireObjectCoercible$1 = requireObjectCoercible$c;
  var correctIsRegExpLogic = correctIsRegexpLogic;

  // eslint-disable-next-line es/no-string-prototype-startswith -- safe
  var nativeStartsWith = uncurryThis$l(''.startsWith);
  var stringSlice$4 = uncurryThis$l(''.slice);
  var min$4 = Math.min;

  var CORRECT_IS_REGEXP_LOGIC = correctIsRegExpLogic('startsWith');
  // https://github.com/zloirock/core-js/pull/702
  var MDN_POLYFILL_BUG = !CORRECT_IS_REGEXP_LOGIC && !!function () {
    var descriptor = getOwnPropertyDescriptor$2(String.prototype, 'startsWith');
    return descriptor && !descriptor.writable;
  }();

  // `String.prototype.startsWith` method
  // https://tc39.es/ecma262/#sec-string.prototype.startswith
  $$w({ target: 'String', proto: true, forced: !MDN_POLYFILL_BUG && !CORRECT_IS_REGEXP_LOGIC }, {
    startsWith: function startsWith(searchString /* , position = 0 */) {
      var that = toString$4(requireObjectCoercible$1(this));
      notARegExp(searchString);
      var index = toLength$3(min$4(arguments.length > 1 ? arguments[1] : undefined, that.length));
      var search = toString$4(searchString);
      return nativeStartsWith
        ? nativeStartsWith(that, search, index)
        : stringSlice$4(that, index, index + search.length) === search;
    }
  });

  var typedArrayConstructor = {exports: {}};

  var NATIVE_ARRAY_BUFFER = arrayBufferBasicDetection;
  var DESCRIPTORS$d = descriptors;
  var global$o = global$Q;
  var isCallable$3 = isCallable$x;
  var isObject$4 = isObject$l;
  var hasOwn$8 = hasOwnProperty_1;
  var classof$5 = classof$j;
  var tryToString = tryToString$7;
  var createNonEnumerableProperty$5 = createNonEnumerableProperty$f;
  var defineBuiltIn$3 = defineBuiltIn$h;
  var defineBuiltInAccessor$7 = defineBuiltInAccessor$g;
  var isPrototypeOf$2 = objectIsPrototypeOf;
  var getPrototypeOf = objectGetPrototypeOf;
  var setPrototypeOf$1 = objectSetPrototypeOf;
  var wellKnownSymbol$7 = wellKnownSymbol$x;
  var uid = uid$5;
  var InternalStateModule$5 = internalState;

  var enforceInternalState$1 = InternalStateModule$5.enforce;
  var getInternalState$2 = InternalStateModule$5.get;
  var Int8Array$4 = global$o.Int8Array;
  var Int8ArrayPrototype$1 = Int8Array$4 && Int8Array$4.prototype;
  var Uint8ClampedArray$1 = global$o.Uint8ClampedArray;
  var Uint8ClampedArrayPrototype = Uint8ClampedArray$1 && Uint8ClampedArray$1.prototype;
  var TypedArray$1 = Int8Array$4 && getPrototypeOf(Int8Array$4);
  var TypedArrayPrototype$2 = Int8ArrayPrototype$1 && getPrototypeOf(Int8ArrayPrototype$1);
  var ObjectPrototype = Object.prototype;
  var TypeError$5 = global$o.TypeError;

  var TO_STRING_TAG$3 = wellKnownSymbol$7('toStringTag');
  var TYPED_ARRAY_TAG$1 = uid('TYPED_ARRAY_TAG');
  var TYPED_ARRAY_CONSTRUCTOR = 'TypedArrayConstructor';
  // Fixing native typed arrays in Opera Presto crashes the browser, see #595
  var NATIVE_ARRAY_BUFFER_VIEWS$2 = NATIVE_ARRAY_BUFFER && !!setPrototypeOf$1 && classof$5(global$o.opera) !== 'Opera';
  var TYPED_ARRAY_TAG_REQUIRED = false;
  var NAME, Constructor, Prototype;

  var TypedArrayConstructorsList = {
    Int8Array: 1,
    Uint8Array: 1,
    Uint8ClampedArray: 1,
    Int16Array: 2,
    Uint16Array: 2,
    Int32Array: 4,
    Uint32Array: 4,
    Float32Array: 4,
    Float64Array: 8
  };

  var BigIntArrayConstructorsList = {
    BigInt64Array: 8,
    BigUint64Array: 8
  };

  var getTypedArrayConstructor$4 = function (it) {
    var proto = getPrototypeOf(it);
    if (!isObject$4(proto)) return;
    var state = getInternalState$2(proto);
    return (state && hasOwn$8(state, TYPED_ARRAY_CONSTRUCTOR)) ? state[TYPED_ARRAY_CONSTRUCTOR] : getTypedArrayConstructor$4(proto);
  };

  var isTypedArray$1 = function (it) {
    if (!isObject$4(it)) return false;
    var klass = classof$5(it);
    return hasOwn$8(TypedArrayConstructorsList, klass)
      || hasOwn$8(BigIntArrayConstructorsList, klass);
  };

  var aTypedArray$s = function (it) {
    if (isTypedArray$1(it)) return it;
    throw TypeError$5('Target is not a typed array');
  };

  var aTypedArrayConstructor$3 = function (C) {
    if (isCallable$3(C) && (!setPrototypeOf$1 || isPrototypeOf$2(TypedArray$1, C))) return C;
    throw TypeError$5(tryToString(C) + ' is not a typed array constructor');
  };

  var exportTypedArrayMethod$t = function (KEY, property, forced, options) {
    if (!DESCRIPTORS$d) return;
    if (forced) for (var ARRAY in TypedArrayConstructorsList) {
      var TypedArrayConstructor = global$o[ARRAY];
      if (TypedArrayConstructor && hasOwn$8(TypedArrayConstructor.prototype, KEY)) try {
        delete TypedArrayConstructor.prototype[KEY];
      } catch (error) {
        // old WebKit bug - some methods are non-configurable
        try {
          TypedArrayConstructor.prototype[KEY] = property;
        } catch (error2) { /* empty */ }
      }
    }
    if (!TypedArrayPrototype$2[KEY] || forced) {
      defineBuiltIn$3(TypedArrayPrototype$2, KEY, forced ? property
        : NATIVE_ARRAY_BUFFER_VIEWS$2 && Int8ArrayPrototype$1[KEY] || property, options);
    }
  };

  for (NAME in TypedArrayConstructorsList) {
    Constructor = global$o[NAME];
    Prototype = Constructor && Constructor.prototype;
    if (Prototype) enforceInternalState$1(Prototype)[TYPED_ARRAY_CONSTRUCTOR] = Constructor;
    else NATIVE_ARRAY_BUFFER_VIEWS$2 = false;
  }

  for (NAME in BigIntArrayConstructorsList) {
    Constructor = global$o[NAME];
    Prototype = Constructor && Constructor.prototype;
    if (Prototype) enforceInternalState$1(Prototype)[TYPED_ARRAY_CONSTRUCTOR] = Constructor;
  }

  // WebKit bug - typed arrays constructors prototype is Object.prototype
  if (!NATIVE_ARRAY_BUFFER_VIEWS$2 || !isCallable$3(TypedArray$1) || TypedArray$1 === Function.prototype) {
    // eslint-disable-next-line no-shadow -- safe
    TypedArray$1 = function TypedArray() {
      throw TypeError$5('Incorrect invocation');
    };
    if (NATIVE_ARRAY_BUFFER_VIEWS$2) for (NAME in TypedArrayConstructorsList) {
      if (global$o[NAME]) setPrototypeOf$1(global$o[NAME], TypedArray$1);
    }
  }

  if (!NATIVE_ARRAY_BUFFER_VIEWS$2 || !TypedArrayPrototype$2 || TypedArrayPrototype$2 === ObjectPrototype) {
    TypedArrayPrototype$2 = TypedArray$1.prototype;
    if (NATIVE_ARRAY_BUFFER_VIEWS$2) for (NAME in TypedArrayConstructorsList) {
      if (global$o[NAME]) setPrototypeOf$1(global$o[NAME].prototype, TypedArrayPrototype$2);
    }
  }

  // WebKit bug - one more object in Uint8ClampedArray prototype chain
  if (NATIVE_ARRAY_BUFFER_VIEWS$2 && getPrototypeOf(Uint8ClampedArrayPrototype) !== TypedArrayPrototype$2) {
    setPrototypeOf$1(Uint8ClampedArrayPrototype, TypedArrayPrototype$2);
  }

  if (DESCRIPTORS$d && !hasOwn$8(TypedArrayPrototype$2, TO_STRING_TAG$3)) {
    TYPED_ARRAY_TAG_REQUIRED = true;
    defineBuiltInAccessor$7(TypedArrayPrototype$2, TO_STRING_TAG$3, {
      configurable: true,
      get: function () {
        return isObject$4(this) ? this[TYPED_ARRAY_TAG$1] : undefined;
      }
    });
    for (NAME in TypedArrayConstructorsList) if (global$o[NAME]) {
      createNonEnumerableProperty$5(global$o[NAME], TYPED_ARRAY_TAG$1, NAME);
    }
  }

  var arrayBufferViewCore = {
    NATIVE_ARRAY_BUFFER_VIEWS: NATIVE_ARRAY_BUFFER_VIEWS$2,
    TYPED_ARRAY_TAG: TYPED_ARRAY_TAG_REQUIRED && TYPED_ARRAY_TAG$1,
    aTypedArray: aTypedArray$s,
    aTypedArrayConstructor: aTypedArrayConstructor$3,
    exportTypedArrayMethod: exportTypedArrayMethod$t,
    getTypedArrayConstructor: getTypedArrayConstructor$4,
    isTypedArray: isTypedArray$1,
    TypedArray: TypedArray$1,
    TypedArrayPrototype: TypedArrayPrototype$2
  };

  /* eslint-disable no-new -- required for testing */

  var global$n = global$Q;
  var fails$l = fails$V;
  var checkCorrectnessOfIteration = checkCorrectnessOfIteration$4;
  var NATIVE_ARRAY_BUFFER_VIEWS$1 = arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS;

  var ArrayBuffer$3 = global$n.ArrayBuffer;
  var Int8Array$3 = global$n.Int8Array;

  var typedArrayConstructorsRequireWrappers = !NATIVE_ARRAY_BUFFER_VIEWS$1 || !fails$l(function () {
    Int8Array$3(1);
  }) || !fails$l(function () {
    new Int8Array$3(-1);
  }) || !checkCorrectnessOfIteration(function (iterable) {
    new Int8Array$3();
    new Int8Array$3(null);
    new Int8Array$3(1.5);
    new Int8Array$3(iterable);
  }, true) || fails$l(function () {
    // Safari (11+) bug - a reason why even Safari 13 should load a typed array polyfill
    return new Int8Array$3(new ArrayBuffer$3(2), 1, undefined).length !== 1;
  });

  var isObject$3 = isObject$l;

  var floor$5 = Math.floor;

  // `IsIntegralNumber` abstract operation
  // https://tc39.es/ecma262/#sec-isintegralnumber
  // eslint-disable-next-line es/no-number-isinteger -- safe
  var isIntegralNumber$1 = Number.isInteger || function isInteger(it) {
    return !isObject$3(it) && isFinite(it) && floor$5(it) === it;
  };

  var toIntegerOrInfinity$4 = toIntegerOrInfinity$e;

  var $RangeError$3 = RangeError;

  var toPositiveInteger$1 = function (it) {
    var result = toIntegerOrInfinity$4(it);
    if (result < 0) throw $RangeError$3("The argument can't be less than 0");
    return result;
  };

  var toPositiveInteger = toPositiveInteger$1;

  var $RangeError$2 = RangeError;

  var toOffset$2 = function (it, BYTES) {
    var offset = toPositiveInteger(it);
    if (offset % BYTES) throw $RangeError$2('Wrong offset');
    return offset;
  };

  var classof$4 = classof$j;

  var isBigIntArray$2 = function (it) {
    var klass = classof$4(it);
    return klass == 'BigInt64Array' || klass == 'BigUint64Array';
  };

  var toPrimitive$1 = toPrimitive$3;

  var $TypeError$3 = TypeError;

  // `ToBigInt` abstract operation
  // https://tc39.es/ecma262/#sec-tobigint
  var toBigInt$3 = function (argument) {
    var prim = toPrimitive$1(argument, 'number');
    if (typeof prim == 'number') throw $TypeError$3("Can't convert number to bigint");
    // eslint-disable-next-line es/no-bigint -- safe
    return BigInt(prim);
  };

  var bind$3 = functionBindContext;
  var call$b = functionCall;
  var aConstructor = aConstructor$2;
  var toObject$6 = toObject$h;
  var lengthOfArrayLike$b = lengthOfArrayLike$m;
  var getIterator$1 = getIterator$4;
  var getIteratorMethod$1 = getIteratorMethod$5;
  var isArrayIteratorMethod = isArrayIteratorMethod$3;
  var isBigIntArray$1 = isBigIntArray$2;
  var aTypedArrayConstructor$2 = arrayBufferViewCore.aTypedArrayConstructor;
  var toBigInt$2 = toBigInt$3;

  var typedArrayFrom$1 = function from(source /* , mapfn, thisArg */) {
    var C = aConstructor(this);
    var O = toObject$6(source);
    var argumentsLength = arguments.length;
    var mapfn = argumentsLength > 1 ? arguments[1] : undefined;
    var mapping = mapfn !== undefined;
    var iteratorMethod = getIteratorMethod$1(O);
    var i, length, result, thisIsBigIntArray, value, step, iterator, next;
    if (iteratorMethod && !isArrayIteratorMethod(iteratorMethod)) {
      iterator = getIterator$1(O, iteratorMethod);
      next = iterator.next;
      O = [];
      while (!(step = call$b(next, iterator)).done) {
        O.push(step.value);
      }
    }
    if (mapping && argumentsLength > 2) {
      mapfn = bind$3(mapfn, arguments[2]);
    }
    length = lengthOfArrayLike$b(O);
    result = new (aTypedArrayConstructor$2(C))(length);
    thisIsBigIntArray = isBigIntArray$1(result);
    for (i = 0; length > i; i++) {
      value = mapping ? mapfn(O[i], i) : O[i];
      // FF30- typed arrays doesn't properly convert objects to typed array values
      result[i] = thisIsBigIntArray ? toBigInt$2(value) : +value;
    }
    return result;
  };

  var $$v = _export;
  var global$m = global$Q;
  var call$a = functionCall;
  var DESCRIPTORS$c = descriptors;
  var TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS = typedArrayConstructorsRequireWrappers;
  var ArrayBufferViewCore$t = arrayBufferViewCore;
  var ArrayBufferModule = arrayBuffer;
  var anInstance$5 = anInstance$a;
  var createPropertyDescriptor$3 = createPropertyDescriptor$a;
  var createNonEnumerableProperty$4 = createNonEnumerableProperty$f;
  var isIntegralNumber = isIntegralNumber$1;
  var toLength$2 = toLength$a;
  var toIndex$1 = toIndex$3;
  var toOffset$1 = toOffset$2;
  var toPropertyKey = toPropertyKey$5;
  var hasOwn$7 = hasOwnProperty_1;
  var classof$3 = classof$j;
  var isObject$2 = isObject$l;
  var isSymbol$1 = isSymbol$6;
  var create$4 = objectCreate;
  var isPrototypeOf$1 = objectIsPrototypeOf;
  var setPrototypeOf = objectSetPrototypeOf;
  var getOwnPropertyNames$1 = objectGetOwnPropertyNames.f;
  var typedArrayFrom = typedArrayFrom$1;
  var forEach$2 = arrayIteration.forEach;
  var setSpecies = setSpecies$5;
  var defineBuiltInAccessor$6 = defineBuiltInAccessor$g;
  var definePropertyModule = objectDefineProperty;
  var getOwnPropertyDescriptorModule = objectGetOwnPropertyDescriptor;
  var InternalStateModule$4 = internalState;
  var inheritIfRequired$2 = inheritIfRequired$6;

  var getInternalState$1 = InternalStateModule$4.get;
  var setInternalState$4 = InternalStateModule$4.set;
  var enforceInternalState = InternalStateModule$4.enforce;
  var nativeDefineProperty = definePropertyModule.f;
  var nativeGetOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;
  var round = Math.round;
  var RangeError$2 = global$m.RangeError;
  var ArrayBuffer$2 = ArrayBufferModule.ArrayBuffer;
  var ArrayBufferPrototype$2 = ArrayBuffer$2.prototype;
  var DataView$2 = ArrayBufferModule.DataView;
  var NATIVE_ARRAY_BUFFER_VIEWS = ArrayBufferViewCore$t.NATIVE_ARRAY_BUFFER_VIEWS;
  var TYPED_ARRAY_TAG = ArrayBufferViewCore$t.TYPED_ARRAY_TAG;
  var TypedArray = ArrayBufferViewCore$t.TypedArray;
  var TypedArrayPrototype$1 = ArrayBufferViewCore$t.TypedArrayPrototype;
  var aTypedArrayConstructor$1 = ArrayBufferViewCore$t.aTypedArrayConstructor;
  var isTypedArray = ArrayBufferViewCore$t.isTypedArray;
  var BYTES_PER_ELEMENT = 'BYTES_PER_ELEMENT';
  var WRONG_LENGTH = 'Wrong length';

  var fromList = function (C, list) {
    aTypedArrayConstructor$1(C);
    var index = 0;
    var length = list.length;
    var result = new C(length);
    while (length > index) result[index] = list[index++];
    return result;
  };

  var addGetter = function (it, key) {
    defineBuiltInAccessor$6(it, key, {
      configurable: true,
      get: function () {
        return getInternalState$1(this)[key];
      }
    });
  };

  var isArrayBuffer = function (it) {
    var klass;
    return isPrototypeOf$1(ArrayBufferPrototype$2, it) || (klass = classof$3(it)) == 'ArrayBuffer' || klass == 'SharedArrayBuffer';
  };

  var isTypedArrayIndex = function (target, key) {
    return isTypedArray(target)
      && !isSymbol$1(key)
      && key in target
      && isIntegralNumber(+key)
      && key >= 0;
  };

  var wrappedGetOwnPropertyDescriptor = function getOwnPropertyDescriptor(target, key) {
    key = toPropertyKey(key);
    return isTypedArrayIndex(target, key)
      ? createPropertyDescriptor$3(2, target[key])
      : nativeGetOwnPropertyDescriptor(target, key);
  };

  var wrappedDefineProperty = function defineProperty(target, key, descriptor) {
    key = toPropertyKey(key);
    if (isTypedArrayIndex(target, key)
      && isObject$2(descriptor)
      && hasOwn$7(descriptor, 'value')
      && !hasOwn$7(descriptor, 'get')
      && !hasOwn$7(descriptor, 'set')
      // TODO: add validation descriptor w/o calling accessors
      && !descriptor.configurable
      && (!hasOwn$7(descriptor, 'writable') || descriptor.writable)
      && (!hasOwn$7(descriptor, 'enumerable') || descriptor.enumerable)
    ) {
      target[key] = descriptor.value;
      return target;
    } return nativeDefineProperty(target, key, descriptor);
  };

  if (DESCRIPTORS$c) {
    if (!NATIVE_ARRAY_BUFFER_VIEWS) {
      getOwnPropertyDescriptorModule.f = wrappedGetOwnPropertyDescriptor;
      definePropertyModule.f = wrappedDefineProperty;
      addGetter(TypedArrayPrototype$1, 'buffer');
      addGetter(TypedArrayPrototype$1, 'byteOffset');
      addGetter(TypedArrayPrototype$1, 'byteLength');
      addGetter(TypedArrayPrototype$1, 'length');
    }

    $$v({ target: 'Object', stat: true, forced: !NATIVE_ARRAY_BUFFER_VIEWS }, {
      getOwnPropertyDescriptor: wrappedGetOwnPropertyDescriptor,
      defineProperty: wrappedDefineProperty
    });

    typedArrayConstructor.exports = function (TYPE, wrapper, CLAMPED) {
      var BYTES = TYPE.match(/\d+/)[0] / 8;
      var CONSTRUCTOR_NAME = TYPE + (CLAMPED ? 'Clamped' : '') + 'Array';
      var GETTER = 'get' + TYPE;
      var SETTER = 'set' + TYPE;
      var NativeTypedArrayConstructor = global$m[CONSTRUCTOR_NAME];
      var TypedArrayConstructor = NativeTypedArrayConstructor;
      var TypedArrayConstructorPrototype = TypedArrayConstructor && TypedArrayConstructor.prototype;
      var exported = {};

      var getter = function (that, index) {
        var data = getInternalState$1(that);
        return data.view[GETTER](index * BYTES + data.byteOffset, true);
      };

      var setter = function (that, index, value) {
        var data = getInternalState$1(that);
        if (CLAMPED) value = (value = round(value)) < 0 ? 0 : value > 0xFF ? 0xFF : value & 0xFF;
        data.view[SETTER](index * BYTES + data.byteOffset, value, true);
      };

      var addElement = function (that, index) {
        nativeDefineProperty(that, index, {
          get: function () {
            return getter(this, index);
          },
          set: function (value) {
            return setter(this, index, value);
          },
          enumerable: true
        });
      };

      if (!NATIVE_ARRAY_BUFFER_VIEWS) {
        TypedArrayConstructor = wrapper(function (that, data, offset, $length) {
          anInstance$5(that, TypedArrayConstructorPrototype);
          var index = 0;
          var byteOffset = 0;
          var buffer, byteLength, length;
          if (!isObject$2(data)) {
            length = toIndex$1(data);
            byteLength = length * BYTES;
            buffer = new ArrayBuffer$2(byteLength);
          } else if (isArrayBuffer(data)) {
            buffer = data;
            byteOffset = toOffset$1(offset, BYTES);
            var $len = data.byteLength;
            if ($length === undefined) {
              if ($len % BYTES) throw RangeError$2(WRONG_LENGTH);
              byteLength = $len - byteOffset;
              if (byteLength < 0) throw RangeError$2(WRONG_LENGTH);
            } else {
              byteLength = toLength$2($length) * BYTES;
              if (byteLength + byteOffset > $len) throw RangeError$2(WRONG_LENGTH);
            }
            length = byteLength / BYTES;
          } else if (isTypedArray(data)) {
            return fromList(TypedArrayConstructor, data);
          } else {
            return call$a(typedArrayFrom, TypedArrayConstructor, data);
          }
          setInternalState$4(that, {
            buffer: buffer,
            byteOffset: byteOffset,
            byteLength: byteLength,
            length: length,
            view: new DataView$2(buffer)
          });
          while (index < length) addElement(that, index++);
        });

        if (setPrototypeOf) setPrototypeOf(TypedArrayConstructor, TypedArray);
        TypedArrayConstructorPrototype = TypedArrayConstructor.prototype = create$4(TypedArrayPrototype$1);
      } else if (TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS) {
        TypedArrayConstructor = wrapper(function (dummy, data, typedArrayOffset, $length) {
          anInstance$5(dummy, TypedArrayConstructorPrototype);
          return inheritIfRequired$2(function () {
            if (!isObject$2(data)) return new NativeTypedArrayConstructor(toIndex$1(data));
            if (isArrayBuffer(data)) return $length !== undefined
              ? new NativeTypedArrayConstructor(data, toOffset$1(typedArrayOffset, BYTES), $length)
              : typedArrayOffset !== undefined
                ? new NativeTypedArrayConstructor(data, toOffset$1(typedArrayOffset, BYTES))
                : new NativeTypedArrayConstructor(data);
            if (isTypedArray(data)) return fromList(TypedArrayConstructor, data);
            return call$a(typedArrayFrom, TypedArrayConstructor, data);
          }(), dummy, TypedArrayConstructor);
        });

        if (setPrototypeOf) setPrototypeOf(TypedArrayConstructor, TypedArray);
        forEach$2(getOwnPropertyNames$1(NativeTypedArrayConstructor), function (key) {
          if (!(key in TypedArrayConstructor)) {
            createNonEnumerableProperty$4(TypedArrayConstructor, key, NativeTypedArrayConstructor[key]);
          }
        });
        TypedArrayConstructor.prototype = TypedArrayConstructorPrototype;
      }

      if (TypedArrayConstructorPrototype.constructor !== TypedArrayConstructor) {
        createNonEnumerableProperty$4(TypedArrayConstructorPrototype, 'constructor', TypedArrayConstructor);
      }

      enforceInternalState(TypedArrayConstructorPrototype).TypedArrayConstructor = TypedArrayConstructor;

      if (TYPED_ARRAY_TAG) {
        createNonEnumerableProperty$4(TypedArrayConstructorPrototype, TYPED_ARRAY_TAG, CONSTRUCTOR_NAME);
      }

      var FORCED = TypedArrayConstructor != NativeTypedArrayConstructor;

      exported[CONSTRUCTOR_NAME] = TypedArrayConstructor;

      $$v({ global: true, constructor: true, forced: FORCED, sham: !NATIVE_ARRAY_BUFFER_VIEWS }, exported);

      if (!(BYTES_PER_ELEMENT in TypedArrayConstructor)) {
        createNonEnumerableProperty$4(TypedArrayConstructor, BYTES_PER_ELEMENT, BYTES);
      }

      if (!(BYTES_PER_ELEMENT in TypedArrayConstructorPrototype)) {
        createNonEnumerableProperty$4(TypedArrayConstructorPrototype, BYTES_PER_ELEMENT, BYTES);
      }

      setSpecies(CONSTRUCTOR_NAME);
    };
  } else typedArrayConstructor.exports = function () { /* empty */ };

  var typedArrayConstructorExports = typedArrayConstructor.exports;

  var createTypedArrayConstructor$7 = typedArrayConstructorExports;

  // `Uint8Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$7('Uint8', function (init) {
    return function Uint8Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var ArrayBufferViewCore$s = arrayBufferViewCore;
  var lengthOfArrayLike$a = lengthOfArrayLike$m;
  var toIntegerOrInfinity$3 = toIntegerOrInfinity$e;

  var aTypedArray$r = ArrayBufferViewCore$s.aTypedArray;
  var exportTypedArrayMethod$s = ArrayBufferViewCore$s.exportTypedArrayMethod;

  // `%TypedArray%.prototype.at` method
  // https://github.com/tc39/proposal-relative-indexing-method
  exportTypedArrayMethod$s('at', function at(index) {
    var O = aTypedArray$r(this);
    var len = lengthOfArrayLike$a(O);
    var relativeIndex = toIntegerOrInfinity$3(index);
    var k = relativeIndex >= 0 ? relativeIndex : len + relativeIndex;
    return (k < 0 || k >= len) ? undefined : O[k];
  });

  var toObject$5 = toObject$h;
  var toAbsoluteIndex$1 = toAbsoluteIndex$8;
  var lengthOfArrayLike$9 = lengthOfArrayLike$m;
  var deletePropertyOrThrow$1 = deletePropertyOrThrow$4;

  var min$3 = Math.min;

  // `Array.prototype.copyWithin` method implementation
  // https://tc39.es/ecma262/#sec-array.prototype.copywithin
  // eslint-disable-next-line es/no-array-prototype-copywithin -- safe
  var arrayCopyWithin = [].copyWithin || function copyWithin(target /* = 0 */, start /* = 0, end = @length */) {
    var O = toObject$5(this);
    var len = lengthOfArrayLike$9(O);
    var to = toAbsoluteIndex$1(target, len);
    var from = toAbsoluteIndex$1(start, len);
    var end = arguments.length > 2 ? arguments[2] : undefined;
    var count = min$3((end === undefined ? len : toAbsoluteIndex$1(end, len)) - from, len - to);
    var inc = 1;
    if (from < to && to < from + count) {
      inc = -1;
      from += count - 1;
      to += count - 1;
    }
    while (count-- > 0) {
      if (from in O) O[to] = O[from];
      else deletePropertyOrThrow$1(O, to);
      to += inc;
      from += inc;
    } return O;
  };

  var uncurryThis$k = functionUncurryThis;
  var ArrayBufferViewCore$r = arrayBufferViewCore;
  var $ArrayCopyWithin = arrayCopyWithin;

  var u$ArrayCopyWithin = uncurryThis$k($ArrayCopyWithin);
  var aTypedArray$q = ArrayBufferViewCore$r.aTypedArray;
  var exportTypedArrayMethod$r = ArrayBufferViewCore$r.exportTypedArrayMethod;

  // `%TypedArray%.prototype.copyWithin` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.copywithin
  exportTypedArrayMethod$r('copyWithin', function copyWithin(target, start /* , end */) {
    return u$ArrayCopyWithin(aTypedArray$q(this), target, start, arguments.length > 2 ? arguments[2] : undefined);
  });

  var ArrayBufferViewCore$q = arrayBufferViewCore;
  var $every = arrayIteration.every;

  var aTypedArray$p = ArrayBufferViewCore$q.aTypedArray;
  var exportTypedArrayMethod$q = ArrayBufferViewCore$q.exportTypedArrayMethod;

  // `%TypedArray%.prototype.every` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.every
  exportTypedArrayMethod$q('every', function every(callbackfn /* , thisArg */) {
    return $every(aTypedArray$p(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$p = arrayBufferViewCore;
  var $fill = arrayFill$1;
  var toBigInt$1 = toBigInt$3;
  var classof$2 = classof$j;
  var call$9 = functionCall;
  var uncurryThis$j = functionUncurryThis;
  var fails$k = fails$V;

  var aTypedArray$o = ArrayBufferViewCore$p.aTypedArray;
  var exportTypedArrayMethod$p = ArrayBufferViewCore$p.exportTypedArrayMethod;
  var slice$2 = uncurryThis$j(''.slice);

  // V8 ~ Chrome < 59, Safari < 14.1, FF < 55, Edge <=18
  var CONVERSION_BUG = fails$k(function () {
    var count = 0;
    // eslint-disable-next-line es/no-typed-arrays -- safe
    new Int8Array(2).fill({ valueOf: function () { return count++; } });
    return count !== 1;
  });

  // `%TypedArray%.prototype.fill` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.fill
  exportTypedArrayMethod$p('fill', function fill(value /* , start, end */) {
    var length = arguments.length;
    aTypedArray$o(this);
    var actualValue = slice$2(classof$2(this), 0, 3) === 'Big' ? toBigInt$1(value) : +value;
    return call$9($fill, this, actualValue, length > 1 ? arguments[1] : undefined, length > 2 ? arguments[2] : undefined);
  }, CONVERSION_BUG);

  var lengthOfArrayLike$8 = lengthOfArrayLike$m;

  var arrayFromConstructorAndList$2 = function (Constructor, list) {
    var index = 0;
    var length = lengthOfArrayLike$8(list);
    var result = new Constructor(length);
    while (length > index) result[index] = list[index++];
    return result;
  };

  var ArrayBufferViewCore$o = arrayBufferViewCore;
  var speciesConstructor$1 = speciesConstructor$4;

  var aTypedArrayConstructor = ArrayBufferViewCore$o.aTypedArrayConstructor;
  var getTypedArrayConstructor$3 = ArrayBufferViewCore$o.getTypedArrayConstructor;

  // a part of `TypedArraySpeciesCreate` abstract operation
  // https://tc39.es/ecma262/#typedarray-species-create
  var typedArraySpeciesConstructor$4 = function (originalArray) {
    return aTypedArrayConstructor(speciesConstructor$1(originalArray, getTypedArrayConstructor$3(originalArray)));
  };

  var arrayFromConstructorAndList$1 = arrayFromConstructorAndList$2;
  var typedArraySpeciesConstructor$3 = typedArraySpeciesConstructor$4;

  var typedArrayFromSpeciesAndList = function (instance, list) {
    return arrayFromConstructorAndList$1(typedArraySpeciesConstructor$3(instance), list);
  };

  var ArrayBufferViewCore$n = arrayBufferViewCore;
  var $filter = arrayIteration.filter;
  var fromSpeciesAndList = typedArrayFromSpeciesAndList;

  var aTypedArray$n = ArrayBufferViewCore$n.aTypedArray;
  var exportTypedArrayMethod$o = ArrayBufferViewCore$n.exportTypedArrayMethod;

  // `%TypedArray%.prototype.filter` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.filter
  exportTypedArrayMethod$o('filter', function filter(callbackfn /* , thisArg */) {
    var list = $filter(aTypedArray$n(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);
    return fromSpeciesAndList(this, list);
  });

  var ArrayBufferViewCore$m = arrayBufferViewCore;
  var $find = arrayIteration.find;

  var aTypedArray$m = ArrayBufferViewCore$m.aTypedArray;
  var exportTypedArrayMethod$n = ArrayBufferViewCore$m.exportTypedArrayMethod;

  // `%TypedArray%.prototype.find` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.find
  exportTypedArrayMethod$n('find', function find(predicate /* , thisArg */) {
    return $find(aTypedArray$m(this), predicate, arguments.length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$l = arrayBufferViewCore;
  var $findIndex = arrayIteration.findIndex;

  var aTypedArray$l = ArrayBufferViewCore$l.aTypedArray;
  var exportTypedArrayMethod$m = ArrayBufferViewCore$l.exportTypedArrayMethod;

  // `%TypedArray%.prototype.findIndex` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.findindex
  exportTypedArrayMethod$m('findIndex', function findIndex(predicate /* , thisArg */) {
    return $findIndex(aTypedArray$l(this), predicate, arguments.length > 1 ? arguments[1] : undefined);
  });

  var bind$2 = functionBindContext;
  var IndexedObject$2 = indexedObject;
  var toObject$4 = toObject$h;
  var lengthOfArrayLike$7 = lengthOfArrayLike$m;

  // `Array.prototype.{ findLast, findLastIndex }` methods implementation
  var createMethod$2 = function (TYPE) {
    var IS_FIND_LAST_INDEX = TYPE == 1;
    return function ($this, callbackfn, that) {
      var O = toObject$4($this);
      var self = IndexedObject$2(O);
      var boundFunction = bind$2(callbackfn, that);
      var index = lengthOfArrayLike$7(self);
      var value, result;
      while (index-- > 0) {
        value = self[index];
        result = boundFunction(value, index, O);
        if (result) switch (TYPE) {
          case 0: return value; // findLast
          case 1: return index; // findLastIndex
        }
      }
      return IS_FIND_LAST_INDEX ? -1 : undefined;
    };
  };

  var arrayIterationFromLast = {
    // `Array.prototype.findLast` method
    // https://github.com/tc39/proposal-array-find-from-last
    findLast: createMethod$2(0),
    // `Array.prototype.findLastIndex` method
    // https://github.com/tc39/proposal-array-find-from-last
    findLastIndex: createMethod$2(1)
  };

  var ArrayBufferViewCore$k = arrayBufferViewCore;
  var $findLast = arrayIterationFromLast.findLast;

  var aTypedArray$k = ArrayBufferViewCore$k.aTypedArray;
  var exportTypedArrayMethod$l = ArrayBufferViewCore$k.exportTypedArrayMethod;

  // `%TypedArray%.prototype.findLast` method
  // https://github.com/tc39/proposal-array-find-from-last
  exportTypedArrayMethod$l('findLast', function findLast(predicate /* , thisArg */) {
    return $findLast(aTypedArray$k(this), predicate, arguments.length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$j = arrayBufferViewCore;
  var $findLastIndex = arrayIterationFromLast.findLastIndex;

  var aTypedArray$j = ArrayBufferViewCore$j.aTypedArray;
  var exportTypedArrayMethod$k = ArrayBufferViewCore$j.exportTypedArrayMethod;

  // `%TypedArray%.prototype.findLastIndex` method
  // https://github.com/tc39/proposal-array-find-from-last
  exportTypedArrayMethod$k('findLastIndex', function findLastIndex(predicate /* , thisArg */) {
    return $findLastIndex(aTypedArray$j(this), predicate, arguments.length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$i = arrayBufferViewCore;
  var $forEach$1 = arrayIteration.forEach;

  var aTypedArray$i = ArrayBufferViewCore$i.aTypedArray;
  var exportTypedArrayMethod$j = ArrayBufferViewCore$i.exportTypedArrayMethod;

  // `%TypedArray%.prototype.forEach` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.foreach
  exportTypedArrayMethod$j('forEach', function forEach(callbackfn /* , thisArg */) {
    $forEach$1(aTypedArray$i(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$h = arrayBufferViewCore;
  var $includes = arrayIncludes.includes;

  var aTypedArray$h = ArrayBufferViewCore$h.aTypedArray;
  var exportTypedArrayMethod$i = ArrayBufferViewCore$h.exportTypedArrayMethod;

  // `%TypedArray%.prototype.includes` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.includes
  exportTypedArrayMethod$i('includes', function includes(searchElement /* , fromIndex */) {
    return $includes(aTypedArray$h(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$g = arrayBufferViewCore;
  var $indexOf = arrayIncludes.indexOf;

  var aTypedArray$g = ArrayBufferViewCore$g.aTypedArray;
  var exportTypedArrayMethod$h = ArrayBufferViewCore$g.exportTypedArrayMethod;

  // `%TypedArray%.prototype.indexOf` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.indexof
  exportTypedArrayMethod$h('indexOf', function indexOf(searchElement /* , fromIndex */) {
    return $indexOf(aTypedArray$g(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);
  });

  var global$l = global$Q;
  var fails$j = fails$V;
  var uncurryThis$i = functionUncurryThis;
  var ArrayBufferViewCore$f = arrayBufferViewCore;
  var ArrayIterators = es_array_iterator;
  var wellKnownSymbol$6 = wellKnownSymbol$x;

  var ITERATOR$4 = wellKnownSymbol$6('iterator');
  var Uint8Array$2 = global$l.Uint8Array;
  var arrayValues = uncurryThis$i(ArrayIterators.values);
  var arrayKeys = uncurryThis$i(ArrayIterators.keys);
  var arrayEntries = uncurryThis$i(ArrayIterators.entries);
  var aTypedArray$f = ArrayBufferViewCore$f.aTypedArray;
  var exportTypedArrayMethod$g = ArrayBufferViewCore$f.exportTypedArrayMethod;
  var TypedArrayPrototype = Uint8Array$2 && Uint8Array$2.prototype;

  var GENERIC = !fails$j(function () {
    TypedArrayPrototype[ITERATOR$4].call([1]);
  });

  var ITERATOR_IS_VALUES = !!TypedArrayPrototype
    && TypedArrayPrototype.values
    && TypedArrayPrototype[ITERATOR$4] === TypedArrayPrototype.values
    && TypedArrayPrototype.values.name === 'values';

  var typedArrayValues = function values() {
    return arrayValues(aTypedArray$f(this));
  };

  // `%TypedArray%.prototype.entries` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.entries
  exportTypedArrayMethod$g('entries', function entries() {
    return arrayEntries(aTypedArray$f(this));
  }, GENERIC);
  // `%TypedArray%.prototype.keys` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.keys
  exportTypedArrayMethod$g('keys', function keys() {
    return arrayKeys(aTypedArray$f(this));
  }, GENERIC);
  // `%TypedArray%.prototype.values` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.values
  exportTypedArrayMethod$g('values', typedArrayValues, GENERIC || !ITERATOR_IS_VALUES, { name: 'values' });
  // `%TypedArray%.prototype[@@iterator]` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype-@@iterator
  exportTypedArrayMethod$g(ITERATOR$4, typedArrayValues, GENERIC || !ITERATOR_IS_VALUES, { name: 'values' });

  var ArrayBufferViewCore$e = arrayBufferViewCore;
  var uncurryThis$h = functionUncurryThis;

  var aTypedArray$e = ArrayBufferViewCore$e.aTypedArray;
  var exportTypedArrayMethod$f = ArrayBufferViewCore$e.exportTypedArrayMethod;
  var $join = uncurryThis$h([].join);

  // `%TypedArray%.prototype.join` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.join
  exportTypedArrayMethod$f('join', function join(separator) {
    return $join(aTypedArray$e(this), separator);
  });

  /* eslint-disable es/no-array-prototype-lastindexof -- safe */
  var apply$4 = functionApply;
  var toIndexedObject$2 = toIndexedObject$c;
  var toIntegerOrInfinity$2 = toIntegerOrInfinity$e;
  var lengthOfArrayLike$6 = lengthOfArrayLike$m;
  var arrayMethodIsStrict$2 = arrayMethodIsStrict$4;

  var min$2 = Math.min;
  var $lastIndexOf$1 = [].lastIndexOf;
  var NEGATIVE_ZERO = !!$lastIndexOf$1 && 1 / [1].lastIndexOf(1, -0) < 0;
  var STRICT_METHOD$2 = arrayMethodIsStrict$2('lastIndexOf');
  var FORCED$8 = NEGATIVE_ZERO || !STRICT_METHOD$2;

  // `Array.prototype.lastIndexOf` method implementation
  // https://tc39.es/ecma262/#sec-array.prototype.lastindexof
  var arrayLastIndexOf = FORCED$8 ? function lastIndexOf(searchElement /* , fromIndex = @[*-1] */) {
    // convert -0 to +0
    if (NEGATIVE_ZERO) return apply$4($lastIndexOf$1, this, arguments) || 0;
    var O = toIndexedObject$2(this);
    var length = lengthOfArrayLike$6(O);
    var index = length - 1;
    if (arguments.length > 1) index = min$2(index, toIntegerOrInfinity$2(arguments[1]));
    if (index < 0) index = length + index;
    for (;index >= 0; index--) if (index in O && O[index] === searchElement) return index || 0;
    return -1;
  } : $lastIndexOf$1;

  var ArrayBufferViewCore$d = arrayBufferViewCore;
  var apply$3 = functionApply;
  var $lastIndexOf = arrayLastIndexOf;

  var aTypedArray$d = ArrayBufferViewCore$d.aTypedArray;
  var exportTypedArrayMethod$e = ArrayBufferViewCore$d.exportTypedArrayMethod;

  // `%TypedArray%.prototype.lastIndexOf` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.lastindexof
  exportTypedArrayMethod$e('lastIndexOf', function lastIndexOf(searchElement /* , fromIndex */) {
    var length = arguments.length;
    return apply$3($lastIndexOf, aTypedArray$d(this), length > 1 ? [searchElement, arguments[1]] : [searchElement]);
  });

  var ArrayBufferViewCore$c = arrayBufferViewCore;
  var $map = arrayIteration.map;
  var typedArraySpeciesConstructor$2 = typedArraySpeciesConstructor$4;

  var aTypedArray$c = ArrayBufferViewCore$c.aTypedArray;
  var exportTypedArrayMethod$d = ArrayBufferViewCore$c.exportTypedArrayMethod;

  // `%TypedArray%.prototype.map` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.map
  exportTypedArrayMethod$d('map', function map(mapfn /* , thisArg */) {
    return $map(aTypedArray$c(this), mapfn, arguments.length > 1 ? arguments[1] : undefined, function (O, length) {
      return new (typedArraySpeciesConstructor$2(O))(length);
    });
  });

  var aCallable$8 = aCallable$h;
  var toObject$3 = toObject$h;
  var IndexedObject$1 = indexedObject;
  var lengthOfArrayLike$5 = lengthOfArrayLike$m;

  var $TypeError$2 = TypeError;

  // `Array.prototype.{ reduce, reduceRight }` methods implementation
  var createMethod$1 = function (IS_RIGHT) {
    return function (that, callbackfn, argumentsLength, memo) {
      aCallable$8(callbackfn);
      var O = toObject$3(that);
      var self = IndexedObject$1(O);
      var length = lengthOfArrayLike$5(O);
      var index = IS_RIGHT ? length - 1 : 0;
      var i = IS_RIGHT ? -1 : 1;
      if (argumentsLength < 2) while (true) {
        if (index in self) {
          memo = self[index];
          index += i;
          break;
        }
        index += i;
        if (IS_RIGHT ? index < 0 : length <= index) {
          throw $TypeError$2('Reduce of empty array with no initial value');
        }
      }
      for (;IS_RIGHT ? index >= 0 : length > index; index += i) if (index in self) {
        memo = callbackfn(memo, self[index], index, O);
      }
      return memo;
    };
  };

  var arrayReduce = {
    // `Array.prototype.reduce` method
    // https://tc39.es/ecma262/#sec-array.prototype.reduce
    left: createMethod$1(false),
    // `Array.prototype.reduceRight` method
    // https://tc39.es/ecma262/#sec-array.prototype.reduceright
    right: createMethod$1(true)
  };

  var ArrayBufferViewCore$b = arrayBufferViewCore;
  var $reduce = arrayReduce.left;

  var aTypedArray$b = ArrayBufferViewCore$b.aTypedArray;
  var exportTypedArrayMethod$c = ArrayBufferViewCore$b.exportTypedArrayMethod;

  // `%TypedArray%.prototype.reduce` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.reduce
  exportTypedArrayMethod$c('reduce', function reduce(callbackfn /* , initialValue */) {
    var length = arguments.length;
    return $reduce(aTypedArray$b(this), callbackfn, length, length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$a = arrayBufferViewCore;
  var $reduceRight = arrayReduce.right;

  var aTypedArray$a = ArrayBufferViewCore$a.aTypedArray;
  var exportTypedArrayMethod$b = ArrayBufferViewCore$a.exportTypedArrayMethod;

  // `%TypedArray%.prototype.reduceRight` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.reduceright
  exportTypedArrayMethod$b('reduceRight', function reduceRight(callbackfn /* , initialValue */) {
    var length = arguments.length;
    return $reduceRight(aTypedArray$a(this), callbackfn, length, length > 1 ? arguments[1] : undefined);
  });

  var ArrayBufferViewCore$9 = arrayBufferViewCore;

  var aTypedArray$9 = ArrayBufferViewCore$9.aTypedArray;
  var exportTypedArrayMethod$a = ArrayBufferViewCore$9.exportTypedArrayMethod;
  var floor$4 = Math.floor;

  // `%TypedArray%.prototype.reverse` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.reverse
  exportTypedArrayMethod$a('reverse', function reverse() {
    var that = this;
    var length = aTypedArray$9(that).length;
    var middle = floor$4(length / 2);
    var index = 0;
    var value;
    while (index < middle) {
      value = that[index];
      that[index++] = that[--length];
      that[length] = value;
    } return that;
  });

  var global$k = global$Q;
  var call$8 = functionCall;
  var ArrayBufferViewCore$8 = arrayBufferViewCore;
  var lengthOfArrayLike$4 = lengthOfArrayLike$m;
  var toOffset = toOffset$2;
  var toIndexedObject$1 = toObject$h;
  var fails$i = fails$V;

  var RangeError$1 = global$k.RangeError;
  var Int8Array$2 = global$k.Int8Array;
  var Int8ArrayPrototype = Int8Array$2 && Int8Array$2.prototype;
  var $set = Int8ArrayPrototype && Int8ArrayPrototype.set;
  var aTypedArray$8 = ArrayBufferViewCore$8.aTypedArray;
  var exportTypedArrayMethod$9 = ArrayBufferViewCore$8.exportTypedArrayMethod;

  var WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS = !fails$i(function () {
    // eslint-disable-next-line es/no-typed-arrays -- required for testing
    var array = new Uint8ClampedArray(2);
    call$8($set, array, { length: 1, 0: 3 }, 1);
    return array[1] !== 3;
  });

  // https://bugs.chromium.org/p/v8/issues/detail?id=11294 and other
  var TO_OBJECT_BUG = WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS && ArrayBufferViewCore$8.NATIVE_ARRAY_BUFFER_VIEWS && fails$i(function () {
    var array = new Int8Array$2(2);
    array.set(1);
    array.set('2', 1);
    return array[0] !== 0 || array[1] !== 2;
  });

  // `%TypedArray%.prototype.set` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.set
  exportTypedArrayMethod$9('set', function set(arrayLike /* , offset */) {
    aTypedArray$8(this);
    var offset = toOffset(arguments.length > 1 ? arguments[1] : undefined, 1);
    var src = toIndexedObject$1(arrayLike);
    if (WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS) return call$8($set, this, src, offset);
    var length = this.length;
    var len = lengthOfArrayLike$4(src);
    var index = 0;
    if (len + offset > length) throw RangeError$1('Wrong length');
    while (index < len) this[offset + index] = src[index++];
  }, !WORKS_WITH_OBJECTS_AND_GENERIC_ON_TYPED_ARRAYS || TO_OBJECT_BUG);

  var ArrayBufferViewCore$7 = arrayBufferViewCore;
  var typedArraySpeciesConstructor$1 = typedArraySpeciesConstructor$4;
  var fails$h = fails$V;
  var arraySlice$5 = arraySlice$9;

  var aTypedArray$7 = ArrayBufferViewCore$7.aTypedArray;
  var exportTypedArrayMethod$8 = ArrayBufferViewCore$7.exportTypedArrayMethod;

  var FORCED$7 = fails$h(function () {
    // eslint-disable-next-line es/no-typed-arrays -- required for testing
    new Int8Array(1).slice();
  });

  // `%TypedArray%.prototype.slice` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.slice
  exportTypedArrayMethod$8('slice', function slice(start, end) {
    var list = arraySlice$5(aTypedArray$7(this), start, end);
    var C = typedArraySpeciesConstructor$1(this);
    var index = 0;
    var length = list.length;
    var result = new C(length);
    while (length > index) result[index] = list[index++];
    return result;
  }, FORCED$7);

  var ArrayBufferViewCore$6 = arrayBufferViewCore;
  var $some = arrayIteration.some;

  var aTypedArray$6 = ArrayBufferViewCore$6.aTypedArray;
  var exportTypedArrayMethod$7 = ArrayBufferViewCore$6.exportTypedArrayMethod;

  // `%TypedArray%.prototype.some` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.some
  exportTypedArrayMethod$7('some', function some(callbackfn /* , thisArg */) {
    return $some(aTypedArray$6(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);
  });

  var arraySlice$4 = arraySliceSimple;

  var floor$3 = Math.floor;

  var mergeSort = function (array, comparefn) {
    var length = array.length;
    var middle = floor$3(length / 2);
    return length < 8 ? insertionSort(array, comparefn) : merge(
      array,
      mergeSort(arraySlice$4(array, 0, middle), comparefn),
      mergeSort(arraySlice$4(array, middle), comparefn),
      comparefn
    );
  };

  var insertionSort = function (array, comparefn) {
    var length = array.length;
    var i = 1;
    var element, j;

    while (i < length) {
      j = i;
      element = array[i];
      while (j && comparefn(array[j - 1], element) > 0) {
        array[j] = array[--j];
      }
      if (j !== i++) array[j] = element;
    } return array;
  };

  var merge = function (array, left, right, comparefn) {
    var llength = left.length;
    var rlength = right.length;
    var lindex = 0;
    var rindex = 0;

    while (lindex < llength || rindex < rlength) {
      array[lindex + rindex] = (lindex < llength && rindex < rlength)
        ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]
        : lindex < llength ? left[lindex++] : right[rindex++];
    } return array;
  };

  var arraySort$1 = mergeSort;

  var userAgent$1 = engineUserAgent;

  var firefox = userAgent$1.match(/firefox\/(\d+)/i);

  var engineFfVersion = !!firefox && +firefox[1];

  var UA = engineUserAgent;

  var engineIsIeOrEdge = /MSIE|Trident/.test(UA);

  var userAgent = engineUserAgent;

  var webkit = userAgent.match(/AppleWebKit\/(\d+)\./);

  var engineWebkitVersion = !!webkit && +webkit[1];

  var global$j = global$Q;
  var uncurryThis$g = functionUncurryThisClause;
  var fails$g = fails$V;
  var aCallable$7 = aCallable$h;
  var internalSort$1 = arraySort$1;
  var ArrayBufferViewCore$5 = arrayBufferViewCore;
  var FF$1 = engineFfVersion;
  var IE_OR_EDGE$1 = engineIsIeOrEdge;
  var V8$2 = engineV8Version;
  var WEBKIT$1 = engineWebkitVersion;

  var aTypedArray$5 = ArrayBufferViewCore$5.aTypedArray;
  var exportTypedArrayMethod$6 = ArrayBufferViewCore$5.exportTypedArrayMethod;
  var Uint16Array$1 = global$j.Uint16Array;
  var nativeSort$1 = Uint16Array$1 && uncurryThis$g(Uint16Array$1.prototype.sort);

  // WebKit
  var ACCEPT_INCORRECT_ARGUMENTS = !!nativeSort$1 && !(fails$g(function () {
    nativeSort$1(new Uint16Array$1(2), null);
  }) && fails$g(function () {
    nativeSort$1(new Uint16Array$1(2), {});
  }));

  var STABLE_SORT$1 = !!nativeSort$1 && !fails$g(function () {
    // feature detection can be too slow, so check engines versions
    if (V8$2) return V8$2 < 74;
    if (FF$1) return FF$1 < 67;
    if (IE_OR_EDGE$1) return true;
    if (WEBKIT$1) return WEBKIT$1 < 602;

    var array = new Uint16Array$1(516);
    var expected = Array(516);
    var index, mod;

    for (index = 0; index < 516; index++) {
      mod = index % 4;
      array[index] = 515 - index;
      expected[index] = index - 2 * mod + 3;
    }

    nativeSort$1(array, function (a, b) {
      return (a / 4 | 0) - (b / 4 | 0);
    });

    for (index = 0; index < 516; index++) {
      if (array[index] !== expected[index]) return true;
    }
  });

  var getSortCompare$1 = function (comparefn) {
    return function (x, y) {
      if (comparefn !== undefined) return +comparefn(x, y) || 0;
      // eslint-disable-next-line no-self-compare -- NaN check
      if (y !== y) return -1;
      // eslint-disable-next-line no-self-compare -- NaN check
      if (x !== x) return 1;
      if (x === 0 && y === 0) return 1 / x > 0 && 1 / y < 0 ? 1 : -1;
      return x > y;
    };
  };

  // `%TypedArray%.prototype.sort` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.sort
  exportTypedArrayMethod$6('sort', function sort(comparefn) {
    if (comparefn !== undefined) aCallable$7(comparefn);
    if (STABLE_SORT$1) return nativeSort$1(this, comparefn);

    return internalSort$1(aTypedArray$5(this), getSortCompare$1(comparefn));
  }, !STABLE_SORT$1 || ACCEPT_INCORRECT_ARGUMENTS);

  var ArrayBufferViewCore$4 = arrayBufferViewCore;
  var toLength$1 = toLength$a;
  var toAbsoluteIndex = toAbsoluteIndex$8;
  var typedArraySpeciesConstructor = typedArraySpeciesConstructor$4;

  var aTypedArray$4 = ArrayBufferViewCore$4.aTypedArray;
  var exportTypedArrayMethod$5 = ArrayBufferViewCore$4.exportTypedArrayMethod;

  // `%TypedArray%.prototype.subarray` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.subarray
  exportTypedArrayMethod$5('subarray', function subarray(begin, end) {
    var O = aTypedArray$4(this);
    var length = O.length;
    var beginIndex = toAbsoluteIndex(begin, length);
    var C = typedArraySpeciesConstructor(O);
    return new C(
      O.buffer,
      O.byteOffset + beginIndex * O.BYTES_PER_ELEMENT,
      toLength$1((end === undefined ? length : toAbsoluteIndex(end, length)) - beginIndex)
    );
  });

  var global$i = global$Q;
  var apply$2 = functionApply;
  var ArrayBufferViewCore$3 = arrayBufferViewCore;
  var fails$f = fails$V;
  var arraySlice$3 = arraySlice$9;

  var Int8Array$1 = global$i.Int8Array;
  var aTypedArray$3 = ArrayBufferViewCore$3.aTypedArray;
  var exportTypedArrayMethod$4 = ArrayBufferViewCore$3.exportTypedArrayMethod;
  var $toLocaleString = [].toLocaleString;

  // iOS Safari 6.x fails here
  var TO_LOCALE_STRING_BUG = !!Int8Array$1 && fails$f(function () {
    $toLocaleString.call(new Int8Array$1(1));
  });

  var FORCED$6 = fails$f(function () {
    return [1, 2].toLocaleString() != new Int8Array$1([1, 2]).toLocaleString();
  }) || !fails$f(function () {
    Int8Array$1.prototype.toLocaleString.call([1, 2]);
  });

  // `%TypedArray%.prototype.toLocaleString` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.tolocalestring
  exportTypedArrayMethod$4('toLocaleString', function toLocaleString() {
    return apply$2(
      $toLocaleString,
      TO_LOCALE_STRING_BUG ? arraySlice$3(aTypedArray$3(this)) : aTypedArray$3(this),
      arraySlice$3(arguments)
    );
  }, FORCED$6);

  var lengthOfArrayLike$3 = lengthOfArrayLike$m;

  // https://tc39.es/proposal-change-array-by-copy/#sec-array.prototype.toReversed
  // https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.toReversed
  var arrayToReversed$1 = function (O, C) {
    var len = lengthOfArrayLike$3(O);
    var A = new C(len);
    var k = 0;
    for (; k < len; k++) A[k] = O[len - k - 1];
    return A;
  };

  var arrayToReversed = arrayToReversed$1;
  var ArrayBufferViewCore$2 = arrayBufferViewCore;

  var aTypedArray$2 = ArrayBufferViewCore$2.aTypedArray;
  var exportTypedArrayMethod$3 = ArrayBufferViewCore$2.exportTypedArrayMethod;
  var getTypedArrayConstructor$2 = ArrayBufferViewCore$2.getTypedArrayConstructor;

  // `%TypedArray%.prototype.toReversed` method
  // https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.toReversed
  exportTypedArrayMethod$3('toReversed', function toReversed() {
    return arrayToReversed(aTypedArray$2(this), getTypedArrayConstructor$2(this));
  });

  var ArrayBufferViewCore$1 = arrayBufferViewCore;
  var uncurryThis$f = functionUncurryThis;
  var aCallable$6 = aCallable$h;
  var arrayFromConstructorAndList = arrayFromConstructorAndList$2;

  var aTypedArray$1 = ArrayBufferViewCore$1.aTypedArray;
  var getTypedArrayConstructor$1 = ArrayBufferViewCore$1.getTypedArrayConstructor;
  var exportTypedArrayMethod$2 = ArrayBufferViewCore$1.exportTypedArrayMethod;
  var sort = uncurryThis$f(ArrayBufferViewCore$1.TypedArrayPrototype.sort);

  // `%TypedArray%.prototype.toSorted` method
  // https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.toSorted
  exportTypedArrayMethod$2('toSorted', function toSorted(compareFn) {
    if (compareFn !== undefined) aCallable$6(compareFn);
    var O = aTypedArray$1(this);
    var A = arrayFromConstructorAndList(getTypedArrayConstructor$1(O), O);
    return sort(A, compareFn);
  });

  var exportTypedArrayMethod$1 = arrayBufferViewCore.exportTypedArrayMethod;
  var fails$e = fails$V;
  var global$h = global$Q;
  var uncurryThis$e = functionUncurryThis;

  var Uint8Array$1 = global$h.Uint8Array;
  var Uint8ArrayPrototype = Uint8Array$1 && Uint8Array$1.prototype || {};
  var arrayToString = [].toString;
  var join$3 = uncurryThis$e([].join);

  if (fails$e(function () { arrayToString.call({}); })) {
    arrayToString = function toString() {
      return join$3(this);
    };
  }

  var IS_NOT_ARRAY_METHOD = Uint8ArrayPrototype.toString != arrayToString;

  // `%TypedArray%.prototype.toString` method
  // https://tc39.es/ecma262/#sec-%typedarray%.prototype.tostring
  exportTypedArrayMethod$1('toString', arrayToString, IS_NOT_ARRAY_METHOD);

  var lengthOfArrayLike$2 = lengthOfArrayLike$m;
  var toIntegerOrInfinity$1 = toIntegerOrInfinity$e;

  var $RangeError$1 = RangeError;

  // https://tc39.es/proposal-change-array-by-copy/#sec-array.prototype.with
  // https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.with
  var arrayWith$1 = function (O, C, index, value) {
    var len = lengthOfArrayLike$2(O);
    var relativeIndex = toIntegerOrInfinity$1(index);
    var actualIndex = relativeIndex < 0 ? len + relativeIndex : relativeIndex;
    if (actualIndex >= len || actualIndex < 0) throw $RangeError$1('Incorrect index');
    var A = new C(len);
    var k = 0;
    for (; k < len; k++) A[k] = k === actualIndex ? value : O[k];
    return A;
  };

  var arrayWith = arrayWith$1;
  var ArrayBufferViewCore = arrayBufferViewCore;
  var isBigIntArray = isBigIntArray$2;
  var toIntegerOrInfinity = toIntegerOrInfinity$e;
  var toBigInt = toBigInt$3;

  var aTypedArray = ArrayBufferViewCore.aTypedArray;
  var getTypedArrayConstructor = ArrayBufferViewCore.getTypedArrayConstructor;
  var exportTypedArrayMethod = ArrayBufferViewCore.exportTypedArrayMethod;

  var PROPER_ORDER = !!function () {
    try {
      // eslint-disable-next-line no-throw-literal, es/no-typed-arrays, es/no-array-prototype-with -- required for testing
      new Int8Array(1)['with'](2, { valueOf: function () { throw 8; } });
    } catch (error) {
      // some early implementations, like WebKit, does not follow the final semantic
      // https://github.com/tc39/proposal-change-array-by-copy/pull/86
      return error === 8;
    }
  }();

  // `%TypedArray%.prototype.with` method
  // https://tc39.es/proposal-change-array-by-copy/#sec-%typedarray%.prototype.with
  exportTypedArrayMethod('with', { 'with': function (index, value) {
    var O = aTypedArray(this);
    var relativeIndex = toIntegerOrInfinity(index);
    var actualValue = isBigIntArray(O) ? toBigInt(value) : +value;
    return arrayWith(O, getTypedArrayConstructor(O), relativeIndex, actualValue);
  } }['with'], !PROPER_ORDER);

  var uncurryThisAccessor$1 = functionUncurryThisAccessor;
  var classof$1 = classofRaw$2;

  var $TypeError$1 = TypeError;

  // Includes
  // - Perform ? RequireInternalSlot(O, [[ArrayBufferData]]).
  // - If IsSharedArrayBuffer(O) is true, throw a TypeError exception.
  var arrayBufferByteLength$2 = uncurryThisAccessor$1(ArrayBuffer.prototype, 'byteLength', 'get') || function (O) {
    if (classof$1(O) != 'ArrayBuffer') throw $TypeError$1('ArrayBuffer expected');
    return O.byteLength;
  };

  var uncurryThis$d = functionUncurryThis;
  var arrayBufferByteLength$1 = arrayBufferByteLength$2;

  var slice$1 = uncurryThis$d(ArrayBuffer.prototype.slice);

  var arrayBufferIsDetached = function (O) {
    if (arrayBufferByteLength$1(O) !== 0) return false;
    try {
      slice$1(O, 0, 0);
      return false;
    } catch (error) {
      return true;
    }
  };

  var DESCRIPTORS$b = descriptors;
  var defineBuiltInAccessor$5 = defineBuiltInAccessor$g;
  var isDetached$1 = arrayBufferIsDetached;

  var ArrayBufferPrototype$1 = ArrayBuffer.prototype;

  if (DESCRIPTORS$b && !('detached' in ArrayBufferPrototype$1)) {
    defineBuiltInAccessor$5(ArrayBufferPrototype$1, 'detached', {
      configurable: true,
      get: function detached() {
        return isDetached$1(this);
      }
    });
  }

  var global$g = global$Q;
  var fails$d = fails$V;
  var V8$1 = engineV8Version;
  var IS_BROWSER = engineIsBrowser;
  var IS_DENO = engineIsDeno;
  var IS_NODE$1 = engineIsNode;

  var structuredClone$1 = global$g.structuredClone;

  var structuredCloneProperTransfer = !!structuredClone$1 && !fails$d(function () {
    // prevent V8 ArrayBufferDetaching protector cell invalidation and performance degradation
    // https://github.com/zloirock/core-js/issues/679
    if ((IS_DENO && V8$1 > 92) || (IS_NODE$1 && V8$1 > 94) || (IS_BROWSER && V8$1 > 97)) return false;
    var buffer = new ArrayBuffer(8);
    var clone = structuredClone$1(buffer, { transfer: [buffer] });
    return buffer.byteLength != 0 || clone.byteLength != 8;
  });

  var global$f = global$Q;
  var uncurryThis$c = functionUncurryThis;
  var uncurryThisAccessor = functionUncurryThisAccessor;
  var toIndex = toIndex$3;
  var isDetached = arrayBufferIsDetached;
  var arrayBufferByteLength = arrayBufferByteLength$2;
  var PROPER_TRANSFER = structuredCloneProperTransfer;

  var TypeError$4 = global$f.TypeError;
  var structuredClone = global$f.structuredClone;
  var ArrayBuffer$1 = global$f.ArrayBuffer;
  var DataView$1 = global$f.DataView;
  var min$1 = Math.min;
  var ArrayBufferPrototype = ArrayBuffer$1.prototype;
  var DataViewPrototype = DataView$1.prototype;
  var slice = uncurryThis$c(ArrayBufferPrototype.slice);
  var isResizable = uncurryThisAccessor(ArrayBufferPrototype, 'resizable', 'get');
  var maxByteLength = uncurryThisAccessor(ArrayBufferPrototype, 'maxByteLength', 'get');
  var getInt8 = uncurryThis$c(DataViewPrototype.getInt8);
  var setInt8 = uncurryThis$c(DataViewPrototype.setInt8);

  var arrayBufferTransfer = PROPER_TRANSFER && function (arrayBuffer, newLength, preserveResizability) {
    var byteLength = arrayBufferByteLength(arrayBuffer);
    var newByteLength = newLength === undefined ? byteLength : min$1(toIndex(newLength), byteLength);
    var fixedLength = !isResizable || !isResizable(arrayBuffer);
    if (isDetached(arrayBuffer)) throw TypeError$4('ArrayBuffer is detached');
    var newBuffer = structuredClone(arrayBuffer, { transfer: [arrayBuffer] });
    if (byteLength == newByteLength && (preserveResizability || fixedLength)) return newBuffer;
    if (!preserveResizability || fixedLength) return slice(newBuffer, 0, newByteLength);
    var newNewBuffer = new ArrayBuffer$1(newByteLength, maxByteLength && { maxByteLength: maxByteLength(newBuffer) });
    var a = new DataView$1(newBuffer);
    var b = new DataView$1(newNewBuffer);
    for (var i = 0; i < newByteLength; i++) setInt8(b, i, getInt8(a, i));
    return newNewBuffer;
  };

  var $$u = _export;
  var $transfer$1 = arrayBufferTransfer;

  // `ArrayBuffer.prototype.transfer` method
  // https://tc39.es/proposal-arraybuffer-transfer/#sec-arraybuffer.prototype.transfer
  if ($transfer$1) $$u({ target: 'ArrayBuffer', proto: true }, {
    transfer: function transfer() {
      return $transfer$1(this, arguments.length ? arguments[0] : undefined, true);
    }
  });

  var $$t = _export;
  var $transfer = arrayBufferTransfer;

  // `ArrayBuffer.prototype.transferToFixedLength` method
  // https://tc39.es/proposal-arraybuffer-transfer/#sec-arraybuffer.prototype.transfertofixedlength
  if ($transfer) $$t({ target: 'ArrayBuffer', proto: true }, {
    transferToFixedLength: function transferToFixedLength() {
      return $transfer(this, arguments.length ? arguments[0] : undefined, false);
    }
  });

  var $$s = _export;
  var global$e = global$Q;
  var anInstance$4 = anInstance$a;
  var isCallable$2 = isCallable$x;
  var createNonEnumerableProperty$3 = createNonEnumerableProperty$f;
  var fails$c = fails$V;
  var hasOwn$6 = hasOwnProperty_1;
  var wellKnownSymbol$5 = wellKnownSymbol$x;
  var IteratorPrototype$1 = iteratorsCore.IteratorPrototype;

  var TO_STRING_TAG$2 = wellKnownSymbol$5('toStringTag');

  var NativeIterator = global$e.Iterator;

  // FF56- have non-standard global helper `Iterator`
  var FORCED$5 = !isCallable$2(NativeIterator)
    || NativeIterator.prototype !== IteratorPrototype$1
    // FF44- non-standard `Iterator` passes previous tests
    || !fails$c(function () { NativeIterator({}); });

  var IteratorConstructor = function Iterator() {
    anInstance$4(this, IteratorPrototype$1);
  };

  if (!hasOwn$6(IteratorPrototype$1, TO_STRING_TAG$2)) {
    createNonEnumerableProperty$3(IteratorPrototype$1, TO_STRING_TAG$2, 'Iterator');
  }

  if (FORCED$5 || !hasOwn$6(IteratorPrototype$1, 'constructor') || IteratorPrototype$1.constructor === Object) {
    createNonEnumerableProperty$3(IteratorPrototype$1, 'constructor', IteratorConstructor);
  }

  IteratorConstructor.prototype = IteratorPrototype$1;

  // `Iterator` constructor
  // https://github.com/tc39/proposal-iterator-helpers
  $$s({ global: true, constructor: true, forced: FORCED$5 }, {
    Iterator: IteratorConstructor
  });

  var aCallable$5 = aCallable$h;

  var getIteratorDirect$4 = function (obj) {
    return {
      iterator: obj,
      next: aCallable$5(obj.next)
    };
  };

  var $$r = _export;
  var iterate$1 = iterate$6;
  var aCallable$4 = aCallable$h;
  var anObject$7 = anObject$s;
  var getIteratorDirect$3 = getIteratorDirect$4;

  // `Iterator.prototype.forEach` method
  // https://github.com/tc39/proposal-iterator-helpers
  $$r({ target: 'Iterator', proto: true, real: true }, {
    forEach: function forEach(fn) {
      anObject$7(this);
      aCallable$4(fn);
      var record = getIteratorDirect$3(this);
      var counter = 0;
      iterate$1(record, function (value) {
        fn(value, counter++);
      }, { IS_RECORD: true });
    }
  });

  var call$7 = functionCall;
  var create$3 = objectCreate;
  var createNonEnumerableProperty$2 = createNonEnumerableProperty$f;
  var defineBuiltIns$1 = defineBuiltIns$4;
  var wellKnownSymbol$4 = wellKnownSymbol$x;
  var InternalStateModule$3 = internalState;
  var getMethod$1 = getMethod$9;
  var IteratorPrototype = iteratorsCore.IteratorPrototype;
  var createIterResultObject = createIterResultObject$4;
  var iteratorClose = iteratorClose$3;

  var TO_STRING_TAG$1 = wellKnownSymbol$4('toStringTag');
  var ITERATOR_HELPER = 'IteratorHelper';
  var WRAP_FOR_VALID_ITERATOR = 'WrapForValidIterator';
  var setInternalState$3 = InternalStateModule$3.set;

  var createIteratorProxyPrototype = function (IS_ITERATOR) {
    var getInternalState = InternalStateModule$3.getterFor(IS_ITERATOR ? WRAP_FOR_VALID_ITERATOR : ITERATOR_HELPER);

    return defineBuiltIns$1(create$3(IteratorPrototype), {
      next: function next() {
        var state = getInternalState(this);
        // for simplification:
        //   for `%WrapForValidIteratorPrototype%.next` our `nextHandler` returns `IterResultObject`
        //   for `%IteratorHelperPrototype%.next` - just a value
        if (IS_ITERATOR) return state.nextHandler();
        try {
          var result = state.done ? undefined : state.nextHandler();
          return createIterResultObject(result, state.done);
        } catch (error) {
          state.done = true;
          throw error;
        }
      },
      'return': function () {
        var state = getInternalState(this);
        var iterator = state.iterator;
        state.done = true;
        if (IS_ITERATOR) {
          var returnMethod = getMethod$1(iterator, 'return');
          return returnMethod ? call$7(returnMethod, iterator) : createIterResultObject(undefined, true);
        }
        if (state.inner) try {
          iteratorClose(state.inner.iterator, 'normal');
        } catch (error) {
          return iteratorClose(iterator, 'throw', error);
        }
        iteratorClose(iterator, 'normal');
        return createIterResultObject(undefined, true);
      }
    });
  };

  var WrapForValidIteratorPrototype = createIteratorProxyPrototype(true);
  var IteratorHelperPrototype = createIteratorProxyPrototype(false);

  createNonEnumerableProperty$2(IteratorHelperPrototype, TO_STRING_TAG$1, 'Iterator Helper');

  var iteratorCreateProxy = function (nextHandler, IS_ITERATOR) {
    var IteratorProxy = function Iterator(record, state) {
      if (state) {
        state.iterator = record.iterator;
        state.next = record.next;
      } else state = record;
      state.type = IS_ITERATOR ? WRAP_FOR_VALID_ITERATOR : ITERATOR_HELPER;
      state.nextHandler = nextHandler;
      state.counter = 0;
      state.done = false;
      setInternalState$3(this, state);
    };

    IteratorProxy.prototype = IS_ITERATOR ? WrapForValidIteratorPrototype : IteratorHelperPrototype;

    return IteratorProxy;
  };

  var call$6 = functionCall;
  var aCallable$3 = aCallable$h;
  var anObject$6 = anObject$s;
  var getIteratorDirect$2 = getIteratorDirect$4;
  var createIteratorProxy$1 = iteratorCreateProxy;
  var callWithSafeIterationClosing$1 = callWithSafeIterationClosing$3;

  var IteratorProxy$1 = createIteratorProxy$1(function () {
    var iterator = this.iterator;
    var result = anObject$6(call$6(this.next, iterator));
    var done = this.done = !!result.done;
    if (!done) return callWithSafeIterationClosing$1(iterator, this.mapper, [result.value, this.counter++], true);
  });

  // `Iterator.prototype.map` method
  // https://github.com/tc39/proposal-iterator-helpers
  var iteratorMap = function map(mapper) {
    anObject$6(this);
    aCallable$3(mapper);
    return new IteratorProxy$1(getIteratorDirect$2(this), {
      mapper: mapper
    });
  };

  var $$q = _export;
  var map = iteratorMap;

  // `Iterator.prototype.map` method
  // https://github.com/tc39/proposal-iterator-helpers
  $$q({ target: 'Iterator', proto: true, real: true }, {
    map: map
  });

  // iterable DOM collections
  // flag - `iterable` interface - 'entries', 'keys', 'values', 'forEach' methods
  var domIterables = {
    CSSRuleList: 0,
    CSSStyleDeclaration: 0,
    CSSValueList: 0,
    ClientRectList: 0,
    DOMRectList: 0,
    DOMStringList: 0,
    DOMTokenList: 1,
    DataTransferItemList: 0,
    FileList: 0,
    HTMLAllCollection: 0,
    HTMLCollection: 0,
    HTMLFormElement: 0,
    HTMLSelectElement: 0,
    MediaList: 0,
    MimeTypeArray: 0,
    NamedNodeMap: 0,
    NodeList: 1,
    PaintRequestList: 0,
    Plugin: 0,
    PluginArray: 0,
    SVGLengthList: 0,
    SVGNumberList: 0,
    SVGPathSegList: 0,
    SVGPointList: 0,
    SVGStringList: 0,
    SVGTransformList: 0,
    SourceBufferList: 0,
    StyleSheetList: 0,
    TextTrackCueList: 0,
    TextTrackList: 0,
    TouchList: 0
  };

  // in old WebKit versions, `element.classList` is not an instance of global `DOMTokenList`
  var documentCreateElement = documentCreateElement$2;

  var classList = documentCreateElement('span').classList;
  var DOMTokenListPrototype$2 = classList && classList.constructor && classList.constructor.prototype;

  var domTokenListPrototype = DOMTokenListPrototype$2 === Object.prototype ? undefined : DOMTokenListPrototype$2;

  var $forEach = arrayIteration.forEach;
  var arrayMethodIsStrict$1 = arrayMethodIsStrict$4;

  var STRICT_METHOD$1 = arrayMethodIsStrict$1('forEach');

  // `Array.prototype.forEach` method implementation
  // https://tc39.es/ecma262/#sec-array.prototype.foreach
  var arrayForEach = !STRICT_METHOD$1 ? function forEach(callbackfn /* , thisArg */) {
    return $forEach(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);
  // eslint-disable-next-line es/no-array-prototype-foreach -- safe
  } : [].forEach;

  var global$d = global$Q;
  var DOMIterables$1 = domIterables;
  var DOMTokenListPrototype$1 = domTokenListPrototype;
  var forEach$1 = arrayForEach;
  var createNonEnumerableProperty$1 = createNonEnumerableProperty$f;

  var handlePrototype$1 = function (CollectionPrototype) {
    // some Chrome versions have non-configurable methods on DOMTokenList
    if (CollectionPrototype && CollectionPrototype.forEach !== forEach$1) try {
      createNonEnumerableProperty$1(CollectionPrototype, 'forEach', forEach$1);
    } catch (error) {
      CollectionPrototype.forEach = forEach$1;
    }
  };

  for (var COLLECTION_NAME$1 in DOMIterables$1) {
    if (DOMIterables$1[COLLECTION_NAME$1]) {
      handlePrototype$1(global$d[COLLECTION_NAME$1] && global$d[COLLECTION_NAME$1].prototype);
    }
  }

  handlePrototype$1(DOMTokenListPrototype$1);

  var global$c = global$Q;
  var DOMIterables = domIterables;
  var DOMTokenListPrototype = domTokenListPrototype;
  var ArrayIteratorMethods = es_array_iterator;
  var createNonEnumerableProperty = createNonEnumerableProperty$f;
  var wellKnownSymbol$3 = wellKnownSymbol$x;

  var ITERATOR$3 = wellKnownSymbol$3('iterator');
  var TO_STRING_TAG = wellKnownSymbol$3('toStringTag');
  var ArrayValues = ArrayIteratorMethods.values;

  var handlePrototype = function (CollectionPrototype, COLLECTION_NAME) {
    if (CollectionPrototype) {
      // some Chrome versions have non-configurable methods on DOMTokenList
      if (CollectionPrototype[ITERATOR$3] !== ArrayValues) try {
        createNonEnumerableProperty(CollectionPrototype, ITERATOR$3, ArrayValues);
      } catch (error) {
        CollectionPrototype[ITERATOR$3] = ArrayValues;
      }
      if (!CollectionPrototype[TO_STRING_TAG]) {
        createNonEnumerableProperty(CollectionPrototype, TO_STRING_TAG, COLLECTION_NAME);
      }
      if (DOMIterables[COLLECTION_NAME]) for (var METHOD_NAME in ArrayIteratorMethods) {
        // some Chrome versions have non-configurable methods on DOMTokenList
        if (CollectionPrototype[METHOD_NAME] !== ArrayIteratorMethods[METHOD_NAME]) try {
          createNonEnumerableProperty(CollectionPrototype, METHOD_NAME, ArrayIteratorMethods[METHOD_NAME]);
        } catch (error) {
          CollectionPrototype[METHOD_NAME] = ArrayIteratorMethods[METHOD_NAME];
        }
      }
    }
  };

  for (var COLLECTION_NAME in DOMIterables) {
    handlePrototype(global$c[COLLECTION_NAME] && global$c[COLLECTION_NAME].prototype, COLLECTION_NAME);
  }

  handlePrototype(DOMTokenListPrototype, 'DOMTokenList');

  var fails$b = fails$V;
  var wellKnownSymbol$2 = wellKnownSymbol$x;
  var DESCRIPTORS$a = descriptors;
  var IS_PURE$1 = isPure;

  var ITERATOR$2 = wellKnownSymbol$2('iterator');

  var urlConstructorDetection = !fails$b(function () {
    // eslint-disable-next-line unicorn/relative-url-style -- required for testing
    var url = new URL('b?a=1&b=2&c=3', 'http://a');
    var searchParams = url.searchParams;
    var result = '';
    url.pathname = 'c%20d';
    searchParams.forEach(function (value, key) {
      searchParams['delete']('b');
      result += key + value;
    });
    return (IS_PURE$1 && !url.toJSON)
      || (!searchParams.size && (IS_PURE$1 || !DESCRIPTORS$a))
      || !searchParams.sort
      || url.href !== 'http://a/c%20d?a=1&c=3'
      || searchParams.get('c') !== '3'
      || String(new URLSearchParams('?a=1')) !== 'a=1'
      || !searchParams[ITERATOR$2]
      // throws in Edge
      || new URL('https://a@b').username !== 'a'
      || new URLSearchParams(new URLSearchParams('a=b')).get('a') !== 'b'
      // not punycoded in Edge
      || new URL('http://тест').host !== 'xn--e1aybc'
      // not escaped in Chrome 62-
      || new URL('http://a#б').hash !== '#%D0%B1'
      // fails in Chrome 66-
      || result !== 'a1c3'
      // throws in Safari
      || new URL('http://x', undefined).host !== 'x';
  });

  var DESCRIPTORS$9 = descriptors;
  var uncurryThis$b = functionUncurryThis;
  var call$5 = functionCall;
  var fails$a = fails$V;
  var objectKeys$1 = objectKeys$4;
  var getOwnPropertySymbolsModule = objectGetOwnPropertySymbols;
  var propertyIsEnumerableModule = objectPropertyIsEnumerable;
  var toObject$2 = toObject$h;
  var IndexedObject = indexedObject;

  // eslint-disable-next-line es/no-object-assign -- safe
  var $assign = Object.assign;
  // eslint-disable-next-line es/no-object-defineproperty -- required for testing
  var defineProperty$4 = Object.defineProperty;
  var concat = uncurryThis$b([].concat);

  // `Object.assign` method
  // https://tc39.es/ecma262/#sec-object.assign
  var objectAssign = !$assign || fails$a(function () {
    // should have correct order of operations (Edge bug)
    if (DESCRIPTORS$9 && $assign({ b: 1 }, $assign(defineProperty$4({}, 'a', {
      enumerable: true,
      get: function () {
        defineProperty$4(this, 'b', {
          value: 3,
          enumerable: false
        });
      }
    }), { b: 2 })).b !== 1) return true;
    // should work with symbols and should have deterministic property order (V8 bug)
    var A = {};
    var B = {};
    // eslint-disable-next-line es/no-symbol -- safe
    var symbol = Symbol();
    var alphabet = 'abcdefghijklmnopqrst';
    A[symbol] = 7;
    alphabet.split('').forEach(function (chr) { B[chr] = chr; });
    return $assign({}, A)[symbol] != 7 || objectKeys$1($assign({}, B)).join('') != alphabet;
  }) ? function assign(target, source) { // eslint-disable-line no-unused-vars -- required for `.length`
    var T = toObject$2(target);
    var argumentsLength = arguments.length;
    var index = 1;
    var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;
    var propertyIsEnumerable = propertyIsEnumerableModule.f;
    while (argumentsLength > index) {
      var S = IndexedObject(arguments[index++]);
      var keys = getOwnPropertySymbols ? concat(objectKeys$1(S), getOwnPropertySymbols(S)) : objectKeys$1(S);
      var length = keys.length;
      var j = 0;
      var key;
      while (length > j) {
        key = keys[j++];
        if (!DESCRIPTORS$9 || call$5(propertyIsEnumerable, S, key)) T[key] = S[key];
      }
    } return T;
  } : $assign;

  // based on https://github.com/bestiejs/punycode.js/blob/master/punycode.js
  var uncurryThis$a = functionUncurryThis;

  var maxInt = 2147483647; // aka. 0x7FFFFFFF or 2^31-1
  var base = 36;
  var tMin = 1;
  var tMax = 26;
  var skew = 38;
  var damp = 700;
  var initialBias = 72;
  var initialN = 128; // 0x80
  var delimiter = '-'; // '\x2D'
  var regexNonASCII = /[^\0-\u007E]/; // non-ASCII chars
  var regexSeparators = /[.\u3002\uFF0E\uFF61]/g; // RFC 3490 separators
  var OVERFLOW_ERROR = 'Overflow: input needs wider integers to process';
  var baseMinusTMin = base - tMin;

  var $RangeError = RangeError;
  var exec$3 = uncurryThis$a(regexSeparators.exec);
  var floor$2 = Math.floor;
  var fromCharCode$1 = String.fromCharCode;
  var charCodeAt$1 = uncurryThis$a(''.charCodeAt);
  var join$2 = uncurryThis$a([].join);
  var push$5 = uncurryThis$a([].push);
  var replace$3 = uncurryThis$a(''.replace);
  var split$2 = uncurryThis$a(''.split);
  var toLowerCase$1 = uncurryThis$a(''.toLowerCase);

  /**
   * Creates an array containing the numeric code points of each Unicode
   * character in the string. While JavaScript uses UCS-2 internally,
   * this function will convert a pair of surrogate halves (each of which
   * UCS-2 exposes as separate characters) into a single code point,
   * matching UTF-16.
   */
  var ucs2decode = function (string) {
    var output = [];
    var counter = 0;
    var length = string.length;
    while (counter < length) {
      var value = charCodeAt$1(string, counter++);
      if (value >= 0xD800 && value <= 0xDBFF && counter < length) {
        // It's a high surrogate, and there is a next character.
        var extra = charCodeAt$1(string, counter++);
        if ((extra & 0xFC00) == 0xDC00) { // Low surrogate.
          push$5(output, ((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);
        } else {
          // It's an unmatched surrogate; only append this code unit, in case the
          // next code unit is the high surrogate of a surrogate pair.
          push$5(output, value);
          counter--;
        }
      } else {
        push$5(output, value);
      }
    }
    return output;
  };

  /**
   * Converts a digit/integer into a basic code point.
   */
  var digitToBasic = function (digit) {
    //  0..25 map to ASCII a..z or A..Z
    // 26..35 map to ASCII 0..9
    return digit + 22 + 75 * (digit < 26);
  };

  /**
   * Bias adaptation function as per section 3.4 of RFC 3492.
   * https://tools.ietf.org/html/rfc3492#section-3.4
   */
  var adapt = function (delta, numPoints, firstTime) {
    var k = 0;
    delta = firstTime ? floor$2(delta / damp) : delta >> 1;
    delta += floor$2(delta / numPoints);
    while (delta > baseMinusTMin * tMax >> 1) {
      delta = floor$2(delta / baseMinusTMin);
      k += base;
    }
    return floor$2(k + (baseMinusTMin + 1) * delta / (delta + skew));
  };

  /**
   * Converts a string of Unicode symbols (e.g. a domain name label) to a
   * Punycode string of ASCII-only symbols.
   */
  var encode = function (input) {
    var output = [];

    // Convert the input in UCS-2 to an array of Unicode code points.
    input = ucs2decode(input);

    // Cache the length.
    var inputLength = input.length;

    // Initialize the state.
    var n = initialN;
    var delta = 0;
    var bias = initialBias;
    var i, currentValue;

    // Handle the basic code points.
    for (i = 0; i < input.length; i++) {
      currentValue = input[i];
      if (currentValue < 0x80) {
        push$5(output, fromCharCode$1(currentValue));
      }
    }

    var basicLength = output.length; // number of basic code points.
    var handledCPCount = basicLength; // number of code points that have been handled;

    // Finish the basic string with a delimiter unless it's empty.
    if (basicLength) {
      push$5(output, delimiter);
    }

    // Main encoding loop:
    while (handledCPCount < inputLength) {
      // All non-basic code points < n have been handled already. Find the next larger one:
      var m = maxInt;
      for (i = 0; i < input.length; i++) {
        currentValue = input[i];
        if (currentValue >= n && currentValue < m) {
          m = currentValue;
        }
      }

      // Increase `delta` enough to advance the decoder's <n,i> state to <m,0>, but guard against overflow.
      var handledCPCountPlusOne = handledCPCount + 1;
      if (m - n > floor$2((maxInt - delta) / handledCPCountPlusOne)) {
        throw $RangeError(OVERFLOW_ERROR);
      }

      delta += (m - n) * handledCPCountPlusOne;
      n = m;

      for (i = 0; i < input.length; i++) {
        currentValue = input[i];
        if (currentValue < n && ++delta > maxInt) {
          throw $RangeError(OVERFLOW_ERROR);
        }
        if (currentValue == n) {
          // Represent delta as a generalized variable-length integer.
          var q = delta;
          var k = base;
          while (true) {
            var t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);
            if (q < t) break;
            var qMinusT = q - t;
            var baseMinusT = base - t;
            push$5(output, fromCharCode$1(digitToBasic(t + qMinusT % baseMinusT)));
            q = floor$2(qMinusT / baseMinusT);
            k += base;
          }

          push$5(output, fromCharCode$1(digitToBasic(q)));
          bias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);
          delta = 0;
          handledCPCount++;
        }
      }

      delta++;
      n++;
    }
    return join$2(output, '');
  };

  var stringPunycodeToAscii = function (input) {
    var encoded = [];
    var labels = split$2(replace$3(toLowerCase$1(input), regexSeparators, '\u002E'), '.');
    var i, label;
    for (i = 0; i < labels.length; i++) {
      label = labels[i];
      push$5(encoded, exec$3(regexNonASCII, label) ? 'xn--' + encode(label) : label);
    }
    return join$2(encoded, '.');
  };

  // TODO: in core-js@4, move /modules/ dependencies to public entries for better optimization by tools like `preset-env`

  var $$p = _export;
  var global$b = global$Q;
  var call$4 = functionCall;
  var uncurryThis$9 = functionUncurryThis;
  var DESCRIPTORS$8 = descriptors;
  var USE_NATIVE_URL$1 = urlConstructorDetection;
  var defineBuiltIn$2 = defineBuiltIn$h;
  var defineBuiltInAccessor$4 = defineBuiltInAccessor$g;
  var defineBuiltIns = defineBuiltIns$4;
  var setToStringTag$2 = setToStringTag$9;
  var createIteratorConstructor = iteratorCreateConstructor;
  var InternalStateModule$2 = internalState;
  var anInstance$3 = anInstance$a;
  var isCallable$1 = isCallable$x;
  var hasOwn$5 = hasOwnProperty_1;
  var bind$1 = functionBindContext;
  var classof = classof$j;
  var anObject$5 = anObject$s;
  var isObject$1 = isObject$l;
  var $toString$1 = toString$n;
  var create$2 = objectCreate;
  var createPropertyDescriptor$2 = createPropertyDescriptor$a;
  var getIterator = getIterator$4;
  var getIteratorMethod = getIteratorMethod$5;
  var validateArgumentsLength$3 = validateArgumentsLength$5;
  var wellKnownSymbol$1 = wellKnownSymbol$x;
  var arraySort = arraySort$1;

  var ITERATOR$1 = wellKnownSymbol$1('iterator');
  var URL_SEARCH_PARAMS = 'URLSearchParams';
  var URL_SEARCH_PARAMS_ITERATOR = URL_SEARCH_PARAMS + 'Iterator';
  var setInternalState$2 = InternalStateModule$2.set;
  var getInternalParamsState = InternalStateModule$2.getterFor(URL_SEARCH_PARAMS);
  var getInternalIteratorState = InternalStateModule$2.getterFor(URL_SEARCH_PARAMS_ITERATOR);
  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;

  // Avoid NodeJS experimental warning
  var safeGetBuiltIn = function (name) {
    if (!DESCRIPTORS$8) return global$b[name];
    var descriptor = getOwnPropertyDescriptor$1(global$b, name);
    return descriptor && descriptor.value;
  };

  var nativeFetch = safeGetBuiltIn('fetch');
  var NativeRequest = safeGetBuiltIn('Request');
  var Headers$1 = safeGetBuiltIn('Headers');
  var RequestPrototype = NativeRequest && NativeRequest.prototype;
  var HeadersPrototype = Headers$1 && Headers$1.prototype;
  var RegExp$1 = global$b.RegExp;
  var TypeError$3 = global$b.TypeError;
  var decodeURIComponent$1 = global$b.decodeURIComponent;
  var encodeURIComponent$1 = global$b.encodeURIComponent;
  var charAt$3 = uncurryThis$9(''.charAt);
  var join$1 = uncurryThis$9([].join);
  var push$4 = uncurryThis$9([].push);
  var replace$2 = uncurryThis$9(''.replace);
  var shift$1 = uncurryThis$9([].shift);
  var splice = uncurryThis$9([].splice);
  var split$1 = uncurryThis$9(''.split);
  var stringSlice$3 = uncurryThis$9(''.slice);

  var plus = /\+/g;
  var sequences = Array(4);

  var percentSequence = function (bytes) {
    return sequences[bytes - 1] || (sequences[bytes - 1] = RegExp$1('((?:%[\\da-f]{2}){' + bytes + '})', 'gi'));
  };

  var percentDecode = function (sequence) {
    try {
      return decodeURIComponent$1(sequence);
    } catch (error) {
      return sequence;
    }
  };

  var deserialize = function (it) {
    var result = replace$2(it, plus, ' ');
    var bytes = 4;
    try {
      return decodeURIComponent$1(result);
    } catch (error) {
      while (bytes) {
        result = replace$2(result, percentSequence(bytes--), percentDecode);
      }
      return result;
    }
  };

  var find = /[!'()~]|%20/g;

  var replacements = {
    '!': '%21',
    "'": '%27',
    '(': '%28',
    ')': '%29',
    '~': '%7E',
    '%20': '+'
  };

  var replacer = function (match) {
    return replacements[match];
  };

  var serialize = function (it) {
    return replace$2(encodeURIComponent$1(it), find, replacer);
  };

  var URLSearchParamsIterator = createIteratorConstructor(function Iterator(params, kind) {
    setInternalState$2(this, {
      type: URL_SEARCH_PARAMS_ITERATOR,
      iterator: getIterator(getInternalParamsState(params).entries),
      kind: kind
    });
  }, 'Iterator', function next() {
    var state = getInternalIteratorState(this);
    var kind = state.kind;
    var step = state.iterator.next();
    var entry = step.value;
    if (!step.done) {
      step.value = kind === 'keys' ? entry.key : kind === 'values' ? entry.value : [entry.key, entry.value];
    } return step;
  }, true);

  var URLSearchParamsState = function (init) {
    this.entries = [];
    this.url = null;

    if (init !== undefined) {
      if (isObject$1(init)) this.parseObject(init);
      else this.parseQuery(typeof init == 'string' ? charAt$3(init, 0) === '?' ? stringSlice$3(init, 1) : init : $toString$1(init));
    }
  };

  URLSearchParamsState.prototype = {
    type: URL_SEARCH_PARAMS,
    bindURL: function (url) {
      this.url = url;
      this.update();
    },
    parseObject: function (object) {
      var iteratorMethod = getIteratorMethod(object);
      var iterator, next, step, entryIterator, entryNext, first, second;

      if (iteratorMethod) {
        iterator = getIterator(object, iteratorMethod);
        next = iterator.next;
        while (!(step = call$4(next, iterator)).done) {
          entryIterator = getIterator(anObject$5(step.value));
          entryNext = entryIterator.next;
          if (
            (first = call$4(entryNext, entryIterator)).done ||
            (second = call$4(entryNext, entryIterator)).done ||
            !call$4(entryNext, entryIterator).done
          ) throw TypeError$3('Expected sequence with length 2');
          push$4(this.entries, { key: $toString$1(first.value), value: $toString$1(second.value) });
        }
      } else for (var key in object) if (hasOwn$5(object, key)) {
        push$4(this.entries, { key: key, value: $toString$1(object[key]) });
      }
    },
    parseQuery: function (query) {
      if (query) {
        var attributes = split$1(query, '&');
        var index = 0;
        var attribute, entry;
        while (index < attributes.length) {
          attribute = attributes[index++];
          if (attribute.length) {
            entry = split$1(attribute, '=');
            push$4(this.entries, {
              key: deserialize(shift$1(entry)),
              value: deserialize(join$1(entry, '='))
            });
          }
        }
      }
    },
    serialize: function () {
      var entries = this.entries;
      var result = [];
      var index = 0;
      var entry;
      while (index < entries.length) {
        entry = entries[index++];
        push$4(result, serialize(entry.key) + '=' + serialize(entry.value));
      } return join$1(result, '&');
    },
    update: function () {
      this.entries.length = 0;
      this.parseQuery(this.url.query);
    },
    updateURL: function () {
      if (this.url) this.url.update();
    }
  };

  // `URLSearchParams` constructor
  // https://url.spec.whatwg.org/#interface-urlsearchparams
  var URLSearchParamsConstructor = function URLSearchParams(/* init */) {
    anInstance$3(this, URLSearchParamsPrototype$1);
    var init = arguments.length > 0 ? arguments[0] : undefined;
    var state = setInternalState$2(this, new URLSearchParamsState(init));
    if (!DESCRIPTORS$8) this.length = state.entries.length;
  };

  var URLSearchParamsPrototype$1 = URLSearchParamsConstructor.prototype;

  defineBuiltIns(URLSearchParamsPrototype$1, {
    // `URLSearchParams.prototype.append` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-append
    append: function append(name, value) {
      validateArgumentsLength$3(arguments.length, 2);
      var state = getInternalParamsState(this);
      push$4(state.entries, { key: $toString$1(name), value: $toString$1(value) });
      if (!DESCRIPTORS$8) this.length++;
      state.updateURL();
    },
    // `URLSearchParams.prototype.delete` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-delete
    'delete': function (name) {
      validateArgumentsLength$3(arguments.length, 1);
      var state = getInternalParamsState(this);
      var entries = state.entries;
      var key = $toString$1(name);
      var index = 0;
      while (index < entries.length) {
        if (entries[index].key === key) splice(entries, index, 1);
        else index++;
      }
      if (!DESCRIPTORS$8) this.length = entries.length;
      state.updateURL();
    },
    // `URLSearchParams.prototype.get` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-get
    get: function get(name) {
      validateArgumentsLength$3(arguments.length, 1);
      var entries = getInternalParamsState(this).entries;
      var key = $toString$1(name);
      var index = 0;
      for (; index < entries.length; index++) {
        if (entries[index].key === key) return entries[index].value;
      }
      return null;
    },
    // `URLSearchParams.prototype.getAll` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-getall
    getAll: function getAll(name) {
      validateArgumentsLength$3(arguments.length, 1);
      var entries = getInternalParamsState(this).entries;
      var key = $toString$1(name);
      var result = [];
      var index = 0;
      for (; index < entries.length; index++) {
        if (entries[index].key === key) push$4(result, entries[index].value);
      }
      return result;
    },
    // `URLSearchParams.prototype.has` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-has
    has: function has(name) {
      validateArgumentsLength$3(arguments.length, 1);
      var entries = getInternalParamsState(this).entries;
      var key = $toString$1(name);
      var index = 0;
      while (index < entries.length) {
        if (entries[index++].key === key) return true;
      }
      return false;
    },
    // `URLSearchParams.prototype.set` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-set
    set: function set(name, value) {
      validateArgumentsLength$3(arguments.length, 1);
      var state = getInternalParamsState(this);
      var entries = state.entries;
      var found = false;
      var key = $toString$1(name);
      var val = $toString$1(value);
      var index = 0;
      var entry;
      for (; index < entries.length; index++) {
        entry = entries[index];
        if (entry.key === key) {
          if (found) splice(entries, index--, 1);
          else {
            found = true;
            entry.value = val;
          }
        }
      }
      if (!found) push$4(entries, { key: key, value: val });
      if (!DESCRIPTORS$8) this.length = entries.length;
      state.updateURL();
    },
    // `URLSearchParams.prototype.sort` method
    // https://url.spec.whatwg.org/#dom-urlsearchparams-sort
    sort: function sort() {
      var state = getInternalParamsState(this);
      arraySort(state.entries, function (a, b) {
        return a.key > b.key ? 1 : -1;
      });
      state.updateURL();
    },
    // `URLSearchParams.prototype.forEach` method
    forEach: function forEach(callback /* , thisArg */) {
      var entries = getInternalParamsState(this).entries;
      var boundFunction = bind$1(callback, arguments.length > 1 ? arguments[1] : undefined);
      var index = 0;
      var entry;
      while (index < entries.length) {
        entry = entries[index++];
        boundFunction(entry.value, entry.key, this);
      }
    },
    // `URLSearchParams.prototype.keys` method
    keys: function keys() {
      return new URLSearchParamsIterator(this, 'keys');
    },
    // `URLSearchParams.prototype.values` method
    values: function values() {
      return new URLSearchParamsIterator(this, 'values');
    },
    // `URLSearchParams.prototype.entries` method
    entries: function entries() {
      return new URLSearchParamsIterator(this, 'entries');
    }
  }, { enumerable: true });

  // `URLSearchParams.prototype[@@iterator]` method
  defineBuiltIn$2(URLSearchParamsPrototype$1, ITERATOR$1, URLSearchParamsPrototype$1.entries, { name: 'entries' });

  // `URLSearchParams.prototype.toString` method
  // https://url.spec.whatwg.org/#urlsearchparams-stringification-behavior
  defineBuiltIn$2(URLSearchParamsPrototype$1, 'toString', function toString() {
    return getInternalParamsState(this).serialize();
  }, { enumerable: true });

  // `URLSearchParams.prototype.size` getter
  // https://github.com/whatwg/url/pull/734
  if (DESCRIPTORS$8) defineBuiltInAccessor$4(URLSearchParamsPrototype$1, 'size', {
    get: function size() {
      return getInternalParamsState(this).entries.length;
    },
    configurable: true,
    enumerable: true
  });

  setToStringTag$2(URLSearchParamsConstructor, URL_SEARCH_PARAMS);

  $$p({ global: true, constructor: true, forced: !USE_NATIVE_URL$1 }, {
    URLSearchParams: URLSearchParamsConstructor
  });

  // Wrap `fetch` and `Request` for correct work with polyfilled `URLSearchParams`
  if (!USE_NATIVE_URL$1 && isCallable$1(Headers$1)) {
    var headersHas = uncurryThis$9(HeadersPrototype.has);
    var headersSet = uncurryThis$9(HeadersPrototype.set);

    var wrapRequestOptions = function (init) {
      if (isObject$1(init)) {
        var body = init.body;
        var headers;
        if (classof(body) === URL_SEARCH_PARAMS) {
          headers = init.headers ? new Headers$1(init.headers) : new Headers$1();
          if (!headersHas(headers, 'content-type')) {
            headersSet(headers, 'content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
          }
          return create$2(init, {
            body: createPropertyDescriptor$2(0, $toString$1(body)),
            headers: createPropertyDescriptor$2(0, headers)
          });
        }
      } return init;
    };

    if (isCallable$1(nativeFetch)) {
      $$p({ global: true, enumerable: true, dontCallGetSet: true, forced: true }, {
        fetch: function fetch(input /* , init */) {
          return nativeFetch(input, arguments.length > 1 ? wrapRequestOptions(arguments[1]) : {});
        }
      });
    }

    if (isCallable$1(NativeRequest)) {
      var RequestConstructor = function Request(input /* , init */) {
        anInstance$3(this, RequestPrototype);
        return new NativeRequest(input, arguments.length > 1 ? wrapRequestOptions(arguments[1]) : {});
      };

      RequestPrototype.constructor = RequestConstructor;
      RequestConstructor.prototype = RequestPrototype;

      $$p({ global: true, constructor: true, dontCallGetSet: true, forced: true }, {
        Request: RequestConstructor
      });
    }
  }

  var web_urlSearchParams_constructor = {
    URLSearchParams: URLSearchParamsConstructor,
    getState: getInternalParamsState
  };

  // TODO: in core-js@4, move /modules/ dependencies to public entries for better optimization by tools like `preset-env`

  var $$o = _export;
  var DESCRIPTORS$7 = descriptors;
  var USE_NATIVE_URL = urlConstructorDetection;
  var global$a = global$Q;
  var bind = functionBindContext;
  var uncurryThis$8 = functionUncurryThis;
  var defineBuiltIn$1 = defineBuiltIn$h;
  var defineBuiltInAccessor$3 = defineBuiltInAccessor$g;
  var anInstance$2 = anInstance$a;
  var hasOwn$4 = hasOwnProperty_1;
  var assign = objectAssign;
  var arrayFrom = arrayFrom$1;
  var arraySlice$2 = arraySliceSimple;
  var codeAt = stringMultibyte.codeAt;
  var toASCII = stringPunycodeToAscii;
  var $toString = toString$n;
  var setToStringTag$1 = setToStringTag$9;
  var validateArgumentsLength$2 = validateArgumentsLength$5;
  var URLSearchParamsModule = web_urlSearchParams_constructor;
  var InternalStateModule$1 = internalState;

  var setInternalState$1 = InternalStateModule$1.set;
  var getInternalURLState = InternalStateModule$1.getterFor('URL');
  var URLSearchParams$1 = URLSearchParamsModule.URLSearchParams;
  var getInternalSearchParamsState = URLSearchParamsModule.getState;

  var NativeURL = global$a.URL;
  var TypeError$2 = global$a.TypeError;
  var parseInt$1 = global$a.parseInt;
  var floor$1 = Math.floor;
  var pow$1 = Math.pow;
  var charAt$2 = uncurryThis$8(''.charAt);
  var exec$2 = uncurryThis$8(/./.exec);
  var join = uncurryThis$8([].join);
  var numberToString = uncurryThis$8(1.0.toString);
  var pop = uncurryThis$8([].pop);
  var push$3 = uncurryThis$8([].push);
  var replace$1 = uncurryThis$8(''.replace);
  var shift = uncurryThis$8([].shift);
  var split = uncurryThis$8(''.split);
  var stringSlice$2 = uncurryThis$8(''.slice);
  var toLowerCase = uncurryThis$8(''.toLowerCase);
  var unshift = uncurryThis$8([].unshift);

  var INVALID_AUTHORITY = 'Invalid authority';
  var INVALID_SCHEME = 'Invalid scheme';
  var INVALID_HOST = 'Invalid host';
  var INVALID_PORT = 'Invalid port';

  var ALPHA = /[a-z]/i;
  // eslint-disable-next-line regexp/no-obscure-range -- safe
  var ALPHANUMERIC = /[\d+-.a-z]/i;
  var DIGIT = /\d/;
  var HEX_START = /^0x/i;
  var OCT = /^[0-7]+$/;
  var DEC = /^\d+$/;
  var HEX = /^[\da-f]+$/i;
  /* eslint-disable regexp/no-control-character -- safe */
  var FORBIDDEN_HOST_CODE_POINT = /[\0\t\n\r #%/:<>?@[\\\]^|]/;
  var FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT = /[\0\t\n\r #/:<>?@[\\\]^|]/;
  var LEADING_C0_CONTROL_OR_SPACE = /^[\u0000-\u0020]+/;
  var TRAILING_C0_CONTROL_OR_SPACE = /(^|[^\u0000-\u0020])[\u0000-\u0020]+$/;
  var TAB_AND_NEW_LINE = /[\t\n\r]/g;
  /* eslint-enable regexp/no-control-character -- safe */
  var EOF;

  // https://url.spec.whatwg.org/#ipv4-number-parser
  var parseIPv4 = function (input) {
    var parts = split(input, '.');
    var partsLength, numbers, index, part, radix, number, ipv4;
    if (parts.length && parts[parts.length - 1] == '') {
      parts.length--;
    }
    partsLength = parts.length;
    if (partsLength > 4) return input;
    numbers = [];
    for (index = 0; index < partsLength; index++) {
      part = parts[index];
      if (part == '') return input;
      radix = 10;
      if (part.length > 1 && charAt$2(part, 0) == '0') {
        radix = exec$2(HEX_START, part) ? 16 : 8;
        part = stringSlice$2(part, radix == 8 ? 1 : 2);
      }
      if (part === '') {
        number = 0;
      } else {
        if (!exec$2(radix == 10 ? DEC : radix == 8 ? OCT : HEX, part)) return input;
        number = parseInt$1(part, radix);
      }
      push$3(numbers, number);
    }
    for (index = 0; index < partsLength; index++) {
      number = numbers[index];
      if (index == partsLength - 1) {
        if (number >= pow$1(256, 5 - partsLength)) return null;
      } else if (number > 255) return null;
    }
    ipv4 = pop(numbers);
    for (index = 0; index < numbers.length; index++) {
      ipv4 += numbers[index] * pow$1(256, 3 - index);
    }
    return ipv4;
  };

  // https://url.spec.whatwg.org/#concept-ipv6-parser
  // eslint-disable-next-line max-statements -- TODO
  var parseIPv6 = function (input) {
    var address = [0, 0, 0, 0, 0, 0, 0, 0];
    var pieceIndex = 0;
    var compress = null;
    var pointer = 0;
    var value, length, numbersSeen, ipv4Piece, number, swaps, swap;

    var chr = function () {
      return charAt$2(input, pointer);
    };

    if (chr() == ':') {
      if (charAt$2(input, 1) != ':') return;
      pointer += 2;
      pieceIndex++;
      compress = pieceIndex;
    }
    while (chr()) {
      if (pieceIndex == 8) return;
      if (chr() == ':') {
        if (compress !== null) return;
        pointer++;
        pieceIndex++;
        compress = pieceIndex;
        continue;
      }
      value = length = 0;
      while (length < 4 && exec$2(HEX, chr())) {
        value = value * 16 + parseInt$1(chr(), 16);
        pointer++;
        length++;
      }
      if (chr() == '.') {
        if (length == 0) return;
        pointer -= length;
        if (pieceIndex > 6) return;
        numbersSeen = 0;
        while (chr()) {
          ipv4Piece = null;
          if (numbersSeen > 0) {
            if (chr() == '.' && numbersSeen < 4) pointer++;
            else return;
          }
          if (!exec$2(DIGIT, chr())) return;
          while (exec$2(DIGIT, chr())) {
            number = parseInt$1(chr(), 10);
            if (ipv4Piece === null) ipv4Piece = number;
            else if (ipv4Piece == 0) return;
            else ipv4Piece = ipv4Piece * 10 + number;
            if (ipv4Piece > 255) return;
            pointer++;
          }
          address[pieceIndex] = address[pieceIndex] * 256 + ipv4Piece;
          numbersSeen++;
          if (numbersSeen == 2 || numbersSeen == 4) pieceIndex++;
        }
        if (numbersSeen != 4) return;
        break;
      } else if (chr() == ':') {
        pointer++;
        if (!chr()) return;
      } else if (chr()) return;
      address[pieceIndex++] = value;
    }
    if (compress !== null) {
      swaps = pieceIndex - compress;
      pieceIndex = 7;
      while (pieceIndex != 0 && swaps > 0) {
        swap = address[pieceIndex];
        address[pieceIndex--] = address[compress + swaps - 1];
        address[compress + --swaps] = swap;
      }
    } else if (pieceIndex != 8) return;
    return address;
  };

  var findLongestZeroSequence = function (ipv6) {
    var maxIndex = null;
    var maxLength = 1;
    var currStart = null;
    var currLength = 0;
    var index = 0;
    for (; index < 8; index++) {
      if (ipv6[index] !== 0) {
        if (currLength > maxLength) {
          maxIndex = currStart;
          maxLength = currLength;
        }
        currStart = null;
        currLength = 0;
      } else {
        if (currStart === null) currStart = index;
        ++currLength;
      }
    }
    if (currLength > maxLength) {
      maxIndex = currStart;
      maxLength = currLength;
    }
    return maxIndex;
  };

  // https://url.spec.whatwg.org/#host-serializing
  var serializeHost = function (host) {
    var result, index, compress, ignore0;
    // ipv4
    if (typeof host == 'number') {
      result = [];
      for (index = 0; index < 4; index++) {
        unshift(result, host % 256);
        host = floor$1(host / 256);
      } return join(result, '.');
    // ipv6
    } else if (typeof host == 'object') {
      result = '';
      compress = findLongestZeroSequence(host);
      for (index = 0; index < 8; index++) {
        if (ignore0 && host[index] === 0) continue;
        if (ignore0) ignore0 = false;
        if (compress === index) {
          result += index ? ':' : '::';
          ignore0 = true;
        } else {
          result += numberToString(host[index], 16);
          if (index < 7) result += ':';
        }
      }
      return '[' + result + ']';
    } return host;
  };

  var C0ControlPercentEncodeSet = {};
  var fragmentPercentEncodeSet = assign({}, C0ControlPercentEncodeSet, {
    ' ': 1, '"': 1, '<': 1, '>': 1, '`': 1
  });
  var pathPercentEncodeSet = assign({}, fragmentPercentEncodeSet, {
    '#': 1, '?': 1, '{': 1, '}': 1
  });
  var userinfoPercentEncodeSet = assign({}, pathPercentEncodeSet, {
    '/': 1, ':': 1, ';': 1, '=': 1, '@': 1, '[': 1, '\\': 1, ']': 1, '^': 1, '|': 1
  });

  var percentEncode = function (chr, set) {
    var code = codeAt(chr, 0);
    return code > 0x20 && code < 0x7F && !hasOwn$4(set, chr) ? chr : encodeURIComponent(chr);
  };

  // https://url.spec.whatwg.org/#special-scheme
  var specialSchemes = {
    ftp: 21,
    file: null,
    http: 80,
    https: 443,
    ws: 80,
    wss: 443
  };

  // https://url.spec.whatwg.org/#windows-drive-letter
  var isWindowsDriveLetter = function (string, normalized) {
    var second;
    return string.length == 2 && exec$2(ALPHA, charAt$2(string, 0))
      && ((second = charAt$2(string, 1)) == ':' || (!normalized && second == '|'));
  };

  // https://url.spec.whatwg.org/#start-with-a-windows-drive-letter
  var startsWithWindowsDriveLetter = function (string) {
    var third;
    return string.length > 1 && isWindowsDriveLetter(stringSlice$2(string, 0, 2)) && (
      string.length == 2 ||
      ((third = charAt$2(string, 2)) === '/' || third === '\\' || third === '?' || third === '#')
    );
  };

  // https://url.spec.whatwg.org/#single-dot-path-segment
  var isSingleDot = function (segment) {
    return segment === '.' || toLowerCase(segment) === '%2e';
  };

  // https://url.spec.whatwg.org/#double-dot-path-segment
  var isDoubleDot = function (segment) {
    segment = toLowerCase(segment);
    return segment === '..' || segment === '%2e.' || segment === '.%2e' || segment === '%2e%2e';
  };

  // States:
  var SCHEME_START = {};
  var SCHEME = {};
  var NO_SCHEME = {};
  var SPECIAL_RELATIVE_OR_AUTHORITY = {};
  var PATH_OR_AUTHORITY = {};
  var RELATIVE = {};
  var RELATIVE_SLASH = {};
  var SPECIAL_AUTHORITY_SLASHES = {};
  var SPECIAL_AUTHORITY_IGNORE_SLASHES = {};
  var AUTHORITY = {};
  var HOST = {};
  var HOSTNAME = {};
  var PORT = {};
  var FILE = {};
  var FILE_SLASH = {};
  var FILE_HOST = {};
  var PATH_START = {};
  var PATH = {};
  var CANNOT_BE_A_BASE_URL_PATH = {};
  var QUERY = {};
  var FRAGMENT = {};

  var URLState = function (url, isBase, base) {
    var urlString = $toString(url);
    var baseState, failure, searchParams;
    if (isBase) {
      failure = this.parse(urlString);
      if (failure) throw TypeError$2(failure);
      this.searchParams = null;
    } else {
      if (base !== undefined) baseState = new URLState(base, true);
      failure = this.parse(urlString, null, baseState);
      if (failure) throw TypeError$2(failure);
      searchParams = getInternalSearchParamsState(new URLSearchParams$1());
      searchParams.bindURL(this);
      this.searchParams = searchParams;
    }
  };

  URLState.prototype = {
    type: 'URL',
    // https://url.spec.whatwg.org/#url-parsing
    // eslint-disable-next-line max-statements -- TODO
    parse: function (input, stateOverride, base) {
      var url = this;
      var state = stateOverride || SCHEME_START;
      var pointer = 0;
      var buffer = '';
      var seenAt = false;
      var seenBracket = false;
      var seenPasswordToken = false;
      var codePoints, chr, bufferCodePoints, failure;

      input = $toString(input);

      if (!stateOverride) {
        url.scheme = '';
        url.username = '';
        url.password = '';
        url.host = null;
        url.port = null;
        url.path = [];
        url.query = null;
        url.fragment = null;
        url.cannotBeABaseURL = false;
        input = replace$1(input, LEADING_C0_CONTROL_OR_SPACE, '');
        input = replace$1(input, TRAILING_C0_CONTROL_OR_SPACE, '$1');
      }

      input = replace$1(input, TAB_AND_NEW_LINE, '');

      codePoints = arrayFrom(input);

      while (pointer <= codePoints.length) {
        chr = codePoints[pointer];
        switch (state) {
          case SCHEME_START:
            if (chr && exec$2(ALPHA, chr)) {
              buffer += toLowerCase(chr);
              state = SCHEME;
            } else if (!stateOverride) {
              state = NO_SCHEME;
              continue;
            } else return INVALID_SCHEME;
            break;

          case SCHEME:
            if (chr && (exec$2(ALPHANUMERIC, chr) || chr == '+' || chr == '-' || chr == '.')) {
              buffer += toLowerCase(chr);
            } else if (chr == ':') {
              if (stateOverride && (
                (url.isSpecial() != hasOwn$4(specialSchemes, buffer)) ||
                (buffer == 'file' && (url.includesCredentials() || url.port !== null)) ||
                (url.scheme == 'file' && !url.host)
              )) return;
              url.scheme = buffer;
              if (stateOverride) {
                if (url.isSpecial() && specialSchemes[url.scheme] == url.port) url.port = null;
                return;
              }
              buffer = '';
              if (url.scheme == 'file') {
                state = FILE;
              } else if (url.isSpecial() && base && base.scheme == url.scheme) {
                state = SPECIAL_RELATIVE_OR_AUTHORITY;
              } else if (url.isSpecial()) {
                state = SPECIAL_AUTHORITY_SLASHES;
              } else if (codePoints[pointer + 1] == '/') {
                state = PATH_OR_AUTHORITY;
                pointer++;
              } else {
                url.cannotBeABaseURL = true;
                push$3(url.path, '');
                state = CANNOT_BE_A_BASE_URL_PATH;
              }
            } else if (!stateOverride) {
              buffer = '';
              state = NO_SCHEME;
              pointer = 0;
              continue;
            } else return INVALID_SCHEME;
            break;

          case NO_SCHEME:
            if (!base || (base.cannotBeABaseURL && chr != '#')) return INVALID_SCHEME;
            if (base.cannotBeABaseURL && chr == '#') {
              url.scheme = base.scheme;
              url.path = arraySlice$2(base.path);
              url.query = base.query;
              url.fragment = '';
              url.cannotBeABaseURL = true;
              state = FRAGMENT;
              break;
            }
            state = base.scheme == 'file' ? FILE : RELATIVE;
            continue;

          case SPECIAL_RELATIVE_OR_AUTHORITY:
            if (chr == '/' && codePoints[pointer + 1] == '/') {
              state = SPECIAL_AUTHORITY_IGNORE_SLASHES;
              pointer++;
            } else {
              state = RELATIVE;
              continue;
            } break;

          case PATH_OR_AUTHORITY:
            if (chr == '/') {
              state = AUTHORITY;
              break;
            } else {
              state = PATH;
              continue;
            }

          case RELATIVE:
            url.scheme = base.scheme;
            if (chr == EOF) {
              url.username = base.username;
              url.password = base.password;
              url.host = base.host;
              url.port = base.port;
              url.path = arraySlice$2(base.path);
              url.query = base.query;
            } else if (chr == '/' || (chr == '\\' && url.isSpecial())) {
              state = RELATIVE_SLASH;
            } else if (chr == '?') {
              url.username = base.username;
              url.password = base.password;
              url.host = base.host;
              url.port = base.port;
              url.path = arraySlice$2(base.path);
              url.query = '';
              state = QUERY;
            } else if (chr == '#') {
              url.username = base.username;
              url.password = base.password;
              url.host = base.host;
              url.port = base.port;
              url.path = arraySlice$2(base.path);
              url.query = base.query;
              url.fragment = '';
              state = FRAGMENT;
            } else {
              url.username = base.username;
              url.password = base.password;
              url.host = base.host;
              url.port = base.port;
              url.path = arraySlice$2(base.path);
              url.path.length--;
              state = PATH;
              continue;
            } break;

          case RELATIVE_SLASH:
            if (url.isSpecial() && (chr == '/' || chr == '\\')) {
              state = SPECIAL_AUTHORITY_IGNORE_SLASHES;
            } else if (chr == '/') {
              state = AUTHORITY;
            } else {
              url.username = base.username;
              url.password = base.password;
              url.host = base.host;
              url.port = base.port;
              state = PATH;
              continue;
            } break;

          case SPECIAL_AUTHORITY_SLASHES:
            state = SPECIAL_AUTHORITY_IGNORE_SLASHES;
            if (chr != '/' || charAt$2(buffer, pointer + 1) != '/') continue;
            pointer++;
            break;

          case SPECIAL_AUTHORITY_IGNORE_SLASHES:
            if (chr != '/' && chr != '\\') {
              state = AUTHORITY;
              continue;
            } break;

          case AUTHORITY:
            if (chr == '@') {
              if (seenAt) buffer = '%40' + buffer;
              seenAt = true;
              bufferCodePoints = arrayFrom(buffer);
              for (var i = 0; i < bufferCodePoints.length; i++) {
                var codePoint = bufferCodePoints[i];
                if (codePoint == ':' && !seenPasswordToken) {
                  seenPasswordToken = true;
                  continue;
                }
                var encodedCodePoints = percentEncode(codePoint, userinfoPercentEncodeSet);
                if (seenPasswordToken) url.password += encodedCodePoints;
                else url.username += encodedCodePoints;
              }
              buffer = '';
            } else if (
              chr == EOF || chr == '/' || chr == '?' || chr == '#' ||
              (chr == '\\' && url.isSpecial())
            ) {
              if (seenAt && buffer == '') return INVALID_AUTHORITY;
              pointer -= arrayFrom(buffer).length + 1;
              buffer = '';
              state = HOST;
            } else buffer += chr;
            break;

          case HOST:
          case HOSTNAME:
            if (stateOverride && url.scheme == 'file') {
              state = FILE_HOST;
              continue;
            } else if (chr == ':' && !seenBracket) {
              if (buffer == '') return INVALID_HOST;
              failure = url.parseHost(buffer);
              if (failure) return failure;
              buffer = '';
              state = PORT;
              if (stateOverride == HOSTNAME) return;
            } else if (
              chr == EOF || chr == '/' || chr == '?' || chr == '#' ||
              (chr == '\\' && url.isSpecial())
            ) {
              if (url.isSpecial() && buffer == '') return INVALID_HOST;
              if (stateOverride && buffer == '' && (url.includesCredentials() || url.port !== null)) return;
              failure = url.parseHost(buffer);
              if (failure) return failure;
              buffer = '';
              state = PATH_START;
              if (stateOverride) return;
              continue;
            } else {
              if (chr == '[') seenBracket = true;
              else if (chr == ']') seenBracket = false;
              buffer += chr;
            } break;

          case PORT:
            if (exec$2(DIGIT, chr)) {
              buffer += chr;
            } else if (
              chr == EOF || chr == '/' || chr == '?' || chr == '#' ||
              (chr == '\\' && url.isSpecial()) ||
              stateOverride
            ) {
              if (buffer != '') {
                var port = parseInt$1(buffer, 10);
                if (port > 0xFFFF) return INVALID_PORT;
                url.port = (url.isSpecial() && port === specialSchemes[url.scheme]) ? null : port;
                buffer = '';
              }
              if (stateOverride) return;
              state = PATH_START;
              continue;
            } else return INVALID_PORT;
            break;

          case FILE:
            url.scheme = 'file';
            if (chr == '/' || chr == '\\') state = FILE_SLASH;
            else if (base && base.scheme == 'file') {
              if (chr == EOF) {
                url.host = base.host;
                url.path = arraySlice$2(base.path);
                url.query = base.query;
              } else if (chr == '?') {
                url.host = base.host;
                url.path = arraySlice$2(base.path);
                url.query = '';
                state = QUERY;
              } else if (chr == '#') {
                url.host = base.host;
                url.path = arraySlice$2(base.path);
                url.query = base.query;
                url.fragment = '';
                state = FRAGMENT;
              } else {
                if (!startsWithWindowsDriveLetter(join(arraySlice$2(codePoints, pointer), ''))) {
                  url.host = base.host;
                  url.path = arraySlice$2(base.path);
                  url.shortenPath();
                }
                state = PATH;
                continue;
              }
            } else {
              state = PATH;
              continue;
            } break;

          case FILE_SLASH:
            if (chr == '/' || chr == '\\') {
              state = FILE_HOST;
              break;
            }
            if (base && base.scheme == 'file' && !startsWithWindowsDriveLetter(join(arraySlice$2(codePoints, pointer), ''))) {
              if (isWindowsDriveLetter(base.path[0], true)) push$3(url.path, base.path[0]);
              else url.host = base.host;
            }
            state = PATH;
            continue;

          case FILE_HOST:
            if (chr == EOF || chr == '/' || chr == '\\' || chr == '?' || chr == '#') {
              if (!stateOverride && isWindowsDriveLetter(buffer)) {
                state = PATH;
              } else if (buffer == '') {
                url.host = '';
                if (stateOverride) return;
                state = PATH_START;
              } else {
                failure = url.parseHost(buffer);
                if (failure) return failure;
                if (url.host == 'localhost') url.host = '';
                if (stateOverride) return;
                buffer = '';
                state = PATH_START;
              } continue;
            } else buffer += chr;
            break;

          case PATH_START:
            if (url.isSpecial()) {
              state = PATH;
              if (chr != '/' && chr != '\\') continue;
            } else if (!stateOverride && chr == '?') {
              url.query = '';
              state = QUERY;
            } else if (!stateOverride && chr == '#') {
              url.fragment = '';
              state = FRAGMENT;
            } else if (chr != EOF) {
              state = PATH;
              if (chr != '/') continue;
            } break;

          case PATH:
            if (
              chr == EOF || chr == '/' ||
              (chr == '\\' && url.isSpecial()) ||
              (!stateOverride && (chr == '?' || chr == '#'))
            ) {
              if (isDoubleDot(buffer)) {
                url.shortenPath();
                if (chr != '/' && !(chr == '\\' && url.isSpecial())) {
                  push$3(url.path, '');
                }
              } else if (isSingleDot(buffer)) {
                if (chr != '/' && !(chr == '\\' && url.isSpecial())) {
                  push$3(url.path, '');
                }
              } else {
                if (url.scheme == 'file' && !url.path.length && isWindowsDriveLetter(buffer)) {
                  if (url.host) url.host = '';
                  buffer = charAt$2(buffer, 0) + ':'; // normalize windows drive letter
                }
                push$3(url.path, buffer);
              }
              buffer = '';
              if (url.scheme == 'file' && (chr == EOF || chr == '?' || chr == '#')) {
                while (url.path.length > 1 && url.path[0] === '') {
                  shift(url.path);
                }
              }
              if (chr == '?') {
                url.query = '';
                state = QUERY;
              } else if (chr == '#') {
                url.fragment = '';
                state = FRAGMENT;
              }
            } else {
              buffer += percentEncode(chr, pathPercentEncodeSet);
            } break;

          case CANNOT_BE_A_BASE_URL_PATH:
            if (chr == '?') {
              url.query = '';
              state = QUERY;
            } else if (chr == '#') {
              url.fragment = '';
              state = FRAGMENT;
            } else if (chr != EOF) {
              url.path[0] += percentEncode(chr, C0ControlPercentEncodeSet);
            } break;

          case QUERY:
            if (!stateOverride && chr == '#') {
              url.fragment = '';
              state = FRAGMENT;
            } else if (chr != EOF) {
              if (chr == "'" && url.isSpecial()) url.query += '%27';
              else if (chr == '#') url.query += '%23';
              else url.query += percentEncode(chr, C0ControlPercentEncodeSet);
            } break;

          case FRAGMENT:
            if (chr != EOF) url.fragment += percentEncode(chr, fragmentPercentEncodeSet);
            break;
        }

        pointer++;
      }
    },
    // https://url.spec.whatwg.org/#host-parsing
    parseHost: function (input) {
      var result, codePoints, index;
      if (charAt$2(input, 0) == '[') {
        if (charAt$2(input, input.length - 1) != ']') return INVALID_HOST;
        result = parseIPv6(stringSlice$2(input, 1, -1));
        if (!result) return INVALID_HOST;
        this.host = result;
      // opaque host
      } else if (!this.isSpecial()) {
        if (exec$2(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT, input)) return INVALID_HOST;
        result = '';
        codePoints = arrayFrom(input);
        for (index = 0; index < codePoints.length; index++) {
          result += percentEncode(codePoints[index], C0ControlPercentEncodeSet);
        }
        this.host = result;
      } else {
        input = toASCII(input);
        if (exec$2(FORBIDDEN_HOST_CODE_POINT, input)) return INVALID_HOST;
        result = parseIPv4(input);
        if (result === null) return INVALID_HOST;
        this.host = result;
      }
    },
    // https://url.spec.whatwg.org/#cannot-have-a-username-password-port
    cannotHaveUsernamePasswordPort: function () {
      return !this.host || this.cannotBeABaseURL || this.scheme == 'file';
    },
    // https://url.spec.whatwg.org/#include-credentials
    includesCredentials: function () {
      return this.username != '' || this.password != '';
    },
    // https://url.spec.whatwg.org/#is-special
    isSpecial: function () {
      return hasOwn$4(specialSchemes, this.scheme);
    },
    // https://url.spec.whatwg.org/#shorten-a-urls-path
    shortenPath: function () {
      var path = this.path;
      var pathSize = path.length;
      if (pathSize && (this.scheme != 'file' || pathSize != 1 || !isWindowsDriveLetter(path[0], true))) {
        path.length--;
      }
    },
    // https://url.spec.whatwg.org/#concept-url-serializer
    serialize: function () {
      var url = this;
      var scheme = url.scheme;
      var username = url.username;
      var password = url.password;
      var host = url.host;
      var port = url.port;
      var path = url.path;
      var query = url.query;
      var fragment = url.fragment;
      var output = scheme + ':';
      if (host !== null) {
        output += '//';
        if (url.includesCredentials()) {
          output += username + (password ? ':' + password : '') + '@';
        }
        output += serializeHost(host);
        if (port !== null) output += ':' + port;
      } else if (scheme == 'file') output += '//';
      output += url.cannotBeABaseURL ? path[0] : path.length ? '/' + join(path, '/') : '';
      if (query !== null) output += '?' + query;
      if (fragment !== null) output += '#' + fragment;
      return output;
    },
    // https://url.spec.whatwg.org/#dom-url-href
    setHref: function (href) {
      var failure = this.parse(href);
      if (failure) throw TypeError$2(failure);
      this.searchParams.update();
    },
    // https://url.spec.whatwg.org/#dom-url-origin
    getOrigin: function () {
      var scheme = this.scheme;
      var port = this.port;
      if (scheme == 'blob') try {
        return new URLConstructor(scheme.path[0]).origin;
      } catch (error) {
        return 'null';
      }
      if (scheme == 'file' || !this.isSpecial()) return 'null';
      return scheme + '://' + serializeHost(this.host) + (port !== null ? ':' + port : '');
    },
    // https://url.spec.whatwg.org/#dom-url-protocol
    getProtocol: function () {
      return this.scheme + ':';
    },
    setProtocol: function (protocol) {
      this.parse($toString(protocol) + ':', SCHEME_START);
    },
    // https://url.spec.whatwg.org/#dom-url-username
    getUsername: function () {
      return this.username;
    },
    setUsername: function (username) {
      var codePoints = arrayFrom($toString(username));
      if (this.cannotHaveUsernamePasswordPort()) return;
      this.username = '';
      for (var i = 0; i < codePoints.length; i++) {
        this.username += percentEncode(codePoints[i], userinfoPercentEncodeSet);
      }
    },
    // https://url.spec.whatwg.org/#dom-url-password
    getPassword: function () {
      return this.password;
    },
    setPassword: function (password) {
      var codePoints = arrayFrom($toString(password));
      if (this.cannotHaveUsernamePasswordPort()) return;
      this.password = '';
      for (var i = 0; i < codePoints.length; i++) {
        this.password += percentEncode(codePoints[i], userinfoPercentEncodeSet);
      }
    },
    // https://url.spec.whatwg.org/#dom-url-host
    getHost: function () {
      var host = this.host;
      var port = this.port;
      return host === null ? ''
        : port === null ? serializeHost(host)
        : serializeHost(host) + ':' + port;
    },
    setHost: function (host) {
      if (this.cannotBeABaseURL) return;
      this.parse(host, HOST);
    },
    // https://url.spec.whatwg.org/#dom-url-hostname
    getHostname: function () {
      var host = this.host;
      return host === null ? '' : serializeHost(host);
    },
    setHostname: function (hostname) {
      if (this.cannotBeABaseURL) return;
      this.parse(hostname, HOSTNAME);
    },
    // https://url.spec.whatwg.org/#dom-url-port
    getPort: function () {
      var port = this.port;
      return port === null ? '' : $toString(port);
    },
    setPort: function (port) {
      if (this.cannotHaveUsernamePasswordPort()) return;
      port = $toString(port);
      if (port == '') this.port = null;
      else this.parse(port, PORT);
    },
    // https://url.spec.whatwg.org/#dom-url-pathname
    getPathname: function () {
      var path = this.path;
      return this.cannotBeABaseURL ? path[0] : path.length ? '/' + join(path, '/') : '';
    },
    setPathname: function (pathname) {
      if (this.cannotBeABaseURL) return;
      this.path = [];
      this.parse(pathname, PATH_START);
    },
    // https://url.spec.whatwg.org/#dom-url-search
    getSearch: function () {
      var query = this.query;
      return query ? '?' + query : '';
    },
    setSearch: function (search) {
      search = $toString(search);
      if (search == '') {
        this.query = null;
      } else {
        if ('?' == charAt$2(search, 0)) search = stringSlice$2(search, 1);
        this.query = '';
        this.parse(search, QUERY);
      }
      this.searchParams.update();
    },
    // https://url.spec.whatwg.org/#dom-url-searchparams
    getSearchParams: function () {
      return this.searchParams.facade;
    },
    // https://url.spec.whatwg.org/#dom-url-hash
    getHash: function () {
      var fragment = this.fragment;
      return fragment ? '#' + fragment : '';
    },
    setHash: function (hash) {
      hash = $toString(hash);
      if (hash == '') {
        this.fragment = null;
        return;
      }
      if ('#' == charAt$2(hash, 0)) hash = stringSlice$2(hash, 1);
      this.fragment = '';
      this.parse(hash, FRAGMENT);
    },
    update: function () {
      this.query = this.searchParams.serialize() || null;
    }
  };

  // `URL` constructor
  // https://url.spec.whatwg.org/#url-class
  var URLConstructor = function URL(url /* , base */) {
    var that = anInstance$2(this, URLPrototype);
    var base = validateArgumentsLength$2(arguments.length, 1) > 1 ? arguments[1] : undefined;
    var state = setInternalState$1(that, new URLState(url, false, base));
    if (!DESCRIPTORS$7) {
      that.href = state.serialize();
      that.origin = state.getOrigin();
      that.protocol = state.getProtocol();
      that.username = state.getUsername();
      that.password = state.getPassword();
      that.host = state.getHost();
      that.hostname = state.getHostname();
      that.port = state.getPort();
      that.pathname = state.getPathname();
      that.search = state.getSearch();
      that.searchParams = state.getSearchParams();
      that.hash = state.getHash();
    }
  };

  var URLPrototype = URLConstructor.prototype;

  var accessorDescriptor = function (getter, setter) {
    return {
      get: function () {
        return getInternalURLState(this)[getter]();
      },
      set: setter && function (value) {
        return getInternalURLState(this)[setter](value);
      },
      configurable: true,
      enumerable: true
    };
  };

  if (DESCRIPTORS$7) {
    // `URL.prototype.href` accessors pair
    // https://url.spec.whatwg.org/#dom-url-href
    defineBuiltInAccessor$3(URLPrototype, 'href', accessorDescriptor('serialize', 'setHref'));
    // `URL.prototype.origin` getter
    // https://url.spec.whatwg.org/#dom-url-origin
    defineBuiltInAccessor$3(URLPrototype, 'origin', accessorDescriptor('getOrigin'));
    // `URL.prototype.protocol` accessors pair
    // https://url.spec.whatwg.org/#dom-url-protocol
    defineBuiltInAccessor$3(URLPrototype, 'protocol', accessorDescriptor('getProtocol', 'setProtocol'));
    // `URL.prototype.username` accessors pair
    // https://url.spec.whatwg.org/#dom-url-username
    defineBuiltInAccessor$3(URLPrototype, 'username', accessorDescriptor('getUsername', 'setUsername'));
    // `URL.prototype.password` accessors pair
    // https://url.spec.whatwg.org/#dom-url-password
    defineBuiltInAccessor$3(URLPrototype, 'password', accessorDescriptor('getPassword', 'setPassword'));
    // `URL.prototype.host` accessors pair
    // https://url.spec.whatwg.org/#dom-url-host
    defineBuiltInAccessor$3(URLPrototype, 'host', accessorDescriptor('getHost', 'setHost'));
    // `URL.prototype.hostname` accessors pair
    // https://url.spec.whatwg.org/#dom-url-hostname
    defineBuiltInAccessor$3(URLPrototype, 'hostname', accessorDescriptor('getHostname', 'setHostname'));
    // `URL.prototype.port` accessors pair
    // https://url.spec.whatwg.org/#dom-url-port
    defineBuiltInAccessor$3(URLPrototype, 'port', accessorDescriptor('getPort', 'setPort'));
    // `URL.prototype.pathname` accessors pair
    // https://url.spec.whatwg.org/#dom-url-pathname
    defineBuiltInAccessor$3(URLPrototype, 'pathname', accessorDescriptor('getPathname', 'setPathname'));
    // `URL.prototype.search` accessors pair
    // https://url.spec.whatwg.org/#dom-url-search
    defineBuiltInAccessor$3(URLPrototype, 'search', accessorDescriptor('getSearch', 'setSearch'));
    // `URL.prototype.searchParams` getter
    // https://url.spec.whatwg.org/#dom-url-searchparams
    defineBuiltInAccessor$3(URLPrototype, 'searchParams', accessorDescriptor('getSearchParams'));
    // `URL.prototype.hash` accessors pair
    // https://url.spec.whatwg.org/#dom-url-hash
    defineBuiltInAccessor$3(URLPrototype, 'hash', accessorDescriptor('getHash', 'setHash'));
  }

  // `URL.prototype.toJSON` method
  // https://url.spec.whatwg.org/#dom-url-tojson
  defineBuiltIn$1(URLPrototype, 'toJSON', function toJSON() {
    return getInternalURLState(this).serialize();
  }, { enumerable: true });

  // `URL.prototype.toString` method
  // https://url.spec.whatwg.org/#URL-stringification-behavior
  defineBuiltIn$1(URLPrototype, 'toString', function toString() {
    return getInternalURLState(this).serialize();
  }, { enumerable: true });

  if (NativeURL) {
    var nativeCreateObjectURL = NativeURL.createObjectURL;
    var nativeRevokeObjectURL = NativeURL.revokeObjectURL;
    // `URL.createObjectURL` method
    // https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL
    if (nativeCreateObjectURL) defineBuiltIn$1(URLConstructor, 'createObjectURL', bind(nativeCreateObjectURL, NativeURL));
    // `URL.revokeObjectURL` method
    // https://developer.mozilla.org/en-US/docs/Web/API/URL/revokeObjectURL
    if (nativeRevokeObjectURL) defineBuiltIn$1(URLConstructor, 'revokeObjectURL', bind(nativeRevokeObjectURL, NativeURL));
  }

  setToStringTag$1(URLConstructor, 'URL');

  $$o({ global: true, constructor: true, forced: !USE_NATIVE_URL, sham: !DESCRIPTORS$7 }, {
    URL: URLConstructor
  });

  var $$n = _export;
  var call$3 = functionCall;

  // `URL.prototype.toJSON` method
  // https://url.spec.whatwg.org/#dom-url-tojson
  $$n({ target: 'URL', proto: true, enumerable: true }, {
    toJSON: function toJSON() {
      return call$3(URL.prototype.toString, this);
    }
  });

  var DESCRIPTORS$6 = descriptors;
  var uncurryThis$7 = functionUncurryThis;
  var defineBuiltInAccessor$2 = defineBuiltInAccessor$g;

  var URLSearchParamsPrototype = URLSearchParams.prototype;
  var forEach = uncurryThis$7(URLSearchParamsPrototype.forEach);

  // `URLSearchParams.prototype.size` getter
  // https://github.com/whatwg/url/pull/734
  if (DESCRIPTORS$6 && !('size' in URLSearchParamsPrototype)) {
    defineBuiltInAccessor$2(URLSearchParamsPrototype, 'size', {
      get: function size() {
        var count = 0;
        forEach(this, function () { count++; });
        return count;
      },
      configurable: true,
      enumerable: true
    });
  }

  var $$m = _export;
  var fails$9 = fails$V;
  var isArray$1 = isArray$6;
  var isObject = isObject$l;
  var toObject$1 = toObject$h;
  var lengthOfArrayLike$1 = lengthOfArrayLike$m;
  var doesNotExceedSafeInteger = doesNotExceedSafeInteger$4;
  var createProperty = createProperty$5;
  var arraySpeciesCreate = arraySpeciesCreate$3;
  var arrayMethodHasSpeciesSupport = arrayMethodHasSpeciesSupport$5;
  var wellKnownSymbol = wellKnownSymbol$x;
  var V8_VERSION = engineV8Version;

  var IS_CONCAT_SPREADABLE = wellKnownSymbol('isConcatSpreadable');

  // We can't use this feature detection in V8 since it causes
  // deoptimization and serious performance degradation
  // https://github.com/zloirock/core-js/issues/679
  var IS_CONCAT_SPREADABLE_SUPPORT = V8_VERSION >= 51 || !fails$9(function () {
    var array = [];
    array[IS_CONCAT_SPREADABLE] = false;
    return array.concat()[0] !== array;
  });

  var isConcatSpreadable = function (O) {
    if (!isObject(O)) return false;
    var spreadable = O[IS_CONCAT_SPREADABLE];
    return spreadable !== undefined ? !!spreadable : isArray$1(O);
  };

  var FORCED$4 = !IS_CONCAT_SPREADABLE_SUPPORT || !arrayMethodHasSpeciesSupport('concat');

  // `Array.prototype.concat` method
  // https://tc39.es/ecma262/#sec-array.prototype.concat
  // with adding support of @@isConcatSpreadable and @@species
  $$m({ target: 'Array', proto: true, arity: 1, forced: FORCED$4 }, {
    // eslint-disable-next-line no-unused-vars -- required for `.length`
    concat: function concat(arg) {
      var O = toObject$1(this);
      var A = arraySpeciesCreate(O, 0);
      var n = 0;
      var i, k, length, len, E;
      for (i = -1, length = arguments.length; i < length; i++) {
        E = i === -1 ? O : arguments[i];
        if (isConcatSpreadable(E)) {
          len = lengthOfArrayLike$1(E);
          doesNotExceedSafeInteger(n + len);
          for (k = 0; k < len; k++, n++) if (k in E) createProperty(A, n, E[k]);
        } else {
          doesNotExceedSafeInteger(n + 1);
          createProperty(A, n++, E);
        }
      }
      A.length = n;
      return A;
    }
  });

  var apply$1 = functionApply;
  var call$2 = functionCall;
  var uncurryThis$6 = functionUncurryThis;
  var fixRegExpWellKnownSymbolLogic = fixRegexpWellKnownSymbolLogic;
  var anObject$4 = anObject$s;
  var isNullOrUndefined = isNullOrUndefined$b;
  var isRegExp = isRegexp;
  var requireObjectCoercible = requireObjectCoercible$c;
  var speciesConstructor = speciesConstructor$4;
  var advanceStringIndex = advanceStringIndex$3;
  var toLength = toLength$a;
  var toString$3 = toString$n;
  var getMethod = getMethod$9;
  var arraySlice$1 = arraySliceSimple;
  var callRegExpExec = regexpExecAbstract;
  var regexpExec = regexpExec$3;
  var stickyHelpers = regexpStickyHelpers;
  var fails$8 = fails$V;

  var UNSUPPORTED_Y = stickyHelpers.UNSUPPORTED_Y;
  var MAX_UINT32 = 0xFFFFFFFF;
  var min = Math.min;
  var $push = [].push;
  var exec$1 = uncurryThis$6(/./.exec);
  var push$2 = uncurryThis$6($push);
  var stringSlice$1 = uncurryThis$6(''.slice);

  // Chrome 51 has a buggy "split" implementation when RegExp#exec !== nativeExec
  // Weex JS has frozen built-in prototypes, so use try / catch wrapper
  var SPLIT_WORKS_WITH_OVERWRITTEN_EXEC = !fails$8(function () {
    // eslint-disable-next-line regexp/no-empty-group -- required for testing
    var re = /(?:)/;
    var originalExec = re.exec;
    re.exec = function () { return originalExec.apply(this, arguments); };
    var result = 'ab'.split(re);
    return result.length !== 2 || result[0] !== 'a' || result[1] !== 'b';
  });

  // @@split logic
  fixRegExpWellKnownSymbolLogic('split', function (SPLIT, nativeSplit, maybeCallNative) {
    var internalSplit;
    if (
      'abbc'.split(/(b)*/)[1] == 'c' ||
      // eslint-disable-next-line regexp/no-empty-group -- required for testing
      'test'.split(/(?:)/, -1).length != 4 ||
      'ab'.split(/(?:ab)*/).length != 2 ||
      '.'.split(/(.?)(.?)/).length != 4 ||
      // eslint-disable-next-line regexp/no-empty-capturing-group, regexp/no-empty-group -- required for testing
      '.'.split(/()()/).length > 1 ||
      ''.split(/.?/).length
    ) {
      // based on es5-shim implementation, need to rework it
      internalSplit = function (separator, limit) {
        var string = toString$3(requireObjectCoercible(this));
        var lim = limit === undefined ? MAX_UINT32 : limit >>> 0;
        if (lim === 0) return [];
        if (separator === undefined) return [string];
        // If `separator` is not a regex, use native split
        if (!isRegExp(separator)) {
          return call$2(nativeSplit, string, separator, lim);
        }
        var output = [];
        var flags = (separator.ignoreCase ? 'i' : '') +
                    (separator.multiline ? 'm' : '') +
                    (separator.unicode ? 'u' : '') +
                    (separator.sticky ? 'y' : '');
        var lastLastIndex = 0;
        // Make `global` and avoid `lastIndex` issues by working with a copy
        var separatorCopy = new RegExp(separator.source, flags + 'g');
        var match, lastIndex, lastLength;
        while (match = call$2(regexpExec, separatorCopy, string)) {
          lastIndex = separatorCopy.lastIndex;
          if (lastIndex > lastLastIndex) {
            push$2(output, stringSlice$1(string, lastLastIndex, match.index));
            if (match.length > 1 && match.index < string.length) apply$1($push, output, arraySlice$1(match, 1));
            lastLength = match[0].length;
            lastLastIndex = lastIndex;
            if (output.length >= lim) break;
          }
          if (separatorCopy.lastIndex === match.index) separatorCopy.lastIndex++; // Avoid an infinite loop
        }
        if (lastLastIndex === string.length) {
          if (lastLength || !exec$1(separatorCopy, '')) push$2(output, '');
        } else push$2(output, stringSlice$1(string, lastLastIndex));
        return output.length > lim ? arraySlice$1(output, 0, lim) : output;
      };
    // Chakra, V8
    } else if ('0'.split(undefined, 0).length) {
      internalSplit = function (separator, limit) {
        return separator === undefined && limit === 0 ? [] : call$2(nativeSplit, this, separator, limit);
      };
    } else internalSplit = nativeSplit;

    return [
      // `String.prototype.split` method
      // https://tc39.es/ecma262/#sec-string.prototype.split
      function split(separator, limit) {
        var O = requireObjectCoercible(this);
        var splitter = isNullOrUndefined(separator) ? undefined : getMethod(separator, SPLIT);
        return splitter
          ? call$2(splitter, separator, O, limit)
          : call$2(internalSplit, toString$3(O), separator, limit);
      },
      // `RegExp.prototype[@@split]` method
      // https://tc39.es/ecma262/#sec-regexp.prototype-@@split
      //
      // NOTE: This cannot be properly polyfilled in engines that don't support
      // the 'y' flag.
      function (string, limit) {
        var rx = anObject$4(this);
        var S = toString$3(string);
        var res = maybeCallNative(internalSplit, rx, S, limit, internalSplit !== nativeSplit);

        if (res.done) return res.value;

        var C = speciesConstructor(rx, RegExp);

        var unicodeMatching = rx.unicode;
        var flags = (rx.ignoreCase ? 'i' : '') +
                    (rx.multiline ? 'm' : '') +
                    (rx.unicode ? 'u' : '') +
                    (UNSUPPORTED_Y ? 'g' : 'y');

        // ^(? + rx + ) is needed, in combination with some S slicing, to
        // simulate the 'y' flag.
        var splitter = new C(UNSUPPORTED_Y ? '^(?:' + rx.source + ')' : rx, flags);
        var lim = limit === undefined ? MAX_UINT32 : limit >>> 0;
        if (lim === 0) return [];
        if (S.length === 0) return callRegExpExec(splitter, S) === null ? [S] : [];
        var p = 0;
        var q = 0;
        var A = [];
        while (q < S.length) {
          splitter.lastIndex = UNSUPPORTED_Y ? 0 : q;
          var z = callRegExpExec(splitter, UNSUPPORTED_Y ? stringSlice$1(S, q) : S);
          var e;
          if (
            z === null ||
            (e = min(toLength(splitter.lastIndex + (UNSUPPORTED_Y ? q : 0)), S.length)) === p
          ) {
            q = advanceStringIndex(S, q, unicodeMatching);
          } else {
            push$2(A, stringSlice$1(S, p, q));
            if (A.length === lim) return A;
            for (var i = 1; i <= z.length - 1; i++) {
              push$2(A, z[i]);
              if (A.length === lim) return A;
            }
            q = p = e;
          }
        }
        push$2(A, stringSlice$1(S, p));
        return A;
      }
    ];
  }, !SPLIT_WORKS_WITH_OVERWRITTEN_EXEC, UNSUPPORTED_Y);

  var $$l = _export;
  var global$9 = global$Q;
  var defineBuiltInAccessor$1 = defineBuiltInAccessor$g;
  var DESCRIPTORS$5 = descriptors;

  var $TypeError = TypeError;
  // eslint-disable-next-line es/no-object-defineproperty -- safe
  var defineProperty$3 = Object.defineProperty;
  var INCORRECT_VALUE = global$9.self !== global$9;

  // `self` getter
  // https://html.spec.whatwg.org/multipage/window-object.html#dom-self
  try {
    if (DESCRIPTORS$5) {
      // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
      var descriptor$2 = Object.getOwnPropertyDescriptor(global$9, 'self');
      // some engines have `self`, but with incorrect descriptor
      // https://github.com/denoland/deno/issues/15765
      if (INCORRECT_VALUE || !descriptor$2 || !descriptor$2.get || !descriptor$2.enumerable) {
        defineBuiltInAccessor$1(global$9, 'self', {
          get: function self() {
            return global$9;
          },
          set: function self(value) {
            if (this !== global$9) throw $TypeError('Illegal invocation');
            defineProperty$3(global$9, 'self', {
              value: value,
              writable: true,
              configurable: true,
              enumerable: true
            });
          },
          configurable: true,
          enumerable: true
        });
      }
    } else $$l({ global: true, simple: true, forced: INCORRECT_VALUE }, {
      self: global$9
    });
  } catch (error) { /* empty */ }

  var $$k = _export;
  var uncurryThis$5 = functionUncurryThis;
  var aCallable$2 = aCallable$h;
  var toObject = toObject$h;
  var lengthOfArrayLike = lengthOfArrayLike$m;
  var deletePropertyOrThrow = deletePropertyOrThrow$4;
  var toString$2 = toString$n;
  var fails$7 = fails$V;
  var internalSort = arraySort$1;
  var arrayMethodIsStrict = arrayMethodIsStrict$4;
  var FF = engineFfVersion;
  var IE_OR_EDGE = engineIsIeOrEdge;
  var V8 = engineV8Version;
  var WEBKIT = engineWebkitVersion;

  var test$2 = [];
  var nativeSort = uncurryThis$5(test$2.sort);
  var push$1 = uncurryThis$5(test$2.push);

  // IE8-
  var FAILS_ON_UNDEFINED = fails$7(function () {
    test$2.sort(undefined);
  });
  // V8 bug
  var FAILS_ON_NULL = fails$7(function () {
    test$2.sort(null);
  });
  // Old WebKit
  var STRICT_METHOD = arrayMethodIsStrict('sort');

  var STABLE_SORT = !fails$7(function () {
    // feature detection can be too slow, so check engines versions
    if (V8) return V8 < 70;
    if (FF && FF > 3) return;
    if (IE_OR_EDGE) return true;
    if (WEBKIT) return WEBKIT < 603;

    var result = '';
    var code, chr, value, index;

    // generate an array with more 512 elements (Chakra and old V8 fails only in this case)
    for (code = 65; code < 76; code++) {
      chr = String.fromCharCode(code);

      switch (code) {
        case 66: case 69: case 70: case 72: value = 3; break;
        case 68: case 71: value = 4; break;
        default: value = 2;
      }

      for (index = 0; index < 47; index++) {
        test$2.push({ k: chr + index, v: value });
      }
    }

    test$2.sort(function (a, b) { return b.v - a.v; });

    for (index = 0; index < test$2.length; index++) {
      chr = test$2[index].k.charAt(0);
      if (result.charAt(result.length - 1) !== chr) result += chr;
    }

    return result !== 'DGBEFHACIJK';
  });

  var FORCED$3 = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;

  var getSortCompare = function (comparefn) {
    return function (x, y) {
      if (y === undefined) return -1;
      if (x === undefined) return 1;
      if (comparefn !== undefined) return +comparefn(x, y) || 0;
      return toString$2(x) > toString$2(y) ? 1 : -1;
    };
  };

  // `Array.prototype.sort` method
  // https://tc39.es/ecma262/#sec-array.prototype.sort
  $$k({ target: 'Array', proto: true, forced: FORCED$3 }, {
    sort: function sort(comparefn) {
      if (comparefn !== undefined) aCallable$2(comparefn);

      var array = toObject(this);

      if (STABLE_SORT) return comparefn === undefined ? nativeSort(array) : nativeSort(array, comparefn);

      var items = [];
      var arrayLength = lengthOfArrayLike(array);
      var itemsLength, index;

      for (index = 0; index < arrayLength; index++) {
        if (index in array) push$1(items, array[index]);
      }

      internalSort(items, getSortCompare(comparefn));

      itemsLength = lengthOfArrayLike(items);
      index = 0;

      while (index < itemsLength) array[index] = items[index++];
      while (index < arrayLength) deletePropertyOrThrow(array, index++);

      return array;
    }
  });

  var $$j = _export;

  // `Number.MAX_SAFE_INTEGER` constant
  // https://tc39.es/ecma262/#sec-number.max_safe_integer
  $$j({ target: 'Number', stat: true, nonConfigurable: true, nonWritable: true }, {
    MAX_SAFE_INTEGER: 0x1FFFFFFFFFFFFF
  });

  var createTypedArrayConstructor$6 = typedArrayConstructorExports;

  // `Int8Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$6('Int8', function (init) {
    return function Int8Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var global$8 = global$Q;

  var globalIsFinite = global$8.isFinite;

  // `Number.isFinite` method
  // https://tc39.es/ecma262/#sec-number.isfinite
  // eslint-disable-next-line es/no-number-isfinite -- safe
  var numberIsFinite$1 = Number.isFinite || function isFinite(it) {
    return typeof it == 'number' && globalIsFinite(it);
  };

  var $$i = _export;
  var numberIsFinite = numberIsFinite$1;

  // `Number.isFinite` method
  // https://tc39.es/ecma262/#sec-number.isfinite
  $$i({ target: 'Number', stat: true }, { isFinite: numberIsFinite });

  var global$7 = global$Q;
  var fails$6 = fails$V;
  var uncurryThis$4 = functionUncurryThis;
  var toString$1 = toString$n;
  var trim$1 = stringTrim.trim;
  var whitespaces$2 = whitespaces$5;

  var charAt$1 = uncurryThis$4(''.charAt);
  var $parseFloat$1 = global$7.parseFloat;
  var Symbol$1 = global$7.Symbol;
  var ITERATOR = Symbol$1 && Symbol$1.iterator;
  var FORCED$2 = 1 / $parseFloat$1(whitespaces$2 + '-0') !== -Infinity
    // MS Edge 18- broken with boxed symbols
    || (ITERATOR && !fails$6(function () { $parseFloat$1(Object(ITERATOR)); }));

  // `parseFloat` method
  // https://tc39.es/ecma262/#sec-parsefloat-string
  var numberParseFloat = FORCED$2 ? function parseFloat(string) {
    var trimmedString = trim$1(toString$1(string));
    var result = $parseFloat$1(trimmedString);
    return result === 0 && charAt$1(trimmedString, 0) == '-' ? -0 : result;
  } : $parseFloat$1;

  var $$h = _export;
  var $parseFloat = numberParseFloat;

  // `parseFloat` method
  // https://tc39.es/ecma262/#sec-parsefloat-string
  $$h({ global: true, forced: parseFloat != $parseFloat }, {
    parseFloat: $parseFloat
  });

  var regExpFindStringParts=/(?:^|.+?)(?:[\s$£€\uFFE5^+=`~<>{}[\]|\u3000-\u303F!-#%-\x2A,-/:;\x3F@\x5B-\x5D_\x7B}\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+|$)/g;/**
   * Generates an array of strings with all possible combinations of first-letter or all-letter case transformations
   * If caseMatchType is not 'full', then only combinations of first-letter cases for each word are calculated
   * If caseMatchType is 'full', then all-uppercase combinations of each word are added to the variations array
   * NB may produce duplicate strings if string begins with punctuation or if it is in a language with no case
   * @param {String} string The string to be converted
   * @param {String} caseMatchType ('basic'|'full') The type (complexity) of case variations to calculate
   * @return {Array} An array containing strings with all possible combinations of case types
   */function allCaseFirstLetters(string,caseMatchType){if(string){var comboArray=[];// Split string into parts beginning with first word letters
  var strParts=string.match(regExpFindStringParts);// Prevent a full search if we have more than 6 string parts
  if(strParts.length>6)caseMatchType='basic';// Set the base (binary or ternary) according to the complexity of the search
  var base=caseMatchType==='full'?3:2;// If n = strParts.length, then the number of possible case combinations (numCombos) is base ^ n
  // For *basic* case calculation: think of numCombos as a binary number of n bits, with each bit representing lcase (0) or ucase (1)
  // For *full* case calculation: think of numCombos as a tertiary base number, e.g. 000, 111, 222,
  // with each bit representing all-lowercase (0), First-Letter-Uppercase (1) or ALL-UPPERCASE (2)
  var numCombos=Math.pow(base,strParts.length);// Prevent more than 1024 combinations (2^10) being calculated
  if(numCombos>1024)numCombos=1024;var typeCase,mixedTypeCaseStr,bitmask,caseBit;// Iterate through every possible combination, starting with (base ^ n) - 1 and decreasing; we go from high to low,
  // because title case (e.g. binary 1111) is more common than all lowercase (0000) so will be found first
  for(var i=numCombos;i--;){mixedTypeCaseStr='';bitmask=1;for(var j=0;j<strParts.length;j++){// Get modulus of division (this is equivalent to bitwise AND for different bases)
  // caseBit will be 0, 1 or 2 (latter only for 'full' case calcualation)
  caseBit=~~(i/bitmask%base);if(caseBit===2){// All uppercase
  typeCase=strParts[j].toLocaleUpperCase();}else {// Modify only first letter
  typeCase=strParts[j].replace(/^./,function(m){// 1 = uppercase, 0 = lowercase
  return caseBit?m.toLocaleUpperCase():m.toLocaleLowerCase();});}mixedTypeCaseStr+=typeCase;// Shift bitmask to the next higher bit
  bitmask*=base;}comboArray.push(mixedTypeCaseStr);}return comboArray;}else {return [string];}}/**
   * Generates an array of Strings, where all duplicates have been removed
   * (without changing the order)
   * It is optimized for small arrays.
   * Source : http://codereview.stackexchange.com/questions/60128/removing-duplicates-from-an-array-quickly
   * @param {Array} array of String
   * @returns {Array} same array of Strings, without duplicates
   */function removeDuplicateStringsInSmallArray(array){var unique=[];for(var i=0;i<array.length;i++){var current=array[i];if(unique.indexOf(current)<0){unique.push(current);}}return unique;}/**
   * Utility function : return true if the given string ends with the suffix
   * @param {String} str
   * @param {String} suffix
   * @returns {Boolean}
   */function endsWith(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1;}/**
   * Read a float encoded in 2 bytes
   * @param {Array} byteArray
   * @param {Integer} firstIndex
   * @param {Boolean} littleEndian (optional)
   * @returns {Float}
   */function readFloatFrom4Bytes(byteArray,firstIndex,littleEndian){var dataView=new DataView(byteArray.buffer,firstIndex,4);var float=dataView.getFloat32(0,littleEndian);return float;}/**
   * Reads a Uint8Array from the given file starting at byte offset begin until end
   * @param {File} file The file object to be read
   * @param {Integer} begin The offset in <File> at which to begin reading
   * @param {Integer} end The byte at whcih to stop reading (reads up to and including end - 1)
   * @returns {Promise<Uint8Array>} A Promise for an array buffer with the read data
   */function readFileSlice(file,begin,end){if(file.slice&&'arrayBuffer'in Blob.prototype){// DEV: This method uses the native arrayBuffer method of Blob, if available, as it eliminates
  // the need to use FileReader and set up event listeners; it also uses the method's native Promise
  // rather than setting up potentially hundreds of new Q promises for small byte range reads
  // Also uses Native FS handle
  return file.slice(begin,end).arrayBuffer().then(function(buffer){return new Uint8Array(buffer);});}else {return new Promise(function(resolve,reject){if(file.readMode==='electron'){// We are reading a packaged file and have to use Electron fs.read (so we don't have to pick the file)
  fs.open(file.path,'r',function(err,fd){if(err){reject(err);}else {var size=end-begin;var arr=typeof Buffer!=='undefined'&&Buffer.alloc(size)||new Uint8Array(size);fs.read(fd,arr,0,size,begin,function(err,bytesRead,data){if(err)reject(err);fs.close(fd,function(err){if(err)reject(err);else return resolve(data);});});}});}else {var reader=new FileReader();reader.readAsArrayBuffer(file.slice(begin,end));reader.addEventListener('load',function(e){resolve(new Uint8Array(e.target.result));});reader.addEventListener('error',reject);reader.addEventListener('abort',reject);}});}}/**
   * Performs a binary search on indices begin <= i < end, utilizing query(i) to return where to
   * continue the search.
   * If lowerBound is not set, returns only indices where query returns 0 and null otherwise.
   * If lowerBound is set, returns the smallest index where query does not return > 0.
   * @param {Integer} begin The beginning of the search window
   * @param {Integer} end The end of the search window
   * @param {Function} query The query to run to test the current point in the window
   * @param {Boolean} lowerBound Determines the type of search
   * @returns {Promise} Promise for the lowest dirEntry that fulfils (or fails to fulfil) the query
   */function binarySearch(begin,end,query,lowerBound){if(end<=begin){return lowerBound?begin:null;}var mid=Math.floor((begin+end)/2);return query(mid).then(function(decision){if(decision<0){return binarySearch(begin,mid,query,lowerBound);}else if(decision>0){return binarySearch(mid+1,end,query,lowerBound);}else {return mid;}});}/**
   * Does a "left shift" on an integer.
   * It is equivalent to int << bits (which works only on 32-bit integers),
   * but compatible with 64-bit integers.
   *
   * @param {Integer} int
   * @param {Integer} bits
   * @returns {Integer}
   */function leftShift(int,bits){return int*Math.pow(2,bits);}/**
   * Converts base 64 code to Uint6
   * From https://developer.mozilla.org/en-US/docs/Glossary/Base64
   * @param {Integer} nChr Numerical character code
   * @returns {Integer} Converted character code
   */function b64ToUint6(nChr){return nChr>64&&nChr<91?nChr-65:nChr>96&&nChr<123?nChr-71:nChr>47&&nChr<58?nChr+4:nChr===43?62:nChr===47?63:0;}/**
   * Recommended rewrite of the faulty .btoa() function in JavaScript because of the problem with UTF-8-encoded data
   * From https://developer.mozilla.org/en-US/docs/Glossary/Base64
   * @param {String} sBase64 Base 64 encoded string
   * @param {Integer} nBlocksSize Optional block size
   * @returns {Uint8Array} A Uint8Array containing the converted data
   */function base64DecToArr(sBase64,nBlocksSize){var sB64Enc=sBase64.replace(/[^A-Za-z0-9+/]/g,''),nInLen=sB64Enc.length,nOutLen=nInLen*3+1>>2,taBytes=new Uint8Array(nOutLen);for(var nMod3,nMod4,nUint24=0,nOutIdx=0,nInIdx=0;nInIdx<nInLen;nInIdx++){nMod4=nInIdx&3;nUint24|=b64ToUint6(sB64Enc.charCodeAt(nInIdx))<<6*(3-nMod4);if(nMod4===3||nInLen-nInIdx===1){for(nMod3=0;nMod3<3&&nOutIdx<nOutLen;nMod3++,nOutIdx++){taBytes[nOutIdx]=nUint24>>>(16>>>nMod3&24)&255;}nUint24=0;}}return taBytes;}/**
   Converts a dataURI to Uint8Array
   * @param {String} dataURI The data URI to convert
   * @returns {Uint8Array} A Uint8Array with the converted buffer
   */function dataURItoUint8Array(dataURI){var parsedString=dataURI.match(/^data:([^,]*),(.*)/i);if(parsedString&&/base64/i.test(parsedString[1])){return base64DecToArr(parsedString[2]);}else {var byteString=decodeURI(parsedString[2]);var ab=[];for(var i=0;i<byteString.length;i++){ab[i]=byteString.charCodeAt(i);}return new Uint8Array(ab);}}/**
   * Detect whether the browser supports the webkitdirectory attribute on input elements
   * @returns {Boolean} True if the webkitdirectory attribute is supported, false otherwise
   */function webkitdirectorySupported(){return 'webkitdirectory'in document.createElement('input')&&!/iOS|Android/.test(params.appType);}/**
   * Matches the outermost balanced constructs and their contents
   * even if they have nested balanced constructs within them
   * e.g., outer HTML of a pair of opening and closing tags.
   * Left and right constructs must not be equal. Backreferences in right are not supported.
   * Double backslash (\\) any backslash characters, e.g. '\\b'.
   * If you do not set the global flag ('g'), then only contents of first construct will be returned.
   * Adapted from http://blog.stevenlevithan.com/archives/javascript-match-recursive-regexp
   * (c) 2007 Steven Levithan - MIT Licence https://opensource.org/licenses/MIT
   *
   * @param {string} str - String to be searched.
   * @param {string} left - Regex string of opening pattern to match, e.g. '<table\\b[^>]*>' matches <table> or <table ...>.
   * @param {string} right - Regex string of closing pattern to match, e.g. '</table>'. Must not be equal to left.
   * @param {string} flags - Regex flags, if any, such as 'gi' (= match globally and case insensitive).
   * @param {string} prefix - An optional Regex string that must be present before <left> for the regex to match
   * @returns {Array} An array of matches.
   */function matchOuter(str,left,right,flags,prefix){flags=flags||'';var f=flags.replace(/g/g,''),g=flags.indexOf('g')>-1,l=new RegExp(left,f),// Creates a neutral middle value if left is a well-formed regex for an html tag with attributes
  mid=/^(<[^\\]+)\\/.test(left)?left.replace(/^(<[^\\]+)[\S\s]+$/,'$1')+'\\b[^>]*>':'',x=new RegExp((prefix?prefix:'')+(mid?mid:left)+'|'+right,'g'+f),a=[],t,s,m;mid=mid?new RegExp(mid,f):l;do{t=0;while(m=x.exec(str)){if((t?mid:l).test(m[0])){if(!t++)s=m.index;}else if(t){if(! --t){a.push(str.slice(s,x.lastIndex));if(!g)return a;}}}}while(t&&(x.lastIndex=s));return a;}/**
   * Matches the contents of innermost HTML elements even if they are nested inside other elements.
   * Left and right strings must be opening and closing HTML or XML elements. Backreferences are not supported.
   * If you do not set the global flag ('g'), then only contents of first match will be returned.
   * Double backslash (\\) any backslash characters, e.g. '\\b'.
   * Adapted from http://blog.stevenlevithan.com/archives/match-innermost-html-element
   *
   * @param {string} str - String to be searched.
   * @param {string} left - Regex string of opening element to match, e.g. '<table\\b[^>]*>', must include '<' and '>'.
   * @param {string} right - Regex string of closing element to match, e.g. '</table>'.
   * @param {string} flags - Regex flags, if any, such as 'gi' (= match globally and case insensitive).
   * @returns {Array} A RegExp array of matches.
   */function matchInner(str,left,right,flags){flags=flags||'';var x=new RegExp(left+'(?:(?=([^<]+))\\1|<(?!'+left.replace(/^</,'')+'))*?'+right,flags);return str.match(x);}// Defines an object and functions for searching and highlighting text in a node
  //
  // Original JavaScript code by Chirp Internet: www.chirp.com.au
  // Please acknowledge use of this code by including this header.
  // For documentation see: http://www.the-art-of-web.com/javascript/search-highlight/
  function Hilitor(node,tag){var targetNode=node||document.body;var hiliteTag=tag||'EM';var skipTags=new RegExp('^(?:'+hiliteTag+'|SCRIPT|FORM)$');var colors=['#ff6','#a0ffff','#9f9','#f99','#f6f'];var className='hilitor';var wordColor=[];var colorIdx=0;var matchRegex='';// Add any symbols that may prefix a start string and don't match \b (word boundary)
  var leadingSymbols="‘'\"“([«¿¡!*-";this.setMatchType=function(type){switch(type){case 'left':this.openLeft=false;this.openRight=true;break;case 'right':this.openLeft=true;this.openRight=false;break;case 'open':this.openLeft=this.openRight=true;break;default:this.openLeft=this.openRight=false;}};function addAccents(input){var retval=input;retval=retval.replace(/([ao])e/ig,'$1');retval=retval.replace(/\\u00[CE][0124]/ig,'a');retval=retval.replace(/\\u00E7/ig,'c');retval=retval.replace(/\\u00E[89AB]|\\u00C[9A]/ig,'e');retval=retval.replace(/\\u00[CE][DEF]/ig,'i');retval=retval.replace(/\\u00[DF]1/ig,'n');retval=retval.replace(/\\u00[FD][346]/ig,'o');retval=retval.replace(/\\u00F[9BC]/ig,'u');retval=retval.replace(/\\u00FF/ig,'y');retval=retval.replace(/\\u00DF/ig,'s');retval=retval.replace(/'/ig,"['’‘]");retval=retval.replace(/c/ig,'[cç]');retval=retval.replace(/e/ig,'[eèéêë]');retval=retval.replace(/a/ig,'([aàâäá]|ae)');retval=retval.replace(/i/ig,'[iîïíì]');retval=retval.replace(/n/ig,'[nñ]');retval=retval.replace(/o/ig,'([oôöó]|oe)');retval=retval.replace(/u/ig,'[uùûüú]');retval=retval.replace(/y/ig,'[yÿ]');retval=retval.replace(/s/ig,'(ss|[sß])');return retval;}this.setRegex=function(input){input=input.replace(/\\([^u]|$)/g,'$1');// Replace any spaces with regex OR
  input=input.replace(/\s+/g,'|');// Remove leading and trailing
  input=input.replace(/^\||\|$/g,'');if(input){var re='('+input+')';if(!this.openLeft)re='(?:^|[\\b\\s'+leadingSymbols+'])'+re;if(!this.openRight)re=re+'(?:[\\b\\s]|$)';matchRegex=new RegExp(re,'i');return true;}return false;};this.getRegex=function(){var retval=matchRegex.toString();retval=retval.replace(/(^\/|\(\?:[^\)]+\)|\/i$)/g,'');return retval;};this.countFullMatches=function(input){if(node===undefined||!node)return;var strippedText=node.innerHTML.replace(/<title[^>]*>[\s\S]*<\/title>/i,'');strippedText=node.innerHTML.replace(/<[^>]*>\s*/g,' ');if(!strippedText)return 0;strippedText=strippedText.replace(/(?:&nbsp;|\r?\n|[.,;:?!¿¡-])+/g,' ');strippedText=strippedText.replace(/\s+/g,' ');if(!strippedText.length)return 0;input=input.replace(/[\s.,;:?!¿¡-]+/g,' ');var inputMatcher=new RegExp(input,'ig');var matches=strippedText.match(inputMatcher);if(matches)return matches.length;else return 0;};this.countPartialMatches=function(){if(node===undefined||!node)return;var matches=matchInner(node.innerHTML,'<'+hiliteTag+'\\b[^>]*class="hilitor"[^>]*>','</'+hiliteTag+'>','gi');if(matches)return matches.length;else return 0;};this.scrollFrom=0;this.lastScrollValue='';this.scrollToFullMatch=function(input,scrollFrom){if(node===undefined||!node)return;if(!input)return;// Normalize spaces
  input=input.replace(/\s+/g,' ');var inputWords=input.split(' ');var testInput=addAccents(input);testInput=new RegExp(testInput,'i');var hilitedNodes=node.getElementsByClassName(className);var subNodes=[];var start=scrollFrom||0;start=start>=hilitedNodes.length?0:start;var end=start+inputWords.length;for(start;start<hilitedNodes.length;start++){for(var f=start;f<end;f++){if(f==hilitedNodes.length)break;subNodes.push(hilitedNodes[f].innerHTML);}var nodeText=subNodes.join(' ');if(testInput.test(nodeText)){var iframeWindow=document.getElementById('articleContent').contentWindow;if(appstate.isReplayWorkerAvailable){iframeWindow=document.getElementById('articleContent').contentDocument.getElementById('replay_iframe').contentWindow;}var root=iframeWindow.document.documentElement;var zoomFactor='zoom'in root.style&&params.relativeFontSize&&!window.MSBlobBuilder?params.relativeFontSize/100:1;// Convert both the element position and viewport height to zoomed coordinates
  var elementPosition=hilitedNodes[start].offsetTop*zoomFactor;var viewportOffset=window.innerHeight/4;var scrollOffset=elementPosition-viewportOffset;if('scrollBehavior'in document.documentElement.style){iframeWindow.scrollTo({top:scrollOffset,behavior:'smooth'});}else {iframeWindow.scrollTo(0,scrollOffset);}break;}else {if(f==hilitedNodes.length&&scrollFrom>0){// Restart search from top of page
  scrollFrom=0;start=0;}}subNodes=[];end++;}return start+inputWords.length;};// recursively apply word highlighting
  this.hiliteWords=function(node){if(node===undefined||!node)return;if(!matchRegex)return;if(skipTags.test(node.nodeName))return;if(node.hasChildNodes()){for(var i=0;i<node.childNodes.length;i++)this.hiliteWords(node.childNodes[i]);}if(node.nodeType==3){// NODE_TEXT
  var nv,regs;if((nv=node.nodeValue)&&(regs=matchRegex.exec(nv))){if(!wordColor[regs[1].toLowerCase()]){wordColor[regs[1].toLowerCase()]=colors[colorIdx++%colors.length];}var match=document.createElement(hiliteTag);match.appendChild(document.createTextNode(regs[1]));match.style.setProperty('background-color',wordColor[regs[1].toLowerCase()],'important');match.style.fontStyle='inherit';match.style.color='#000';match.className=className;var after;// In case of leading whitespace or other symbols
  var leadR=new RegExp('^[\\s'+leadingSymbols+']');if(leadR.test(regs[0])){after=node.splitText(regs.index+1);}else {after=node.splitText(regs.index);}after.nodeValue=after.nodeValue.substring(regs[1].length);node.parentNode.insertBefore(match,after);}}};// remove highlighting
  this.remove=function(){if(typeof node.innerHTML=='undefined')return;var arr=node.getElementsByClassName(className),el;while(arr.length&&(el=arr[0])){var parent=el.parentNode;parent.replaceChild(el.firstChild,el);parent.normalize();}};// start highlighting at target node
  this.apply=function(input){this.remove();if(input===undefined||!(input=input.replace(/(^\s+|\s+$)/g,'')))return;input=addAccents(input);input=convertCharStr2jEsc(input);if(this.setRegex(input)){this.hiliteWords(targetNode);}};// added by Yanosh Kunsh to include utf-8 string comparison
  function dec2hex4(textString){var hexequiv=new Array('0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F');return hexequiv[textString>>12&0xF]+hexequiv[textString>>8&0xF]+hexequiv[textString>>4&0xF]+hexequiv[textString&0xF];}function convertCharStr2jEsc(str,cstyle){// Converts a string of characters to JavaScript escapes
  // str: sequence of Unicode characters
  var highsurrogate=0;var suppCP;var pad;var outputString='';for(var i=0;i<str.length;i++){var cc=str.charCodeAt(i);if(cc<0||cc>0xFFFF){outputString+='!Error in convertCharStr2UTF16: unexpected charCodeAt result, cc='+cc+'!';}if(highsurrogate!=0){// this is a supp char, and cc contains the low surrogate
  if(0xDC00<=cc&&cc<=0xDFFF){suppCP=0x10000+(highsurrogate-0xD800<<10)+(cc-0xDC00);{suppCP-=0x10000;outputString+="\\u"+dec2hex4(0xD800|suppCP>>10)+"\\u"+dec2hex4(0xDC00|suppCP&0x3FF);}highsurrogate=0;continue;}else {outputString+='Error in convertCharStr2UTF16: low surrogate expected, cc='+cc+'!';highsurrogate=0;}}if(0xD800<=cc&&cc<=0xDBFF){// start of supplementary character
  highsurrogate=cc;}else {// this is a BMP character
  switch(cc){case 0:outputString+='\\0';break;case 8:outputString+='\\b';break;case 9:outputString+='\\t';break;case 10:outputString+='\\n';break;case 13:outputString+='\\r';break;case 11:outputString+='\\v';break;case 12:outputString+='\\f';break;case 34:outputString+='\\\"';break;case 39:outputString+='\\\'';break;case 92:outputString+='\\\\';break;default:if(cc>0x1f&&cc<0x7F){outputString+=String.fromCharCode(cc);}else {pad=cc.toString(16).toUpperCase();while(pad.length<4){pad='0'+pad;}outputString+="\\u"+pad;}}}}return outputString;}}// Does a forward search for el forward through next siblings, or up the DOM tree then forward
  // Returns if fn(el) is true, or else keeps searching to end of DOM
  function getClosestForward(el,fn){return el&&(fn(el)?el:getClosestForward(el.nextElementSibling,fn))||el&&(fn(el)?el:getClosestForward(el.parentNode,fn));}// Does a reverse search for el back through previous siblings, or up the DOM tree then back
  // Returns if fn(el) is true, or else keeps searching to top of DOM
  function getClosestBack(el,fn){return el&&(fn(el)?el:getClosestBack(el.previousElementSibling,fn))||el&&(fn(el)?el:getClosestBack(el.parentNode,fn));}// Create a closest function alternative because IE11 and others do not support closest
  function closest(ele,s){var cele=ele;var cmatches=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;do{if(cmatches.call(cele,s))return cele;cele=cele.parentElement||cele.parentNode;}while(cele!==null&&cele.nodeType===1);return null;}/**
   * Queues Promise Factories* to be resolved or rejected sequentially. This helps to avoid overlapping Promise functions.
   * Primarily used by uiUtil.systemAlert, to prevent alerts showing while others are being displayed.
   *
   *   *A Promise Factory is merely a Promise wrapped in a function to prevent it from executing immediately. E.g. to use
   *   this function with a Promise, call it like this (or, more likely, use your own pre-wrapped Promise):
   *
   *      return util.PromiseQueue.enqueue(function () {
   *          return new Promise(function (resolve, reject) { ... });
   *      });
   *
   * Adapted from https://medium.com/@karenmarkosyan/how-to-manage-promises-into-dynamic-queue-with-vanilla-javascript-9d0d1f8d4df5
   *
   * @type {Object} PromiseQueue
   * @property {Function} enqueue Queues a Promise Factory. Call this function repeatedly to queue Promises sequentially
   * @param {Function<Promise>} promiseFactory A Promise wrapped in an ordinary function
   * @returns {Promise} A Promise that resolves or rejects with the resolved/rejected value of the Promise Factory
   */var PromiseQueue={_queue:[],_working:false,enqueue:function enqueue(promiseFactory){var that=this;return new Promise(function(resolve,reject){// Don't allow more than four dialogues to queue up
  if(that._queue.length>=4)reject(new Error('PromiseQueue: queue length exceeded'));else that._queue.push({promise:promiseFactory,resolve:resolve,reject:reject});if(!that._working)that._dequeue();});},_dequeue:function _dequeue(){this._working=true;var deferred=this._queue.shift();if(!deferred){this._working=false;return false;}var that=this;return deferred.promise().then(function(val){deferred.resolve(val);return that._dequeue();}).catch(function(err){deferred.reject(err);return that._dequeue();});}};var util = {allCaseFirstLetters:allCaseFirstLetters,removeDuplicateStringsInSmallArray:removeDuplicateStringsInSmallArray,endsWith:endsWith,readFloatFrom4Bytes:readFloatFrom4Bytes,readFileSlice:readFileSlice,binarySearch:binarySearch,dataURItoUint8Array:dataURItoUint8Array,leftShift:leftShift,matchOuter:matchOuter,matchInner:matchInner,webkitdirectorySupported:webkitdirectorySupported,Hilitor:Hilitor,getClosestForward:getClosestForward,getClosestBack:getClosestBack,closest:closest,PromiseQueue:PromiseQueue};

  var $$g = _export;
  var IS_PURE = isPure;
  var DESCRIPTORS$4 = descriptors;
  var global$6 = global$Q;
  var path = path$2;
  var uncurryThis$3 = functionUncurryThis;
  var isForced = isForced_1;
  var hasOwn$3 = hasOwnProperty_1;
  var inheritIfRequired$1 = inheritIfRequired$6;
  var isPrototypeOf = objectIsPrototypeOf;
  var isSymbol = isSymbol$6;
  var toPrimitive = toPrimitive$3;
  var fails$5 = fails$V;
  var getOwnPropertyNames = objectGetOwnPropertyNames.f;
  var getOwnPropertyDescriptor = objectGetOwnPropertyDescriptor.f;
  var defineProperty$2 = objectDefineProperty.f;
  var thisNumberValue = thisNumberValue$2;
  var trim = stringTrim.trim;

  var NUMBER = 'Number';
  var NativeNumber = global$6[NUMBER];
  path[NUMBER];
  var NumberPrototype = NativeNumber.prototype;
  var TypeError$1 = global$6.TypeError;
  var stringSlice = uncurryThis$3(''.slice);
  var charCodeAt = uncurryThis$3(''.charCodeAt);

  // `ToNumeric` abstract operation
  // https://tc39.es/ecma262/#sec-tonumeric
  var toNumeric = function (value) {
    var primValue = toPrimitive(value, 'number');
    return typeof primValue == 'bigint' ? primValue : toNumber(primValue);
  };

  // `ToNumber` abstract operation
  // https://tc39.es/ecma262/#sec-tonumber
  var toNumber = function (argument) {
    var it = toPrimitive(argument, 'number');
    var first, third, radix, maxCode, digits, length, index, code;
    if (isSymbol(it)) throw TypeError$1('Cannot convert a Symbol value to a number');
    if (typeof it == 'string' && it.length > 2) {
      it = trim(it);
      first = charCodeAt(it, 0);
      if (first === 43 || first === 45) {
        third = charCodeAt(it, 2);
        if (third === 88 || third === 120) return NaN; // Number('+0x1') should be NaN, old V8 fix
      } else if (first === 48) {
        switch (charCodeAt(it, 1)) {
          case 66: case 98: radix = 2; maxCode = 49; break; // fast equal of /^0b[01]+$/i
          case 79: case 111: radix = 8; maxCode = 55; break; // fast equal of /^0o[0-7]+$/i
          default: return +it;
        }
        digits = stringSlice(it, 2);
        length = digits.length;
        for (index = 0; index < length; index++) {
          code = charCodeAt(digits, index);
          // parseInt parses a string to a first unavailable symbol
          // but ToNumber should return NaN if a string contains unavailable symbols
          if (code < 48 || code > maxCode) return NaN;
        } return parseInt(digits, radix);
      }
    } return +it;
  };

  var FORCED$1 = isForced(NUMBER, !NativeNumber(' 0o1') || !NativeNumber('0b1') || NativeNumber('+0x1'));

  var calledWithNew = function (dummy) {
    // includes check on 1..constructor(foo) case
    return isPrototypeOf(NumberPrototype, dummy) && fails$5(function () { thisNumberValue(dummy); });
  };

  // `Number` constructor
  // https://tc39.es/ecma262/#sec-number-constructor
  var NumberWrapper = function Number(value) {
    var n = arguments.length < 1 ? 0 : NativeNumber(toNumeric(value));
    return calledWithNew(this) ? inheritIfRequired$1(Object(n), this, NumberWrapper) : n;
  };

  NumberWrapper.prototype = NumberPrototype;
  if (FORCED$1 && true) NumberPrototype.constructor = NumberWrapper;

  $$g({ global: true, constructor: true, wrap: true, forced: FORCED$1 }, {
    Number: NumberWrapper
  });

  // Use `internal/copy-constructor-properties` helper in `core-js@4`
  var copyConstructorProperties = function (target, source) {
    for (var keys = DESCRIPTORS$4 ? getOwnPropertyNames(source) : (
      // ES3:
      'MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,' +
      // ES2015 (in case, if modules with ES2015 Number statics required before):
      'EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,' +
      // ESNext
      'fromString,range'
    ).split(','), j = 0, key; keys.length > j; j++) {
      if (hasOwn$3(source, key = keys[j]) && !hasOwn$3(target, key)) {
        defineProperty$2(target, key, getOwnPropertyDescriptor(source, key));
      }
    }
  };
  if (FORCED$1 || IS_PURE) copyConstructorProperties(path[NUMBER], NativeNumber);

  var regexpCookieKeysToMigrate=new RegExp(['contentInjectionMode','lastSelectedArchive','lastSelectedArchivePath','imageDisplay','useMathJax','appVersion','listOfArchives','lastPageVisit','cssCache','cssUITheme','cssTheme','cssSource','removePageMaxWidth','hideActiveContentWarning','hideToolbars','allowHTMLExtraction','openAllSections','PWAInstalled','lastPageLoad','showFileSelectors'].join('|'));/**
   * A list of deprecated keys that should be removed. Add any further keys to the list of strings separated by a comma.
   * @type {Array}
   */var deprecatedKeys=['lastContentInjectionMode','lastPageHTML','lastPageVisit','version','useCache'];/**
   * The prefix that will be added to keys when stored in localStorage: this is used to prevent
   * potential collision of key names with localStorage keys used by code inside ZIM archives
   * It is set in init.js because it is needed early in app loading
   * @type {String}
   */var keyPrefix=params.keyPrefix;// Tests for available Storage APIs (document.cookie or localStorage) and returns the best available of these
  function getBestAvailableStorageAPI(){// DEV: In FF extensions, cookies are blocked since at least FF 68.6 but possibly since FF 55 [kiwix-js #612]
  var type='none';// First test for localStorage API support
  var localStorageTest;try{localStorageTest='localStorage'in window&&window['localStorage']!==null;// DEV: Above test returns true in IE11 running from file:// protocol, but attempting to write a key to
  // localStorage causes an exception; so to test fully, we must now attempt to write and remove a test key
  if(localStorageTest){localStorage.setItem('tempKiwixStorageTest','');localStorage.removeItem('tempKiwixStorageTest');}}catch(e){localStorageTest=false;}// Now test for document.cookie API support
  document.cookie='tempKiwixCookieTest=working; expires=Fri, 31 Dec 9999 23:59:59 GMT; SameSite=Strict';var kiwixCookieTest=/tempKiwixCookieTest=working/.test(document.cookie);// Remove test value by expiring the key
  document.cookie='tempKiwixCookieTest=; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict';if(kiwixCookieTest)type='cookie';// Prefer localStorage if supported due to some platforms removing cookies once the session ends in some contexts
  if(localStorageTest)type='local_storage';// If both cookies and localStorage are supported, and document.cookie contains keys to migrate,
  // migrate settings to use localStorage
  if(kiwixCookieTest&&localStorageTest&&regexpCookieKeysToMigrate.test(document.cookie))_migrateStorageSettings();// Remove any deprecated keys
  deprecatedKeys.forEach(function(key){if(localStorageTest)localStorage.removeItem(keyPrefix+key);settingsStore.removeItem(key);// Because this runs before we have returned a store type, this will remove from cookie too
  });// Note that if this function returns 'none', the cookie implementations below will run anyway. This is because storing a cookie
  // does not cause an exception even if cookies are blocked in some contexts, whereas accessing localStorage may cause an exception
  return type;}var settingsStore={getItem:function getItem(sKey){if(!sKey){return null;}if(params.storeType!=='local_storage'){return decodeURIComponent(document.cookie.replace(new RegExp('(?:(?:^|.*;)\\s*'+encodeURIComponent(sKey).replace(/[-.+*]/g,'\\$&')+'\\s*\\=\\s*([^;]*).*$)|^.*$'),'$1'))||null;}else {return localStorage.getItem(keyPrefix+sKey);}},setItem:function setItem(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(params.storeType!=='local_storage'){if(!sKey||/^(?:expires|max-age|path|domain|secure)$/i.test(sKey)){return false;}var sExpires='';if(vEnd){switch(vEnd.constructor){case Number:sExpires=vEnd===Infinity?'; expires=Fri, 31 Dec 9999 23:59:59 GMT':'; max-age='+vEnd;break;case String:sExpires='; expires='+vEnd;break;case Date:sExpires='; expires='+vEnd.toUTCString();break;}}document.cookie=encodeURIComponent(sKey)+'='+encodeURIComponent(sValue)+sExpires+(sDomain?'; domain='+sDomain:'')+(sPath?'; path='+sPath:'')+(bSecure?'; secure':'');}else {localStorage.setItem(keyPrefix+sKey,sValue);}return true;},removeItem:function removeItem(sKey,sPath,sDomain){if(!this.hasItem(sKey)){return false;}if(params.storeType!=='local_storage'){document.cookie=encodeURIComponent(sKey)+'=; expires=Thu, 01 Jan 1970 00:00:00 GMT'+(sDomain?'; domain='+sDomain:'')+(sPath?'; path='+sPath:'');}else {localStorage.removeItem(keyPrefix+sKey);}return true;},hasItem:function hasItem(sKey){if(!sKey){return false;}if(params.storeType!=='local_storage'){return new RegExp('(?:^|;\\s*)'+encodeURIComponent(sKey).replace(/[-.+*]/g,'\\$&')+'\\s*\\=').test(document.cookie);}else {return localStorage.getItem(keyPrefix+sKey)!==null;}},_cookieKeys:function _cookieKeys(){// Disabling linter check because this is library code
  // eslint-disable-next-line no-useless-backreference
  var aKeys=document.cookie.replace(/((?:^|\s*;)[^=]+)(?=;|$)|^\s*|\s*(?:=[^;]*)?(?:\1|$)/g,'').split(/\s*(?:=[^;]*)?;\s*/);for(var nLen=aKeys.length,nIdx=0;nIdx<nLen;nIdx++){aKeys[nIdx]=decodeURIComponent(aKeys[nIdx]);}return aKeys;}};// One-off migration of storage settings from cookies to localStorage
  function _migrateStorageSettings(){console.log('Migrating Settings Store from cookies to localStorage...');var cookieKeys=settingsStore._cookieKeys();// Note that because migration occurs before setting params.storeType, settingsStore.getItem() will get the item from
  // document.cookie instead of localStorage, which is the intended behaviour
  for(var i=0;i<cookieKeys.length;i++){if(regexpCookieKeysToMigrate.test(cookieKeys[i])){var migratedKey=keyPrefix+cookieKeys[i];localStorage.setItem(migratedKey,settingsStore.getItem(cookieKeys[i]));settingsStore.removeItem(cookieKeys[i]);console.log('- '+migratedKey);}}console.log('Migration done.');}var settingsStore$1 = {getItem:settingsStore.getItem,setItem:settingsStore.setItem,removeItem:settingsStore.removeItem,hasItem:settingsStore.hasItem,getBestAvailableStorageAPI:getBestAvailableStorageAPI};

  /**
   * Global variables
   */var itemsCount=false;// Placeholders for the articleContainer, header and footer
  var header=document.getElementById('top');var footer=document.getElementById('footer');var articleContainer$2=document.getElementById('articleContent');/**
   * Hides slide-away UI elements
   */function hideSlidingUIElements(){var articleContainer=document.getElementById('articleContent');var articleElement=document.querySelector('article');var footerStyles=getComputedStyle(footer);var footerHeight=parseFloat(footerStyles.height)+parseFloat(footerStyles.marginTop)-2;var headerStyles=getComputedStyle(header);var headerHeight=parseFloat(headerStyles.height)+parseFloat(headerStyles.marginBottom)-2;if(params.hideToolbars===true){// Only hide footer if requested
  footer.style.transform='translateY('+footerHeight+'px)';}articleContainer.style.height=window.innerHeight+'px';// articleContainer.style.height = document.documentElement.clientHeight + 'px';
  header.style.transform='translateY(-'+headerHeight+'px)';articleElement.style.transform='translateY(-'+headerHeight+'px)';// Needed by IE11 (only browser that has window.navigator.msSaveBlob)
  if(window.navigator&&window.navigator.msSaveBlob)articleContainer.style.transform='translateY(-'+headerHeight+'px)';}/**
   * Restores slide-away UI elements
   */function showSlidingUIElements(){var articleContainer=document.getElementById('articleContent');var articleElement=document.querySelector('article');var headerStyles=getComputedStyle(document.getElementById('top'));var headerHeight=parseFloat(headerStyles.height)+parseFloat(headerStyles.marginBottom);header.style.transform='translateY(0)';// Needed for Windows Mobile to prevent header disappearing beneath iframe
  articleElement.style.transform='translateY(-1px)';articleContainer.style.transform='translateY(-1px)';footer.style.transform='translateY(0)';articleContainer.style.height=window.innerHeight+headerHeight+'px';// articleContainer.style.height = document.documentElement.clientHeight + 'px';
  }var scrollThrottle=false;/**
   * Launcher for the slide-away function, including a throttle to prevent it being called too often
   */function scroller(e){if(!e)return;if(scrollThrottle||params.hideToolbars===false)return;// We have to refresh the articleContainer when the window changes
  articleContainer$2=document.getElementById('articleContent');// Get the replay_iframe if it exists
  var replayIframe=articleContainer$2.contentWindow?articleContainer$2.contentWindow.document?articleContainer$2.contentWindow.document.getElementById('replay_iframe'):null:null;articleContainer$2=replayIframe||articleContainer$2;if(articleContainer$2.style.display==='none')return;// DEV: windowIsScrollable gets set and reset in slideAway()
  if(windowIsScrollable&&e.type==='wheel')return;var newScrollY=articleContainer$2.contentWindow.pageYOffset;// If it's a non-scroll event and we're actually scrolling, get out of the way and let the scroll event handle it
  if(/^touch|^wheel|^keydown/.test(e.type)&&newScrollY!==oldScrollY){oldScrollY=newScrollY;return;}if(e.type==='touchstart'){oldTouchY=e.touches[0].screenY;return;}// Value below is checked in app.js articleLoader() to prevent showing the UI elements if the user has already started scrolling
  articleContainer$2.contentWindow.scrollFired=true;// console.debug('scrollFired:', articleContainer.id, e.type);
  scrollThrottle=true;// Call the main function
  slideAway(e);// Set timeouts for the throttle
  var timeout=250;if(/^touch|^keydown/.test(e.type)){scrollThrottle=false;return;}else if(e.type==='wheel'&&Math.abs(e.deltaY)>6){timeout=1200;}setTimeout(function(){scrollThrottle=false;},timeout);}if('MSBlobBuilder'in window){header.style.position='relative';header.style.zIndex=1;}var oldScrollY=0;var oldTouchY=0;var timeoutResetScrollable;var windowIsScrollable=false;// Slides away or restores the header and footer
  function slideAway(e){var newScrollY=articleContainer$2.contentWindow.pageYOffset;var delta;var visibleState=/\(0p?x?\)/.test(header.style.transform);// Remove any content warning
  hideActiveContentWarning();// If the search field is focused and elements are not showing, do not slide away
  if(document.activeElement===document.getElementById('prefix')){if(!visibleState)showSlidingUIElements();}else if(e.type==='scroll'){windowIsScrollable=true;if(newScrollY===oldScrollY)return;if(newScrollY<oldScrollY){showSlidingUIElements();}else if(newScrollY-oldScrollY>30){// Hide the toolbars if user has scrolled and not already hidden
  hideSlidingUIElements();}oldScrollY=newScrollY;// Debounces the scroll at end of page
  var resetScrollable=function resetScrollable(){windowIsScrollable=false;};clearTimeout(timeoutResetScrollable);timeoutResetScrollable=setTimeout(resetScrollable,3000);}else {var hideOrShow=visibleState?hideSlidingUIElements:showSlidingUIElements;if(newScrollY===0&&windowIsScrollable){// If we are at the top of a scrollable page, always restore the UI elements
  hideOrShow=showSlidingUIElements;}if(e.type==='touchend'){delta=Math.abs(oldTouchY-e.changedTouches[0].screenY);if(delta>50){hideOrShow();}}else if(e.type==='wheel'){delta=Math.abs(e.deltaY);if(delta>6){hideOrShow();}}else if(e.type==='keydown'){// IE11 produces Up and Down instead of ArrowUp and ArrowDown
  if((e.ctrlKey||e.metaKey)&&/^(Arrow)?(Up|Down)$/.test(e.key)){hideOrShow();}}// DEBUG for non-scrolling events events
  // console.debug('eventType: ' + e.type + ' oldScrollY: ' + oldScrollY + ' newScrollY: ' + newScrollY + ' windowIsScrollable: ' + windowIsScrollable);
  }}/**
   * Creates either a blob: or data: URI from the given content
   * The given attribute of the DOM node (nodeAttribute) is then set to this URI
   *
   * This is used to inject images (and other dependencies) into the article DOM
   *
   * @param {Object} node The node to which the URI should be added
   * @param {String} nodeAttribute The attribute to set to the URI
   * @param {Uint8Array} content The binary content to convert to a URI
   * @param {String} mimeType The MIME type of the content
   * @param {Boolean} makeDataURI If true, make a data: URI instead of a blob URL
   * @param {Function} callback An optional function to call with the URI
   */function feedNodeWithBlob(node,nodeAttribute,content,mimeType,makeDataURI,callback){// Decode WebP data if the browser does not support WebP and the mimeType is webp
  if(webpMachine&&/image\/webp/i.test(mimeType)){// If we're dealing with a dataURI, first convert to Uint8Array (polyfill cannot read data URIs)
  if(/^data:/i.test(content)){content=util.dataURItoUint8Array(content);}// DEV: Note that webpMachine is single threaded and will reject an image if it is busy
  // However, the prepareImagesJQuery() function in images.js is sequential (it waits for a callback
  // before processing another image) so we do not need to queue WebP images here
  webpMachine.decode(content).then(function(uri){// DEV: WebpMachine.decode() returns a data: URI
  // We callback before the node is set so that we don't incur slow DOM rewrites before processing more images
  if(callback)callback(uri);node.setAttribute(nodeAttribute,uri);}).catch(function(err){console.error('There was an error decoding image in WebpMachine',err);if(callback)callback();});}else {var url;if(makeDataURI){// Because btoa fails on utf8 strings (in SVGs, for example) we need to use FileReader method
  // See https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem
  // url = 'data:' + mimeType + ';base64,' + btoa(util.uintToString(content));
  getDataUriFromUint8Array(content,mimeType).then(function(uri){node.setAttribute(nodeAttribute,uri);if(callback)callback(uri);}).catch(function(err){console.error('There was an error converting binary content to data URI',err);if(callback)callback(null);});}else {var blob=new Blob([content],{type:mimeType});// Establish the current window (avoids having to pass it to this function)
  var docWindow=node.ownerDocument.defaultView||node.ownerDocument.parentWindow||window;url=docWindow.URL.createObjectURL(blob);if(callback)callback(url);node.addEventListener('load',function(){URL.revokeObjectURL(url);});node.setAttribute(nodeAttribute,url);}}}/**
   * Creates a data: URI from the given content
   * @param {Uint8Array} content The binary content to convert to a URI
   * @param {String} mimeType The MIME type of the content
   * @returns {Promise<String>} A promise that resolves to the data URI
   */function getDataUriFromUint8Array(content,mimeType){var _this=this;// Use FileReader method because btoa fails on utf8 strings (in SVGs, for example)
  // See https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem
  // This native browser method is very fast: see https://stackoverflow.com/a/66046176/9727685
  return new Promise(function(resolve,reject){_newArrowCheck(this,_this);var myReader=new FileReader();myReader.onloadend=function(){var url=myReader.result;resolve(url);};myReader.onerror=function(err){reject(err);};myReader.readAsDataURL(new Blob([content],{type:mimeType}));}.bind(this));}/**
   * Removes parameters and anchors from a URL
   * @param {type} url The URL to be processed
   * @returns {String} The same URL without its parameters and anchors
   */function removeUrlParameters(url){// Remove any querystring
  var strippedUrl=url.replace(/\?[^?]*$/,'');// Remove any anchor parameters - note that we are deliberately excluding entity references, e.g. '&#39;'.
  strippedUrl=strippedUrl.replace(/#[^#;]*$/,'');return strippedUrl;}// Transforms an asset (script or link) element string into a usable element containing the given content or a BLOB
  function TableOfContents(articleDoc){this.doc=articleDoc;this.headings=this.doc.querySelectorAll('h1, h2, h3, h4, h5, h6');this.getHeadingObjects=function(){var headings=[];for(var i=0;i<this.headings.length;i++){var element=this.headings[i];var obj={};obj.id=element.id;var objectId=element.innerHTML.match(/\bid\s*=\s*["']\s*([^"']+?)\s*["']/i);obj.id=obj.id?obj.id:objectId&&objectId.length>1?objectId[1]:'';obj.index=i;obj.textContent=element.textContent;obj.tagName=element.tagName;headings.push(obj);}return headings;};}function makeReturnLink(title){// Abbreviate title if necessary
  var shortTitle=title.substring(0,25);shortTitle=shortTitle===title?shortTitle:shortTitle+'...';var link='<h4 style="font-size:'+~~(params.relativeUIFontSize*1.4*0.14)+'px;"><a href="#">&lt;&lt; Return to '+shortTitle+'</a></h4>';var returnDivs=document.getElementsByClassName('returntoArticle');for(var i=0;i<returnDivs.length;i++){returnDivs[i].innerHTML=link;}}/**
   * Displays the operations panel in the footer to show a message with an optional timeout interval. If no timeout is specified, the panel
   * will display for 10s before being cleared. If the timeout is set to true, the panel will display indefinitely or until pollOpsPanel
   * is called again. If set to false, the panel will be cleared.
   * @param {String} msg The message (may be HTML-formatted) to display in the panel, or if empty, the panel will be cleared
   * @param {Integer|Boolean} opControl A timeout value, or if true, the panel will display indefinitely
   */function pollOpsPanel(msg,opControl){msg=msg||null;var footer=document.getElementById('footer');var opsPanel=document.getElementById('alertBoxFooter');var navigationButtons=document.getElementById('navigationButtons');var configuration=document.getElementById('configuration');var timeout=Number.isFinite(opControl)?opControl:10000;if(msg===null){opsPanel.style.display='none';if(configuration.style.display==='none'){navigationButtons.style.display='block';footer.style.display='block';}else {navigationButtons.style.display='none';}}else {opsPanel.style.display='block';opsPanel.innerHTML='<div class="alert alert-info">'+msg+'</div>';if(configuration.style.display!=='none'){footer.style.display='block';navigationButtons.style.display='none';}else {navigationButtons.style.display='block';}}// Close panel after 10s if no timeout specified
  clearTimeout(pollOpsPanel);if(opControl!==true){setTimeout(pollOpsPanel,timeout);}}/**
   * Starts the spinner, with an optional message and optional timeout interval. If no timeout is specified, the spinner
   * will run for 3s before being cleared. If the timeout is set to true, the spinner will run indefinitely or until pollSpinner
   * is called again.
   * @param {String} msg A message (may be HTML-formatted) to display below the spinner
   * @param {Integer|Boolean} noTimeoutOrInterval A timeout value, or if true, the spinner will run indefinitely until pollSpinner is called again
   */function pollSpinner(msg,noTimeoutOrInterval){msg=msg||'';document.getElementById('searchingArticles').style.display='block';var cachingAssets=document.getElementById('cachingAssets');cachingAssets.innerHTML=msg;if(msg)cachingAssets.style.display='block';else cachingAssets.style.display='none';// Never allow spinner to run for more than 3s
  clearTimeout(clearSpinner);if(!noTimeoutOrInterval||noTimeoutOrInterval!==true){var interval=noTimeoutOrInterval||3000;setTimeout(clearSpinner,interval);}}function clearSpinner(){document.getElementById('searchingArticles').style.display='none';var cachingAssets=document.getElementById('cachingAssets');cachingAssets.innerHTML='';cachingAssets.style.display='none';}function printCustomElements(innerDocument){// For now, adding a printing stylesheet to a zimit ZIM appears to diasble printing of any images!
  if(appstate.wikimediaZimLoaded){// Add any missing classes
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(class\s*=\s*["'][^"']*vcard\b[^>]+>\s*<span)>/ig,'$1 class="map-pin">');// Remove encapsulated External Links
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<details\b(?![^>]"externalLinks"))((?:[^<]|<(?!\/details>))+?['"]external_links['"])/i,'$1 class="externalLinks" $2');// This is the best we can do for removing External Links if its not encapsulated
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<(?:h2|span)\b[^<]+external_links(?:[^<]|<(?!\/div>|\/details>))+?<ul\s*(?!class="externalLinks"))/i,'$1 class="externalLinks" ');// Further Reading
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<details\b(?![^>]"furtherReading"))((?:[^<]|<(?!\/details>))+?['"]further_reading['"])/i,'$1 class="furtherReading" $2');innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<(?:h2|span)\b[^<]+further_reading(?:[^<]|<(?!\/div>|\/details>))+?<ul\s*(?!class="furtherReading"))/i,'$1 class="furtherReading" ');// See Also
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<details\b(?![^>]"seeAlso"))((?:[^<]|<(?!\/details>))+?['"]see_also['"])/i,'$1 class="seeAlso" $2');innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<(?:h2|span)\b[^<]+see_also(?:[^<]|<(?!\/div>|\/details>))+?<ul\s*(?!class="seeAlso"))/i,'$1 class="seeAlso" ');// References (this is for details-summary ZIMs only: it gets rid of the title)
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<details\b(?![^>]"zimReferences"))((?:[^<]|<(?!\/details>))+?['"]references['"])/i,'$1 class="zimReferences" $2');// Sources (this is for details-summary ZIMs only: it gets rid of the title)
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<details\b(?![^>]"zimSources"))((?:[^<]|<(?!\/details>))+?['"]sources['"])/i,'$1 class="zimSources" $2');innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/(<div\s+)([^>]+>\s+This article is issued from)/i,'$1class="copyLeft" $2');// Remove openInTab div (we can't do this using DOM methods because it aborts code spawned from onclick event)
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/<div\s(?=[^<]+?openInTab)(?:[^<]|<(?!\/div>))+<\/div>\s*/,'');// Add an @media print conditional stylesheet
  var printOptions=innerDocument.getElementById('printOptions');// If there is no printOptions style block in the iframe, create it
  if(!printOptions){var printStyle=innerDocument.createElement('style');printStyle.id='printOptions';innerDocument.head.appendChild(printStyle);printOptions=innerDocument.getElementById('printOptions');}var printStyleInnerHTML='@media print { ';printStyleInnerHTML+=document.getElementById('printNavBoxCheck').checked?'':'.navbox, .vertical-navbox { display: none; } ';printStyleInnerHTML+=document.getElementById('printEndNoteCheck').checked?'':'.reflist, div[class*=references], .zimReferences, .zimSources { display: none; } ';printStyleInnerHTML+=document.getElementById('externalLinkCheck').checked?'':'.externalLinks, .furtherReading { display: none; } ';printStyleInnerHTML+=document.getElementById('seeAlsoLinkCheck').checked?'':'.seeAlso { display: none; } ';printStyleInnerHTML+=document.getElementById('printInfoboxCheck').checked?'':'.mw-stack, .infobox, .infobox_v2, .infobox_v3, .qbRight, .qbRightDiv, .wv-quickbar, .wikitable { display: none; } ';// printStyleInnerHTML += document.getElementById("printImageCheck").checked ? "" : "img, .gallery { display: none; } ";
  printStyleInnerHTML+='.copyLeft { display: none } ';printStyleInnerHTML+='.map-pin { display: none } ';printStyleInnerHTML+='.external { padding-right: 0 !important } ';}if(/gutenberg/i.test(appstate.selectedArchive.file.name)){// Remove any blocks with classnames zim_info, zim_epub and zim_up
  var elementsToRemove=innerDocument.body.querySelectorAll('.zim_info, .zim_epub, .zim_up');if(elementsToRemove){for(var i=0;i<elementsToRemove.length;i++){elementsToRemove[i].parentNode.removeChild(elementsToRemove[i]);}params.printInterception=true;}}// Using @media print on images doesn't get rid of them all, so use brute force
  if(!document.getElementById('printImageCheck').checked){innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/<img\b[^>]*>\s*/ig,'');}else if(/id="breakoutLink"/.test(innerDocument.body.innerHTML)){// Remove any breakout link
  innerDocument.body.innerHTML=innerDocument.body.innerHTML.replace(/<img\b[^>]+id="breakoutLink"[^>]*>\s*/,'');}var sliderVal=document.getElementById('documentZoomSlider').value;sliderVal=~~sliderVal;sliderVal=Math.floor(sliderVal*(Math.max(window.screen.width,window.screen.height)/1440));if(appstate.wikimediaZimLoaded){printStyleInnerHTML+='body { font-size: '+sliderVal+'% !important; } ';printStyleInnerHTML+='}';printOptions.innerHTML=printStyleInnerHTML;}else {innerDocument.body.style.setProperty('font-size',sliderVal+'%','important');}}function downloadBlobUWP(blob,filename,message){// Copy BLOB to downloads folder and launch from there in Edge
  // First create an empty file in the folder
  Windows.Storage.DownloadsFolder.createFileAsync(filename,Windows.Storage.CreationCollisionOption.generateUniqueName).then(function(file){// Open the returned dummy file in order to copy the data into it
  file.openAsync(Windows.Storage.FileAccessMode.readWrite).then(function(output){// Get the InputStream stream from the blob object
  var input=blob.msDetachStream();// Copy the stream from the blob to the File stream
  Windows.Storage.Streams.RandomAccessStream.copyAsync(input,output).then(function(){output.flushAsync().done(function(){input.close();output.close();// Finally, tell the system to open the file if it's not a subtitle file
  if(!/\.(?:ttml|ssa|ass|srt|idx|sub|vtt)$/i.test(filename))Windows.System.Launcher.launchFileAsync(file);if(file.isAvailable){var fileLink=file.path.replace(/\\/g,'/');fileLink=fileLink.replace(/^([^:]+:\/(?:[^/]+\/)*)(.*)/,function(p0,p1,p2){return 'file:///'+p1+encodeURIComponent(p2);});if(message){message.innerHTML='<strong>Download:</strong> Your file was saved as <a href="'+fileLink+'" target="_blank" class="alert-link">'+file.path+'</a>';}// window.open(fileLink, null, "msHideView=no");
  }});});});});}/**
   * Derives the URL.pathname from a relative or semi-relative URL using the given base ZIM URL
   *
   * @param {String} url The (URI-encoded) URL to convert (e.g. "Einstein", "../Einstein",
   *      "../../I/im%C3%A1gen.png", "-/s/style.css", "/A/Einstein.html", "../static/bootstrap/css/bootstrap.min.css")
   * @param {String} base The base ZIM URL of the currently loaded article (e.g. "A/", "A/subdir1/subdir2/", "C/Singapore/")
   * @returns {String} The derived ZIM URL in decoded form (e.g. "A/Einstein", "I/imágen.png", "C/")
   */function deriveZimUrlFromRelativeUrl(url,base){// We use a dummy domain because URL API requires a valid URI
  var dummy='http://d/';var deriveZimUrl=function deriveZimUrl(url,base){if(typeof URL==='function')return new URL(url,base);// IE11 lacks URL API: workaround adapted from https://stackoverflow.com/a/28183162/9727685
  var d=document.implementation.createHTMLDocument('t');// innerHTML required as string contains HTML tags
  d.head.innerHTML='<base href="'+base+'">';var a=d.createElement('a');a.href=url;return {pathname:a.href.replace(dummy,'')};};var zimUrl=deriveZimUrl(url,dummy+base);return decodeURIComponent(zimUrl.pathname.replace(/^\//,''));}/**
   * Inserts a new link element into the document header
   * @param {Element} doc The document to which to attach the new element
   * @param {String} cssContent The content to insert as an inline stylesheet
   * @param {String} id An optional id to add to the style element
   */function insertLinkElement(doc,cssContent,id){var cssElement=document.createElement('style');if(id){cssElement.id=id;}if(cssElement.styleSheet){cssElement.styleSheet.cssText=cssContent;}else {cssElement.appendChild(document.createTextNode(cssContent));}doc.head.appendChild(cssElement);}/**
   * Walk up the DOM tree to find the closest element where the tagname matches the supplied regular expression
   *
   * @param {Element} el The starting DOM element
   * @param {RegExp} rgx A regular expression to match the element's tagname
   * @returns {Element|null} The matching element or null if no match was found
   */function getClosestMatchForTagname(el,rgx){do{if(rgx.test(el.tagName))return el;el=el.parentElement||el.parentNode;}while(el!==null&&el.nodeType===1);return null;}/**
   * Displays a Bootstrap warning alert with information about how to access content in a ZIM with unsupported active UI
   * @param {String} type The ZIM archive type ('open', 'zimit', or 'legacy')
   */function displayActiveContentWarning(type){// We have to add the alert box in code, because Bootstrap removes it completely from the DOM when the user dismisses it
  var alertHTML='';if(params.contentInjectionMode==='jquery'&&type==='open'){alertHTML='<div id="activeContent" class="alert alert-warning alert-dismissible fade in" style="margin-bottom: 0;">'+'<a href="#" id="activeContentClose" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+'<strong>Unable to display active content:</strong> To use <b>Archive Index</b> type a <b><i>space</i></b>, or for <b>URL Index</b> type '+'<b><i>space / </i></b>, or else <a id="swModeLink" href="#contentInjectionModeDiv" class="alert-link">switch to Service Worker mode</a> '+'if your platform supports it. &nbsp;[<a id="stop" href="#expertSettingsDiv" class="alert-link">Permanently hide</a>]'+'</div>';}else if(params.contentInjectionMode==='serviceworker'&&type==='legacy'){alertHTML='<div id="activeContent" class="alert alert-warning alert-dismissible fade in" style="margin-bottom: 0;">'+'<a href="#" id="activeContentClose" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+'<strong>Legacy ZIM type!</strong> To display content correctly from this historical ZIM, '+'please <a id="jqModeLink" href="#contentInjectionModeDiv" class="alert-link">switch to the legacy Restricted mode</a>. '+'You may need to increase font size with zoom buttons at bottom of screen.&nbsp;[<a id="stop" href="#expertSettingsDiv" class="alert-link">Permanently hide</a>]'+'</div>';}else if(type==='zimit'){alertHTML='<div id="activeContent" class="alert alert-warning alert-dismissible fade in" style="margin-bottom: 0;">'+'<a href="#" id="activeContentClose" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+(// '<strong>' + (params.contentInjectionMode === 'jquery' ? 'Limited Zimit' : 'Experimental') + ' support:</strong> ' +
  params.contentInjectionMode==='jquery'?'<b>Limited Zimit support!</b> Please <a id="swModeLink" href="#contentInjectionModeDiv" '+'class="alert-link">switch to Service Worker mode</a> if your platform supports it.<br />':'Legacy support for <b>Zimit classic</b> archives. Audio/video and some dynamic content may fail.<br />')+'Start search with <b>.*</b> to match part of a title, type <b><i>space</i></b> for the ZIM Archive Index, or '+'<b><i>space / </i></b> for the URL Index.&nbsp;[<a id="stop" href="#expertSettingsDiv" class="alert-link">Permanently hide</a>]'+'</div>';}else if(params.contentInjectionMode==='serviceworker'&&(params.manipulateImages||params.displayHiddenBlockElements===true||params.allowHTMLExtraction)){alertHTML='<div id="activeContent" class="alert alert-warning alert-dismissible fade in" style="margin-bottom: 0;">'+'<a href="#" id="activeContentClose" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+'<strong>Active content may not work correctly:</strong> Please '+(params.displayHiddenBlockElements?'<a id="hbeModeLink" href="#displayHiddenBlockElementsDiv" class="alert-link">disable Display hidden block elements</a> ':params.manipulateImages?'<a id="imModeLink" href="#imageManipulationDiv" class="alert-link">disable Image manipulation</a> ':'')+(params.allowHTMLExtraction?(params.displayHiddenBlockElements||params.manipulateImages?'and ':'')+'disable Breakout icon ':'')+'for this content to work properly. To use Archive Index type a <b><i>space</i></b> '+'in the box above, or <b><i>space / </i></b> for URL Index.&nbsp;[<a id="stop" href="#expertSettingsDiv" class="alert-link">Permanently hide</a>]'+'</div>';}else {// There is nothing to display
  return;}var alertBoxHeader=document.getElementById('alertBoxHeader');alertBoxHeader.innerHTML=alertHTML;alertBoxHeader.style.display='block';document.getElementById('activeContentClose').addEventListener('click',function(){hideActiveContentWarning();});['swModeLink','jqModeLink','imModeLink','hbeModeLink','stop'].forEach(function(id){// Define event listeners for both hyperlinks in alert box: these take the user to the Config tab and highlight
  // the options that the user needs to select
  var modeLink=document.getElementById(id);if(modeLink){modeLink.addEventListener('click',function(){var elementID=id==='stop'?'hideActiveContentWarningCheck':id==='swModeLink'?'serviceworkerModeRadio':id==='jqModeLink'?'jQueryModeRadio':id==='imModeLink'?'manipulateImagesCheck':'displayHiddenBlockElementsCheck';var thisLabel=document.getElementById(elementID).parentNode;thisLabel.style.borderColor='red';thisLabel.style.borderStyle='solid';// Make sure the container is visible
  var container=thisLabel.parentNode;if(!/panel-body/.test(container.className)){container=container.parentNode;}container.style.display='block';container.previousElementSibling.innerHTML=container.previousElementSibling.innerHTML.replace(/▶/,'▼');var btnHome=document.getElementById('btnHome');[thisLabel,btnHome].forEach(function(ele){// Define event listeners to cancel the highlighting both on the highlighted element and on the Home tab
  ele.addEventListener('mousedown',function(){thisLabel.style.borderColor='';thisLabel.style.borderStyle='';});});alertBoxHeader.style.display='none';document.getElementById('btnConfigure').click();});}});}/**
   * Hides the active content warning alert box with a fade-out effect
   */function hideActiveContentWarning(){var alertBoxHeader=document.getElementById('alertBoxHeader');if(alertBoxHeader.style.display==='none')return;alertBoxHeader.style.opacity=0;alertBoxHeader.style.maxHeight=0;setTimeout(function(){alertBoxHeader.style.display='none';alertBoxHeader.style.opacity=1;alertBoxHeader.style.maxHeight='';},500);}/**
   * Displays a Bootstrap alert box at the foot of the page to enable saving the content of the given title to the device's filesystem
   * and initiates download/save process if this is supported by the OS or Browser
   *
   * @param {String} title The path and filename to the file to be extracted
   * @param {Boolean|String} download A Bolean value that will trigger download of title, or the filename that should
   *     be used to save the file in local FS
   * @param {String} contentType The mimetype of the downloadable file, if known
   * @param {Uint8Array} content The binary-format content of the downloadable file
   * @param {Boolean} autoDismiss If true, dismiss the alert programmatically
   */function displayFileDownloadAlert(title,download,contentType,content,autoDismiss){// We have to create the alert box in code, because Bootstrap removes it completely from the DOM when the user dismisses it
  document.getElementById('alertBoxFooter').innerHTML='<div id="downloadAlert" class="alert alert-info alert-dismissible">'+'    <a href="#" id="downloaAlertClose" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+'    <span id="alertMessage"></span>'+'</div>';// Download code adapted from https://stackoverflow.com/a/19230668/9727685
  if(!contentType||/application.download/i.test(contentType)){// DEV: Add more contentTypes here for downloadable files
  contentType=/\.epub([?#]|$)/i.test(title)?'application/epub+zip':/\.pdf([?#]|$)/i.test(title)?'application/pdf':/\.zip([?#]|$)/i.test(title)?'application/zip':/\.png([?#]|$)/i.test(title)?'image/png':/\.jpe?g([?#]|$)/i.test(title)?'image/jpeg':/\.webp([?#]|$)/i.test(title)?'image/webp':/\.svg([?#]|$)/i.test(title)?'image/svg+xml':/\.gif([?#]|$)/i.test(title)?'image/gif':/\.tiff([?#]|$)/i.test(title)?'image/tiff':/\.mp4([?#]|$)/i.test(title)?'video/mp4':/\.(webm)([?#]|$)/i.test(title)?'video/webm':/\.mpeg([?#]|$)/i.test(title)?'video/mpeg':/\.mp3([?#]|$)/i.test(title)?'audio/mpeg'// Default contentType if no match:
  :'application/octet-stream';}var a=document.createElement('a');var blob=new Blob([content],{type:contentType});// If the filename to use for saving has not been specified, construct it from title
  var filename=typeof download!=='string'?title.replace(/^.*\/([^\\/?#&]*).*$/,'$1'):download;// If not match was possible from the title, give it a generic name
  if(filename===title||!filename)filename='downloadfile';// Make filename safe
  filename=filename.replace(/[/\\:*?"<>|#&]/g,'_');// If the file doesn't have an extension, add one for compatibility with older browsers
  if(!/\.(epub|pdf|odt|zip|png|jpe?g|webp|svg|gif|tiff|mp4|webm|mpe?g|mp3)([?#]|$)/i.test(filename)){var extension=/epub/i.test(contentType)?'.epub':/pdf/i.test(contentType)?'.pdf':/opendument/i.test(contentType)?'.odt':/\/zip$/i.test(contentType)?'.zip':/png/i.test(contentType)?'.png':/jpeg/i.test(contentType)?'.jpeg':/webp/i.test(contentType)?'.webp':/svg/i.test(contentType)?'.svg':/gif/i.test(contentType)?'.gif':/tiff/i.test(contentType)?'.tiff':/mp4/i.test(contentType)?'.mp4':/webm/i.test(contentType)?'.webm':/mpeg/i.test(contentType)?'.mpeg':/mp3/i.test(contentType)?'.mp3':'';filename=filename.replace(/^(.*?)([#?]|$)/,'$1'+extension);}a.href=window.URL.createObjectURL(blob);a.target='_blank';a.type=contentType;a.download=filename;a.classList.add('alert-link');a.innerHTML=filename;var alertMessage=document.getElementById('alertMessage');alertMessage.innerHTML=download!==false?'<strong>Download</strong> If the download does not start, please tap the following link: ':'<strong>Download</strong> To download the contents, please tap the following link: ';// We have to add the anchor to a UI element for Firefox to be able to click it programmatically: see https://stackoverflow.com/a/27280611/9727685
  alertMessage.appendChild(a);var downloadAlert=document.getElementById('downloadAlert');// For IE11 we need to force use of the saveBlob method with the onclick event
  if(window.navigator&&window.navigator.msSaveBlob){a.addEventListener('click',function(e){window.navigator.msSaveBlob(blob,filename);e.preventDefault();});}document.getElementById('downloaAlertClose').addEventListener('click',function(){downloadAlert.style.display='none';});if(download!==false){try{a.click();// Following line should run only if there was no error, leaving the alert showing in case of error
  if(autoDismiss&&downloadAlert)downloadAlert.style.display='none';return;}catch(err){// Edge will error out unless there is a download added but Chrome works better without the attribute
  a.download=filename;}try{a.click();// Following line should run only if there was no error, leaving the alert showing in case of error
  if(autoDismiss&&downloadAlert)downloadAlert.style.display='none';}catch(err){// And try to launch through UWP download
  if(typeof Windows!=='undefined'&&Windows.Storage){downloadBlobUWP(blob,filename,alertMessage);if(autoDismiss&&downloadAlert)downloadAlert.style.display='none';}else {// Last gasp attempt to open automatically
  window.open(a.href);}}}}/**
   * Initiates XMLHttpRequest
   * Can be used for loading local files; CSP may restrict access to remote files due to CORS
   *
   * @param {URL} url The Uniform Resource Locator to be read
   * @param {String} responseType The response type to return (arraybuffer|blob|document|json|text);
   *     (passing an empty or null string defaults to text)
   * @param {Function} callback The function to call with the result: data, mimetype, and status or error code
   */function XHR(url,responseType,callback){var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(e){if(this.readyState===4){callback(this.response,this.response.type,this.status);}};var err=false;try{xhr.open('GET',url,true);if(responseType)xhr.responseType=responseType;}catch(e){console.log('Exception during GET request: '+e);err=true;}if(!err){xhr.send();}else {callback('Error',null,500);}}/**
   * Inserts a link to break the article out to a new browser tab
   *
   * @param {String} mode The app mode to use for the breakoutLink icon (light|dark)
   */function insertBreakoutLink(mode){var desc='Open article in new tab or window';var iframe=document.getElementById('articleContent').contentDocument;// This code provides an absolute link, removing the file and any query string from href (we need this because of SW mode)
  var prefix=(window.location.protocol+'//'+window.location.host+window.location.pathname).replace(/\/[^/]*$/,'');var div=document.createElement('div');div.style.cssText='top: 10px; right: 25px; position: relative; z-index: 2; float: right;';div.id='openInTab';div.innerHTML='<a href="#"><img id="breakoutLink" src="'+prefix+'/img/icons/'+(mode==='light'?'new_window.svg':'new_window_lb.svg')+'" width="30" height="30" alt="'+desc+'" title="'+desc+'"></a>';iframe.body.insertBefore(div,iframe.body.firstChild);var openInTab=iframe.getElementById('openInTab');openInTab.addEventListener('click',function(e){e.preventDefault();itemsCount=false;params.preloadingAllImages=false;extractHTML();});}/**
   * Extracts self-contained HTML from the iframe DOM, transforming BLOB references to dataURIs
   */function extractHTML(){if(params.preloadingAllImages!==true){params.preloadAllImages();return;}var iframe=document.getElementById('articleContent').contentDocument;// Store the html for the head section, to restore later (in SW mode, stylesheets will be transformed to dataURI links,
  // which only work from file:/// URL, due to CORS, so they have to be restored)
  var headHtml=iframe.head.innerHTML;var title=iframe.title;if(itemsCount===false){// Establish the source items that need to be extracted to self-contained URIs
  // DEV: Add any further sources to the querySelector below
  var items=iframe.querySelectorAll('img[src],link[href][rel="stylesheet"]');itemsCount=items.length;Array.prototype.slice.call(items).forEach(function(item){// Extract the BLOB itself from the URL (even if it's a blob: URL)
  var itemUrl=item.href||item.src;XHR(itemUrl,'blob',function(response,mimetype,status){if(status===500){itemsCount--;return;}// Pure SVG images may be missing the mimetype
  if(!mimetype)mimetype=/\.svg$/i.test(itemUrl)?'image/svg+xml':'';// Now read the data from the extracted blob
  var myReader=new FileReader();myReader.addEventListener('loadend',function(){if(myReader.result){var dataURL=myReader.result.replace(/data:;/,'data:'+mimetype+';');if(item.href){try{item.href=dataURL;}catch(err){}}if(item.src){try{item.src=dataURL;}catch(err){}}}itemsCount--;if(itemsCount===0)extractHTML();});// Start the reading process.
  myReader.readAsDataURL(response);});});}if(itemsCount>0)return;// Ensures function stops if we are still extracting images or css
  // Construct filename (forbidden characters will be removed in the download function)
  var filename=title.replace(/(\.html?)*$/i,'.html');var html=iframe.documentElement.outerHTML;// Remove openInTab div (we can't do this using DOM methods because it aborts code spawned from onclick event)
  html=html.replace(/<div\s(?=[^<]+?openInTab)(?:[^<]|<(?!\/div>))+<\/div>\s*/,'');var blob=new Blob([html],{type:'text/html'});// We can't use window.open() because pop-up blockers block it, so use explicit BLOB download
  displayFileDownloadAlert(title,filename,'text/html',blob,true);// Restore original head section (to restore any transformed stylesheets)
  iframe.head.innerHTML=headHtml;itemsCount=false;params.preloadingAllImages=false;clearSpinner();}/**
   * Displays a Bootstrap alert or confirm dialog box depending on the options provided
   *
   * @param {String} message The alert message(can be formatted using HTML) to display in the body of the modal.
   * @param {String} label The modal's label or title which appears in the header (optional, Default = "Confirmation" or "Message")
   * @param {Boolean} isConfirm If true, the modal will be a confirm dialog box, otherwise it will be a simple alert message
   * @param {String} declineConfirmLabel The text to display on the decline confirmation button (optional, Default = "Cancel")
   * @param {String} approveConfirmLabel  The text to display on the approve confirmation button (optional, Default = "Confirm")
   * @param {String} closeMessageLabel  The text to display on the close alert message button (optional, Default = "Okay")
   * @param {String} alertModal The modal to display (optional)
   * @returns {Promise<Boolean>} A promise which resolves to true if the user clicked Confirm, false if the user clicked Cancel/Okay, backdrop or the cross(x) button
   */function systemAlert(message,label,isConfirm,declineConfirmLabel,approveConfirmLabel,closeMessageLabel,alertModal){alertModal=alertModal||'alertModal';var prfx=alertModal==='myModal'?'my':alertModal==='printModal'?'print':'';declineConfirmLabel=declineConfirmLabel||'Cancel';approveConfirmLabel=approveConfirmLabel||'Confirm';closeMessageLabel=closeMessageLabel||'Okay';label=label||(isConfirm?'Confirmation':'Message');return util.PromiseQueue.enqueue(function(){return new Promise(function(resolve,reject){if(!message)reject(new Error('Missing body message'));// Set the text to the modal and its buttons
  document.getElementById('approveConfirm').textContent=approveConfirmLabel;document.getElementById('declineConfirm').textContent=declineConfirmLabel;document.getElementById('closeMessage').textContent=closeMessageLabel;document.getElementById('modalLabel').textContent=label;// Using innerHTML to set the message to allow HTML formatting
  document.getElementById('modalText').innerHTML=message;// Display buttons acc to the type of alert
  document.getElementById('approveConfirm').style.display=isConfirm?'inline':'none';document.getElementById('declineConfirm').style.display=isConfirm?'inline':'none';document.getElementById('closeMessage').style.display=isConfirm?'none':'inline';// Display the modal
  var modal=document.getElementById(alertModal);var backdrop=document.createElement('div');backdrop.classList.add('modal-backdrop');backdrop.style.opacity='0.3';document.body.appendChild(backdrop);// Show the modal
  document.body.classList.add('modal-open');modal.classList.add('show');modal.style.display='block';backdrop.classList.add('show');// Set the ARIA attributes for the modal
  modal.setAttribute('aria-hidden','false');modal.setAttribute('aria-modal','true');modal.setAttribute('role','dialog');// Get elements to which we will attach event listeners
  var modalCloseBtn=document.getElementById(prfx+'modalCloseBtn');var declineConfirm=document.getElementById(prfx+'declineConfirm');var closeMessage=document.getElementById(prfx+'closeMessage');var approveConfirm=document.getElementById(prfx+'approveConfirm');// Hide modal handlers
  var closeModalHandler=function closeModalHandler(){document.body.classList.remove('modal-open');modal.classList.remove('show');modal.style.display='none';backdrop.classList.remove('show');if(Array.from(document.body.children).indexOf(backdrop)>=0){document.body.removeChild(backdrop);}// remove event listeners
  if(modalCloseBtn)modalCloseBtn.removeEventListener('click',close);if(declineConfirm)declineConfirm.removeEventListener('click',close);if(closeMessage)closeMessage.removeEventListener('click',close);if(approveConfirm)approveConfirm.removeEventListener('click',closeConfirm);modal.removeEventListener('click',close);document.getElementsByClassName('modal-dialog')[0].removeEventListener('click',stopOutsideModalClick);modal.removeEventListener('keyup',keyHandler);};// function to call when modal is closed
  var close=function close(e){// If user clicked on the backdrop, close the modal
  if(e.target.id===alertModal||/close|decline/i.test(e.target.id)){closeModalHandler();resolve(false);}};var closeConfirm=function closeConfirm(){closeModalHandler();resolve(true);};var stopOutsideModalClick=function stopOutsideModalClick(e){e.stopPropagation();};var keyHandler=function keyHandler(e){if(/Enter/.test(e.key)){// We need to focus before clicking the button, because the handler above is based on document.activeElement
  if(isConfirm){approveConfirm.focus();approveConfirm.click();}else {closeMessage.focus();closeMessage.click();}}else if(/Esc/.test(e.key)){modalCloseBtn.focus();modalCloseBtn.click();}};// When hide modal is called, resolve promise with true if hidden using approve button, false otherwise
  if(modalCloseBtn)modalCloseBtn.addEventListener('click',close);if(declineConfirm)declineConfirm.addEventListener('click',close);if(closeMessage)closeMessage.addEventListener('click',close);if(approveConfirm)approveConfirm.addEventListener('click',closeConfirm);modal.addEventListener('click',close);document.getElementsByClassName('modal-dialog')[0].addEventListener('click',stopOutsideModalClick);modal.addEventListener('keyup',keyHandler);// Set focus to the first focusable element inside the modal
  modal.focus();});}).catch(function(err){console.warn(err);});}/**
   * Shows that an upgrade is ready to install
   * @param {String} ver The version of the upgrade
   * @param {String} type Either 'load', 'install', 'download', 'display' or 'progress' according to the type of upgrade
   * @param {String} url An optional download URL
   */function showUpgradeReady(ver,type,url){var alertBoxPersistent=document.getElementById('alertBoxPersistent');alertBoxPersistent.innerHTML='<div id="upgradeAlert" class="alert alert-info alert-dismissible">\n'+'    <a href="#" id="closeUpgradeAlert" class="close" data-dismiss="alert" aria-label="close">&times;</a>\n'+'    <span id="persistentMessage"></span>\n'+'</div>\n';var persistentMessage=document.getElementById('persistentMessage');var reboot=function reboot(){// Disable beforeunload interceptor
  params.interceptBeforeUnload=false;navigator.serviceWorker.controller.postMessage({action:'skipWaiting'});window.location.reload();};if(type==='progress'){persistentMessage.innerHTML='Download in progress: '+ver+'%';}else {var reloadLink=(/load|deploy/.test(type)?', or <a href="#" id="reloadNowLink" style="color:white;text-decoration:underline;">reload now</a>':'')+'.)';persistentMessage.innerHTML='Version '+ver+(url?' is available to '+type+'! Go to <a href="'+url+'" style="color:white;" target="_blank">'+url+'</a>':' is ready to '+type+'! (Re-launch app to '+type+reloadLink);document.getElementById('closeUpgradeAlert').addEventListener('click',function(){alertBoxPersistent.style.display='none';});if(/load|deploy/.test(type)){if(!params.autoUpdatePWA||type==='deploy'){document.getElementById('reloadNowLink').addEventListener('click',function(e){e.preventDefault();reboot();});}else {// If user has allowed auto-update, just reboot
  reboot();}}}}/**
   * Checks if a server is accessible by attempting to load a test image from the server
   *
   * @param {String} imageSrc The full URI of the image
   * @param {any} onSuccess A function to call if the image can be loaded
   * @param {any} onError A function to call if the image cannot be loaded
   */function checkServerIsAccessible(imageSrc,onSuccess,onError){var image=new Image();image.onload=onSuccess;image.onerror=onError;image.src=imageSrc;}/**
   * Checks whether an element is partially or fully inside the current viewport, and adds the rect.top value to element.top
   *
   * @param {Window} area The Window to check
   * @param {Element} el The DOM element for which to check visibility
   * @param {Boolean} fully If true, checks that the entire element is inside the viewport
   * @param {Integer} offset An additional bottom (+) or top (-) margin to include in the search window
   * @returns {Boolean} True if the element is fully or partially inside the current viewport
   */function isElementInView(area,el,fully,offset){offset=offset||0;var rect=el.getBoundingClientRect();el.top=rect.top;// console.log(el.dataset.kiwixurl + ': ' + rect.top);
  if(fully){return rect.top>0+(offset<0?offset:0)&&rect.bottom<area.innerHeight+(offset>0?offset:0)&&rect.left>0&&rect.right<area.innerWidth;}else {return rect.top<area.innerHeight+(offset>0?offset:0)&&rect.bottom>0+(offset<0?offset:0)&&rect.left<area.innerWidth&&rect.right>0;}}/**
   * Initiates pointer touch events on the given element in order to set the zoom level
   *
   * @param {Element} element The element to which the pointer events should be attached
   * @param {Node} container The node to which the pointer events should be applied, if different
   */function initTouchZoom(element,container){container=container||element;// Global vars to cache event state
  appstate.evCache=[];appstate.prevDiff=-1;// Set initial element transforms
  var contentWin=element.ownerDocument.defaultView||element.ownerDocument.parentWindow;container.style.transformOrigin='left top';// DEV: To support RTL languages, this should be 'right top'
  appstate.windowScale=1;appstate.sessionScale=1;appstate.startVector=null;// Install event handlers for the pointer target
  element.onpointerdown=pointerdownHandler;element.onpointermove=function(event){pointermoveHandler(event,container,contentWin);};// Use same handler for pointer{up,cancel,out,leave} events since
  // the semantics for these events - in this app - are the same.
  element.onpointerup=pointerupHandler;element.onpointercancel=pointerupHandler;element.onpointerout=pointerupHandler;element.onpointerleave=pointerupHandler;}function pointerdownHandler(ev){// The pointerdown event signals the start of a touch interaction.
  // This event is cached to support 2-finger gestures
  appstate.evCache.push(ev);// console.debug('pointerDown', ev);
  }function pointermoveHandler(ev,cont,win){// This function implements a 2-pointer horizontal pinch/zoom gesture.
  // console.debug('pointerMove', ev);
  // Find this event in the cache and update its record with this event
  for(var i=0;i<appstate.evCache.length;i++){if(ev.pointerId===appstate.evCache[i].pointerId){appstate.evCache[i]=ev;break;}}// If two pointers are down, check for pinch gestures
  if(appstate.evCache.length===2){ev.preventDefault();// Calculate the distance between the two pointers
  var x0=appstate.evCache[0].clientX;var y0=appstate.evCache[0].clientY;var x1=appstate.evCache[1].clientX;var y1=appstate.evCache[1].clientY;var curDiff=Math.abs(Math.sqrt(Math.pow(x1-x0,2)+Math.pow(y1-y0,2)));// console.debug('Current difference: ' + curDiff);
  if(appstate.prevDiff>0){if(appstate.startVector===null){appstate.startVector=curDiff;appstate.scrollXStart=win.scrollX/appstate.windowScale;appstate.scrollYStart=win.scrollY/appstate.windowScale;// console.debug('scrollXStart: ' + appstate.scrollXStart);
  }appstate.windowScale=appstate.sessionScale*curDiff/appstate.startVector;// console.debug('winScrollY: ' + win.scrollY);
  // console.debug('winScrollX: ' + win.scrollX);
  // console.debug('x0x1 mean: ' + (x0 + x1)/2);
  // console.debug('y0y1 mean: ' + (y0 + y1)/2);
  cont.style.transform='scale('+appstate.windowScale+')';win.scrollTo(appstate.scrollXStart*appstate.windowScale,appstate.scrollYStart*appstate.windowScale);}// Cache the distance for the next move event
  appstate.prevDiff=curDiff;}}function pointerupHandler(ev){// console.debug(ev.type, ev);
  // Remove this pointer from the cache
  removeEvent(ev);// If the number of pointers down is less than two then reset diff tracker
  if(appstate.evCache.length<2){appstate.prevDiff=-1;}}function removeEvent(ev){// Remove this event from the target's cache
  for(var i=0;i<appstate.evCache.length;i++){if(appstate.evCache[i].pointerId===ev.pointerId){appstate.evCache.splice(i,1);break;}}appstate.startVector=null;appstate.sessionScale=appstate.windowScale;}// Reports an error in loading one of the ASM or WASM machines to the UI API Status Panel
  // This can't be done in app.js because the error occurs after the API panel is first displayed
  function reportAssemblerErrorToAPIStatusPanel(decoderType,error,assemblerMachineType){console.error('Could not instantiate any '+decoderType+' decoder!',error);params.decompressorAPI.assemblerMachineType=assemblerMachineType;params.decompressorAPI.errorStatus='Error loading '+decoderType+' decompressor!';var decompAPI=document.getElementById('decompressorAPIStatus');decompAPI.textContent='Decompressor API: '+params.decompressorAPI.errorStatus;decompAPI.className='apiBroken';document.getElementById('apiStatusDiv').className='panel panel-danger';}// Reports the search provider to the API Status Panel
  function reportSearchProviderToAPIStatusPanel(provider){var providerAPI=document.getElementById('searchProviderStatus');if(providerAPI){// NB we need this so that tests don't fail
  providerAPI.textContent='Search Provider: '+(/^fulltext/.test(provider)?'Title + Xapian ['+provider+']':/^title/.test(provider)?'Title only ['+provider+']':'Not initialized');providerAPI.className=/^fulltext/.test(provider)?'apiAvailable':!/ERROR/.test(provider)?'apiUnavailable':'apiBroken';}}/**
   * Warn the user that they clicked on an external link, and open it in a new tab
   *
   * @param {Event} event The click event to handle (optional, but if not provided, clickedAnchor must be provided)
   * @param {Element} clickedAnchor The DOM anchor that has been clicked (optional, defaults to event.target)
   * @param {String} message The message to display to the user (optional, defaults to a generic message)
   */function warnAndOpenExternalLinkInNewTab(event,clickedAnchor,message){if(event){// We have to prevent any blank target from firing on the original event
  event.target.removeAttribute('target');event.preventDefault();event.stopPropagation();}if(!clickedAnchor)clickedAnchor=event.target;if(articleContainer$2.contentWindow&&clickedAnchor.origin===articleContainer$2.contentWindow.location.origin){clickedAnchor.href=clickedAnchor.href.replace(clickedAnchor.origin,appstate.selectedArchive.source.replace(/\/$/,''));}var href=clickedAnchor.protocol?clickedAnchor.href:'http://'+clickedAnchor.href;// @WORKAROUND: Note that for Zimit2 ZIMs (only), any querystring in an external link will be overencoded.
  // See https://github.com/kiwix/kiwix-js/issues/1258. DEV: Monitor this issue, and remove the workaround if it is fixed upstream.
  if(params.zimType==='zimit2'){href=decodeURIComponent(href);}clickedAnchor.type=clickedAnchor.type||(/https:\/\/www.openstreetmap.*?mlat/.test(href)?'map':'link');message=message||'<p>Click the link to open this external '+clickedAnchor.type+' (in a new '+params.windowOpener+')';var anchor='<a id="kiwixExternalLink" href="'+href+'" style="word-break:break-all;">'+href+'</a>';message+=':</p><p>'+anchor+'</p><p>You may change whether links open in a window or a new browser tab in Configuration.</p>';var opener=function opener(ev){try{window.open(href,params.windowOpener==='tab'?'_blank':ev?ev.target.title:'Download',params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);if(ev)ev.preventDefault();}catch(e){if(!ev)systemAlert('We could not open this link programmatically! Please turn on "Warn before opening external links" in Configuration (under "Control of browsing data") and try again.');else ev.target.target='_blank';}};if(params.openExternalLinksInNewTabs){systemAlert(message,'Opening external '+clickedAnchor.type,false,null,null,'Close');// Close dialog box if user clicks the link
  document.getElementById('kiwixExternalLink').addEventListener('click',function(e){opener(e);document.getElementById('closeMessage').click();});}else {opener();}}/**
   * Set up toggles to make Configuration headings collapsible
   */function setupConfigurationToggles(){var configHeadings=document.querySelectorAll('.panel-heading');Array.prototype.slice.call(configHeadings).forEach(function(panelHeading){var headingText=panelHeading.innerHTML;var panelBody=panelHeading.nextElementSibling;var panelParent=panelHeading.parentElement;var panelPrevious=panelParent?panelParent.previousElementSibling:null;if(panelPrevious&&!/panel\s/.test(panelPrevious.className))panelPrevious=null;var panelPreviousHeading=panelPrevious?panelPrevious.querySelector('.panel-heading'):null;var panelNext=panelParent?panelParent.nextElementSibling:null;if(panelNext&&!/panel\s/.test(panelNext.className))panelPrevious=null;var panelNextHeading=panelNext?panelNext.querySelector('.panel-heading'):null;panelHeading.addEventListener('click',function(){if(/▶/.test(panelHeading.innerHTML)){panelHeading.innerHTML=panelHeading.innerHTML.replace(/([▼▶]\s)?/,'▼ ');panelBody.style.display='block';// We're opening, so separate from previous and next
  if(panelPrevious)panelPrevious.style.marginBottom=null;if(panelParent)panelParent.style.marginBottom=panelNext?null:0;// Close all other panels
  Array.prototype.slice.call(configHeadings).forEach(function(head){var text=head.innerHTML;if(/▶/.test(text))return;// Don't close panel for certain cases
  if(panelHeading===head||/API\sStatus/.test(text+headingText)||!params.appCache&&/Troubleshooting/.test(text))return;head.click();});}else {panelHeading.innerHTML=panelHeading.innerHTML.replace(/([▼▶]\s)?/,'▶ ');panelBody.style.display='none';if(panelPrevious)panelPrevious.style.marginBottom=panelPreviousHeading&&/▼/.test(panelPreviousHeading.innerHTML)?null:0;if(panelNext)panelParent.style.marginBottom=panelNextHeading&&/▼/.test(panelNextHeading.innerHTML)?null:0;}});// Close each heading to begin with, except the first and specials
  var exceptionTest=function exceptionTest(testStr){return /Display\ssize|API\sStatus/i.test(testStr)||/Troubleshooting/i.test(testStr)&&!params.appCache;};if(panelNext)panelNextHeading.innerHTML=(exceptionTest(panelNextHeading.innerHTML)?'&#9660; ':'&#9654; ')+panelNextHeading.innerHTML;var icon=exceptionTest(headingText)?'▼ ':'▶ ';panelHeading.innerHTML=panelHeading.innerHTML.replace(/([▼▶]\s)?/,icon);if(panelBody&&!exceptionTest(headingText))panelBody.style.display='none';var marginBottom=0;marginBottom=/▼/.test(panelHeading.innerHTML)?null:marginBottom;if(panelNext)panelParent.style.marginBottom=/▼/.test(panelNextHeading.innerHTML)?null:marginBottom;else panelParent.style.marginBottom=0;});// Programme the button to toggle all settings
  document.getElementById('btnToggleSettings').addEventListener('mousedown',function(e){e.preventDefault();var open=/Open/.test(e.target.innerHTML);Array.prototype.slice.call(configHeadings).forEach(function(panelHeading){if(!open&&/API\sStatus/.test(panelHeading.innerHTML))return;if(!open&&/▼\sTroubleshooting/.test(panelHeading.innerHTML)){panelHeading.click();return;}var panelBody=panelHeading.nextElementSibling;panelHeading.innerHTML=open?panelHeading.innerHTML.replace(/▶/,'▼'):panelHeading.innerHTML.replace(/▼/,'▶');panelBody.style.display=open?'block':'none';var panelParent=panelHeading.parentElement;if(panelParent)panelParent.style.marginBottom=open?null:0;});if(open)e.target.innerHTML=e.target.innerHTML.replace(/▶\sOpen/,'▼ Close');else e.target.innerHTML=e.target.innerHTML.replace(/▼\sClose/,'▶ Open');});}/**
   * A function to test whether the app is in full-screen mode
   * @returns {Boolean} True if the app is in full-screen mode, false otherwise
   */function appIsFullScreen(){return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);}/**
   * Puts the requested element into full-screen mode, or cancels full-screen mode if no element is provided
   * @param {Element} el The element to put into full-screen mode. If not provided, the function will cancel any full-screen mode
   * @returns {Promise<Boolean>} A Promise that resolves to true if the element entered full-screen mode, false if full-screen mode cancelled
   */function requestOrCancelFullScreen(el){// Don't do anything if already in full-screen mode, and user has not requested to exit full-screen mode
  if(el&&appIsFullScreen()){console.debug('Display is already full screen');return Promise.resolve(true);}// Choose the correct method to request or cancel full-screen mode
  var rq=function rq(sel){var fn=sel// Request full-screen mode
  ?sel.requestFullscreen?sel.requestFullscreen():sel.webkitRequestFullscreen?sel.webkitRequestFullscreen():sel.mozRequestFullScreen?sel.mozRequestFullScreen():sel.msRequestFullscreen?sel.msRequestFullscreen():Promise.reject(new Error('No full-screen mode API available'))// Cancel full-screen mode
  :document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.reject(new Error('No full-screen mode API available'));return Promise.resolve(fn);};return rq(el).then(function(){console.log(el?'Full-screen mode enabled':'Full-screen mode disabled');return !!el;}).catch(function(err){console.log('Error enabling full-screen mode',err);throw err;});}/**
   * Attempts to put the app into full-screen mode and (if requested) lock the display orientation using the Screen Orientation Lock API
   * @param {string} val A valid value in the API, e.g. '', 'natural', 'portrait', 'landscape'
   * @returns {Promise<String>} A Promise that resolves to a string informing the result (which may be '')
   */function lockDisplayOrientation(val){if(val){// Request setting the app to full-screen mode
  return requestOrCancelFullScreen(document.documentElement).then(function(){// If the app is now in full-screen mode, lock the display orientation);
  if(val!=='fullscreen'){if(screen&&screen.orientation&&screen.orientation.lock){if(val){return screen.orientation.lock(val).then(function(){console.log('Display orientation locked to '+val);}).catch(function(error){console.warn('Error locking display orientation (but in some contexts, it may have worked anyway)',error);throw error;});}else {screen.orientation.unlock();// NB This doesn't return a Promise
  // return Promise.resolve();
  }}else {console.warn('The screen.orientation.lock API is not supported on this device!');var rtn=val?'unsupported':'';return rtn;// return Promise.resolve(rtn);
  }}else {if(!document.documentElement.requestFullscreen&&(document.documentElement.webkitRequestFullscreen||document.documentElement.msRequestFullscreen)){// We are in a Safari browser or IE11, and a click is required to enter full-screen mode
  return 'click';}}}).catch(function(error){throw error;});}else {// User wants to cancel full-screen mode and unlock the display orientation
  if(screen&&screen.orientation&&screen.orientation.unlock){screen.orientation.unlock();// NB This doesn't return a Promise
  }return requestOrCancelFullScreen();}}/**
   * Finds the closest <a> or <area> enclosing tag of an element.
   * Returns undefined if there isn't any.
   *
   * @param {Element} element The element to test
   * @returns {Element} closest enclosing anchor tag (if any)
   */function closestAnchorEnclosingElement(element){if(Element.prototype.closest){// Recent browsers support that natively. See https://developer.mozilla.org/en-US/docs/Web/API/Element/closest
  return element.closest('a,area');}else {// For other browsers, notably IE, we do that by hand (we did not manage to make polyfills work on IE11)
  var currentElement=element;while(currentElement.tagName!=='A'&&currentElement.tagName!=='AREA'){// If there is no parent Element, we did not find any enclosing A tag
  if(!currentElement.parentElement){return;}else {// Else we try the next parent Element
  currentElement=currentElement.parentElement;}}// If we reach this line, it means the currentElement is the enclosing Anchor we're looking for
  return currentElement;}}/**
   * Handles the click on the title of an article in search results
   * @param {Event} event The click event to handle
   * @param {Function} findDirEntryCallback Callback to find and launch article
   */function handleTitleClick$1(event,findDirEntryCallback){event.preventDefault();// User may have clicked on a child element of the list item if it contains HTML (for example, italics),
  // so we may need to find the closest list item
  var target=event.target;if(!/list-group-item/.test(target.className)){console.warn('User clicked on child element of list item, looking for parent...');while(target&&!/list-group-item/.test(target.className)){target=target.parentNode;}if(!target){// No list item found, so we can't do anything
  console.warn('No list item could be found for clicked event!');return;}}var dirEntryId=decodeURIComponent(target.getAttribute('dirEntryId'));findDirEntryCallback(dirEntryId);}/**
   * Creates and inserts snippet elements for search results
   * @param {Array} entriesArray Array of directory entries
   * @param {NodeList} links The article link elements
   * @param {Number} length Number of items to process
   */function createSnippetElements(entriesArray,links,length){for(var i=0;i<length;i++){var dirEntry=entriesArray[i];// Add snippet if it exists
  if(dirEntry.snippet&&links[i]){var snippetId='snippet-'+i;// Create snippet container
  var snippetContainer=document.createElement('div');snippetContainer.className='snippet-container';snippetContainer.tabIndex=0;// Make it focusable to help with keyboard hiding
  // Create and populate snippet header
  var snippetHeader=document.createElement('div');snippetHeader.className='snippet-header';snippetHeader.tabIndex=0;snippetHeader.setAttribute('data-target',snippetId);snippetHeader.setAttribute('aria-expanded','false');var indicator=document.createElement('span');indicator.className='snippet-indicator';indicator.textContent='▶';var preview=document.createElement('span');preview.className='snippet-preview';preview.innerHTML=dirEntry.snippet.substring(0,80)+'...';snippetHeader.appendChild(indicator);snippetHeader.appendChild(preview);// Create snippet content
  var content=document.createElement('div');content.id=snippetId;content.className='snippet-content collapsed';content.innerHTML=dirEntry.snippet;// Assemble and insert
  snippetContainer.appendChild(snippetHeader);snippetContainer.appendChild(content);// Insert after the article link
  links[i].parentNode.insertBefore(snippetContainer,links[i].nextSibling);}}}/**
   * Expands or collapses fulltext search snippet content when the header is selected
   * @param {Element} ele The container element that was selected
   * @param {Event} ev The event to handle or null if called programmatically
  */function toggleSnippet(ele,ev){if(ev){ev.preventDefault();ev.stopPropagation();// Prevent triggering the article link
  // Set a flag to indicate that a snippet was just interacted with
  // This prevents the search results from being hidden by the blur event
  appstate.snippetInteractionFlag=true;}var header=ele.children[0];// Snippet header
  var content=ele.children[1];// Snippet content
  var isExpanded=header.getAttribute('aria-expanded')==='true';if(isExpanded){// Collapse
  content.classList.add('collapsed');header.setAttribute('aria-expanded','false');}else {// Expand
  content.classList.remove('collapsed');header.setAttribute('aria-expanded','true');}}/**
   * Attaches event listeners to article list and snippet container elements
   * @param {Function} findDirEntryCallback Function to find and launch article by dirEntryId
   * @param {Object} appstate App state object containing search status
   */function attachArticleListEventListeners(findDirEntryCallback,appstate){// We have to use mousedown below instead of click as otherwise the prefix blur event fires first
  // and prevents this event from firing; note that touch also triggers mousedown
  document.querySelectorAll('#articleList a, .snippet-container').forEach(function(element){element.addEventListener('mousedown',function(e){if(element.classList.contains('snippet-container')){// Set a flag to prevent hover behavior immediately after manual interaction
  element.dataset.manuallyInteracted='true';// Clear the flag after a short delay
  setTimeout(function(){delete element.dataset.manuallyInteracted;},500);// Prevents Android keyboard from popping up and covering the article list
  element.focus();// Handle snippet toggle
  toggleSnippet(element,e);}else {// Handle article link
  appstate.search.status='cancelled';handleTitleClick$1(e,findDirEntryCallback);}});// Add hover functionality for snippet containers with delay
  if(element.classList.contains('snippet-container')){var hoverTimeout;element.addEventListener('mouseenter',function(){// Skip hover behavior if user just manually interacted
  if(element.dataset.manuallyInteracted==='true'){return;}// Clear any existing timeout
  if(hoverTimeout){clearTimeout(hoverTimeout);}// Set a delay before expanding (e.g., 400ms)
  hoverTimeout=setTimeout(function(){// Only toggle if the element is not expanded
  if(element.children[1]&&element.children[1].classList.contains('collapsed')){// Check if the element has already been manually interacted with
  if(element.dataset.manuallyInteracted)return;// Expand the snippet
  toggleSnippet(element,null);}},400);});element.addEventListener('mouseleave',function(){// Clear the timeout if user leaves before delay completes
  if(hoverTimeout){clearTimeout(hoverTimeout);hoverTimeout=null;}// Safety check: ensure the element still has the expected children
  // if (element.children.length < 2) return;
  // Always collapse on mouse leave
  // var header = element.children[0];
  // var content = element.children[1];
  // content.classList.add('collapsed');
  // header.setAttribute('aria-expanded', 'false');
  });}});}/**
   * Use intelligent search-size calculation based on app type and environment. This is because fulltext search with snippets
   * is slower than basic fulltext search, and excruciatingly slow on Android if not using the OPFS
   */function dynamicallySetMaxSearchResults(){if(!settingsStore$1.hasItem('maxSearchResultsSize')){if(params.libzimSearchType==='search'){// If the user has set the search type to basic search, we can use a larger number of results
  params.maxSearchResultsSize=25;}if(/Android/.test(params.appType)){if(params.useOPFS){// Android with OPFS can handle more results: 15 with snippets, 20 with basic search
  params.maxSearchResultsSize=params.libzimSearchType==='search'?20:15;}else {// Android without OPFS needs restricted results and basic search
  params.maxSearchResultsSize=10;params.libzimSearchType=settingsStore$1.getItem('libzimSearchType')||'search';}}}// Set UI state for maxSearchResultsSize and libzimSearchType
  document.getElementById('titleSearchRange').value=params.maxSearchResultsSize;document.getElementById('titleSearchRangeVal').innerHTML=params.maxSearchResultsSize;document.getElementById('libzimSearchType').checked=params.libzimSearchType==='searchWithSnippets';}function setExpressServerUI(port,ipaddress){// See main.cjs for default values
  params.expressIPaddress=ipaddress||'localhost';document.getElementById('expressPortInput').value=port;document.getElementById('expressPortInputDiv').style.display='block';// Only encourage opening in browser if we are not in a packaged app
  if(!params.packagedFile){var openAppInBrowserSpan=document.getElementById('openAppInBrowserSpan');openAppInBrowserSpan.style.display='inline';var openAppInBrowserLinksDiv=document.getElementById('openAppInBrowserLinks');// Clear existing links
  openAppInBrowserLinksDiv.innerHTML='';var localhostURI='http://localhost:'+port;var lanURI;console.log('Local URI: '+localhostURI);// Create LAN span
  var localhostSpan=document.createElement('span');localhostSpan.innerHTML='<a href="'+localhostURI+'">'+localhostURI+'</a> (from this PC)';localhostSpan.addEventListener('click',function(e){e.preventDefault();electronAPI.openExternal(localhostURI+'/www/index.html');});openAppInBrowserLinksDiv.appendChild(localhostSpan);if(ipaddress&&ipaddress!=='localhost'){// External access enabled - show both localhost and LAN address
  lanURI='http://'+ipaddress+':'+port;console.log('LAN URI: '+lanURI);// Create localhost link
  var lanSpan=document.createElement('span');lanSpan.innerHTML='<a href="'+lanURI+'">'+lanURI+'</a> (from other device)';lanSpan.addEventListener('click',function(e){e.preventDefault();electronAPI.openExternal(lanURI+'/www/index.html');});openAppInBrowserLinksDiv.appendChild(localhostSpan);openAppInBrowserLinksDiv.appendChild(document.createElement('br'));openAppInBrowserLinksDiv.appendChild(lanSpan);}}}/**
   * Functions and classes exposed by this module
   */var uiUtil = {hideSlidingUIElements:hideSlidingUIElements,showSlidingUIElements:showSlidingUIElements,scroller:scroller,systemAlert:systemAlert,showUpgradeReady:showUpgradeReady,feedNodeWithBlob:feedNodeWithBlob,getDataUriFromUint8Array:getDataUriFromUint8Array,deriveZimUrlFromRelativeUrl:deriveZimUrlFromRelativeUrl,insertLinkElement:insertLinkElement,getClosestMatchForTagname:getClosestMatchForTagname,removeUrlParameters:removeUrlParameters,ToC:TableOfContents,isElementInView:isElementInView,makeReturnLink:makeReturnLink,pollOpsPanel:pollOpsPanel,pollSpinner:pollSpinner,clearSpinner:clearSpinner,XHR:XHR,printCustomElements:printCustomElements,downloadBlobUWP:downloadBlobUWP,displayActiveContentWarning:displayActiveContentWarning,hideActiveContentWarning:hideActiveContentWarning,displayFileDownloadAlert:displayFileDownloadAlert,insertBreakoutLink:insertBreakoutLink,extractHTML:extractHTML,checkServerIsAccessible:checkServerIsAccessible,initTouchZoom:initTouchZoom,appIsFullScreen:appIsFullScreen,lockDisplayOrientation:lockDisplayOrientation,reportAssemblerErrorToAPIStatusPanel:reportAssemblerErrorToAPIStatusPanel,reportSearchProviderToAPIStatusPanel:reportSearchProviderToAPIStatusPanel,warnAndOpenExternalLinkInNewTab:warnAndOpenExternalLinkInNewTab,setupConfigurationToggles:setupConfigurationToggles,closestAnchorEnclosingElement:closestAnchorEnclosingElement,handleTitleClick:handleTitleClick$1,createSnippetElements:createSnippetElements,toggleSnippet:toggleSnippet,attachArticleListEventListeners:attachArticleListEventListeners,dynamicallySetMaxSearchResults:dynamicallySetMaxSearchResults,setExpressServerUI:setExpressServerUI};

  var $$f = _export;
  var copyWithin = arrayCopyWithin;
  var addToUnscopables = addToUnscopables$3;

  // `Array.prototype.copyWithin` method
  // https://tc39.es/ecma262/#sec-array.prototype.copywithin
  $$f({ target: 'Array', proto: true }, {
    copyWithin: copyWithin
  });

  // https://tc39.es/ecma262/#sec-array.prototype-@@unscopables
  addToUnscopables('copyWithin');

  var $$e = _export;

  var floor = Math.floor;
  var log = Math.log;
  var LOG2E = Math.LOG2E;

  // `Math.clz32` method
  // https://tc39.es/ecma262/#sec-math.clz32
  $$e({ target: 'Math', stat: true }, {
    clz32: function clz32(x) {
      var n = x >>> 0;
      return n ? 31 - floor(log(n + 0.5) * LOG2E) : 32;
    }
  });

  // `Math.sign` method implementation
  // https://tc39.es/ecma262/#sec-math.sign
  // eslint-disable-next-line es/no-math-sign -- safe
  var mathSign = Math.sign || function sign(x) {
    var n = +x;
    // eslint-disable-next-line no-self-compare -- NaN check
    return n == 0 || n != n ? n : n < 0 ? -1 : 1;
  };

  var sign = mathSign;

  var abs = Math.abs;
  var pow = Math.pow;
  var EPSILON = pow(2, -52);
  var EPSILON32 = pow(2, -23);
  var MAX32 = pow(2, 127) * (2 - EPSILON32);
  var MIN32 = pow(2, -126);

  var roundTiesToEven = function (n) {
    return n + 1 / EPSILON - 1 / EPSILON;
  };

  // `Math.fround` method implementation
  // https://tc39.es/ecma262/#sec-math.fround
  // eslint-disable-next-line es/no-math-fround -- safe
  var mathFround = Math.fround || function fround(x) {
    var n = +x;
    var $abs = abs(n);
    var $sign = sign(n);
    var a, result;
    if ($abs < MIN32) return $sign * roundTiesToEven($abs / MIN32 / EPSILON32) * MIN32 * EPSILON32;
    a = (1 + EPSILON32 / EPSILON) * $abs;
    result = a - (a - $abs);
    // eslint-disable-next-line no-self-compare -- NaN check
    if (result > MAX32 || result != result) return $sign * Infinity;
    return $sign * result;
  };

  var $$d = _export;
  var fround = mathFround;

  // `Math.fround` method
  // https://tc39.es/ecma262/#sec-math.fround
  $$d({ target: 'Math', stat: true }, { fround: fround });

  var $$c = _export;
  var fails$4 = fails$V;

  // eslint-disable-next-line es/no-math-imul -- required for testing
  var $imul = Math.imul;

  var FORCED = fails$4(function () {
    return $imul(0xFFFFFFFF, 5) != -5 || $imul.length != 2;
  });

  // `Math.imul` method
  // https://tc39.es/ecma262/#sec-math.imul
  // some WebKit versions fails with big numbers, some has wrong arity
  $$c({ target: 'Math', stat: true, forced: FORCED }, {
    imul: function imul(x, y) {
      var UINT16 = 0xFFFF;
      var xn = +x;
      var yn = +y;
      var xl = UINT16 & xn;
      var yl = UINT16 & yn;
      return 0 | xl * yl + ((UINT16 & xn >>> 16) * yl + xl * (UINT16 & yn >>> 16) << 16 >>> 0);
    }
  });

  var $$b = _export;
  var trunc = mathTrunc;

  // `Math.trunc` method
  // https://tc39.es/ecma262/#sec-math.trunc
  $$b({ target: 'Math', stat: true }, {
    trunc: trunc
  });

  var createTypedArrayConstructor$5 = typedArrayConstructorExports;

  // `Float32Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$5('Float32', function (init) {
    return function Float32Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var createTypedArrayConstructor$4 = typedArrayConstructorExports;

  // `Float64Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$4('Float64', function (init) {
    return function Float64Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var createTypedArrayConstructor$3 = typedArrayConstructorExports;

  // `Int16Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$3('Int16', function (init) {
    return function Int16Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var createTypedArrayConstructor$2 = typedArrayConstructorExports;

  // `Int32Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$2('Int32', function (init) {
    return function Int32Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var createTypedArrayConstructor$1 = typedArrayConstructorExports;

  // `Uint16Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor$1('Uint16', function (init) {
    return function Uint16Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var createTypedArrayConstructor = typedArrayConstructorExports;

  // `Uint32Array` constructor
  // https://tc39.es/ecma262/#sec-typedarray-objects
  createTypedArrayConstructor('Uint32', function (init) {
    return function Uint32Array(data, byteOffset, length) {
      return init(this, data, byteOffset, length);
    };
  });

  var itoc = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
  var ctoi$1 = {};

  for (var index = 0; index < 66; index++) ctoi$1[itoc.charAt(index)] = index;

  var base64Map = {
    ctoi: ctoi$1
  };

  var $$a = _export;
  var global$5 = global$Q;
  var getBuiltIn$3 = getBuiltIn$f;
  var uncurryThis$2 = functionUncurryThis;
  var call$1 = functionCall;
  var fails$3 = fails$V;
  var toString = toString$n;
  var hasOwn$2 = hasOwnProperty_1;
  var validateArgumentsLength$1 = validateArgumentsLength$5;
  var ctoi = base64Map.ctoi;

  var disallowed = /[^\d+/a-z]/i;
  var whitespaces$1 = /[\t\n\f\r ]+/g;
  var finalEq = /[=]{1,2}$/;

  var $atob = getBuiltIn$3('atob');
  var fromCharCode = String.fromCharCode;
  var charAt = uncurryThis$2(''.charAt);
  var replace = uncurryThis$2(''.replace);
  var exec = uncurryThis$2(disallowed.exec);

  var NO_SPACES_IGNORE = fails$3(function () {
    return $atob(' ') !== '';
  });

  var NO_ENCODING_CHECK = !fails$3(function () {
    $atob('a');
  });

  var NO_ARG_RECEIVING_CHECK = !NO_SPACES_IGNORE && !NO_ENCODING_CHECK && !fails$3(function () {
    $atob();
  });

  var WRONG_ARITY = !NO_SPACES_IGNORE && !NO_ENCODING_CHECK && $atob.length !== 1;

  // `atob` method
  // https://html.spec.whatwg.org/multipage/webappapis.html#dom-atob
  $$a({ global: true, bind: true, enumerable: true, forced: NO_SPACES_IGNORE || NO_ENCODING_CHECK || NO_ARG_RECEIVING_CHECK || WRONG_ARITY }, {
    atob: function atob(data) {
      validateArgumentsLength$1(arguments.length, 1);
      // `webpack` dev server bug on IE global methods - use call(fn, global, ...)
      if (NO_ARG_RECEIVING_CHECK || WRONG_ARITY) return call$1($atob, global$5, data);
      var string = replace(toString(data), whitespaces$1, '');
      var output = '';
      var position = 0;
      var bc = 0;
      var chr, bs;
      if (string.length % 4 == 0) {
        string = replace(string, finalEq, '');
      }
      if (string.length % 4 == 1 || exec(disallowed, string)) {
        throw new (getBuiltIn$3('DOMException'))('The string is not correctly encoded', 'InvalidCharacterError');
      }
      while (chr = charAt(string, position++)) {
        if (hasOwn$2(ctoi, chr)) {
          bs = bc % 4 ? bs * 64 + ctoi[chr] : ctoi[chr];
          if (bc++ % 4) output += fromCharCode(255 & bs >> (-2 * bc & 6));
        }
      } return output;
    }
  });

  var IS_NODE = engineIsNode;

  var tryNodeRequire$1 = function (name) {
    try {
      // eslint-disable-next-line no-new-func -- safe
      if (IS_NODE) return Function('return require("' + name + '")')();
    } catch (error) { /* empty */ }
  };

  var DESCRIPTORS$3 = descriptors;
  var fails$2 = fails$V;
  var anObject$3 = anObject$s;
  var create$1 = objectCreate;
  var normalizeStringArgument$2 = normalizeStringArgument$4;

  var nativeErrorToString = Error.prototype.toString;

  var INCORRECT_TO_STRING$1 = fails$2(function () {
    if (DESCRIPTORS$3) {
      // Chrome 32- incorrectly call accessor
      // eslint-disable-next-line es/no-object-defineproperty -- safe
      var object = create$1(Object.defineProperty({}, 'name', { get: function () {
        return this === object;
      } }));
      if (nativeErrorToString.call(object) !== 'true') return true;
    }
    // FF10- does not properly handle non-strings
    return nativeErrorToString.call({ message: 1, name: 2 }) !== '2: 1'
      // IE8 does not properly handle defaults
      || nativeErrorToString.call({}) !== 'Error';
  });

  var errorToString$1 = INCORRECT_TO_STRING$1 ? function toString() {
    var O = anObject$3(this);
    var name = normalizeStringArgument$2(O.name, 'Error');
    var message = normalizeStringArgument$2(O.message);
    return !name ? message : !message ? name : name + ': ' + message;
  } : nativeErrorToString;

  var domExceptionConstants = {
    IndexSizeError: { s: 'INDEX_SIZE_ERR', c: 1, m: 1 },
    DOMStringSizeError: { s: 'DOMSTRING_SIZE_ERR', c: 2, m: 0 },
    HierarchyRequestError: { s: 'HIERARCHY_REQUEST_ERR', c: 3, m: 1 },
    WrongDocumentError: { s: 'WRONG_DOCUMENT_ERR', c: 4, m: 1 },
    InvalidCharacterError: { s: 'INVALID_CHARACTER_ERR', c: 5, m: 1 },
    NoDataAllowedError: { s: 'NO_DATA_ALLOWED_ERR', c: 6, m: 0 },
    NoModificationAllowedError: { s: 'NO_MODIFICATION_ALLOWED_ERR', c: 7, m: 1 },
    NotFoundError: { s: 'NOT_FOUND_ERR', c: 8, m: 1 },
    NotSupportedError: { s: 'NOT_SUPPORTED_ERR', c: 9, m: 1 },
    InUseAttributeError: { s: 'INUSE_ATTRIBUTE_ERR', c: 10, m: 1 },
    InvalidStateError: { s: 'INVALID_STATE_ERR', c: 11, m: 1 },
    SyntaxError: { s: 'SYNTAX_ERR', c: 12, m: 1 },
    InvalidModificationError: { s: 'INVALID_MODIFICATION_ERR', c: 13, m: 1 },
    NamespaceError: { s: 'NAMESPACE_ERR', c: 14, m: 1 },
    InvalidAccessError: { s: 'INVALID_ACCESS_ERR', c: 15, m: 1 },
    ValidationError: { s: 'VALIDATION_ERR', c: 16, m: 0 },
    TypeMismatchError: { s: 'TYPE_MISMATCH_ERR', c: 17, m: 1 },
    SecurityError: { s: 'SECURITY_ERR', c: 18, m: 1 },
    NetworkError: { s: 'NETWORK_ERR', c: 19, m: 1 },
    AbortError: { s: 'ABORT_ERR', c: 20, m: 1 },
    URLMismatchError: { s: 'URL_MISMATCH_ERR', c: 21, m: 1 },
    QuotaExceededError: { s: 'QUOTA_EXCEEDED_ERR', c: 22, m: 1 },
    TimeoutError: { s: 'TIMEOUT_ERR', c: 23, m: 1 },
    InvalidNodeTypeError: { s: 'INVALID_NODE_TYPE_ERR', c: 24, m: 1 },
    DataCloneError: { s: 'DATA_CLONE_ERR', c: 25, m: 1 }
  };

  var $$9 = _export;
  var tryNodeRequire = tryNodeRequire$1;
  var getBuiltIn$2 = getBuiltIn$f;
  var fails$1 = fails$V;
  var create = objectCreate;
  var createPropertyDescriptor$1 = createPropertyDescriptor$a;
  var defineProperty$1 = objectDefineProperty.f;
  var defineBuiltIn = defineBuiltIn$h;
  var defineBuiltInAccessor = defineBuiltInAccessor$g;
  var hasOwn$1 = hasOwnProperty_1;
  var anInstance$1 = anInstance$a;
  var anObject$2 = anObject$s;
  var errorToString = errorToString$1;
  var normalizeStringArgument$1 = normalizeStringArgument$4;
  var DOMExceptionConstants$1 = domExceptionConstants;
  var clearErrorStack$1 = errorStackClear;
  var InternalStateModule = internalState;
  var DESCRIPTORS$2 = descriptors;

  var DOM_EXCEPTION$2 = 'DOMException';
  var DATA_CLONE_ERR = 'DATA_CLONE_ERR';
  var Error$2 = getBuiltIn$2('Error');
  // NodeJS < 17.0 does not expose `DOMException` to global
  var NativeDOMException$1 = getBuiltIn$2(DOM_EXCEPTION$2) || (function () {
    try {
      // NodeJS < 15.0 does not expose `MessageChannel` to global
      var MessageChannel = getBuiltIn$2('MessageChannel') || tryNodeRequire('worker_threads').MessageChannel;
      // eslint-disable-next-line es/no-weak-map, unicorn/require-post-message-target-origin -- safe
      new MessageChannel().port1.postMessage(new WeakMap());
    } catch (error) {
      if (error.name == DATA_CLONE_ERR && error.code == 25) return error.constructor;
    }
  })();
  var NativeDOMExceptionPrototype = NativeDOMException$1 && NativeDOMException$1.prototype;
  var ErrorPrototype = Error$2.prototype;
  var setInternalState = InternalStateModule.set;
  var getInternalState = InternalStateModule.getterFor(DOM_EXCEPTION$2);
  var HAS_STACK = 'stack' in Error$2(DOM_EXCEPTION$2);

  var codeFor = function (name) {
    return hasOwn$1(DOMExceptionConstants$1, name) && DOMExceptionConstants$1[name].m ? DOMExceptionConstants$1[name].c : 0;
  };

  var $DOMException$1 = function DOMException() {
    anInstance$1(this, DOMExceptionPrototype$1);
    var argumentsLength = arguments.length;
    var message = normalizeStringArgument$1(argumentsLength < 1 ? undefined : arguments[0]);
    var name = normalizeStringArgument$1(argumentsLength < 2 ? undefined : arguments[1], 'Error');
    var code = codeFor(name);
    setInternalState(this, {
      type: DOM_EXCEPTION$2,
      name: name,
      message: message,
      code: code
    });
    if (!DESCRIPTORS$2) {
      this.name = name;
      this.message = message;
      this.code = code;
    }
    if (HAS_STACK) {
      var error = Error$2(message);
      error.name = DOM_EXCEPTION$2;
      defineProperty$1(this, 'stack', createPropertyDescriptor$1(1, clearErrorStack$1(error.stack, 1)));
    }
  };

  var DOMExceptionPrototype$1 = $DOMException$1.prototype = create(ErrorPrototype);

  var createGetterDescriptor = function (get) {
    return { enumerable: true, configurable: true, get: get };
  };

  var getterFor = function (key) {
    return createGetterDescriptor(function () {
      return getInternalState(this)[key];
    });
  };

  if (DESCRIPTORS$2) {
    // `DOMException.prototype.code` getter
    defineBuiltInAccessor(DOMExceptionPrototype$1, 'code', getterFor('code'));
    // `DOMException.prototype.message` getter
    defineBuiltInAccessor(DOMExceptionPrototype$1, 'message', getterFor('message'));
    // `DOMException.prototype.name` getter
    defineBuiltInAccessor(DOMExceptionPrototype$1, 'name', getterFor('name'));
  }

  defineProperty$1(DOMExceptionPrototype$1, 'constructor', createPropertyDescriptor$1(1, $DOMException$1));

  // FF36- DOMException is a function, but can't be constructed
  var INCORRECT_CONSTRUCTOR = fails$1(function () {
    return !(new NativeDOMException$1() instanceof Error$2);
  });

  // Safari 10.1 / Chrome 32- / IE8- DOMException.prototype.toString bugs
  var INCORRECT_TO_STRING = INCORRECT_CONSTRUCTOR || fails$1(function () {
    return ErrorPrototype.toString !== errorToString || String(new NativeDOMException$1(1, 2)) !== '2: 1';
  });

  // Deno 1.6.3- DOMException.prototype.code just missed
  var INCORRECT_CODE = INCORRECT_CONSTRUCTOR || fails$1(function () {
    return new NativeDOMException$1(1, 'DataCloneError').code !== 25;
  });

  // Deno 1.6.3- DOMException constants just missed
  INCORRECT_CONSTRUCTOR
    || NativeDOMException$1[DATA_CLONE_ERR] !== 25
    || NativeDOMExceptionPrototype[DATA_CLONE_ERR] !== 25;

  var FORCED_CONSTRUCTOR$1 = INCORRECT_CONSTRUCTOR;

  // `DOMException` constructor
  // https://webidl.spec.whatwg.org/#idl-DOMException
  $$9({ global: true, constructor: true, forced: FORCED_CONSTRUCTOR$1 }, {
    DOMException: FORCED_CONSTRUCTOR$1 ? $DOMException$1 : NativeDOMException$1
  });

  var PolyfilledDOMException$1 = getBuiltIn$2(DOM_EXCEPTION$2);
  var PolyfilledDOMExceptionPrototype$1 = PolyfilledDOMException$1.prototype;

  if (INCORRECT_TO_STRING && (NativeDOMException$1 === PolyfilledDOMException$1)) {
    defineBuiltIn(PolyfilledDOMExceptionPrototype$1, 'toString', errorToString);
  }

  if (INCORRECT_CODE && DESCRIPTORS$2 && NativeDOMException$1 === PolyfilledDOMException$1) {
    defineBuiltInAccessor(PolyfilledDOMExceptionPrototype$1, 'code', createGetterDescriptor(function () {
      return codeFor(anObject$2(this).name);
    }));
  }

  // `DOMException` constants
  for (var key$1 in DOMExceptionConstants$1) if (hasOwn$1(DOMExceptionConstants$1, key$1)) {
    var constant$1 = DOMExceptionConstants$1[key$1];
    var constantName$1 = constant$1.s;
    var descriptor$1 = createPropertyDescriptor$1(6, constant$1.c);
    if (!hasOwn$1(PolyfilledDOMException$1, constantName$1)) {
      defineProperty$1(PolyfilledDOMException$1, constantName$1, descriptor$1);
    }
    if (!hasOwn$1(PolyfilledDOMExceptionPrototype$1, constantName$1)) {
      defineProperty$1(PolyfilledDOMExceptionPrototype$1, constantName$1, descriptor$1);
    }
  }

  var $$8 = _export;
  var global$4 = global$Q;
  var getBuiltIn$1 = getBuiltIn$f;
  var createPropertyDescriptor = createPropertyDescriptor$a;
  var defineProperty = objectDefineProperty.f;
  var hasOwn = hasOwnProperty_1;
  var anInstance = anInstance$a;
  var inheritIfRequired = inheritIfRequired$6;
  var normalizeStringArgument = normalizeStringArgument$4;
  var DOMExceptionConstants = domExceptionConstants;
  var clearErrorStack = errorStackClear;
  var DESCRIPTORS$1 = descriptors;

  var DOM_EXCEPTION$1 = 'DOMException';
  var Error$1 = getBuiltIn$1('Error');
  var NativeDOMException = getBuiltIn$1(DOM_EXCEPTION$1);

  var $DOMException = function DOMException() {
    anInstance(this, DOMExceptionPrototype);
    var argumentsLength = arguments.length;
    var message = normalizeStringArgument(argumentsLength < 1 ? undefined : arguments[0]);
    var name = normalizeStringArgument(argumentsLength < 2 ? undefined : arguments[1], 'Error');
    var that = new NativeDOMException(message, name);
    var error = Error$1(message);
    error.name = DOM_EXCEPTION$1;
    defineProperty(that, 'stack', createPropertyDescriptor(1, clearErrorStack(error.stack, 1)));
    inheritIfRequired(that, this, $DOMException);
    return that;
  };

  var DOMExceptionPrototype = $DOMException.prototype = NativeDOMException.prototype;

  var ERROR_HAS_STACK = 'stack' in Error$1(DOM_EXCEPTION$1);
  var DOM_EXCEPTION_HAS_STACK = 'stack' in new NativeDOMException(1, 2);

  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe
  var descriptor = NativeDOMException && DESCRIPTORS$1 && Object.getOwnPropertyDescriptor(global$4, DOM_EXCEPTION$1);

  // Bun ~ 0.1.1 DOMException have incorrect descriptor and we can't redefine it
  // https://github.com/Jarred-Sumner/bun/issues/399
  var BUGGY_DESCRIPTOR = !!descriptor && !(descriptor.writable && descriptor.configurable);

  var FORCED_CONSTRUCTOR = ERROR_HAS_STACK && !BUGGY_DESCRIPTOR && !DOM_EXCEPTION_HAS_STACK;

  // `DOMException` constructor patch for `.stack` where it's required
  // https://webidl.spec.whatwg.org/#es-DOMException-specialness
  $$8({ global: true, constructor: true, forced: FORCED_CONSTRUCTOR }, { // TODO: fix export logic
    DOMException: FORCED_CONSTRUCTOR ? $DOMException : NativeDOMException
  });

  var PolyfilledDOMException = getBuiltIn$1(DOM_EXCEPTION$1);
  var PolyfilledDOMExceptionPrototype = PolyfilledDOMException.prototype;

  if (PolyfilledDOMExceptionPrototype.constructor !== PolyfilledDOMException) {
    {
      defineProperty(PolyfilledDOMExceptionPrototype, 'constructor', createPropertyDescriptor(1, PolyfilledDOMException));
    }

    for (var key in DOMExceptionConstants) if (hasOwn(DOMExceptionConstants, key)) {
      var constant = DOMExceptionConstants[key];
      var constantName = constant.s;
      if (!hasOwn(PolyfilledDOMException, constantName)) {
        defineProperty(PolyfilledDOMException, constantName, createPropertyDescriptor(6, constant.c));
      }
    }
  }

  var getBuiltIn = getBuiltIn$f;
  var setToStringTag = setToStringTag$9;

  var DOM_EXCEPTION = 'DOMException';

  // `DOMException.prototype[@@toStringTag]` property
  setToStringTag(getBuiltIn(DOM_EXCEPTION), DOM_EXCEPTION);

  var $$7 = _export;
  var global$3 = global$Q;
  var clearImmediate = task$1.clear;

  // `clearImmediate` method
  // http://w3c.github.io/setImmediate/#si-clearImmediate
  $$7({ global: true, bind: true, enumerable: true, forced: global$3.clearImmediate !== clearImmediate }, {
    clearImmediate: clearImmediate
  });

  /* global Bun -- Deno case */

  var engineIsBun = typeof Bun == 'function' && Bun && typeof Bun.version == 'string';

  var global$2 = global$Q;
  var apply = functionApply;
  var isCallable = isCallable$x;
  var ENGINE_IS_BUN = engineIsBun;
  var USER_AGENT = engineUserAgent;
  var arraySlice = arraySlice$9;
  var validateArgumentsLength = validateArgumentsLength$5;

  var Function$1 = global$2.Function;
  // dirty IE9- and Bun 0.3.0- checks
  var WRAP = /MSIE .\./.test(USER_AGENT) || ENGINE_IS_BUN && (function () {
    var version = global$2.Bun.version.split('.');
    return version.length < 3 || version[0] == 0 && (version[1] < 3 || version[1] == 3 && version[2] == 0);
  })();

  // IE9- / Bun 0.3.0- setTimeout / setInterval / setImmediate additional parameters fix
  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers
  // https://github.com/oven-sh/bun/issues/1633
  var schedulersFix$1 = function (scheduler, hasTimeArg) {
    var firstParamIndex = hasTimeArg ? 2 : 1;
    return WRAP ? function (handler, timeout /* , ...arguments */) {
      var boundArgs = validateArgumentsLength(arguments.length, 1) > firstParamIndex;
      var fn = isCallable(handler) ? handler : Function$1(handler);
      var params = boundArgs ? arraySlice(arguments, firstParamIndex) : [];
      var callback = boundArgs ? function () {
        apply(fn, this, params);
      } : fn;
      return hasTimeArg ? scheduler(callback, timeout) : scheduler(callback);
    } : scheduler;
  };

  var $$6 = _export;
  var global$1 = global$Q;
  var setTask = task$1.set;
  var schedulersFix = schedulersFix$1;

  // https://github.com/oven-sh/bun/issues/1633
  var setImmediate$1 = global$1.setImmediate ? schedulersFix(setTask, false) : setTask;

  // `setImmediate` method
  // http://w3c.github.io/setImmediate/#si-setImmediate
  $$6({ global: true, bind: true, enumerable: true, forced: global$1.setImmediate !== setImmediate$1 }, {
    setImmediate: setImmediate$1
  });

  var XZ$1=function(){var _scriptDir=(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href);return function(XZ){XZ=XZ||{};var a;a||(a=typeof XZ!=='undefined'?XZ:{});var Promise=function(){function b(){}function e(c,f){return function(){c.apply(f,arguments);};}function d(c){if(!(this instanceof d))throw new TypeError("Promises must be constructed via new");if("function"!==typeof c)throw new TypeError("not a function");this.s=0;this.B=false;this.u=void 0;this.v=[];P(c,this);}function m(c,f){for(;3===c.s;)c=c.u;0===c.s?c.v.push(f):(c.B=true,d.C(function(){var g=1===c.s?f.F:f.G;if(null===g)(1===c.s?h:k)(f.promise,c.u);else {try{var l=g(c.u);}catch(p){k(f.promise,p);return;}h(f.promise,l);}}));}function h(c,f){try{if(f===c)throw new TypeError("A promise cannot be resolved with itself.");if(f&&("object"===_typeof(f)||"function"===typeof f)){var g=f.then;if(f instanceof d){c.s=3;c.u=f;v(c);return;}if("function"===typeof g){P(e(g,f),c);return;}}c.s=1;c.u=f;v(c);}catch(l){k(c,l);}}function k(c,f){c.s=2;c.u=f;v(c);}function v(c){2===c.s&&0===c.v.length&&d.C(function(){c.B||d.D(c.u);});for(var f=0,g=c.v.length;f<g;f++)m(c,c.v[f]);c.v=null;}function I(c,f,g){this.F="function"===typeof c?c:null;this.G="function"===typeof f?f:null;this.promise=g;}function P(c,f){var g=false;try{c(function(l){g||(g=!0,h(f,l));},function(l){g||(g=!0,k(f,l));});}catch(l){g||(g=true,k(f,l));}}d.prototype["catch"]=function(c){return this.then(null,c);};d.prototype.then=function(c,f){var g=new this.constructor(b);m(this,new I(c,f,g));return g;};d.all=function(c){return new d(function(f,g){function l(Q,w){try{if(w&&("object"===_typeof(w)||"function"===typeof w)){var R=w.then;if("function"===typeof R){R.call(w,function(J){l(Q,J);},g);return;}}p[Q]=w;0===--ea&&f(p);}catch(J){g(J);}}if(!Array.isArray(c))return g(new TypeError("Promise.all accepts an array"));var p=Array.prototype.slice.call(c);if(0===p.length)return f([]);for(var ea=p.length,C=0;C<p.length;C++)l(C,p[C]);});};d.resolve=function(c){return c&&"object"===_typeof(c)&&c.constructor===d?c:new d(function(f){f(c);});};d.reject=function(c){return new d(function(f,g){g(c);});};d.race=function(c){return new d(function(f,g){if(!Array.isArray(c))return g(new TypeError("Promise.race accepts an array"));for(var l=0,p=c.length;l<p;l++)d.resolve(c[l]).then(f,g);});};d.C="function"===typeof setImmediate&&function(c){setImmediate(c);}||function(c){setTimeout(c,0);};d.D=function(c){"undefined"!==typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",c);};return d;}(),n,q;a.ready=new Promise(function(b,e){n=b;q=e;});var r={},t;for(t in a)a.hasOwnProperty(t)&&(r[t]=a[t]);var u="";"undefined"!==typeof document&&document.currentScript&&(u=document.currentScript.src);_scriptDir&&(u=_scriptDir);0!==u.indexOf("blob:")?u=u.substr(0,u.replace(/[?#].*/,"").lastIndexOf("/")+1):u="";var x=a.printErr||console.warn.bind(console);for(t in r)r.hasOwnProperty(t)&&(a[t]=r[t]);r=null;var y;a.wasmBinary&&(y=a.wasmBinary);a.noExitRuntime||true;function aa(){this.buffer=new ArrayBuffer(z/65536*65536);}function ba(){this.exports=// EMSCRIPTEN_START_ASM
  function instantiate(V){function c(d){d.set=function(a,b){this[a]=b;};d.get=function(a){return this[a];};return d;}var e;var f=new Uint8Array(123);for(var a=25;a>=0;--a){f[48+a]=52+a;f[65+a]=a;f[97+a]=26+a;}f[43]=62;f[47]=63;function l(m,n,o){var g,h,a=0,i=n,j=o.length,k=n+(j*3>>2)-(o[j-2]=="=")-(o[j-1]=="=");for(;a<j;a+=4){g=f[o.charCodeAt(a+1)];h=f[o.charCodeAt(a+2)];m[i++]=f[o.charCodeAt(a)]<<2|g>>4;if(i<k)m[i++]=g<<4|h>>2;if(i<k)m[i++]=h<<6|f[o.charCodeAt(a+3)];}}function p(q){l(e,1024,"/Td6WFo=");l(e,1032,"QBRQ");}function T(U){var r=U.a;var s=r.buffer;var t=new Int8Array(s);var u=new Int16Array(s);var v=new Int32Array(s);var w=new Uint8Array(s);var x=new Uint16Array(s);var y=new Uint32Array(s);var B=Math.imul;var E=Math.clz32;U.abort;var O=U.b;var P=U.c;var Q=0;// EMSCRIPTEN_START_FUNCS
  function pa(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,x=0,z=0;d=v[a>>2];a:{if(v[d+36>>2]){h=v[d>>2];break a;}t[d+40|0]=0;v[d>>2]=0;v[d+4>>2]=0;v[d+24>>2]=0;v[d+28>>2]=0;_(d+72|0,100);v[d+172>>2]=12;h=0;}z=v[a+20>>2];s=v[a+8>>2];v[d+16>>2]=s;x=d+96|0;p=d+176|0;n=d+168|0;while(1){b:{c:{d:{e:{f:{g:{h:{i:{j:{k:{l:{m:{switch(h|0){case 2:b=v[a+8>>2];e=v[a+4>>2];h=v[d+172>>2];c=v[a+12>>2];g=v[d+168>>2];break l;case 0:h=v[a+8>>2];e=v[a+12>>2]-h|0;c=v[d+168>>2];b=v[d+172>>2]-c|0;b=b>>>0>e>>>0?e:b;W((c+n|0)+8|0,h+v[a+4>>2]|0,b);v[a+8>>2]=b+v[a+8>>2];c=0;e=b+v[d+168>>2]|0;b=v[d+172>>2];v[d+168>>2]=(b|0)==(e|0)?0:e;if((b|0)!=(e|0)){break b;}v[d>>2]=1;if(fa(p,1024,6)){c=5;break b;}c=6;if(w[d+182|0]){break b;}b=w[d+183|0];v[d+32>>2]=b;if(!(1<<b&19)|b>>>0>4){break b;}break;case 9:break h;case 8:break i;case 7:break j;case 6:break k;case 1:break m;case 5:break c;case 4:break d;case 3:break e;default:continue;}}b=v[a+8>>2];c=v[a+12>>2];if((b|0)==(c|0)){c=0;break b;}e=v[a+4>>2];h=w[e+b|0];if(!h){v[a+8>>2]=b+1;v[d+16>>2]=b;h=6;v[d>>2]=6;continue;}v[d+168>>2]=0;v[d>>2]=2;h=(h<<2)+4|0;v[d+172>>2]=h;v[d+64>>2]=h;g=0;}e=b+e|0;c=c-b|0;b=h-g|0;b=b>>>0>c>>>0?c:b;W((g+n|0)+8|0,e,b);v[a+8>>2]=b+v[a+8>>2];c=0;e=b+v[d+168>>2]|0;b=v[d+172>>2];v[d+168>>2]=(b|0)==(e|0)?0:e;if((b|0)!=(e|0)){break b;}b=e-4|0;v[d+172>>2]=b;c=Y(p,b,0);q=v[d+172>>2];b=q+d|0;if((c|0)!=(w[b+176|0]|w[b+177|0]<<8|(w[b+178|0]<<16|w[b+179|0]<<24))){c=7;break b;}v[d+168>>2]=2;m=t[d+177|0];if(m&63){c=6;break b;}b=2;o=-1;l=-1;g=-1;f=-1;if(!(m&64)){break f;}h=v[d+4>>2];if(!h){v[d+8>>2]=0;v[d+12>>2]=0;}j=q>>>0>2?q:2;while(1){if((b|0)==(j|0)){c=7;break b;}r=w[(b+n|0)+8|0];b=b+1|0;v[d+168>>2]=b;e=d;k=v[d+12>>2];g=r&127;c=h;i=c&31;if((c&63)>>>0>=32){f=g<<i;c=0;}else {f=(1<<i)-1&g>>>32-i;c=g<<i;}g=c|v[d+8>>2];c=f|k;f=c;v[e+8>>2]=g;v[e+12>>2]=c;if(!(r&128)){if(!(!h|r)){c=7;break b;}v[d+4>>2]=0;break f;}c=7;h=h+7|0;v[d+4>>2]=h;if((h|0)!=63){continue;}break;}break b;}n=d+144|0;n:{while(1){c=v[a+12>>2];l=v[a+4>>2];h=v[d+4>>2];if(!h){v[d+8>>2]=0;v[d+12>>2]=0;}b=v[a+8>>2];j=b>>>0>c>>>0?b:c;o:{while(1){p:{if((b|0)==(j|0)){c=0;b=j;break p;}m=w[b+l|0];b=b+1|0;v[a+8>>2]=b;k=d;f=v[d+12>>2];g=m&127;c=h;p=c&31;if((c&63)>>>0>=32){e=g<<p;c=0;}else {e=(1<<p)-1&g>>>32-p;c=g<<p;}g=c|v[d+8>>2];c=e|f;f=c;v[k+8>>2]=g;v[k+12>>2]=c;if(!(m&128)){if(!h|m){break o;}c=7;break p;}c=7;h=h+7|0;v[d+4>>2]=h;if((h|0)!=63){continue;}}break;}e=v[d+132>>2];g=v[d+16>>2];f=b-g|0;b=f;k=b+v[d+128>>2]|0;v[d+128>>2]=k;v[d+132>>2]=b>>>0>k>>>0?e+1|0:e;v[d+24>>2]=Y(g+l|0,b,v[d+24>>2]);v[d+28>>2]=0;break n;}v[d+4>>2]=0;q:{r:{switch(v[d+120>>2]){case 0:v[d+136>>2]=g;v[d+140>>2]=f;c=7;if((g|0)!=v[d+88>>2]|(f|0)!=v[d+92>>2]){break n;}v[d+120>>2]=1;break q;case 2:f=f+v[d+156>>2]|0;c=g+v[d+152>>2]|0;f=c>>>0<g>>>0?f+1|0:f;b=d;v[b+152>>2]=c;v[b+156>>2]=f;v[b+160>>2]=Y(n,24,v[b+160>>2]);v[b+120>>2]=1;b=v[b+136>>2];f=v[d+140>>2]-!b|0;g=b-1|0;v[d+136>>2]=g;v[d+140>>2]=f;break q;case 1:v[d+120>>2]=2;f=f+v[d+148>>2]|0;c=g+v[d+144>>2]|0;f=c>>>0<g>>>0?f+1|0:f;b=d;v[b+144>>2]=c;v[b+148>>2]=f;break;default:break r;}}g=v[d+136>>2];f=v[d+140>>2];}if(g|f){continue;}break;}c=1;}if((c|0)!=1){break b;}v[d>>2]=7;}n=v[d+128>>2];b=v[a+8>>2];j=v[d+16>>2];c=b-j|0;e=n+c|0;s:{if(!(e&3)){break s;}i=v[a+4>>2];if(v[a+12>>2]==(b|0)){e=b;break g;}e=b+1|0;v[a+8>>2]=e;c=7;if(w[b+i|0]){break b;}g=e-j|0;k=g+n|0;t:{if(!(k&3)){break t;}i=v[a+4>>2];if(v[a+12>>2]==(e|0)){break g;}f=b+2|0;v[a+8>>2]=f;if(w[e+i|0]){break b;}g=f-j|0;k=g+n|0;if(!(k&3)){b=f;break s;}i=v[a+4>>2];if((f|0)==v[a+12>>2]){e=f;break g;}e=b+3|0;v[a+8>>2]=e;if(w[f+i|0]){break b;}g=e-j|0;k=g+n|0;if(!(k&3)){break t;}if(v[a+12>>2]==(e|0)){i=v[a+4>>2];break g;}v[a+8>>2]=b+4;break b;}b=e;}ba(d,v[a+4>>2],b);c=7;if(fa(x,d+144|0,24)){break b;}v[d>>2]=8;}b=v[a+8>>2];k=v[a+12>>2];u:{while(1){f=0;if((b|0)==(k|0)){break u;}g=v[d+24>>2];e=v[d+28>>2];h=v[d+4>>2];c=b+1|0;v[a+8>>2]=c;l=w[v[a+4>>2]+b|0];b=h;j=b&31;f=7;if((l|0)!=(((b&63)>>>0>=32?e>>>j|0:((1<<j)-1&e)<<32-j|g>>>j)&255)){break u;}e=h+8|0;v[d+4>>2]=e;b=c;if(e>>>0<32){continue;}break;}v[d+4>>2]=0;v[d+24>>2]=0;v[d+28>>2]=0;f=1;}c=f;if((c|0)!=1){break b;}v[d>>2]=9;v[d+172>>2]=12;}c=0;f=v[a+8>>2];h=v[a+12>>2]-f|0;e=v[d+168>>2];b=v[d+172>>2]-e|0;b=b>>>0>h>>>0?h:b;W((d+e|0)+176|0,f+v[a+4>>2]|0,b);v[a+8>>2]=b+v[a+8>>2];b=b+v[d+168>>2]|0;e=(b|0)==v[d+172>>2];v[d+168>>2]=e?0:b;if(!e){break b;}b=7;v:{if((w[d+186|0]|w[d+187|0]<<8)!=23129){break v;}if((Y(d+180|0,6,0)|0)!=(w[d+176|0]|w[d+177|0]<<8|(w[d+178|0]<<16|w[d+179|0]<<24))){break v;}e=v[d+132>>2];f=e>>>2|0;if(w[d+184|0]|((w[d+180|0]|w[d+181|0]<<8|(w[d+182|0]<<16|w[d+183|0]<<24))!=((e&3)<<30|v[d+128>>2]>>>2)|f)){break v;}b=v[d+32>>2]==w[d+185|0]?1:7;}c=b;break b;}ba(d,i,e);c=0;break b;}v[d+48>>2]=g;v[d+52>>2]=f;if((m|0)<0){h=v[d+4>>2];if(!h){v[d+8>>2]=0;v[d+12>>2]=0;}k=b>>>0>q>>>0?b:q;while(1){if((b|0)==(k|0)){c=7;break b;}m=w[(b+n|0)+8|0];b=b+1|0;v[d+168>>2]=b;f=d;g=v[d+12>>2];j=m&127;c=h;l=c&31;if((c&63)>>>0>=32){e=j<<l;c=0;}else {e=(1<<l)-1&j>>>32-l;c=j<<l;}o=c|v[d+8>>2];c=e|g;l=c;v[f+8>>2]=o;v[f+12>>2]=c;w:{if(!(m&128)){if(!h|m){break w;}c=7;break b;}c=7;h=h+7|0;v[d+4>>2]=h;if((h|0)!=63){continue;}break b;}break;}v[d+4>>2]=0;}v[d+56>>2]=o;v[d+60>>2]=l;if(q-b>>>0<2){c=7;break b;}c=b+1|0;v[d+168>>2]=c;if(w[(b+n|0)+8|0]!=33){c=6;break b;}h=b+2|0;v[d+168>>2]=h;if(w[(c+n|0)+8|0]!=1){c=6;break b;}c=7;if((h|0)==(q|0)){break b;}v[d+168>>2]=b+3;f=v[d+1200>>2];e=6;b=w[(h+n|0)+8|0];x:{if(b>>>0>39){break x;}h=(b&1|2)<<(b>>>1|0)+11;v[f+48>>2]=h;y:{z:{b=v[f+60>>2];if(!b){break z;}e=4;if(h>>>0>y[f+52>>2]){break x;}v[f+44>>2]=h;if((b|0)!=2){break z;}c=f+56|0;if(h>>>0<=y[c>>2]){break z;}X(v[f+24>>2]);b=Z(v[f+48>>2]);v[f+24>>2]=b;if(b){break z;}e=3;break y;}v[f+64>>2]=0;t[f+80|0]=1;v[f+104>>2]=0;c=f+28388|0;e=0;}v[c>>2]=0;}c=e;if(c){break b;}b=v[d+168>>2];c=v[d+172>>2];h=b>>>0>c>>>0?b:c;A:{while(1){if((b|0)==(h|0)){break A;}c=b+1|0;v[d+168>>2]=c;e=b+n|0;b=c;if(!w[e+8|0]){continue;}break;}c=6;break b;}v[d+168>>2]=0;v[d+80>>2]=0;v[d+84>>2]=0;v[d+72>>2]=0;v[d+76>>2]=0;v[d>>2]=3;}v[d+16>>2]=v[a+8>>2];v[d+20>>2]=v[a+20>>2];c=v[d+1200>>2];h=c+28392|0;o=c+120|0;r=c+28388|0;B:{while(1){f=v[c+64>>2];C:{D:{E:{F:{G:{H:{I:{J:{K:{L:{M:{N:{O:{P:{Q:{b=v[a+8>>2];e=v[a+12>>2];if(b>>>0>=e>>>0){if((f|0)==7){break Q;}f=0;break B;}switch(f|0){case 8:break H;case 6:break J;case 5:break K;case 4:break L;case 3:break M;case 2:break N;case 1:break O;case 0:break P;case 7:break Q;default:continue;}}i=v[c+76>>2];break I;}f=1;v[a+8>>2]=b+1;g=w[v[a+4>>2]+b|0];if(!g){break G;}if(!((g|0)!=1&g>>>0<=223)){u[c+80>>1]=256;if(!v[c+60>>2]){b=v[a+20>>2];v[c+24>>2]=b+v[a+16>>2];v[c+44>>2]=v[a+24>>2]-b;}v[c+28>>2]=0;v[c+32>>2]=0;v[c+36>>2]=0;v[c+40>>2]=0;break E;}if(!w[c+80|0]){break E;}f=7;break B;}v[a+8>>2]=b+1;b=w[v[a+4>>2]+b|0];v[c+64>>2]=2;v[c+72>>2]=v[c+72>>2]+(b<<8);continue;}v[a+8>>2]=b+1;b=w[v[a+4>>2]+b|0];v[c+64>>2]=3;v[c+72>>2]=(b+v[c+72>>2]|0)+1;continue;}v[a+8>>2]=b+1;b=w[v[a+4>>2]+b|0];v[c+64>>2]=4;v[c+76>>2]=b<<8;continue;}v[a+8>>2]=b+1;b=w[v[a+4>>2]+b|0];v[c+64>>2]=v[c+68>>2];v[c+76>>2]=(b+v[c+76>>2]|0)+1;continue;}v[a+8>>2]=b+1;f=7;b=w[v[a+4>>2]+b|0];if(b>>>0>224){break G;}i=0;e=c;if(b>>>0<45){j=0;}else {b=b-45|0;g=((b&255)>>>0)/45|0;b=b-B(g,45)|0;j=g+1|0;}v[e+116>>2]=-1<<j^-1;if((b&255)>>>0>=9){b=b-9|0;e=((b&255)>>>0)/9|0;i=e+1|0;b=b-B(e,9)|0;}v[c+112>>2]=i;b=b&255;v[c+108>>2]=b;if(b+i>>>0>4){break G;}v[c+112>>2]=-1<<i^-1;b=0;v[c+100>>2]=0;v[c+92>>2]=0;v[c+96>>2]=0;v[c+84>>2]=0;v[c+88>>2]=0;while(1){e=b<<1;u[e+o>>1]=1024;u[(e|2)+o>>1]=1024;b=b+2|0;if((b|0)!=14134){continue;}break;}v[c+64>>2]=6;v[c+8>>2]=5;v[c>>2]=-1;v[c+4>>2]=0;}k=v[c+76>>2];f=7;if(k>>>0<5){break B;}i=v[c+8>>2];if(i){b=v[a+8>>2];g=v[a+12>>2];while(1){f=0;if((b|0)==(g|0)){break B;}f=v[c+4>>2];e=b+1|0;v[a+8>>2]=e;b=w[v[a+4>>2]+b|0];i=i-1|0;v[c+8>>2]=i;v[c+4>>2]=b|f<<8;b=e;if(i){continue;}break;}}v[c+64>>2]=7;i=k-5|0;v[c+76>>2]=i;}f=v[c+32>>2];e=v[a+24>>2]-v[a+20>>2]|0;b=v[c+72>>2];e=b>>>0>e>>>0?e:b;b=v[c+44>>2];v[c+40>>2]=e>>>0<b-f>>>0?f+e|0:b;f=v[a+12>>2];e=v[a+8>>2];b=f-e|0;g=v[c+28388>>2];R:{S:{if(!g){if(i){break S;}i=0;}j=(g+r|0)+4|0;k=v[a+4>>2]+e|0;f=i-g|0;e=42-g|0;e=e>>>0>f>>>0?f:e;g=b>>>0<e>>>0?b:e;W(j,k,g);b=v[c+28388>>2];e=b+g|0;T:{if((e|0)==v[c+76>>2]){_((g+(b+r|0)|0)+4|0,63-e|0);b=g+v[c+28388>>2]|0;break T;}if(e>>>0<=20){v[c+28388>>2]=e;v[a+8>>2]=g+v[a+8>>2];break R;}b=e-21|0;}v[c+16>>2]=0;v[c+12>>2]=h;v[c+20>>2]=b;f=7;if(!da(c)){break G;}b=v[c+28388>>2];e=b+g|0;g=v[c+16>>2];if(e>>>0<g>>>0){break G;}i=v[c+76>>2]-g|0;v[c+76>>2]=i;if(b>>>0>g>>>0){b=b-g|0;v[c+28388>>2]=b;e=h;i=(g+r|0)+4|0;U:{if((e|0)==(i|0)){break U;}f=b+e|0;if(i-f>>>0<=0-(b<<1)>>>0){W(e,i,b);break U;}g=(e^i)&3;V:{W:{if(e>>>0<i>>>0){if(g){break V;}if(!(e&3)){break W;}while(1){if(!b){break U;}t[e|0]=w[i|0];i=i+1|0;b=b-1|0;e=e+1|0;if(e&3){continue;}break;}break W;}X:{if(g){break X;}if(f&3){while(1){if(!b){break U;}b=b-1|0;f=e+b|0;t[f|0]=w[b+i|0];if(f&3){continue;}break;}}if(b>>>0<=3){break X;}while(1){b=b-4|0;v[e+b>>2]=v[b+i>>2];if(b>>>0>3){continue;}break;}}if(!b){break U;}while(1){b=b-1|0;t[e+b|0]=w[b+i|0];if(b){continue;}break;}break U;}if(b>>>0<=3){break V;}while(1){v[e>>2]=v[i>>2];i=i+4|0;e=e+4|0;b=b-4|0;if(b>>>0>3){continue;}break;}}if(!b){break U;}while(1){t[e|0]=w[i|0];e=e+1|0;i=i+1|0;b=b-1|0;if(b){continue;}break;}}break R;}e=v[a+8>>2]+(g-b|0)|0;v[a+8>>2]=e;v[c+28388>>2]=0;f=v[a+12>>2];b=f-e|0;}if(b>>>0>=21){g=v[a+4>>2];v[c+16>>2]=e;v[c+12>>2]=g;v[c+20>>2]=i+21>>>0>b>>>0?f-21|0:e+i|0;f=7;if(!da(c)){break G;}g=v[c+76>>2];e=v[c+16>>2];b=e-v[a+8>>2]|0;if(g>>>0<b>>>0){break G;}i=g-b|0;v[c+76>>2]=i;v[a+8>>2]=e;b=v[a+12>>2]-e|0;if(b>>>0>20){break R;}}b=b>>>0>i>>>0?i:b;W(h,v[a+4>>2]+e|0,b);v[c+28388>>2]=b;v[a+8>>2]=b+v[a+8>>2];}e=v[c+32>>2];f=v[c+28>>2];g=e-f|0;b=c;if(v[b+60>>2]){if((e|0)==v[c+44>>2]){v[c+32>>2]=0;}W(v[a+16>>2]+v[a+20>>2]|0,f+v[c+24>>2]|0,g);e=v[c+32>>2];}v[b+28>>2]=e;e=g+v[a+20>>2]|0;v[a+20>>2]=e;b=v[c+72>>2]-g|0;v[c+72>>2]=b;if(!b){f=7;if(v[c+4>>2]|(v[c+76>>2]|v[c+104>>2])){break G;}v[c+64>>2]=0;break D;}f=0;if((e|0)==v[a+24>>2]){break G;}if(v[a+8>>2]!=v[a+12>>2]|y[c+28388>>2]>=y[c+76>>2]){continue;}break G;}i=v[c+76>>2];if(!i){break F;}f=0;if(b>>>0>=e>>>0){break G;}while(1){m=v[a+24>>2];l=v[a+20>>2];if(m>>>0<=l>>>0){break G;}j=v[c+32>>2];k=v[c+44>>2]-j|0;g=e-b|0;e=m-l|0;e=e>>>0>g>>>0?g:e;e=e>>>0>k>>>0?k:e;g=e>>>0>i>>>0?i:e;v[c+76>>2]=i-g;W(v[c+24>>2]+j|0,v[a+4>>2]+b|0,g);e=g+v[c+32>>2]|0;v[c+32>>2]=e;if(e>>>0>y[c+36>>2]){v[c+36>>2]=e;}b=c;if(v[b+60>>2]){if((e|0)==v[c+44>>2]){v[c+32>>2]=0;}W(v[a+16>>2]+v[a+20>>2]|0,v[a+4>>2]+v[a+8>>2]|0,g);e=v[c+32>>2];}v[b+28>>2]=e;v[a+20>>2]=g+v[a+20>>2];b=g+v[a+8>>2]|0;v[a+8>>2]=b;i=v[c+76>>2];if(!i){break F;}e=v[a+12>>2];if(e>>>0>b>>>0){continue;}break;}}break B;}v[c+64>>2]=0;continue;}if(g<<24>>24>=0){break C;}v[c+64>>2]=1;v[c+72>>2]=g<<16&2031616;if(g>>>0>=192){v[c+68>>2]=5;t[c+81|0]=0;continue;}f=7;if(w[c+81|0]){break B;}v[c+68>>2]=6;if(g>>>0<160){continue;}v[c+84>>2]=0;v[c+88>>2]=0;b=0;v[c+100>>2]=0;v[c+92>>2]=0;v[c+96>>2]=0;while(1){e=b<<1;u[e+o>>1]=1024;u[(e|2)+o>>1]=1024;b=b+2|0;if((b|0)!=14134){continue;}break;}}v[c+8>>2]=5;v[c>>2]=-1;v[c+4>>2]=0;continue;}if(g>>>0<=2){v[c+64>>2]=3;v[c+68>>2]=8;continue;}break;}f=7;}c=f;b=d;e=v[b+76>>2];h=v[a+8>>2]-v[b+16>>2]|0;f=h+v[b+72>>2]|0;k=f;e=f>>>0<h>>>0?e+1|0:e;h=e;v[b+72>>2]=f;v[b+76>>2]=e;l=v[b+20>>2];j=v[a+20>>2]-l|0;b=j;g=b+v[d+80>>2]|0;f=v[d+84>>2];f=b>>>0>g>>>0?f+1|0:f;v[d+80>>2]=g;b=f;v[d+84>>2]=b;e=v[d+52>>2];if((h|0)==(e|0)&k>>>0>y[d+48>>2]|e>>>0<h>>>0){c=7;break b;}e=v[d+60>>2];if((b|0)==(e|0)&g>>>0>y[d+56>>2]|b>>>0>e>>>0){c=7;break b;}k=d;Y:{Z:{_:{switch(v[d+32>>2]-1|0){case 0:e=Y(l+v[a+16>>2]|0,j,v[d+24>>2]);b=0;break Z;case 3:break _;default:break Y;}}h=l+v[a+16>>2]|0;g=v[d+24>>2]^-1;f=v[d+28>>2]^-1;$:{if(!j){break $;}if(j&1){e=((w[h|0]^g&255)<<3)+2064|0;b=v[e>>2];l=v[e+4>>2];e=b;b=f;f=b>>>8|0;g=e^((b&255)<<24|g>>>8);f=f^l;h=h+1|0;e=j-1|0;}else {e=j;}if((j|0)==1){break $;}while(1){j=((w[h|0]^g&255)<<3)+2064|0;b=v[j>>2];m=v[j+4>>2];j=b;b=f;f=b>>>8|0;l=j^((b&255)<<24|g>>>8);g=((w[h+1|0]^l&255)<<3)+2064|0;b=v[g>>2];j=v[g+4>>2];g=f^m;f=g>>>8|0;g=((g&255)<<24|l>>>8)^b;f=f^j;h=h+2|0;e=e-2|0;if(e){continue;}break;}}e=g^-1;b=f^-1;}v[k+24>>2]=e;v[k+28>>2]=b;}if((c|0)!=1){break b;}e=v[d+52>>2];c=e;b=v[d+48>>2];if(!((b|0)==-1&(c|0)==-1|v[d+72>>2]==(b|0)&v[d+76>>2]==(c|0))){c=7;break b;}c=v[d+60>>2];e=c;b=v[d+56>>2];if((b|0)!=-1|(c|0)!=-1){c=7;if(v[d+80>>2]!=(b|0)|v[d+84>>2]!=(e|0)){break b;}}c=v[d+100>>2];b=v[d+64>>2];e=b+v[d+72>>2]|0;f=v[d+76>>2];f=b>>>0>e>>>0?f+1|0:f;b=e;g=b+v[d+96>>2]|0;e=c+f|0;c=g;e=b>>>0>c>>>0?e+1|0:e;b=e;v[d+96>>2]=c;v[d+100>>2]=b;g=4;aa:{switch(v[d+32>>2]-1|0){case 3:g=8;case 0:h=c+g|0;f=h>>>0<c>>>0?b+1|0:b;e=x;v[e>>2]=h;v[e+4>>2]=f;break;default:break aa;}}e=v[d+108>>2]+v[d+84>>2]|0;c=v[d+80>>2];h=c+v[d+104>>2]|0;v[d+104>>2]=h;v[d+108>>2]=c>>>0>h>>>0?e+1|0:e;v[d+112>>2]=Y(x,24,v[d+112>>2]);v[d>>2]=4;f=v[d+92>>2];c=v[d+88>>2]+1|0;f=c?f:f+1|0;b=d;v[b+88>>2]=c;v[b+92>>2]=f;}b=v[d+76>>2];l=v[d+72>>2];ba:{if(!(l&3)){break ba;}c=0;m=v[a+8>>2];j=v[a+12>>2];if((m|0)==(j|0)){break b;}g=m+1|0;v[a+8>>2]=g;if(w[m+v[a+4>>2]|0]){c=7;break b;}h=l+1|0;f=h?b:b+1|0;v[d+72>>2]=h;v[d+76>>2]=f;if(!(h&3)){break ba;}if((g|0)==(j|0)){break b;}k=m+2|0;v[a+8>>2]=k;if(w[g+v[a+4>>2]|0]){c=7;break b;}f=l+2|0;e=f>>>0<2?b+1|0:b;h=d;v[d+72>>2]=f;v[d+76>>2]=e;if(!(f&3)){break ba;}if((j|0)==(k|0)){break b;}g=m+3|0;v[a+8>>2]=g;if(w[k+v[a+4>>2]|0]){c=7;break b;}f=l+3|0;e=f>>>0<3?b+1|0:b;v[d+72>>2]=f;v[h+76>>2]=e;if(!(f&3)){break ba;}if((g|0)==(j|0)){break b;}v[a+8>>2]=m+4;c=7;if(w[g+v[a+4>>2]|0]){break b;}f=b;b=l+4|0;f=b>>>0<4?f+1|0:f;v[d+72>>2]=b;v[d+76>>2]=f;}v[d>>2]=5;}h=1;ca:{da:{ea:{switch(v[d+32>>2]-1|0){case 0:b=v[a+8>>2];k=v[a+12>>2];while(1){if((b|0)==(k|0)){c=0;break b;}g=v[d+24>>2];e=v[d+28>>2];f=v[d+4>>2];c=b+1|0;v[a+8>>2]=c;l=w[v[a+4>>2]+b|0];b=f;j=b&31;if((l|0)!=(((b&63)>>>0>=32?e>>>j|0:((1<<j)-1&e)<<32-j|g>>>j)&255)){c=7;break b;}e=f+8|0;v[d+4>>2]=e;b=c;if(e>>>0<32){continue;}break;}break da;case 3:break ea;default:break ca;}}b=v[a+8>>2];k=v[a+12>>2];while(1){if((b|0)==(k|0)){c=0;break b;}g=v[d+24>>2];e=v[d+28>>2];f=v[d+4>>2];c=b+1|0;v[a+8>>2]=c;l=w[v[a+4>>2]+b|0];b=f;j=b&31;if((l|0)!=(((b&63)>>>0>=32?e>>>j|0:((1<<j)-1&e)<<32-j|g>>>j)&255)){c=7;break b;}e=f+8|0;v[d+4>>2]=e;b=c;if(e>>>0<64){continue;}break;}}v[d+4>>2]=0;v[d+24>>2]=0;v[d+28>>2]=0;}v[d>>2]=1;continue;}break;}fa:{if(!v[d+36>>2]){ga:{switch(c|0){case 0:c=v[a+8>>2]==v[a+12>>2]?7:8;break;case 1:break fa;default:break ga;}}v[a+20>>2]=z;v[a+8>>2]=s;break fa;}if(!(v[a+8>>2]!=(s|0)|c|v[a+20>>2]!=(z|0))){a=w[d+40|0];t[d+40|0]=1;c=a<<3;break fa;}t[d+40|0]=0;}return c|0;}function da(a){var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;j=v[a+32>>2];b=v[a+40>>2];a:{if(j>>>0>=b>>>0){break a;}c=v[a+104>>2];if(!c){break a;}d=v[a+84>>2];if(d>>>0>=y[a+36>>2]|d>>>0>=y[a+48>>2]){break a;}b=b-j|0;g=b>>>0<c>>>0?b:c;v[a+104>>2]=c-g;e=(d^-1)+j|0;e=d>>>0>=j>>>0?v[a+44>>2]+e|0:e;d=v[a+24>>2];b=w[e+d|0];v[a+32>>2]=j+1;t[d+j|0]=b;h=g-1|0;b:{if(!h){break b;}if(h&1){b=e+1|0;e=(b|0)==v[a+44>>2]?0:b;c=v[a+24>>2];d=w[e+c|0];b=v[a+32>>2];v[a+32>>2]=b+1;t[b+c|0]=d;h=g-2|0;}if((g|0)==2){break b;}while(1){g=v[a+24>>2];b=e+1|0;c=(b|0)==v[a+44>>2]?0:b;d=w[g+c|0];b=v[a+32>>2];v[a+32>>2]=b+1;t[b+g|0]=d;b=c+1|0;e=(b|0)==v[a+44>>2]?0:b;c=v[a+24>>2];d=w[e+c|0];b=v[a+32>>2];v[a+32>>2]=b+1;t[b+c|0]=d;h=h-2|0;if(h){continue;}break;}}j=v[a+32>>2];if(j>>>0<=y[a+36>>2]){break a;}v[a+36>>2]=j;}c:{d:{if(y[a+40>>2]<=j>>>0){break d;}n=a+1756|0;o=a+2784|0;p=a+84|0;while(1){d=v[a+16>>2];if(d>>>0>y[a+20>>2]){break d;}m=v[a+100>>2];i=v[a+116>>2]&j;k=((m<<5)+a|0)+(i<<1)|0;g=k;f=v[a>>2];e:{if(f>>>0>=16777216){e=v[a+4>>2];break e;}f=f<<8;v[a>>2]=f;b=d+1|0;v[a+16>>2]=b;e=w[v[a+12>>2]+d|0]|v[a+4>>2]<<8;v[a+4>>2]=e;d=b;}b=x[g+120>>1];c=B(b,f>>>11|0);f:{if(e>>>0<c>>>0){v[a>>2]=c;u[g+120>>1]=b+(2048-b>>>5|0);f=j-1|0;f=j?f:v[a+44>>2]+f|0;i=v[a+108>>2];g=v[a+36>>2];l=((v[a+112>>2]&j)<<i)+((g?w[v[a+24>>2]+f|0]:0)>>>8-i|0)|0;f=1;g:{if(m>>>0<=6){while(1){f=f<<1;g=(f+(B(l,1536)+a|0)|0)+3812|0;h:{if(c>>>0>16777215){b=c;break h;}b=c<<8;v[a>>2]=b;c=d+1|0;v[a+16>>2]=c;e=w[v[a+12>>2]+d|0]|e<<8;v[a+4>>2]=e;d=c;}i=x[g>>1];c=B(i,b>>>11|0);i:{if(e>>>0>=c>>>0){e=e-c|0;v[a+4>>2]=e;c=b-c|0;v[a>>2]=c;u[g>>1]=i-(i>>>5|0);f=f|1;break i;}v[a>>2]=c;u[g>>1]=i+(2048-i>>>5|0);}if(f>>>0<256){continue;}break g;}}b=v[a+84>>2];f=(b^-1)+j|0;f=b>>>0>=j>>>0?v[a+44>>2]+f|0:f;g=g?w[v[a+24>>2]+f|0]:0;f=1;h=256;while(1){g=g<<1;m=h&g;i=((B(l,1536)+a|0)+((m+h|0)+f<<1)|0)+3812|0;j:{if(c>>>0>16777215){k=c;break j;}k=c<<8;v[a>>2]=k;b=d+1|0;v[a+16>>2]=b;e=w[v[a+12>>2]+d|0]|e<<8;v[a+4>>2]=e;d=b;}b=i;q=b;b=x[b>>1];c=B(b,k>>>11|0);i=e>>>0>=c>>>0;k:{if(!i){v[a>>2]=c;b=b+(2048-b>>>5|0)|0;break k;}e=e-c|0;v[a+4>>2]=e;c=k-c|0;v[a>>2]=c;h=0;b=b-(b>>>5|0)|0;}u[q>>1]=b;h=h^m;f=i|f<<1;if(f>>>0<256){continue;}break;}}v[a+32>>2]=j+1;t[v[a+24>>2]+j|0]=f;j=v[a+32>>2];if(j>>>0>y[a+36>>2]){v[a+36>>2]=j;}b=a;d=v[a+100>>2];if(d>>>0>=4){if(d>>>0<=9){v[a+100>>2]=d-3;break f;}c=d-6|0;}else {c=0;}v[b+100>>2]=c;break f;}e=e-c|0;v[a+4>>2]=e;c=f-c|0;v[a>>2]=c;u[g+120>>1]=b-(b>>>5|0);l=(m<<1)+a|0;g=l;l:{if(c>>>0>16777215){b=d;break l;}c=c<<8;v[a>>2]=c;b=d+1|0;v[a+16>>2]=b;e=w[v[a+12>>2]+d|0]|e<<8;v[a+4>>2]=e;}m=x[g+504>>1];d=B(m,c>>>11|0);m:{if(d>>>0<=e>>>0){e=e-d|0;v[a+4>>2]=e;c=c-d|0;v[a>>2]=c;u[g+504>>1]=m-(m>>>5|0);n:{if(c>>>0>16777215){g=b;break n;}c=c<<8;v[a>>2]=c;g=b+1|0;v[a+16>>2]=g;e=w[v[a+12>>2]+b|0]|e<<8;v[a+4>>2]=e;}b=x[l+528>>1];f=B(b,c>>>11|0);o:{if(f>>>0>e>>>0){u[l+528>>1]=b+(2048-b>>>5|0);if(f>>>0<=16777215){f=f<<8;v[a>>2]=f;v[a+16>>2]=g+1;e=w[v[a+12>>2]+g|0]|e<<8;v[a+4>>2]=e;}d=x[k+600>>1];b=B(d,f>>>11|0);if(b>>>0<=e>>>0){v[a+4>>2]=e-b;v[a>>2]=f-b;u[k+600>>1]=d-(d>>>5|0);break o;}v[a>>2]=b;u[k+600>>1]=d+(2048-d>>>5|0);v[a+104>>2]=1;v[a+100>>2]=y[a+100>>2]<7?9:11;break m;}e=e-f|0;v[a+4>>2]=e;u[l+528>>1]=b-(b>>>5|0);c=c-f|0;p:{if(c>>>0>16777215){b=g;break p;}c=c<<8;v[a>>2]=c;b=g+1|0;v[a+16>>2]=b;e=w[v[a+12>>2]+g|0]|e<<8;v[a+4>>2]=e;}g=x[l+552>>1];d=B(g,c>>>11|0);q:{if(d>>>0>e>>>0){v[a>>2]=d;u[l+552>>1]=g+(2048-g>>>5|0);c=v[a+88>>2];break q;}e=e-d|0;v[a+4>>2]=e;u[l+552>>1]=g-(g>>>5|0);c=c-d|0;if(c>>>0<=16777215){c=c<<8;v[a>>2]=c;v[a+16>>2]=b+1;e=w[v[a+12>>2]+b|0]|e<<8;v[a+4>>2]=e;}d=x[l+576>>1];b=B(d,c>>>11|0);r:{if(b>>>0>e>>>0){v[a>>2]=b;u[l+576>>1]=d+(2048-d>>>5|0);c=v[a+92>>2];break r;}v[a+4>>2]=e-b;v[a>>2]=c-b;u[l+576>>1]=d-(d>>>5|0);c=v[a+96>>2];v[a+96>>2]=v[a+92>>2];}v[a+92>>2]=v[a+88>>2];}v[a+88>>2]=v[a+84>>2];v[a+84>>2]=c;}v[a+100>>2]=y[a+100>>2]<7?8:11;ca(a,o,i);break m;}v[a>>2]=d;u[g+504>>1]=m+(2048-m>>>5|0);v[a+96>>2]=v[a+92>>2];b=v[a+88>>2];v[a+88>>2]=v[a+84>>2];v[a+92>>2]=b;v[a+100>>2]=y[a+100>>2]<7?7:10;ca(a,n,i);b=v[a+104>>2];d=b>>>0<6?b-2|0:3;c=v[a>>2];e=1;while(1){e=e<<1;g=e+((d<<7)+a|0)|0;s:{if(c>>>0>=16777216){f=v[a+4>>2];break s;}c=c<<8;v[a>>2]=c;b=v[a+16>>2];v[a+16>>2]=b+1;f=w[b+v[a+12>>2]|0]|v[a+4>>2]<<8;v[a+4>>2]=f;}i=x[g+984>>1];b=B(i,c>>>11|0);t:{if(b>>>0<=f>>>0){f=f-b|0;v[a+4>>2]=f;c=c-b|0;v[a>>2]=c;u[g+984>>1]=i-(i>>>5|0);e=e|1;break t;}v[a>>2]=b;u[g+984>>1]=i+(2048-i>>>5|0);c=b;}if(e>>>0<64){continue;}break;}d=e+-64|0;if(d>>>0<=3){v[a+84>>2]=d;break m;}h=e&1|2;v[a+84>>2]=h;b=d>>>1|0;if(d>>>0<=13){i=b-1|0;k=h<<i;v[a+84>>2]=k;h=1;g=(((k<<1)+p|0)+(0-e<<1)|0)+1538|0;l=0;while(1){h=h<<1;m=g+h|0;u:{if(c>>>0>16777215){b=c;break u;}b=c<<8;v[a>>2]=b;d=v[a+16>>2];v[a+16>>2]=d+1;f=w[d+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}d=x[m>>1];c=B(d,b>>>11|0);v:{if(f>>>0>=c>>>0){f=f-c|0;v[a+4>>2]=f;c=b-c|0;v[a>>2]=c;u[m>>1]=d-(d>>>5|0);k=(1<<l)+k|0;v[a+84>>2]=k;h=h|1;break v;}v[a>>2]=c;u[m>>1]=d+(2048-d>>>5|0);}l=l+1|0;if((i|0)!=(l|0)){continue;}break;}break m;}e=b-5|0;while(1){w:{if(c>>>0>16777215){d=c;break w;}d=c<<8;v[a>>2]=d;b=v[a+16>>2];v[a+16>>2]=b+1;f=w[b+v[a+12>>2]|0]|f<<8;}c=d>>>1|0;v[a>>2]=c;g=f-c|0;b=g>>31;h=(b+(h<<1)|0)+1|0;v[a+84>>2]=h;f=g+(b&c)|0;v[a+4>>2]=f;e=e-1|0;if(e){continue;}break;}h=h<<4;v[a+84>>2]=h;if(d>>>0<=33554431){c=c<<8;v[a>>2]=c;b=v[a+16>>2];v[a+16>>2]=b+1;f=w[b+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}b=a;d=x[a+1726>>1];e=B(d,c>>>11|0);x:{if(f>>>0>=e>>>0){f=f-e|0;v[a+4>>2]=f;h=h|1;v[a+84>>2]=h;u[a+1726>>1]=d-(d>>>5|0);e=c-e|0;c=3;break x;}u[a+1726>>1]=d+(2048-d>>>5|0);c=2;}d=c<<1;g=(b+d|0)+1724|0;if(e>>>0<=16777215){e=e<<8;v[a>>2]=e;b=v[a+16>>2];v[a+16>>2]=b+1;f=w[b+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}b=x[g>>1];c=B(b,e>>>11|0);y:{if(f>>>0>=c>>>0){f=f-c|0;v[a+4>>2]=f;u[g>>1]=b-(b>>>5|0);h=h+2|0;v[a+84>>2]=h;c=e-c|0;d=d|1;break y;}u[g>>1]=b+(2048-b>>>5|0);}d=d<<1;g=(d+a|0)+1724|0;if(c>>>0<=16777215){c=c<<8;v[a>>2]=c;b=v[a+16>>2];v[a+16>>2]=b+1;f=w[b+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}b=x[g>>1];e=B(b,c>>>11|0);z:{if(f>>>0>=e>>>0){f=f-e|0;v[a+4>>2]=f;u[g>>1]=b-(b>>>5|0);h=h+4|0;v[a+84>>2]=h;e=c-e|0;d=d|1;break z;}u[g>>1]=b+(2048-b>>>5|0);}if(e>>>0<=16777215){e=e<<8;v[a>>2]=e;b=v[a+16>>2];v[a+16>>2]=b+1;f=w[b+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}b=((d<<1)+a|0)+1724|0;c=x[b>>1];d=B(c,e>>>11|0);if(d>>>0<=f>>>0){v[a+4>>2]=f-d;v[a>>2]=e-d;u[b>>1]=c-(c>>>5|0);v[a+84>>2]=h+8;break m;}v[a>>2]=d;u[b>>1]=c+(2048-c>>>5|0);}c=0;g=v[a+84>>2];if(g>>>0>=y[a+36>>2]|g>>>0>=y[a+48>>2]){break c;}k=v[a+32>>2];b=v[a+40>>2]-k|0;d=v[a+104>>2];i=b>>>0<d>>>0?b:d;v[a+104>>2]=d-i;c=k+(g^-1)|0;c=g>>>0>=k>>>0?v[a+44>>2]+c|0:c;d=v[a+24>>2];b=w[c+d|0];v[a+32>>2]=k+1;t[d+k|0]=b;f=i-1|0;A:{if(!f){break A;}if(f&1){b=c+1|0;c=(b|0)==v[a+44>>2]?0:b;g=v[a+24>>2];d=w[c+g|0];b=v[a+32>>2];v[a+32>>2]=b+1;t[b+g|0]=d;f=i-2|0;}if((i|0)==2){break A;}while(1){g=v[a+24>>2];b=c+1|0;c=(b|0)==v[a+44>>2]?0:b;d=w[g+c|0];b=v[a+32>>2];v[a+32>>2]=b+1;t[b+g|0]=d;b=c+1|0;c=(b|0)==v[a+44>>2]?0:b;g=v[a+24>>2];d=w[c+g|0];b=v[a+32>>2];v[a+32>>2]=b+1;t[b+g|0]=d;f=f-2|0;if(f){continue;}break;}}j=v[a+32>>2];if(j>>>0<=y[a+36>>2]){break f;}v[a+36>>2]=j;}if(y[a+40>>2]>j>>>0){continue;}break;}}c=1;b=v[a>>2];if(b>>>0>16777215){break c;}v[a>>2]=b<<8;b=v[a+16>>2];v[a+16>>2]=b+1;v[a+4>>2]=w[b+v[a+12>>2]|0]|v[a+4>>2]<<8;}return c;}function Z(a){var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0;i=8;a:{b:{if(a>>>0>4294967239){break b;}while(1){i=i>>>0>8?i:8;b=v[1291];f=b;e=v[1290];h=e;a=a>>>0>8?a+3&-4:8;c:{if(a>>>0<=127){g=(a>>>3|0)-1|0;break c;}d=E(a);g=((a>>>29-d^4)-(d<<2)|0)+110|0;if(a>>>0<=4095){break c;}d=((a>>>30-d^2)-(d<<1)|0)+71|0;g=d>>>0<63?d:63;}c=g;d=c&31;if((c&63)>>>0>=32){c=0;b=b>>>d|0;}else {c=b>>>d|0;b=((1<<d)-1&b)<<32-d|h>>>d;}d=c;if(b|c){while(1){f=b;c=d;d:{if(c|b){e=c-1|0;h=e+1|0;j=e;e=b-1|0;h=(e|0)!=-1?h:j;e=E(b^e)+32|0;b=E(c^h);b=(b|0)==32?e:b;c=63-b|0;Q=0-(b>>>0>63)|0;break d;}Q=0;c=64;}e=c;c=e;b=c&31;if((c&63)>>>0>=32){c=0;h=d>>>b|0;}else {c=d>>>b|0;h=((1<<b)-1&d)<<32-b|f>>>b;}d=c;g=e+g|0;f=g<<4;c=v[f+4136>>2];e=f+4128|0;e:{if((c|0)!=(e|0)){b=$(c,i,a);if(b){break b;}b=v[c+4>>2];v[b+8>>2]=v[c+8>>2];v[v[c+8>>2]+4>>2]=b;v[c+8>>2]=e;b=f+4132|0;v[c+4>>2]=v[b>>2];v[b>>2]=c;v[v[c+4>>2]+8>>2]=c;g=g+1|0;b=(d&1)<<31|h>>>1;d=d>>>1|0;break e;}k=v[1291];c=g;j=c&63;b=j;f=b&31;if(b>>>0>=32){b=0;e=-1>>>f|0;}else {e=-1>>>f|0;b=e;e=b|(1<<f)-1<<32-f;}e=e&-2;f=j&31;if(j>>>0>=32){b=e<<f;j=0;}else {b=(1<<f)-1&e>>>32-f|b<<f;j=e<<f;}f=b;e=0-c&63;c=e;b=c&31;if(c>>>0>=32){b=-1<<b;c=0;}else {c=-1<<b;b=c|(1<<b)-1&-1>>>32-b;}l=c&-2;c=e&31;if(e>>>0>=32){e=0;c=b>>>c|0;}else {e=b>>>c|0;c=((1<<c)-1&b)<<32-c|l>>>c;}b=c|j;Q=e|f;v[1290]=v[1290]&b;v[1291]=Q&k;b=h^1;}if(b|d){continue;}break;}e=v[1290];f=v[1291];}f:{if(e|f){d=E(f);h=63-((d|0)==32?E(e)+32|0:d)|0;b=h<<4;d=v[b+4136>>2];g:{if(!f&e>>>0<1073741824){break g;}g=99;c=b+4128|0;if((c|0)==(d|0)){break g;}while(1){if(!g){break g;}b=$(d,i,a);if(b){break b;}g=g-1|0;d=v[d+8>>2];if((c|0)!=(d|0)){continue;}break;}d=c;}if(aa(a+48|0)){break f;}if(!d){break a;}c=(h<<4)+4128|0;if((c|0)==(d|0)){break a;}while(1){b=$(d,i,a);if(b){break b;}d=v[d+8>>2];if((c|0)!=(d|0)){continue;}break;}break a;}if(!aa(a+48|0)){break a;}}b=0;if(i-1&i){break b;}if(a>>>0<=4294967239){continue;}break;}}return b;}return 0;}function W(a,b,c){var d=0,e=0;if(c>>>0>=512){O(a|0,b|0,c|0)|0;return;}d=a+c|0;a:{if(!((a^b)&3)){b:{if(!(a&3)){c=a;break b;}if(!c){c=a;break b;}c=a;while(1){t[c|0]=w[b|0];b=b+1|0;c=c+1|0;if(!(c&3)){break b;}if(c>>>0<d>>>0){continue;}break;}}a=d&-4;c:{if(a>>>0<64){break c;}e=a+-64|0;if(e>>>0<c>>>0){break c;}while(1){v[c>>2]=v[b>>2];v[c+4>>2]=v[b+4>>2];v[c+8>>2]=v[b+8>>2];v[c+12>>2]=v[b+12>>2];v[c+16>>2]=v[b+16>>2];v[c+20>>2]=v[b+20>>2];v[c+24>>2]=v[b+24>>2];v[c+28>>2]=v[b+28>>2];v[c+32>>2]=v[b+32>>2];v[c+36>>2]=v[b+36>>2];v[c+40>>2]=v[b+40>>2];v[c+44>>2]=v[b+44>>2];v[c+48>>2]=v[b+48>>2];v[c+52>>2]=v[b+52>>2];v[c+56>>2]=v[b+56>>2];v[c+60>>2]=v[b+60>>2];b=b- -64|0;c=c- -64|0;if(e>>>0>=c>>>0){continue;}break;}}if(a>>>0<=c>>>0){break a;}while(1){v[c>>2]=v[b>>2];b=b+4|0;c=c+4|0;if(a>>>0>c>>>0){continue;}break;}break a;}if(d>>>0<4){c=a;break a;}e=d-4|0;if(e>>>0<a>>>0){c=a;break a;}c=a;while(1){t[c|0]=w[b|0];t[c+1|0]=w[b+1|0];t[c+2|0]=w[b+2|0];t[c+3|0]=w[b+3|0];b=b+4|0;c=c+4|0;if(e>>>0>=c>>>0){continue;}break;}}if(c>>>0<d>>>0){while(1){t[c|0]=w[b|0];b=b+1|0;c=c+1|0;if((d|0)!=(c|0)){continue;}break;}}}function ca(a,b,c){var d=0,e=0,f=0,g=0,h=0,i=0,j=0;g=v[a>>2];a:{if(g>>>0>=16777216){f=v[a+4>>2];break a;}g=g<<8;v[a>>2]=g;d=v[a+16>>2];v[a+16>>2]=d+1;f=w[d+v[a+12>>2]|0]|v[a+4>>2]<<8;v[a+4>>2]=f;}d=x[b>>1];e=B(d,g>>>11|0);b:{if(f>>>0<e>>>0){u[b>>1]=d+(2048-d>>>5|0);j=((c<<4)+b|0)+4|0;i=2;d=8;break b;}f=f-e|0;v[a+4>>2]=f;u[b>>1]=d-(d>>>5|0);g=g-e|0;if(g>>>0<=16777215){g=g<<8;v[a>>2]=g;d=v[a+16>>2];v[a+16>>2]=d+1;f=w[d+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}d=x[b+2>>1];e=B(d,g>>>11|0);if(f>>>0<e>>>0){u[b+2>>1]=d+(2048-d>>>5|0);j=((c<<4)+b|0)+260|0;i=10;d=8;break b;}f=f-e|0;v[a+4>>2]=f;u[b+2>>1]=d-(d>>>5|0);j=b+516|0;e=g-e|0;i=18;d=256;}v[a+104>>2]=i;b=1;while(1){b=b<<1;g=j+b|0;c:{if(e>>>0>16777215){c=e;break c;}c=e<<8;v[a>>2]=c;e=v[a+16>>2];v[a+16>>2]=e+1;f=w[e+v[a+12>>2]|0]|f<<8;v[a+4>>2]=f;}h=x[g>>1];e=B(h,c>>>11|0);d:{if(f>>>0>=e>>>0){f=f-e|0;v[a+4>>2]=f;e=c-e|0;v[a>>2]=e;u[g>>1]=h-(h>>>5|0);b=b|1;break d;}v[a>>2]=e;u[g>>1]=(2048-h>>>5|0)+h;}if(b>>>0<d>>>0){continue;}break;}v[a+104>>2]=(b-d|0)+i;}function aa(a){var b=0,c=0,d=0,e=0,f=0,g=0;e=v[258];c=a+3&-4;b=e+c|0;a:{b:{if(b>>>0<=e>>>0?c:0){break b;}if(b>>>0>S()<<16>>>0){if(!(P(b|0)|0)){break b;}}v[258]=b;break a;}v[1292]=48;e=-1;}if((e|0)!=-1){c=a+e|0;b=c-16|0;v[b+12>>2]=16;v[b>>2]=16;a=v[1288];if(a){d=v[a+8>>2];}else {d=0;}c:{d:{if((d|0)==(e|0)){d=e-(v[e-4>>2]&-2)|0;f=v[d-4>>2];v[a+8>>2]=c;a=d-(f&-2)|0;c=-16;if(!(t[(a+v[a>>2]|0)-4|0]&1)){break d;}c=v[a+4>>2];v[c+8>>2]=v[a+8>>2];v[v[a+8>>2]+4>>2]=c;b=b-a|0;v[a>>2]=b;break c;}v[e+12>>2]=16;v[e>>2]=16;v[e+8>>2]=c;v[e+4>>2]=a;v[1288]=e;c=16;}a=e+c|0;b=b-a|0;v[a>>2]=b;}v[((b&-4)+a|0)-4>>2]=b|1;g=a;d=v[a>>2]-8|0;e:{if(d>>>0<=127){b=(d>>>3|0)-1|0;break e;}f=E(d);b=((d>>>29-f^4)-(f<<2)|0)+110|0;if(d>>>0<=4095){break e;}b=((d>>>30-f^2)-(f<<1)|0)+71|0;b=b>>>0<63?b:63;}c=b<<4;v[g+4>>2]=c+4128;c=c+4136|0;v[a+8>>2]=v[c>>2];v[c>>2]=a;v[v[a+8>>2]+4>>2]=a;c=v[1291];a=b&31;if((b&63)>>>0>=32){b=1<<a;d=0;}else {d=1<<a;b=d-1&1>>>32-a;}v[1290]=d|v[1290];v[1291]=b|c;}return (e|0)!=-1;}function ea(){var a=0,b=0,c=0,d=0,e=0,f=0,g=0,h=0;while(1){b=f;c=b>>>1|0;b=(b&1)<<31|g>>>1;a=b&1;d=0-a&-679014590;h=0-((a|0)!=0)&-915646571;a=g&1;e=0-a&-679014590;a=c^0-((a|0)!=0)&-915646571;c=b^e;b=a>>>1|0;a=(a&1)<<31|c>>>1;c=a^d;b=b^h;d=b>>>1|0;b=(b&1)<<31|c>>>1;c=b&1;a=a&1;e=0-a&-679014590;a=d^0-((a|0)!=0)&-915646571;d=b^e;b=a>>>1|0;a=(a&1)<<31|d>>>1;d=0-c&-679014590^a;c=b^0-((c|0)!=0)&-915646571;b=c>>>1|0;c=(c&1)<<31|d>>>1;d=c&1;h=0-d&-679014590;a=a&1;e=0-a&-679014590;b=b^0-((a|0)!=0)&-915646571;a=c^e;a=(b&1)<<31|a>>>1;c=0-((d|0)!=0)&-915646571^b>>>1;d=a^h;b=c>>>1|0;e=(g<<3)+2064|0;c=(c&1)<<31|d>>>1;d=c&1;a=a&1;h=0-a&-679014590;b=b^0-((a|0)!=0)&-915646571;a=c^h;v[e>>2]=0-d&-679014590^((b&1)<<31|a>>>1);v[e+4>>2]=0-((d|0)!=0)&-915646571^b>>>1;b=f;f=g+1|0;b=f?b:b+1|0;g=f;f=b;if((g|0)!=256|b){continue;}break;}}function $(a,b,c){var d=0,e=0,f=0,g=0;d=a+4|0;e=(d+b|0)-1&0-b;b=v[a>>2];if(e+c>>>0<=(b+a|0)-4>>>0){f=v[a+4>>2];v[f+8>>2]=v[a+8>>2];v[v[a+8>>2]+4>>2]=f;if((d|0)!=(e|0)){e=e-d|0;f=a-(v[a-4>>2]&-2)|0;d=e+v[f>>2]|0;v[f>>2]=d;v[(f+(d&-4)|0)-4>>2]=d;a=a+e|0;b=b-e|0;v[a>>2]=b;}a:{if(c+24>>>0<=b>>>0){d=(a+c|0)+8|0;b=(b-c|0)-8|0;v[d>>2]=b;v[(d+(b&-4)|0)-4>>2]=b|1;g=d;f=v[d>>2]-8|0;b:{if(f>>>0<=127){e=(f>>>3|0)-1|0;break b;}b=E(f);e=((f>>>29-b^4)-(b<<2)|0)+110|0;if(f>>>0<=4095){break b;}b=((f>>>30-b^2)-(b<<1)|0)+71|0;e=b>>>0<63?b:63;}b=e;e=b<<4;v[g+4>>2]=e+4128;e=e+4136|0;v[d+8>>2]=v[e>>2];v[e>>2]=d;v[v[d+8>>2]+4>>2]=d;e=v[1291];d=b&31;if((b&63)>>>0>=32){b=1<<d;f=0;}else {f=1<<d;b=f-1&1>>>32-d;}v[1290]=f|v[1290];v[1291]=b|e;b=c+8|0;v[a>>2]=b;v[((b&-4)+a|0)-4>>2]=b;break a;}v[(a+b|0)-4>>2]=b;}a=a+4|0;}else {a=0;}return a;}function X(a){var b=0,c=0,d=0,e=0,f=0;if(a){c=a-4|0;e=v[c>>2];b=e;d=c;f=v[a-8>>2];a=f&-2;if((a|0)!=(f|0)){d=c-a|0;b=v[d+4>>2];v[b+8>>2]=v[d+8>>2];v[v[d+8>>2]+4>>2]=b;b=a+e|0;}a=c+e|0;c=v[a>>2];if((c|0)!=v[(a+c|0)-4>>2]){e=v[a+4>>2];v[e+8>>2]=v[a+8>>2];v[v[a+8>>2]+4>>2]=e;b=b+c|0;}v[d>>2]=b;v[((b&-4)+d|0)-4>>2]=b|1;f=d;b=v[d>>2]-8|0;a:{if(b>>>0<=127){a=(b>>>3|0)-1|0;break a;}e=E(b);a=((b>>>29-e^4)-(e<<2)|0)+110|0;if(b>>>0<=4095){break a;}a=((b>>>30-e^2)-(e<<1)|0)+71|0;a=a>>>0<63?a:63;}c=a<<4;v[f+4>>2]=c+4128;c=c+4136|0;v[d+8>>2]=v[c>>2];v[c>>2]=d;v[v[d+8>>2]+4>>2]=d;c=v[1291];d=a&31;if((a&63)>>>0>=32){a=1<<d;b=0;}else {b=1<<d;a=b-1&1>>>32-d;}v[1290]=b|v[1290];v[1291]=a|c;}}function _(a,b){var c=0;a:{if(!b){break a;}c=a+b|0;t[c-1|0]=0;t[a|0]=0;if(b>>>0<3){break a;}t[c-2|0]=0;t[a+1|0]=0;t[c-3|0]=0;t[a+2|0]=0;if(b>>>0<7){break a;}t[c-4|0]=0;t[a+3|0]=0;if(b>>>0<9){break a;}c=0-a&3;a=c+a|0;v[a>>2]=0;c=b-c&-4;b=c+a|0;v[b-4>>2]=0;if(c>>>0<9){break a;}v[a+8>>2]=0;v[a+4>>2]=0;v[b-8>>2]=0;v[b-12>>2]=0;if(c>>>0<25){break a;}v[a+24>>2]=0;v[a+20>>2]=0;v[a+16>>2]=0;v[a+12>>2]=0;v[b-16>>2]=0;v[b-20>>2]=0;v[b-24>>2]=0;v[b-28>>2]=0;b=c;c=a&4|24;b=b-c|0;if(b>>>0<32){break a;}a=a+c|0;while(1){v[a+24>>2]=0;v[a+28>>2]=0;v[a+16>>2]=0;v[a+20>>2]=0;v[a+8>>2]=0;v[a+12>>2]=0;v[a>>2]=0;v[a+4>>2]=0;a=a+32|0;b=b-32|0;if(b>>>0>31){continue;}break;}}}function ja(a){a=a|0;var b=0,c=0,d=0,e=0,f=0;if(!w[4112]){ga();ea();t[4112]=1;}c=Z(28);e=c;b=Z(1208);a:{if(b){v[b+36>>2]=2;f=b;d=Z(28456);if(d){v[d+52>>2]=104857600;v[d+60>>2]=2;v[d+24>>2]=0;v[d+56>>2]=0;}else {d=0;}v[f+1200>>2]=d;if(d){t[b+40|0]=0;v[b>>2]=0;v[b+4>>2]=0;v[b+24>>2]=0;v[b+28>>2]=0;_(b+72|0,100);v[b+172>>2]=12;break a;}X(b);}b=0;}v[e>>2]=b;b=Z(a);v[c+8>>2]=0;v[c+12>>2]=0;v[c+4>>2]=b;b=Z(a);v[c+24>>2]=a;v[c+20>>2]=0;v[c+16>>2]=b;return c|0;}function ga(){var a=0,b=0,c=0,d=0;while(1){b=c>>>1|0;a=(b^0-(c&1)&-306674912)>>>1|0;b=(a^0-(b&1)&-306674912)>>>1|0;a=(0-(a&1)&-306674912^b)>>>1|0;d=0-(a&1)&-306674912;a=(a^0-(b&1)&-306674912)>>>1|0;b=(d^a)>>>1|0;a=(b^0-(a&1)&-306674912)>>>1|0;v[(c<<2)+1040>>2]=0-(a&1)&-306674912^(a^0-(b&1)&-306674912)>>>1;c=c+1|0;if((c|0)!=256){continue;}break;}}function fa(a,b,c){var d=0,e=0;a:{b:{if(c>>>0>=4){if((a|b)&3){break b;}while(1){if(v[a>>2]!=v[b>>2]){break b;}b=b+4|0;a=a+4|0;c=c-4|0;if(c>>>0>3){continue;}break;}}if(!c){break a;}}while(1){d=w[a|0];e=w[b|0];if((d|0)==(e|0)){b=b+1|0;a=a+1|0;c=c-1|0;if(c){continue;}break a;}break;}return d-e|0;}return 0;}function Y(a,b,c){var d=0;c=c^-1;a:{if(!b){break a;}if(b&1){c=v[((w[a|0]^c&255)<<2)+1040>>2]^c>>>8;a=a+1|0;d=b-1|0;}else {d=b;}if((b|0)==1){break a;}while(1){b=v[((w[a|0]^c&255)<<2)+1040>>2]^c>>>8;c=v[((w[a+1|0]^b&255)<<2)+1040>>2]^b>>>8;a=a+2|0;d=d-2|0;if(d){continue;}break;}}return c^-1;}function ba(a,b,c){var d=0,e=0,f=0;e=v[a+16>>2];d=c-e|0;f=d+v[a+128>>2]|0;c=v[a+132>>2];v[a+128>>2]=f;v[a+132>>2]=f>>>0<d>>>0?c+1|0:c;v[a+24>>2]=Y(b+e|0,d,v[a+24>>2]);v[a+28>>2]=0;}function la(a){a=a|0;var b=0,c=0;b=v[a>>2];if(b){c=v[b+1200>>2];if(v[c+60>>2]){X(v[c+24>>2]);}X(c);X(b);}X(v[a+4>>2]);X(v[a+16>>2]);X(a);}function ha(){var a=0,b=0,c=0;while(1){b=a<<4;c=b+4128|0;v[b+4132>>2]=c;v[b+4136>>2]=c;a=a+1|0;if((a|0)!=64){continue;}break;}aa(48);}function qa(a,b){a=a|0;b=b|0;v[a+12>>2]=b;v[a+8>>2]=0;}function ia(a){a=a|0;return y[a+8>>2]>=y[a+12>>2]|0;}function ka(){if(!w[4112]){ga();ea();t[4112]=1;}}function ra(a){a=a|0;return v[a+4>>2];}function oa(a){a=a|0;return v[a+20>>2];}function na(a){a=a|0;return v[a+16>>2];}function ma(a){a=a|0;v[a+20>>2]=0;}// EMSCRIPTEN_END_FUNCS
  e=w;p();var R=c([]);function S(){return s.byteLength/65536|0;}return {"d":ha,"e":ka,"f":ja,"g":ia,"h":ra,"i":qa,"j":pa,"k":oa,"l":na,"m":ma,"n":la,"o":R};}return T(V);}// EMSCRIPTEN_END_ASM
  (A);}function ca(){return {then:function then(b){b({instance:new ba()});}};}var da=Error,WebAssembly={};y=[];"object"!==_typeof(WebAssembly)&&B("no native wasm support detected");var D,E=false,F,G,z=a.INITIAL_MEMORY||83886080;a.wasmMemory?D=a.wasmMemory:D=new aa();D&&(F=D.buffer);z=F.byteLength;var H=F;F=H;a.HEAP8=new Int8Array(H);a.HEAP16=new Int16Array(H);a.HEAP32=new Int32Array(H);a.HEAPU8=G=new Uint8Array(H);a.HEAPU16=new Uint16Array(H);a.HEAPU32=new Uint32Array(H);a.HEAPF32=new Float32Array(H);a.HEAPF64=new Float64Array(H);var K,L=[],M=[],N=[];function fa(){var b=a.preRun.shift();L.unshift(b);}Math.imul||(Math.imul=function(b,e){var d=b&65535,m=e&65535;return d*m+((b>>>16)*m+d*(e>>>16)<<16)|0;});if(!Math.fround){var ha=new Float32Array(1);Math.fround=function(b){ha[0]=b;return ha[0];};}Math.clz32||(Math.clz32=function(b){var e=32,d=b>>16;d&&(e-=16,b=d);if(d=b>>8)e-=8,b=d;if(d=b>>4)e-=4,b=d;if(d=b>>2)e-=2,b=d;return b>>1?e-2:e-b;});Math.trunc||(Math.trunc=function(b){return 0>b?Math.ceil(b):Math.floor(b);});var O=0,T=null;a.preloadedImages={};a.preloadedAudios={};function B(b){if(a.onAbort)a.onAbort(b);b="Aborted("+b+")";x(b);E=true;b=new da(b+". Build with -s ASSERTIONS=1 for more info.");q(b);throw b;}function U(b){return b.startsWith("data:application/octet-stream;base64,");}var V;if(a.locateFile){if(V="xzdec-asm.wasm",!U(V)){var ia=V;V=a.locateFile?a.locateFile(ia,u):u+ia;}}else V=new URL("xzdec-asm.wasm",(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href)).toString();function ja(){var b=V;try{if(b==V&&y)return new Uint8Array(y);if(U(b))try{var e=ka(b.slice(37)),d=new Uint8Array(e.length);for(b=0;b<e.length;++b)d[b]=e.charCodeAt(b);var m=d;}catch(k){throw Error("Converting base64 string to bytes failed.");}else m=void 0;var h=m;if(h)return h;throw "both async and sync fetching of the wasm failed";}catch(k){B(k);}}function la(){return y||"function"!==typeof fetch?Promise.resolve().then(function(){return ja();}):fetch(V,{credentials:"same-origin"}).then(function(b){if(!b.ok)throw "failed to load wasm binary file at '"+V+"'";return b.arrayBuffer();}).catch(function(){return ja();});}function W(b){for(;0<b.length;){var e=b.shift();if("function"==typeof e)e(a);else {var d=e.H;"number"===typeof d?void 0===e.A?ma(d)():ma(d)(e.A):d(void 0===e.A?null:e.A);}}}var X=[];function ma(b){var e=X[b];e||(b>=X.length&&(X.length=b+1),X[b]=e=K.get(b));return e;}var ka="function"===typeof atob?atob:function(b){var e="",d=0;b=b.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(d++));var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(d++));var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(d++));var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(d++));m=m<<2|h>>4;h=(h&15)<<4|k>>2;var I=(k&3)<<6|v;e+=String.fromCharCode(m);64!==k&&(e+=String.fromCharCode(h));64!==v&&(e+=String.fromCharCode(I));}while(d<b.length);return e;},A={b:Uint8Array.prototype.copyWithin?function(b,e,d){G.copyWithin(b,e,e+d);}:function(b,e,d){G.set(G.subarray(e,e+d),b);},c:function c(){B("OOM");},a:D};(function(){function b(h){a.asm=h.exports;K=a.asm.o;M.unshift(a.asm.d);O--;a.monitorRunDependencies&&a.monitorRunDependencies(O);0==O&&(T&&(h=T,T=null,h()));}function e(h){b(h.instance);}function d(h){return la().then(function(){return ca();}).then(function(k){return k;}).then(h,function(k){x("failed to asynchronously prepare wasm: "+k);B(k);});}var m={a:A};O++;a.monitorRunDependencies&&a.monitorRunDependencies(O);if(a.instantiateWasm)try{return a.instantiateWasm(m,b);}catch(h){return x("Module.instantiateWasm callback failed with error: "+h),false;}(function(){return y||"function"!==typeof WebAssembly.instantiateStreaming||U(V)||"function"!==typeof fetch?d(e):fetch(V,{credentials:"same-origin"}).then(function(h){return WebAssembly.instantiateStreaming(h,m).then(e,function(k){x("wasm streaming compile failed: "+k);x("falling back to ArrayBuffer instantiation");return d(e);});});})().catch(q);return {};})();a.___wasm_call_ctors=function(){return (a.___wasm_call_ctors=a.asm.d).apply(null,arguments);};a._init=function(){return (a._init=a.asm.e).apply(null,arguments);};a._init_decompression=function(){return (a._init_decompression=a.asm.f).apply(null,arguments);};a._input_empty=function(){return (a._input_empty=a.asm.g).apply(null,arguments);};a._get_in_buffer=function(){return (a._get_in_buffer=a.asm.h).apply(null,arguments);};a._set_new_input=function(){return (a._set_new_input=a.asm.i).apply(null,arguments);};a._decompress=function(){return (a._decompress=a.asm.j).apply(null,arguments);};a._get_out_pos=function(){return (a._get_out_pos=a.asm.k).apply(null,arguments);};a._get_out_buffer=function(){return (a._get_out_buffer=a.asm.l).apply(null,arguments);};a._out_buffer_cleared=function(){return (a._out_buffer_cleared=a.asm.m).apply(null,arguments);};a._release=function(){return (a._release=a.asm.n).apply(null,arguments);};var Y;T=function na(){Y||Z();Y||(T=na);};function Z(){function b(){if(!Y&&(Y=true,a.calledRun=true,!E)){W(M);n(a);if(a.onRuntimeInitialized)a.onRuntimeInitialized();if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var e=a.postRun.shift();N.unshift(e);}W(N);}}if(!(0<O)){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)fa();W(L);0<O||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("");},1);b();},1)):b());}}a.run=Z;if(a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();Z();return XZ.ready;};}();

  var XZ=function(){var _scriptDir=(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href);return function(XZ){XZ=XZ||{};var a;a||(a=typeof XZ!=='undefined'?XZ:{});var e,f;a.ready=new Promise(function(b,c){e=b;f=c;});var h={},l;for(l in a)a.hasOwnProperty(l)&&(h[l]=a[l]);var m="";"undefined"!==typeof document&&document.currentScript&&(m=document.currentScript.src);_scriptDir&&(m=_scriptDir);0!==m.indexOf("blob:")?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="";var n=a.printErr||console.warn.bind(console);for(l in h)h.hasOwnProperty(l)&&(a[l]=h[l]);h=null;var p;a.wasmBinary&&(p=a.wasmBinary);a.noExitRuntime||true;"object"!==(typeof WebAssembly==="undefined"?"undefined":_typeof(WebAssembly))&&q("no native wasm support detected");var r,t=false,u,v,w=[],x=[],z=[];function A(){var b=a.preRun.shift();w.unshift(b);}var B=0,D=null;a.preloadedImages={};a.preloadedAudios={};function q(b){if(a.onAbort)a.onAbort(b);b="Aborted("+b+")";n(b);t=true;b=new WebAssembly.RuntimeError(b+". Build with -s ASSERTIONS=1 for more info.");f(b);throw b;}function E(){return F.startsWith("data:application/octet-stream;base64,");}var F;if(a.locateFile){if(F="xzdec-wasm.wasm",!E()){var G=F;F=a.locateFile?a.locateFile(G,m):m+G;}}else F=new URL("xzdec-wasm.wasm",(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href)).toString();function H(){var b=F;try{if(b==F&&p)return new Uint8Array(p);throw "both async and sync fetching of the wasm failed";}catch(c){q(c);}}function I(){return p||"function"!==typeof fetch?Promise.resolve().then(function(){return H();}):fetch(F,{credentials:"same-origin"}).then(function(b){if(!b.ok)throw "failed to load wasm binary file at '"+F+"'";return b.arrayBuffer();}).catch(function(){return H();});}function J(b){for(;0<b.length;){var c=b.shift();if("function"==typeof c)c(a);else {var g=c.u;"number"===typeof g?void 0===c.s?K(g)():K(g)(c.s):g(void 0===c.s?null:c.s);}}}var L=[];function K(b){var c=L[b];c||(b>=L.length&&(L.length=b+1),L[b]=c=v.get(b));return c;}var M={a:function a(b,c,g){u.copyWithin(b,c,c+g);},b:function b(){q("OOM");}};(function(){function b(d){a.asm=d.exports;r=a.asm.c;d=r.buffer;a.HEAP8=new Int8Array(d);a.HEAP16=new Int16Array(d);a.HEAP32=new Int32Array(d);a.HEAPU8=u=new Uint8Array(d);a.HEAPU16=new Uint16Array(d);a.HEAPU32=new Uint32Array(d);a.HEAPF32=new Float32Array(d);a.HEAPF64=new Float64Array(d);v=a.asm.o;x.unshift(a.asm.d);B--;a.monitorRunDependencies&&a.monitorRunDependencies(B);0==B&&(D&&(d=D,D=null,d()));}function c(d){b(d.instance);}function g(d){return I().then(function(k){return WebAssembly.instantiate(k,y);}).then(function(k){return k;}).then(d,function(k){n("failed to asynchronously prepare wasm: "+k);q(k);});}var y={a:M};B++;a.monitorRunDependencies&&a.monitorRunDependencies(B);if(a.instantiateWasm)try{return a.instantiateWasm(y,b);}catch(d){return n("Module.instantiateWasm callback failed with error: "+d),false;}(function(){return p||"function"!==typeof WebAssembly.instantiateStreaming||E()||"function"!==typeof fetch?g(c):fetch(F,{credentials:"same-origin"}).then(function(d){return WebAssembly.instantiateStreaming(d,y).then(c,function(k){n("wasm streaming compile failed: "+k);n("falling back to ArrayBuffer instantiation");return g(c);});});})().catch(f);return {};})();a.___wasm_call_ctors=function(){return (a.___wasm_call_ctors=a.asm.d).apply(null,arguments);};a._init=function(){return (a._init=a.asm.e).apply(null,arguments);};a._init_decompression=function(){return (a._init_decompression=a.asm.f).apply(null,arguments);};a._input_empty=function(){return (a._input_empty=a.asm.g).apply(null,arguments);};a._get_in_buffer=function(){return (a._get_in_buffer=a.asm.h).apply(null,arguments);};a._set_new_input=function(){return (a._set_new_input=a.asm.i).apply(null,arguments);};a._decompress=function(){return (a._decompress=a.asm.j).apply(null,arguments);};a._get_out_pos=function(){return (a._get_out_pos=a.asm.k).apply(null,arguments);};a._get_out_buffer=function(){return (a._get_out_buffer=a.asm.l).apply(null,arguments);};a._out_buffer_cleared=function(){return (a._out_buffer_cleared=a.asm.m).apply(null,arguments);};a._release=function(){return (a._release=a.asm.n).apply(null,arguments);};var N;D=function O(){N||P();N||(D=O);};function P(){function b(){if(!N&&(N=true,a.calledRun=true,!t)){J(x);e(a);if(a.onRuntimeInitialized)a.onRuntimeInitialized();if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var c=a.postRun.shift();z.unshift(c);}J(z);}}if(!(0<B)){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)A();J(w);0<B||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("");},1);b();},1)):b());}}a.run=P;if(a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();P();return XZ.ready;};}();

  var XZMachineType=null;// Select asm or wasm conditionally
  if('WebAssembly'in self){console.debug('Instantiating WASM xz decoder');XZMachineType='WASM';}else {console.debug('Instantiating ASM xz decoder');XZMachineType='ASM';}// DEV: xzdec.js has been compiled with `-s EXPORT_NAME="XZ" -s MODULARIZE=1` to avoid a clash with zstddec.js
  // For explanation of loading method below to avoid conflicts, see https://github.com/emscripten-core/emscripten/blob/master/src/settings.js
  /**
   * @typedef EMSInstance An object type representing an Emscripten instance
   *//**
   * The XZ Decoder instance
   * @type EMSInstance
   */var xzdec;var loadASM$1=function loadASM(){XZ$1().then(function(instance){params.decompressorAPI.assemblerMachineType=XZMachineType;xzdec=instance;}).catch(function(err){uiUtil.reportAssemblerErrorToAPIStatusPanel('XZ',err,XZMachineType);});};if(XZMachineType==='WASM'){XZ().then(function(instance){params.decompressorAPI.assemblerMachineType=XZMachineType;xzdec=instance;}).catch(function(err){XZMachineType='ASM';loadASM$1();});}else {loadASM$1();}/**
   * Number of milliseconds to wait for the decompressor to be available for another chunk
   * @type Integer
   */var DELAY_WAITING_IDLE_DECOMPRESSOR$1=50;/**
   * Is the decompressor already working?
   * @type Boolean
   */var busy$1=false;/**
   * @typedef Decompressor
   * @property {Integer} _chunkSize
   * @property {FileReader} _reader
   * @property {unresolved} _decHandle
   * @property {Integer} _inStreamPos
   * @property {Integer} _outStreamPos
   * @property {Array} _outBuffer
   *//**
   * @constructor
   * @param {FileReader} reader
   * @param {Integer} chunkSize
   * @returns {Decompressor}
   */function Decompressor$1(reader,chunkSize){params.decompressorAPI.decompressorLastUsed='XZ';this._chunkSize=chunkSize||1024*5;this._reader=reader;}/**
   * Read length bytes, offset into the decompressed stream. Consecutive calls may only
   * advance in the stream and may not overlap.
   * @param {Integer} offset
   * @param {Integer} length
   */Decompressor$1.prototype.readSlice=function(offset,length){busy$1=true;var that=this;this._inStreamPos=0;this._outStreamPos=0;this._decHandle=xzdec._init_decompression(this._chunkSize);this._outBuffer=new Int8Array(new ArrayBuffer(length));this._outBufferPos=0;return this._readLoop(offset,length).then(function(data){xzdec._release(that._decHandle);busy$1=false;return data;});};/**
   * Reads stream of data from file offset for length of bytes to send to the decompresor
   * This function ensures that only one decompression runs at a time
   * @param {Integer} offset The file offset at which to begin reading compressed data
   * @param {Integer} length The amount of data to read
   * @returns {Promise} A Promise for the read data
   */Decompressor$1.prototype.readSliceSingleThread=function(offset,length){// Tests whether the decompressor is ready (initiated) and not busy
  if(xzdec&&!busy$1){return this.readSlice(offset,length);}else {// The decompressor is already in progress.
  // To avoid using too much memory, we wait until it has finished
  // before using it for another decompression
  var that=this;return new Promise(function(resolve,reject){setTimeout(function(){that.readSliceSingleThread(offset,length).then(resolve,reject);},DELAY_WAITING_IDLE_DECOMPRESSOR$1);});}};/**
   * 
   * @param {Integer} offset
   * @param {Integer} length
   * @returns {Array}
   */Decompressor$1.prototype._readLoop=function(offset,length){var that=this;return this._fillInBufferIfNeeded().then(function(){var ret=xzdec._decompress(that._decHandle);var finished=false;if(ret===0);else if(ret===1){// stream ended
  finished=true;}else {// error @todo handle
  finished=true;}var outPos=xzdec._get_out_pos(that._decHandle);if(outPos>0&&that._outStreamPos+outPos>=offset){var outBuffer=xzdec._get_out_buffer(that._decHandle);var copyStart=offset-that._outStreamPos;if(copyStart<0)copyStart=0;for(var i=copyStart;i<outPos&&that._outBufferPos<that._outBuffer.length;i++)that._outBuffer[that._outBufferPos++]=xzdec.HEAP8[outBuffer+i];}that._outStreamPos+=outPos;if(outPos>0)xzdec._out_buffer_cleared(that._decHandle);if(finished||that._outStreamPos>=offset+length)return that._outBuffer;else return that._readLoop(offset,length);});};/**
   * 
   * @returns {Promise}
   */Decompressor$1.prototype._fillInBufferIfNeeded=function(){if(!xzdec._input_empty(this._decHandle)){return Promise.resolve(0);}var that=this;return this._reader(this._inStreamPos,this._chunkSize).then(function(data){if(data.length>that._chunkSize)data=data.slice(0,that._chunkSize);// For some reason, xzdec.writeArrayToMemory does not seem to be available, and is equivalent to xzdec.HEAP8.set
  xzdec.HEAP8.set(data,xzdec._get_in_buffer(that._decHandle));that._inStreamPos+=data.length;xzdec._set_new_input(that._decHandle,data.length);return 0;});};var xz = {Decompressor:Decompressor$1};

  var $$5 = _export;
  var iterate = iterate$6;
  var aCallable$1 = aCallable$h;
  var anObject$1 = anObject$s;
  var getIteratorDirect$1 = getIteratorDirect$4;

  // `Iterator.prototype.every` method
  // https://github.com/tc39/proposal-iterator-helpers
  $$5({ target: 'Iterator', proto: true, real: true }, {
    every: function every(predicate) {
      anObject$1(this);
      aCallable$1(predicate);
      var record = getIteratorDirect$1(this);
      var counter = 0;
      return !iterate(record, function (value, stop) {
        if (!predicate(value, counter++)) return stop();
      }, { IS_RECORD: true, INTERRUPTED: true }).stopped;
    }
  });

  var ZD$1=function(){var _scriptDir=(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href);return function(ZD){ZD=ZD||{};var a;a||(a=typeof ZD!=='undefined'?ZD:{});var Promise=function(){function c(){}function f(b,e){return function(){b.apply(e,arguments);};}function d(b){if(!(this instanceof d))throw new TypeError("Promises must be constructed via new");if("function"!==typeof b)throw new TypeError("not a function");this.s=0;this.B=false;this.u=void 0;this.v=[];C(b,this);}function n(b,e){for(;3===b.s;)b=b.u;0===b.s?b.v.push(e):(b.B=true,d.C(function(){var g=1===b.s?e.F:e.G;if(null===g)(1===b.s?l:m)(e.promise,b.u);else {try{var h=g(b.u);}catch(k){m(e.promise,k);return;}l(e.promise,h);}}));}function l(b,e){try{if(e===b)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===_typeof(e)||"function"===typeof e)){var g=e.then;if(e instanceof d){b.s=3;b.u=e;q(b);return;}if("function"===typeof g){C(f(g,e),b);return;}}b.s=1;b.u=e;q(b);}catch(h){m(b,h);}}function m(b,e){b.s=2;b.u=e;q(b);}function q(b){2===b.s&&0===b.v.length&&d.C(function(){b.B||d.D(b.u);});for(var e=0,g=b.v.length;e<g;e++)n(b,b.v[e]);b.v=null;}function r(b,e,g){this.F="function"===typeof b?b:null;this.G="function"===typeof e?e:null;this.promise=g;}function C(b,e){var g=false;try{b(function(h){g||(g=!0,l(e,h));},function(h){g||(g=!0,m(e,h));});}catch(h){g||(g=true,m(e,h));}}d.prototype["catch"]=function(b){return this.then(null,b);};d.prototype.then=function(b,e){var g=new this.constructor(c);n(this,new r(b,e,g));return g;};d.all=function(b){return new d(function(e,g){function h(I,z){try{if(z&&("object"===_typeof(z)||"function"===typeof z)){var T=z.then;if("function"===typeof T){T.call(z,function(M){h(I,M);},g);return;}}k[I]=z;0===--u&&e(k);}catch(M){g(M);}}if(!Array.isArray(b))return g(new TypeError("Promise.all accepts an array"));var k=Array.prototype.slice.call(b);if(0===k.length)return e([]);for(var u=k.length,p=0;p<k.length;p++)h(p,k[p]);});};d.resolve=function(b){return b&&"object"===_typeof(b)&&b.constructor===d?b:new d(function(e){e(b);});};d.reject=function(b){return new d(function(e,g){g(b);});};d.race=function(b){return new d(function(e,g){if(!Array.isArray(b))return g(new TypeError("Promise.race accepts an array"));for(var h=0,k=b.length;h<k;h++)d.resolve(b[h]).then(e,g);});};d.C="function"===typeof setImmediate&&function(b){setImmediate(b);}||function(b){setTimeout(b,0);};d.D=function(b){"undefined"!==typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",b);};return d;}(),t,v;a.ready=new Promise(function(c,f){t=c;v=f;});var w={},x;for(x in a)a.hasOwnProperty(x)&&(w[x]=a[x]);var y="";"undefined"!==typeof document&&document.currentScript&&(y=document.currentScript.src);_scriptDir&&(y=_scriptDir);0!==y.indexOf("blob:")?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="";var A=a.printErr||console.warn.bind(console);for(x in w)w.hasOwnProperty(x)&&(a[x]=w[x]);w=null;var B;a.wasmBinary&&(B=a.wasmBinary);a.noExitRuntime||true;function aa(){this.buffer=new ArrayBuffer(D/65536*65536);}function ba(){this.exports=// EMSCRIPTEN_START_ASM
  function instantiate(W){function c(d){d.set=function(a,b){this[a]=b;};d.get=function(a){return this[a];};return d;}var e;var f=new Uint8Array(123);for(var a=25;a>=0;--a){f[48+a]=52+a;f[65+a]=a;f[97+a]=26+a;}f[43]=62;f[47]=63;function l(m,n,o){var g,h,a=0,i=n,j=o.length,k=n+(j*3>>2)-(o[j-2]=="=")-(o[j-1]=="=");for(;a<j;a+=4){g=f[o.charCodeAt(a+1)];h=f[o.charCodeAt(a+2)];m[i++]=f[o.charCodeAt(a)]<<2|g>>4;if(i<k)m[i++]=g<<4|h>>2;if(i<k)m[i++]=h<<6|f[o.charCodeAt(a+3)];}}function p(q){l(e,1024,"QWxsb2NhdGlvbiBlcnJvciA6IG5vdCBlbm91Z2ggbWVtb3J5AENvbnRleHQgc2hvdWxkIGJlIGluaXQgZmlyc3QAU3JjIHNpemUgaXMgaW5jb3JyZWN0AENhbm5vdCBjcmVhdGUgRGljdGlvbmFyeSBmcm9tIHByb3ZpZGVkIHNhbXBsZXMAVW5rbm93biBmcmFtZSBkZXNjcmlwdG9yAFVuc3VwcG9ydGVkIGZyYW1lIHBhcmFtZXRlcgBVbnN1cHBvcnRlZCBwYXJhbWV0ZXIAT3BlcmF0aW9uIG9uIE5VTEwgZGVzdGluYXRpb24gYnVmZmVyAFJlc3RvcmVkIGRhdGEgZG9lc24ndCBtYXRjaCBjaGVja3N1bQBEZXN0aW5hdGlvbiBidWZmZXIgaXMgdG9vIHNtYWxsAFNwZWNpZmllZCBtYXhTeW1ib2xWYWx1ZSBpcyB0b28gc21hbGwAd29ya1NwYWNlIGJ1ZmZlciBpcyBub3QgbGFyZ2UgZW5vdWdoAERpY3Rpb25hcnkgbWlzbWF0Y2gARGVzdGluYXRpb24gYnVmZmVyIGlzIHdyb25nAEFuIEkvTyBlcnJvciBvY2N1cnJlZCB3aGVuIHJlYWRpbmcvc2Vla2luZwBGcmFtZSByZXF1aXJlcyB0b28gbXVjaCBtZW1vcnkgZm9yIGRlY29kaW5nAEZyYW1lIGluZGV4IGlzIHRvbyBsYXJnZQBVbnN1cHBvcnRlZCBtYXggU3ltYm9sIFZhbHVlIDogdG9vIGxhcmdlAE9wZXJhdGlvbiBub3QgYXV0aG9yaXplZCBhdCBjdXJyZW50IHByb2Nlc3Npbmcgc3RhZ2UAVW5zcGVjaWZpZWQgZXJyb3IgY29kZQBQYXJhbWV0ZXIgaXMgb3V0IG9mIGJvdW5kAHRhYmxlTG9nIHJlcXVpcmVzIHRvbyBtdWNoIG1lbW9yeSA6IHVuc3VwcG9ydGVkAFZlcnNpb24gbm90IHN1cHBvcnRlZABEaWN0aW9uYXJ5IGlzIGNvcnJ1cHRlZABObyBlcnJvciBkZXRlY3RlZABDb3JydXB0ZWQgYmxvY2sgZGV0ZWN0ZWQARXJyb3IgKGdlbmVyaWMp");l(e,1880,"AQAAAAEAAAACAAAAAg==");l(e,1904,"AQAAAAEAAAACAAAAAgAAACYAAACCAAAAIQUAAEoAAABnCAAAJgAAAMABAACAAAAASQUAAEoAAAC+CAAAKQAAACwCAACAAAAASQUAAEoAAAC+CAAALwAAAMoCAACAAAAAigUAAEoAAACECQAANQAAAHMDAACAAAAAnQUAAEoAAACgCQAAPQAAAIEDAACAAAAA6wUAAEsAAAA+CgAARAAAAJ4DAACAAAAATQYAAEsAAACqCgAASwAAALMDAACAAAAAwQYAAE0AAAAfDQAATQAAAFMEAACAAAAAIwgAAFEAAACmDwAAVAAAAJkEAACAAAAASwkAAFcAAACxEgAAWAAAANoEAACAAAAAbwkAAF0AAAAjFAAAVAAAAEUFAACAAAAAVAoAAGoAAACMFAAAagAAAK8FAACAAAAAdgkAAHwAAABOEAAAfAAAANICAACAAAAAYwcAAJEAAACQBwAAkgAAAAAAAAABAAAAAQAAAAUAAAANAAAAHQAAAD0AAAB9AAAA/QAAAP0BAAD9AwAA/QcAAP0PAAD9HwAA/T8AAP1/AAD9/wAA/f8BAP3/AwD9/wcA/f8PAP3/HwD9/z8A/f9/AP3//wD9//8B/f//A/3//wf9//8P/f//H/3//z/9//9/AAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAAAARAAAAEgAAABMAAAAUAAAAFQAAABYAAAAXAAAAGAAAABkAAAAaAAAAGwAAABwAAAAdAAAAHgAAAB8AAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAACAAAAAhAAAAIgAAACMAAAAlAAAAJwAAACkAAAArAAAALwAAADMAAAA7AAAAQwAAAFMAAABjAAAAgwAAAAMBAAADAgAAAwQAAAMIAAADEAAAAyAAAANAAAADgAAAAwAB");l(e,2864,"AQAAAAEAAAABAAAAAQAAAAIAAAACAAAAAwAAAAMAAAAEAAAABAAAAAUAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQ");l(e,2964,"AQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQ==");l(e,3168,"AQAAAAEAAAABAAAAAQAAAAIAAAACAAAAAwAAAAMAAAAEAAAABgAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAAAABAAAABAAAAAgAAAAAAAAAAQABAQYAAAAAAAAEAAAAABAAAAQAAAAAIAAABQEAAAAAAAAFAwAAAAAAAAUEAAAAAAAABQYAAAAAAAAFBwAAAAAAAAUJAAAAAAAABQoAAAAAAAAFDAAAAAAAAAYOAAAAAAABBRAAAAAAAAEFFAAAAAAAAQUWAAAAAAACBRwAAAAAAAMFIAAAAAAABAUwAAAAIAAGBUAAAAAAAAcFgAAAAAAACAYAAQAAAAAKBgAEAAAAAAwGABAAACAAAAQAAAAAAAAABAEAAAAAAAAFAgAAACAAAAUEAAAAAAAABQUAAAAgAAAFBwAAAAAAAAUIAAAAIAAABQoAAAAAAAAFCwAAAAAAAAYNAAAAIAABBRAAAAAAAAEFEgAAACAAAQUWAAAAAAACBRgAAAAgAAMFIAAAAAAAAwUoAAAAAAAGBEAAAAAQAAYEQAAAACAABwWAAAAAAAAJBgACAAAAAAsGAAgAADAAAAQAAAAAEAAABAEAAAAgAAAFAgAAACAAAAUDAAAAIAAABQUAAAAgAAAFBgAAACAAAAUIAAAAIAAABQkAAAAgAAAFCwAAACAAAAUMAAAAAAAABg8AAAAgAAEFEgAAACAAAQUUAAAAIAACBRgAAAAgAAIFHAAAACAAAwUoAAAAIAAEBTAAAAAAABAGAAABAAAADwYAgAAAAAAOBgBAAAAAAA0GACA=");l(e,3792,"AQABAQUAAAAAAAAFAAAAAAAABgQ9AAAAAAAJBf0BAAAAAA8F/X8AAAAAFQX9/x8AAAADBQUAAAAAAAcEfQAAAAAADAX9DwAAAAASBf3/AwAAABcF/f9/AAAABQUdAAAAAAAIBP0AAAAAAA4F/T8AAAAAFAX9/w8AAAACBQEAAAAQAAcEfQAAAAAACwX9BwAAAAARBf3/AQAAABYF/f8/AAAABAUNAAAAEAAIBP0AAAAAAA0F/R8AAAAAEwX9/wcAAAABBQEAAAAQAAYEPQAAAAAACgX9AwAAAAAQBf3/AAAAABwF/f//DwAAGwX9//8HAAAaBf3//wMAABkF/f//AQAAGAX9//8=");l(e,4064,"AQABAQYAAAAAAAAGAwAAAAAAAAQEAAAAIAAABQUAAAAAAAAFBgAAAAAAAAUIAAAAAAAABQkAAAAAAAAFCwAAAAAAAAYNAAAAAAAABhAAAAAAAAAGEwAAAAAAAAYWAAAAAAAABhkAAAAAAAAGHAAAAAAAAAYfAAAAAAAABiIAAAAAAAEGJQAAAAAAAQYpAAAAAAACBi8AAAAAAAMGOwAAAAAABAZTAAAAAAAHBoMAAAAAAAkGAwIAABAAAAQEAAAAAAAABAUAAAAgAAAFBgAAAAAAAAUHAAAAIAAABQkAAAAAAAAFCgAAAAAAAAYMAAAAAAAABg8AAAAAAAAGEgAAAAAAAAYVAAAAAAAABhgAAAAAAAAGGwAAAAAAAAYeAAAAAAAABiEAAAAAAAEGIwAAAAAAAQYnAAAAAAACBisAAAAAAAMGMwAAAAAABAZDAAAAAAAFBmMAAAAAAAgGAwEAACAAAAQEAAAAMAAABAQAAAAQAAAEBQAAACAAAAUHAAAAIAAABQgAAAAgAAAFCgAAACAAAAULAAAAAAAABg4AAAAAAAAGEQAAAAAAAAYUAAAAAAAABhcAAAAAAAAGGgAAAAAAAAYdAAAAAAAABiAAAAAAABAGAwABAAAADwYDgAAAAAAOBgNAAAAAAA0GAyAAAAAADAYDEAAAAAALBgMIAAAAAAoGAwQ=");l(e,4596,"AQAAAAMAAAAHAAAADwAAAB8AAAA/AAAAfwAAAP8AAAD/AQAA/wMAAP8HAAD/DwAA/x8AAP8/AAD/fwAA//8AAP//AQD//wMA//8HAP//DwD//x8A//8/AP//fwD///8A////Af///wP///8H////D////x////8/////fwAAAAABAAAAAgAAAAQAAAAAAAAAAgAAAAQAAAAIAAAAAAAAAAEAAAACAAAAAQAAAAQAAAAEAAAABAAAAAQAAAAIAAAACAAAAAgAAAAHAAAACAAAAAkAAAAKAAAACw==");l(e,4817,"F1A=");}function U(V){var r=V.a;var s=r.buffer;var t=new Int8Array(s);var u=new Int16Array(s);var v=new Int32Array(s);var w=new Uint8Array(s);var x=new Uint16Array(s);var y=new Uint32Array(s);var B=Math.imul;var E=Math.clz32;V.abort;var O=V.b;var P=V.c;var Q=5248768;var R=0;// EMSCRIPTEN_START_FUNCS
  function qa(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,u=0,z=0,A=0,C=0,D=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,R=0,S=0,T=0,U=0,V=0;k=Q-192|0;Q=k;g=a+28760|0;f=v[g+4>>2];g=v[g>>2];h=!f&g>>>0>33554432|(f|0)!=0;p=-72;a:{if(e>>>0>131071){break a;}F=-20;b:{c:{if(e>>>0<3){break c;}d:{e:{f:{g:{h:{p=w[d|0];A=p&3;switch(A-1|0){case 0:break f;case 1:break g;case 2:break h;default:break e;}}if(v[a+28808>>2]){break g;}p=-30;break b;}if(e>>>0<5){break c;}o=3;f=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);i:{j:{k:{l:{j=p>>>2&3;switch(j-2|0){case 1:break j;case 0:break k;default:break l;}}g=f>>>14&1023;p=f>>>4&1023;f=!j;break i;}g=f>>>18|0;o=4;p=f>>>4&16383;f=0;break i;}p=f>>>4&262143;if(p>>>0>131072){break c;}g=w[d+4|0]<<10|f>>>22;o=5;f=0;}C=g+o|0;if(C>>>0>e>>>0){break c;}if(!v[a+28956>>2]|p>>>0<769){break d;}while(1){if(n>>>0>=16324){break d;}n=n+512|0;continue;}}g=2;m:{n:{switch((p>>>2&3)-1|0){default:g=1;f=p>>>3|0;break m;case 0:f=(w[d|0]|w[d+1|0]<<8)>>>4|0;break m;case 2:break n;}}if(e>>>0<4){break c;}f=w[d|0]|w[d+1|0]<<8|w[d+2|0]<<16;if(f>>>0>2097167){break c;}g=3;f=f>>>4|0;}j=_(a+29040|0,w[d+g|0],f+32|0);v[a+28928>>2]=f;v[a+28912>>2]=j;F=g+1|0;break c;}g=2;j=e;o:{p:{switch((p>>>2&3)-1|0){default:g=1;f=p>>>3|0;break o;case 0:f=(w[d|0]|w[d+1|0]<<8)>>>4|0;break o;case 2:break p;}}g=3;f=(w[d|0]|w[d+1|0]<<8|w[d+2|0]<<16)>>>4|0;}p=f+g|0;if(p+32>>>0>j>>>0){if(e>>>0<p>>>0){break c;}g=X(a+29040|0,d+g|0,f);v[a+28928>>2]=f;v[a+28912>>2]=g;f=f+g|0;t[f+24|0]=0;t[f+25|0]=0;t[f+26|0]=0;t[f+27|0]=0;t[f+28|0]=0;t[f+29|0]=0;t[f+30|0]=0;t[f+31|0]=0;t[f+16|0]=0;t[f+17|0]=0;t[f+18|0]=0;t[f+19|0]=0;t[f+20|0]=0;t[f+21|0]=0;t[f+22|0]=0;t[f+23|0]=0;t[f+8|0]=0;t[f+9|0]=0;t[f+10|0]=0;t[f+11|0]=0;t[f+12|0]=0;t[f+13|0]=0;t[f+14|0]=0;t[f+15|0]=0;t[f|0]=0;t[f+1|0]=0;t[f+2|0]=0;t[f+3|0]=0;t[f+4|0]=0;t[f+5|0]=0;t[f+6|0]=0;t[f+7|0]=0;break b;}v[a+28928>>2]=f;v[a+28912>>2]=d+g;break b;}q:{if((A|0)==3){l=d+o|0;o=a+29040|0;j=v[a+12>>2];if(f){r:{if(w[j+1|0]){f=-72;s:{if(!g){break s;}t:{u:{v:{if(g>>>0>=4){n=w[(g+l|0)-1|0];f=-1;if(!n){break t;}if(g>>>0<=4294967176){break v;}f=g;break s;}r=w[l|0];w:{switch(g-2|0){case 1:r=w[l+2|0]<<16|r;case 0:r=(w[l+1|0]<<8)+r|0;break;default:break w;}}n=w[(g+l|0)-1|0];f=-20;if(!n){break s;}g=(E(n)-(g<<3)|0)+9|0;break u;}i=g-4|0;f=l+i|0;r=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);g=E(n)-23|0;}s=j+4|0;u=p+o|0;D=0-x[j+2>>1]&31;x:{y:{if(g>>>0<=32){m=u-3|0;z:{while(1){A:{if((i|0)>=4){r=g>>>3|0;j=0;g=g&7;break A;}if(!i){m=u-2|0;i=0;n=l;break y;}f=g>>>3|0;j=l>>>0>(i+l|0)-f>>>0;r=j?i:f;g=g-(r<<3)|0;}i=i-r|0;n=l+i|0;r=w[n|0]|w[n+1|0]<<8|(w[n+2|0]<<16|w[n+3|0]<<24);if(j|m>>>0<=o>>>0){break z;}f=s+(r<<g>>>D<<2)|0;j=x[f>>1];t[o|0]=j;t[o+1|0]=j>>>8;j=w[f+3|0]+o|0;g=w[f+2|0]+g|0;f=s+(r<<g>>>D<<2)|0;o=x[f>>1];t[j|0]=o;t[j+1|0]=o>>>8;o=j+w[f+3|0]|0;g=g+w[f+2|0]|0;if(g>>>0<33){continue;}break;}m=u-2|0;break x;}}n=i+l|0;m=u-2|0;if(g>>>0>32){break x;}}while(1){B:{if((i|0)>=4){j=g&7;r=g>>>3|0;g=0;break B;}if(!i){break x;}f=g;j=f>>>3|0;g=l>>>0>n-j>>>0;r=g?i:j;j=f-(r<<3)|0;}i=i-r|0;n=l+i|0;r=w[n|0]|w[n+1|0]<<8|(w[n+2|0]<<16|w[n+3|0]<<24);if(!(g?0:m>>>0>=o>>>0)){g=j;break x;}f=s+(r<<j>>>D<<2)|0;g=x[f>>1];t[o|0]=g;t[o+1|0]=g>>>8;o=w[f+3|0]+o|0;g=w[f+2|0]+j|0;if(g>>>0<=32){continue;}break;}}if(m>>>0>=o>>>0){while(1){f=s+(r<<g>>>D<<2)|0;j=x[f>>1];t[o|0]=j;t[o+1|0]=j>>>8;g=w[f+2|0]+g|0;o=w[f+3|0]+o|0;if(m>>>0>=o>>>0){continue;}break;}}C:{if(o>>>0>=u>>>0){break C;}j=r<<g>>>D|0;f=s+(j<<2)|0;t[o|0]=w[f|0];if(w[f+3|0]==1){g=w[f+2|0]+g|0;break C;}if(g>>>0>31){break C;}f=w[(s+(j<<2)|0)+2|0]+g|0;g=f>>>0<32?f:32;}f=(l|0)!=(n|0)?-20:(g|0)!=32?-20:p;}}break r;}f=la(o,p,l,g,j);}break q;}D:{if(w[j+1|0]){f=ra(o,p,l,g,j);break D;}f=ka(o,p,l,g,j);}break q;}j=a+26680|0;i=d+o|0;l=a+29040|0;n=a+10280|0;if(f){f=ma(n,i,g,j);if(f>>>0>4294967176){break q;}if(f>>>0<g>>>0){f=la(l,p,f+i|0,g-f|0,n);}else {f=-72;}break q;}f=-70;E:{if(!p){break E;}f=-20;if(!g){break E;}m=p>>>8|0;f=B(g>>>0<p>>>0?(g<<4>>>0)/(p>>>0)|0:15,24);o=B(m,v[f+1884>>2])+v[f+1880>>2]|0;F:{if((o>>>3|0)+o>>>0<v[f+1872>>2]+B(m,v[f+1876>>2])>>>0){f=ia(n,i,g,j,2048);if(f>>>0>4294967176){break E;}j=-72;if(f>>>0>=g>>>0){break F;}f=ra(l,p,f+i|0,g-f|0,n);break E;}f=ma(n,i,g,j);if(f>>>0>4294967176){break E;}j=-72;if(f>>>0>=g>>>0){break F;}j=ka(l,p,f+i|0,g-f|0,n);}f=j;}}if(f>>>0>4294967176){break c;}v[a+28928>>2]=p;v[a+28808>>2]=1;v[a+28912>>2]=a+29040;if((A|0)==2){v[a+12>>2]=a+10280;}g=a+p|0;f=g+29064|0;t[f|0]=0;t[f+1|0]=0;t[f+2|0]=0;t[f+3|0]=0;t[f+4|0]=0;t[f+5|0]=0;t[f+6|0]=0;t[f+7|0]=0;f=g+29056|0;t[f|0]=0;t[f+1|0]=0;t[f+2|0]=0;t[f+3|0]=0;t[f+4|0]=0;t[f+5|0]=0;t[f+6|0]=0;t[f+7|0]=0;f=g+29048|0;t[f|0]=0;t[f+1|0]=0;t[f+2|0]=0;t[f+3|0]=0;t[f+4|0]=0;t[f+5|0]=0;t[f+6|0]=0;t[f+7|0]=0;f=g+29040|0;t[f|0]=0;t[f+1|0]=0;t[f+2|0]=0;t[f+3|0]=0;t[f+4|0]=0;t[f+5|0]=0;t[f+6|0]=0;t[f+7|0]=0;p=C;break b;}p=F;}if(p>>>0>4294967176){break a;}n=v[a+28956>>2];f=d;d=p>>>0<4294967177?p:0;l=f+d|0;f=l;p=-72;m=e-d|0;g=m;G:{H:{if(!g){break H;}e=w[f|0];if(!e){v[k+36>>2]=0;d=(g|0)==1?1:-72;break G;}j=e<<24>>24;d=f+1|0;I:{if((j|0)>=0){break I;}if((j|0)==-1){if((g|0)<3){break H;}e=(w[f+1|0]|w[f+2|0]<<8)+32512|0;d=f+3|0;break I;}if((g|0)<2){break H;}e=(w[f+1|0]|e<<8)-32768|0;d=f+2|0;}v[k+36>>2]=e;j=d+1|0;g=f+g|0;if(j>>>0>g>>>0){break H;}p=-20;d=w[d|0];i=ga(a+16|0,a,d>>>6|0,35,9,j,g-j|0,2960,3104,3264,v[a+28812>>2],v[a+28956>>2],e);if(i>>>0>4294967176){break H;}j=j+(i>>>0<4294967177?i:0)|0;i=ga(a+4120|0,a+8|0,d>>>4&3,31,8,j,g-j|0,2256,2384,3792,v[a+28812>>2],v[a+28956>>2],e);if(i>>>0>4294967176){break H;}C=d>>>2&3;d=j+(i>>>0<4294967177?i:0)|0;e=ga(a+6176|0,a+4|0,C,52,9,d,g-d|0,2512,2736,4064,v[a+28812>>2],v[a+28956>>2],e);if(e>>>0>4294967176){break H;}p=(d+e|0)-f|0;}d=p;}if(d>>>0>4294967176){p=d;break a;}F=v[k+36>>2];if(!b){p=-70;if((F|0)>0){break a;}}g=m-d|0;q=d+l|0;J:{K:{L:{if(n){v[a+28956>>2]=0;break L;}d=a+28760|0;e=v[d>>2];if(!v[d+4>>2]&e>>>0<16777217|(F|0)<=4){break K;}d=v[a+8>>2];f=d+8|0;d=v[d+4>>2];p=0;e=0;while(1){p=(w[(f+(e<<3)|0)+2|0]>22)+p|0;e=e+1|0;if(!(e>>>d|0)){continue;}break;}v[a+28956>>2]=0;if(p<<8-d>>>0<20){break J;}}e=v[a+28912>>2];v[k+188>>2]=e;H=b+c|0;K=v[a+28928>>2]+e|0;M:{if(!F){d=b;break M;}I=v[a+28740>>2];L=v[a+28736>>2];C=v[a+28732>>2];v[a+28812>>2]=1;v[k+92>>2]=v[a+26676>>2];G=a+26668|0;c=G;d=v[c+4>>2];v[k+84>>2]=v[c>>2];v[k+88>>2]=d;v[k+100>>2]=I;v[k+96>>2]=C;N=b-C|0;v[k+104>>2]=N;p=-20;if(!g){break a;}v[k+52>>2]=q;v[k+56>>2]=q+4;N:{if(g>>>0>=4){d=g-4|0;c=q+d|0;v[k+48>>2]=c;l=w[c|0]|w[c+1|0]<<8|(w[c+2|0]<<16|w[c+3|0]<<24);v[k+40>>2]=l;if(l>>>0<16777216|g>>>0>4294967176){break a;}e=E(l>>>24|0)-23|0;break N;}v[k+48>>2]=q;l=w[q|0];v[k+40>>2]=l;O:{switch(g-2|0){case 1:l=w[q+2|0]<<16|l;case 0:l=(w[q+1|0]<<8)+l|0;v[k+40>>2]=l;break;default:break O;}}c=w[(g+q|0)-1|0];if(!c){break a;}e=(E(c)-(g<<3)|0)+9|0;v[k+44>>2]=e;d=0;}f=v[a>>2];c=v[f+4>>2];e=c+e|0;o=l>>>0-e&v[(c<<2)+4592>>2];v[k+60>>2]=o;P:{if(e>>>0>32){break P;}Q:{if((d|0)>=4){d=d-(e>>>3|0)|0;v[k+48>>2]=q+d;e=e&7;break Q;}if(!d){d=0;break P;}c=e>>>3|0;c=q>>>0>(d+q|0)-c>>>0?d:c;d=d-c|0;v[k+48>>2]=q+d;e=e-(c<<3)|0;}c=d+q|0;l=w[c|0]|w[c+1|0]<<8|(w[c+2|0]<<16|w[c+3|0]<<24);v[k+40>>2]=l;}g=(F|0)<4;R=f+8|0;v[k- -64>>2]=R;f=v[a+8>>2];c=v[f+4>>2];e=c+e|0;z=l>>>0-e&v[(c<<2)+4592>>2];v[k+68>>2]=z;R:{if(e>>>0>32){break R;}S:{if((d|0)>=4){d=d-(e>>>3|0)|0;v[k+48>>2]=q+d;e=e&7;break S;}if(!d){d=0;break R;}c=e>>>3|0;c=q>>>0>(d+q|0)-c>>>0?d:c;d=d-c|0;v[k+48>>2]=q+d;e=e-(c<<3)|0;}c=d+q|0;l=w[c|0]|w[c+1|0]<<8|(w[c+2|0]<<16|w[c+3|0]<<24);v[k+40>>2]=l;}O=g?F:4;S=f+8|0;v[k+72>>2]=S;g=v[a+4>>2];a=v[g+4>>2];e=a+e|0;v[k+44>>2]=e;c=0;u=v[(a<<2)+4592>>2]&l>>>0-e;v[k+76>>2]=u;T:{U:{if(e>>>0>=33){v[k+80>>2]=g+8;n=h;break U;}f=k;V:{W:{if((d|0)>=4){a=d-(e>>>3|0)|0;v[k+48>>2]=q+a;e=e&7;break W;}if(!d){v[k+80>>2]=g+8;a=0;n=h;break V;}a=e>>>3|0;c=q>>>0>(d+q|0)-a>>>0?d:a;a=d-c|0;v[k+48>>2]=q+a;e=e-(c<<3)|0;}v[f+44>>2]=e;c=a+q|0;l=w[c|0]|w[c+1|0]<<8|(w[c+2|0]<<16|w[c+3|0]<<24);v[k+80>>2]=g+8;v[k+40>>2]=l;c=0;n=h;if(e>>>0>32){break U;}}D=(O|0)>0?O:0;V=g+8|0;g=a;j=a;h=a;i=a;d=a;while(1){m=k;X:{Y:{if((d|0)>=4){f=e&7;v[k+44>>2]=f;a=d-(e>>>3|0)|0;d=q+a|0;v[k+48>>2]=d;l=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);break Y;}if(!d){f=e;d=0;break X;}a=e>>>3|0;a=q>>>0>(d+q|0)-a>>>0?d:a;f=e-(a<<3)|0;v[k+44>>2]=f;a=d-a|0;d=q+a|0;v[k+48>>2]=d;l=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);}v[m+40>>2]=l;g=a;j=a;h=a;i=a;d=a;}if((c|0)==(D|0)){e=f;c=D;break T;}e=(o<<3)+R|0;m=v[e+4>>2];o=v[e>>2];e=m;T=(e&65535)<<16|o>>>16;J=T&255;m=(u<<3)+V|0;s=v[m+4>>2];r=v[m>>2];m=s;U=(m&65535)<<16|r>>>16;P=U&255;s=(z<<3)+S|0;A=v[s+4>>2];s=v[s>>2];u=A;M=u;A=m;z=e;m=(u&65535)<<16|s>>>16;e=m&255;Z:{if(e>>>0>=2){_:{if(e>>>0>24&n){u=e;m=32-f|0;e=e>>>0<m>>>0?e:m;u=u-e|0;m=l<<f>>>0-e<<u;f=e+f|0;$:{if(f>>>0>32){break $;}aa:{if((h|0)>=4){a=h-(f>>>3|0)|0;v[k+48>>2]=q+a;f=f&7;break aa;}if(!h){h=0;i=0;d=0;break $;}a=f>>>3|0;d=q>>>0>(h+q|0)-a>>>0?h:a;a=h-d|0;v[k+48>>2]=q+a;f=f-(d<<3)|0;}d=a+q|0;l=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);v[k+40>>2]=l;g=a;j=a;h=a;i=a;d=a;}m=m+M|0;if(!u){e=f;break _;}e=f+u|0;v[k+44>>2]=e;m=(l<<f>>>0-u|0)+m|0;break _;}m=M+(l<<f>>>0-m|0)|0;f=e+f|0;if(f>>>0>32){e=f;break _;}d=k;ba:{if((i|0)>=4){e=f&7;v[k+44>>2]=e;a=i-(f>>>3|0)|0;f=q+a|0;v[k+48>>2]=f;l=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);break ba;}if(!i){i=0;e=f;d=0;break _;}a=f>>>3|0;a=q>>>0>(i+q|0)-a>>>0?i:a;e=f-(a<<3)|0;v[k+44>>2]=e;a=i-a|0;f=q+a|0;v[k+48>>2]=f;l=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);}v[d+40>>2]=l;g=a;j=a;h=a;i=a;d=a;}f=v[k+88>>2];u=v[k+84>>2];v[k+84>>2]=m;v[k+88>>2]=u;v[k+92>>2]=f;break Z;}if(!e){if(z){m=v[k+84>>2];e=f;break Z;}m=v[k+88>>2];v[k+88>>2]=v[k+84>>2];v[k+84>>2]=m;e=f;break Z;}e=f+1|0;v[k+44>>2]=e;f=M+(!z+(l<<f>>>31|0)|0)|0;ca:{da:{if((f|0)==3){f=v[k+84>>2]-1|0;m=!f+f|0;break da;}m=v[((f<<2)+k|0)+84>>2];m=!m+m|0;if((f|0)==1){break ca;}}v[k+92>>2]=v[k+88>>2];}v[k+88>>2]=v[k+84>>2];v[k+84>>2]=m;}f=A;if(P){f=(l<<e>>>0-U|0)+f|0;e=e+P|0;}ea:{if(J+P>>>0<20|e>>>0>32){break ea;}d=k;fa:{if((j|0)>=4){a=j-(e>>>3|0)|0;v[k+48>>2]=q+a;e=e&7;break fa;}if(!j){j=0;h=0;i=0;d=0;break ea;}a=e>>>3|0;g=q>>>0>(j+q|0)-a>>>0?j:a;a=j-g|0;v[k+48>>2]=q+a;e=e-(g<<3)|0;}v[d+44>>2]=e;d=a+q|0;l=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);v[k+40>>2]=l;g=a;j=a;h=a;i=a;d=a;}u=r>>>24|0;A=o>>>24|0;if(J){z=(l<<e>>>0-T|0)+z|0;e=e+J|0;}ga:{if(e>>>0>32){break ga;}ha:{if((g|0)>=4){a=g-(e>>>3|0)|0;v[k+48>>2]=q+a;e=e&7;break ha;}if(!g){g=0;j=0;h=0;i=0;d=0;break ga;}a=e>>>3|0;d=q>>>0>(g+q|0)-a>>>0?g:a;a=g-d|0;v[k+48>>2]=q+a;e=e-(d<<3)|0;}d=a+q|0;l=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);v[k+40>>2]=l;g=a;j=a;h=a;i=a;d=a;}J=z+N|0;N=J+f|0;v[k+104>>2]=N;e=e+A|0;o=(v[(A<<2)+4592>>2]&l>>>0-e)+(o&65535)|0;v[k+60>>2]=o;e=e+u|0;u=(v[(u<<2)+4592>>2]&l>>>0-e)+(r&65535)|0;v[k+76>>2]=u;A=(J+(m>>>0>J>>>0?I:C)|0)-m|0;ia:{if(e>>>0>32){break ia;}ja:{if((a|0)>=4){a=a-(e>>>3|0)|0;v[k+48>>2]=q+a;e=e&7;break ja;}if(!a){a=0;g=0;j=0;h=0;i=0;d=0;break ia;}d=e>>>3|0;d=q>>>0>(a+q|0)-d>>>0?a:d;a=a-d|0;v[k+48>>2]=q+a;e=e-(d<<3)|0;}d=a+q|0;l=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);v[k+40>>2]=l;g=a;j=a;h=a;i=a;d=a;}r=(k+112|0)+(c<<4)|0;v[r+12>>2]=A;v[r+8>>2]=m;v[r+4>>2]=f;v[r>>2]=z;f=s>>>24|0;e=f+e|0;v[k+44>>2]=e;z=(v[(f<<2)+4592>>2]&l>>>0-e)+(s&65535)|0;v[k+68>>2]=z;c=c+1|0;if(e>>>0<=32){continue;}break;}}if((c|0)<(O|0)){break a;}}A=H-32|0;d=b;ka:{while(1){if(e>>>0>=33){if((c|0)<(F|0)){break a;}break ka;}a=v[k+48>>2];r=v[k+56>>2];la:{if(a>>>0>=r>>>0){f=e&7;v[k+44>>2]=f;a=a-(e>>>3|0)|0;v[k+48>>2]=a;v[k+40>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);break la;}f=v[k+52>>2];if((f|0)==(a|0)){f=e;break la;}g=e>>>3|0;f=f>>>0>a-g>>>0?a-f|0:g;a=a-f|0;v[k+48>>2]=a;f=e-(f<<3)|0;v[k+44>>2]=f;v[k+40>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);}if((c|0)>=(F|0)){break ka;}e=v[k+64>>2]+(v[k+60>>2]<<3)|0;j=v[e+4>>2];g=v[e>>2];e=j;q=(e&65535)<<16|g>>>16;s=q&255;j=v[k+80>>2]+(v[k+76>>2]<<3)|0;h=v[j+4>>2];j=v[j>>2];i=h;J=(h&65535)<<16|j>>>16;u=J&255;h=v[k+72>>2]+(v[k+68>>2]<<3)|0;m=v[h+4>>2];h=v[h>>2];l=m;D=l;m=i;z=e;i=(l&65535)<<16|h>>>16;e=i&255;ma:{if(e>>>0>=2){na:{if(e>>>0>24&n){l=e;i=32-f|0;e=e>>>0<i>>>0?e:i;l=l-e|0;o=v[k+40>>2];i=o<<f>>>0-e<<l;f=e+f|0;oa:{if(f>>>0>32){break oa;}pa:{if(a>>>0>=r>>>0){a=a-(f>>>3|0)|0;v[k+48>>2]=a;f=f&7;break pa;}e=v[k+52>>2];if((e|0)==(a|0)){break oa;}o=f>>>3|0;e=e>>>0>a-o>>>0?a-e|0:o;a=a-e|0;v[k+48>>2]=a;f=f-(e<<3)|0;}o=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);v[k+40>>2]=o;}i=i+D|0;if(!l){e=f;break na;}e=f+l|0;v[k+44>>2]=e;i=(o<<f>>>0-l|0)+i|0;break na;}i=D+(v[k+40>>2]<<f>>>0-i|0)|0;f=e+f|0;if(f>>>0>32){e=f;break na;}if(a>>>0>=r>>>0){e=f&7;v[k+44>>2]=e;a=a-(f>>>3|0)|0;v[k+48>>2]=a;v[k+40>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);break na;}e=v[k+52>>2];if((e|0)==(a|0)){e=f;break na;}l=f>>>3|0;e=e>>>0>a-l>>>0?a-e|0:l;a=a-e|0;v[k+48>>2]=a;e=f-(e<<3)|0;v[k+44>>2]=e;v[k+40>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);}f=v[k+88>>2];l=v[k+84>>2];v[k+84>>2]=i;v[k+88>>2]=l;v[k+92>>2]=f;break ma;}if(!e){if(z){i=v[k+84>>2];e=f;break ma;}i=v[k+88>>2];v[k+88>>2]=v[k+84>>2];v[k+84>>2]=i;e=f;break ma;}e=f+1|0;v[k+44>>2]=e;f=D+!z+(v[k+40>>2]<<f>>>31)|0;qa:{ra:{if((f|0)==3){f=v[k+84>>2]-1|0;i=!f+f|0;break ra;}i=v[((f<<2)+k|0)+84>>2];i=!i+i|0;if((f|0)==1){break qa;}}v[k+92>>2]=v[k+88>>2];}v[k+88>>2]=v[k+84>>2];v[k+84>>2]=i;}f=m;if(u){f=(v[k+40>>2]<<e>>>0-J|0)+f|0;e=e+u|0;}sa:{if(s+u>>>0<20|e>>>0>32){break sa;}l=k;ta:{if(a>>>0>=r>>>0){a=a-(e>>>3|0)|0;v[k+48>>2]=a;e=e&7;break ta;}m=v[k+52>>2];if((m|0)==(a|0)){break sa;}o=e>>>3|0;m=m>>>0>a-o>>>0?a-m|0:o;a=a-m|0;v[k+48>>2]=a;e=e-(m<<3)|0;}v[l+44>>2]=e;v[k+40>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);}m=j>>>24|0;o=g>>>24|0;if(s){z=(v[k+40>>2]<<e>>>0-q|0)+z|0;e=e+s|0;}ua:{if(e>>>0>32){break ua;}va:{if(a>>>0>=r>>>0){a=a-(e>>>3|0)|0;v[k+48>>2]=a;e=e&7;break va;}l=v[k+52>>2];if((l|0)==(a|0)){break ua;}s=e>>>3|0;l=l>>>0>a-s>>>0?a-l|0:s;a=a-l|0;v[k+48>>2]=a;e=e-(l<<3)|0;}v[k+40>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);}u=v[k+104>>2]+z|0;v[k+104>>2]=u+f;l=v[k+40>>2];e=e+o|0;v[k+60>>2]=(v[(o<<2)+4592>>2]&l>>>0-e)+(g&65535);e=e+m|0;v[k+76>>2]=(v[(m<<2)+4592>>2]&l>>>0-e)+(j&65535);D=v[(k+40|0)+(i>>>0>u>>>0?60:56)>>2];wa:{if(e>>>0>32){break wa;}xa:{if(a>>>0>=r>>>0){a=a-(e>>>3|0)|0;v[k+48>>2]=a;e=e&7;break xa;}g=v[k+52>>2];if((g|0)==(a|0)){break wa;}j=e>>>3|0;g=g>>>0>a-j>>>0?a-g|0:j;a=a-g|0;v[k+48>>2]=a;e=e-(g<<3)|0;}l=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);v[k+40>>2]=l;}a=h>>>24|0;e=a+e|0;v[k+44>>2]=e;v[k+68>>2]=(v[(a<<2)+4592>>2]&l>>>0-e)+(h&65535);ya:{za:{h=v[k+188>>2];l=(k+112|0)+((c&3)<<4)|0;r=v[l>>2];q=h+r|0;Aa:{if(q>>>0>K>>>0){break Aa;}g=v[l+4>>2];j=r+g|0;if(A>>>0<j+d>>>0){break Aa;}if(j+32>>>0<=H-d>>>0){break za;}}a=v[l+12>>2];v[k+24>>2]=v[l+8>>2];v[k+28>>2]=a;a=v[l+4>>2];v[k+16>>2]=v[l>>2];v[k+20>>2]=a;j=ha(d,H,k+16|0,k+188|0,K,C,L,I);break ya;}a=d+r|0;m=v[l+8>>2];e=h;o=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);s=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[d|0]=s;t[d+1|0]=s>>>8;t[d+2|0]=s>>>16;t[d+3|0]=s>>>24;t[d+4|0]=o;t[d+5|0]=o>>>8;t[d+6|0]=o>>>16;t[d+7|0]=o>>>24;o=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);e=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[d+8|0]=e;t[d+9|0]=e>>>8;t[d+10|0]=e>>>16;t[d+11|0]=e>>>24;t[d+12|0]=o;t[d+13|0]=o>>>8;t[d+14|0]=o>>>16;t[d+15|0]=o>>>24;if(r>>>0>=17){e=d+16|0;while(1){o=w[h+20|0]|w[h+21|0]<<8|(w[h+22|0]<<16|w[h+23|0]<<24);r=w[h+16|0]|w[h+17|0]<<8|(w[h+18|0]<<16|w[h+19|0]<<24);t[e|0]=r;t[e+1|0]=r>>>8;t[e+2|0]=r>>>16;t[e+3|0]=r>>>24;t[e+4|0]=o;t[e+5|0]=o>>>8;t[e+6|0]=o>>>16;t[e+7|0]=o>>>24;o=w[h+28|0]|w[h+29|0]<<8|(w[h+30|0]<<16|w[h+31|0]<<24);r=w[h+24|0]|w[h+25|0]<<8|(w[h+26|0]<<16|w[h+27|0]<<24);t[e+8|0]=r;t[e+9|0]=r>>>8;t[e+10|0]=r>>>16;t[e+11|0]=r>>>24;t[e+12|0]=o;t[e+13|0]=o>>>8;t[e+14|0]=o>>>16;t[e+15|0]=o>>>24;h=h+16|0;e=e+16|0;if(e>>>0<a>>>0){continue;}break;}}e=a-m|0;v[k+188>>2]=q;if(m>>>0>a-C>>>0){if(m>>>0>a-L>>>0){break a;}e=e-C|0;h=e+I|0;if(I>>>0>=h+g>>>0){Z(a,h,g);break ya;}g=e+g|0;a=Z(a,h,0-e|0)-e|0;e=C;}if(m>>>0>=16){m=a+g|0;while(1){g=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);h=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=h;t[a+1|0]=h>>>8;t[a+2|0]=h>>>16;t[a+3|0]=h>>>24;t[a+4|0]=g;t[a+5|0]=g>>>8;t[a+6|0]=g>>>16;t[a+7|0]=g>>>24;g=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);h=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[a+8|0]=h;t[a+9|0]=h>>>8;t[a+10|0]=h>>>16;t[a+11|0]=h>>>24;t[a+12|0]=g;t[a+13|0]=g>>>8;t[a+14|0]=g>>>16;t[a+15|0]=g>>>24;e=e+16|0;a=a+16|0;if(m>>>0>a>>>0){continue;}break;}break ya;}Ba:{if(m>>>0<=7){t[a|0]=w[e|0];t[a+1|0]=w[e+1|0];t[a+2|0]=w[e+2|0];t[a+3|0]=w[e+3|0];m=m<<2;e=v[m+4752>>2]+e|0;h=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a+4|0]=h;t[a+5|0]=h>>>8;t[a+6|0]=h>>>16;t[a+7|0]=h>>>24;e=e-v[m+4784>>2]|0;break Ba;}h=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);m=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=m;t[a+1|0]=m>>>8;t[a+2|0]=m>>>16;t[a+3|0]=m>>>24;t[a+4|0]=h;t[a+5|0]=h>>>8;t[a+6|0]=h>>>16;t[a+7|0]=h>>>24;}if(g>>>0<9){break ya;}m=a+g|0;a=a+8|0;e=e+8|0;if((a-e|0)<=15){while(1){g=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);h=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=h;t[a+1|0]=h>>>8;t[a+2|0]=h>>>16;t[a+3|0]=h>>>24;t[a+4|0]=g;t[a+5|0]=g>>>8;t[a+6|0]=g>>>16;t[a+7|0]=g>>>24;e=e+8|0;a=a+8|0;if(m>>>0>a>>>0){continue;}break ya;}}while(1){g=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);h=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=h;t[a+1|0]=h>>>8;t[a+2|0]=h>>>16;t[a+3|0]=h>>>24;t[a+4|0]=g;t[a+5|0]=g>>>8;t[a+6|0]=g>>>16;t[a+7|0]=g>>>24;g=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);h=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[a+8|0]=h;t[a+9|0]=h>>>8;t[a+10|0]=h>>>16;t[a+11|0]=h>>>24;t[a+12|0]=g;t[a+13|0]=g>>>8;t[a+14|0]=g>>>16;t[a+15|0]=g>>>24;e=e+16|0;a=a+16|0;if(m>>>0>a>>>0){continue;}break;}}if(j>>>0<=4294967176){v[l>>2]=z;v[(l|4)>>2]=f;v[(l|8)>>2]=i;v[l+12>>2]=(u+D|0)-i;c=c+1|0;d=d+j|0;e=v[k+44>>2];continue;}break;}p=j;break a;}i=c-O|0;if((F|0)>(i|0)){n=H-32|0;while(1){Ca:{Da:{m=v[k+188>>2];e=(k+112|0)+((i&3)<<4)|0;j=v[e>>2];l=m+j|0;Ea:{if(l>>>0>K>>>0){break Ea;}z=v[e+4>>2];c=j+z|0;if(n>>>0<d+c>>>0){break Ea;}if(c+32>>>0<=H-d>>>0){break Da;}}a=v[e+12>>2];v[k+8>>2]=v[e+8>>2];v[k+12>>2]=a;a=v[e+4>>2];v[k>>2]=v[e>>2];v[k+4>>2]=a;c=ha(d,H,k,k+188|0,K,C,L,I);break Ca;}a=d+j|0;f=v[e+8>>2];e=m;g=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);h=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[d|0]=h;t[d+1|0]=h>>>8;t[d+2|0]=h>>>16;t[d+3|0]=h>>>24;t[d+4|0]=g;t[d+5|0]=g>>>8;t[d+6|0]=g>>>16;t[d+7|0]=g>>>24;g=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);e=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[d+8|0]=e;t[d+9|0]=e>>>8;t[d+10|0]=e>>>16;t[d+11|0]=e>>>24;t[d+12|0]=g;t[d+13|0]=g>>>8;t[d+14|0]=g>>>16;t[d+15|0]=g>>>24;if(j>>>0>=17){e=d+16|0;while(1){g=w[m+20|0]|w[m+21|0]<<8|(w[m+22|0]<<16|w[m+23|0]<<24);j=w[m+16|0]|w[m+17|0]<<8|(w[m+18|0]<<16|w[m+19|0]<<24);t[e|0]=j;t[e+1|0]=j>>>8;t[e+2|0]=j>>>16;t[e+3|0]=j>>>24;t[e+4|0]=g;t[e+5|0]=g>>>8;t[e+6|0]=g>>>16;t[e+7|0]=g>>>24;g=w[m+28|0]|w[m+29|0]<<8|(w[m+30|0]<<16|w[m+31|0]<<24);j=w[m+24|0]|w[m+25|0]<<8|(w[m+26|0]<<16|w[m+27|0]<<24);t[e+8|0]=j;t[e+9|0]=j>>>8;t[e+10|0]=j>>>16;t[e+11|0]=j>>>24;t[e+12|0]=g;t[e+13|0]=g>>>8;t[e+14|0]=g>>>16;t[e+15|0]=g>>>24;m=m+16|0;e=e+16|0;if(e>>>0<a>>>0){continue;}break;}}e=a-f|0;v[k+188>>2]=l;if(f>>>0>a-C>>>0){if(f>>>0>a-L>>>0){break a;}e=e-C|0;g=e+I|0;if(I>>>0>=g+z>>>0){Z(a,g,z);break Ca;}z=e+z|0;a=Z(a,g,0-e|0)-e|0;e=C;}if(f>>>0>=16){j=a+z|0;while(1){f=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=f;t[a+5|0]=f>>>8;t[a+6|0]=f>>>16;t[a+7|0]=f>>>24;f=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);g=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[a+8|0]=g;t[a+9|0]=g>>>8;t[a+10|0]=g>>>16;t[a+11|0]=g>>>24;t[a+12|0]=f;t[a+13|0]=f>>>8;t[a+14|0]=f>>>16;t[a+15|0]=f>>>24;e=e+16|0;a=a+16|0;if(j>>>0>a>>>0){continue;}break;}break Ca;}Fa:{if(f>>>0<=7){t[a|0]=w[e|0];t[a+1|0]=w[e+1|0];t[a+2|0]=w[e+2|0];t[a+3|0]=w[e+3|0];g=f<<2;e=v[g+4752>>2]+e|0;f=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a+4|0]=f;t[a+5|0]=f>>>8;t[a+6|0]=f>>>16;t[a+7|0]=f>>>24;e=e-v[g+4784>>2]|0;break Fa;}f=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=f;t[a+5|0]=f>>>8;t[a+6|0]=f>>>16;t[a+7|0]=f>>>24;}if(z>>>0<9){break Ca;}j=a+z|0;a=a+8|0;e=e+8|0;if((a-e|0)<=15){while(1){f=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=f;t[a+5|0]=f>>>8;t[a+6|0]=f>>>16;t[a+7|0]=f>>>24;e=e+8|0;a=a+8|0;if(j>>>0>a>>>0){continue;}break Ca;}}while(1){f=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=f;t[a+5|0]=f>>>8;t[a+6|0]=f>>>16;t[a+7|0]=f>>>24;f=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);g=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[a+8|0]=g;t[a+9|0]=g>>>8;t[a+10|0]=g>>>16;t[a+11|0]=g>>>24;t[a+12|0]=f;t[a+13|0]=f>>>8;t[a+14|0]=f>>>16;t[a+15|0]=f>>>24;e=e+16|0;a=a+16|0;if(j>>>0>a>>>0){continue;}break;}}if(c>>>0>4294967176){p=c;break a;}d=c+d|0;i=i+1|0;if((F|0)!=(i|0)){continue;}break;}}c=v[k+88>>2];a=G;v[a>>2]=v[k+84>>2];v[a+4>>2]=c;v[a+8>>2]=v[k+92>>2];e=v[k+188>>2];}p=-70;a=K-e|0;if(a>>>0>H-d>>>0){break a;}if(d){a=X(d,e,a)+a|0;}else {a=0;}p=a-b|0;break a;}v[a+28956>>2]=0;}m=h;n=0;h=Q-112|0;Q=h;f=a;e=v[a+28912>>2];v[h+92>>2]=e;d=b;r=d+c|0;u=v[a+28928>>2]+e|0;Ga:{Ha:{if(!F){c=d;break Ha;}D=v[f+28740>>2];z=v[f+28736>>2];l=v[f+28732>>2];v[f+28812>>2]=1;v[h+76>>2]=v[f+26676>>2];C=f+26668|0;a=C;b=v[a+4>>2];v[h+68>>2]=v[a>>2];v[h+72>>2]=b;if(!g){f=-20;break Ga;}v[h+36>>2]=q;v[h+40>>2]=q+4;Ia:{Ja:{if(g>>>0>=4){n=g-4|0;a=q+n|0;v[h+32>>2]=a;j=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);v[h+24>>2]=j;if(j>>>0>=16777216){break Ja;}f=-20;break Ga;}v[h+32>>2]=q;j=w[q|0];v[h+24>>2]=j;Ka:{switch(g-2|0){case 1:j=w[q+2|0]<<16|j;case 0:j=(w[q+1|0]<<8)+j|0;v[h+24>>2]=j;break;default:break Ka;}}a=w[(g+q|0)-1|0];if(!a){f=-20;break Ga;}g=(E(a)-(g<<3)|0)+9|0;v[h+28>>2]=g;break Ia;}if(g>>>0>4294967176){f=-20;break Ga;}g=E(j>>>24|0)-23|0;}c=v[f>>2];a=v[c+4>>2];g=a+g|0;a=j>>>0-g&v[(a<<2)+4592>>2];v[h+44>>2]=a;La:{if(g>>>0>32){break La;}Ma:{if((n|0)>=4){n=n-(g>>>3|0)|0;v[h+32>>2]=q+n;g=g&7;break Ma;}if(!n){n=0;break La;}b=g>>>3|0;b=q>>>0>(n+q|0)-b>>>0?n:b;n=n-b|0;v[h+32>>2]=q+n;g=g-(b<<3)|0;}b=n+q|0;j=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);v[h+24>>2]=j;}e=c+8|0;v[h+48>>2]=e;c=v[f+8>>2];b=v[c+4>>2];i=b+g|0;g=j>>>0-i&v[(b<<2)+4592>>2];v[h+52>>2]=g;Na:{if(i>>>0>32){break Na;}Oa:{if((n|0)>=4){n=n-(i>>>3|0)|0;v[h+32>>2]=q+n;i=i&7;break Oa;}if(!n){n=0;break Na;}b=i>>>3|0;b=q>>>0>(n+q|0)-b>>>0?n:b;n=n-b|0;v[h+32>>2]=q+n;i=i-(b<<3)|0;}b=n+q|0;j=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);v[h+24>>2]=j;}o=c+8|0;v[h+56>>2]=o;p=v[f+4>>2];c=v[p+4>>2];b=c+i|0;v[h+28>>2]=b;i=v[(c<<2)+4592>>2]&j>>>0-b;v[h+60>>2]=i;Pa:{if(b>>>0>32){break Pa;}c=n+q|0;f=h;Qa:{if((n|0)>=4){c=c-(b>>>3|0)|0;v[h+32>>2]=c;b=b&7;break Qa;}if(!n){break Pa;}j=b>>>3|0;j=q>>>0>c-j>>>0?n:j;c=c-j|0;v[h+32>>2]=c;b=b-(j<<3)|0;}v[f+28>>2]=b;v[h+24>>2]=w[c|0]|w[c+1|0]<<8|(w[c+2|0]<<16|w[c+3|0]<<24);}n=p+8|0;v[h- -64>>2]=n;I=r-32|0;c=d;f=0;while(1){a=(a<<3)+e|0;e=v[a+4>>2];j=v[a>>2];a=e;H=(a&65535)<<16|j>>>16;A=H&255;e=(i<<3)+n|0;i=v[e+4>>2];p=v[e>>2];e=i;K=(e&65535)<<16|p>>>16;G=K&255;g=(g<<3)+o|0;i=v[g+4>>2];n=v[g>>2];q=i;o=e;e=a;g=(i&65535)<<16|n>>>16;a=g&255;Ra:{if(a>>>0>=2){Sa:{if(!(!m|a>>>0<25)){i=a;g=32-b|0;a=a>>>0<g>>>0?a:g;s=i-a|0;i=v[h+24>>2];L=i<<b>>>0-a<<s;a=a+b|0;Ta:{if(a>>>0>32){break Ta;}b=v[h+32>>2];Ua:{if(b>>>0>=y[h+40>>2]){b=b-(a>>>3|0)|0;v[h+32>>2]=b;a=a&7;break Ua;}g=v[h+36>>2];if((g|0)==(b|0)){break Ta;}i=a>>>3|0;g=g>>>0>b-i>>>0?b-g|0:i;b=b-g|0;v[h+32>>2]=b;a=a-(g<<3)|0;}i=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);v[h+24>>2]=i;}g=q+L|0;if(!s){break Sa;}g=(i<<a>>>0-s|0)+g|0;a=a+s|0;break Sa;}g=q+(v[h+24>>2]<<b>>>0-g|0)|0;b=a+b|0;if(b>>>0>32){a=b;break Sa;}i=v[h+32>>2];if(i>>>0>=y[h+40>>2]){a=b&7;v[h+28>>2]=a;b=i-(b>>>3|0)|0;v[h+32>>2]=b;v[h+24>>2]=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);break Sa;}a=v[h+36>>2];if((a|0)==(i|0)){a=b;break Sa;}M=b;b=b>>>3|0;b=a>>>0>i-b>>>0?i-a|0:b;a=M-(b<<3)|0;v[h+28>>2]=a;b=i-b|0;v[h+32>>2]=b;v[h+24>>2]=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);}b=v[h+72>>2];i=v[h+68>>2];v[h+68>>2]=g;v[h+72>>2]=i;v[h+76>>2]=b;break Ra;}if(!a){if(e){g=v[h+68>>2];a=b;break Ra;}g=v[h+72>>2];v[h+72>>2]=v[h+68>>2];v[h+68>>2]=g;a=b;break Ra;}a=b+1|0;v[h+28>>2]=a;b=q+!e+(v[h+24>>2]<<b>>>31)|0;Va:{Wa:{if((b|0)==3){b=v[h+68>>2]-1|0;g=!b+b|0;break Wa;}g=v[(h+(b<<2)|0)+68>>2];g=!g+g|0;if((b|0)==1){break Va;}}v[h+76>>2]=v[h+72>>2];}v[h+72>>2]=v[h+68>>2];v[h+68>>2]=g;}b=o;if(G){b=(v[h+24>>2]<<a>>>0-K|0)+b|0;a=a+G|0;}Xa:{if(A+G>>>0<20|a>>>0>32){break Xa;}o=h;i=v[h+32>>2];Ya:{if(i>>>0>=y[h+40>>2]){i=i-(a>>>3|0)|0;v[h+32>>2]=i;a=a&7;break Ya;}s=v[h+36>>2];if((s|0)==(i|0)){break Xa;}G=a>>>3|0;s=s>>>0>i-G>>>0?i-s|0:G;i=i-s|0;v[h+32>>2]=i;a=a-(s<<3)|0;}v[o+28>>2]=a;v[h+24>>2]=w[i|0]|w[i+1|0]<<8|(w[i+2|0]<<16|w[i+3|0]<<24);}o=p>>>24|0;i=j;s=i>>>24|0;if(A){e=(v[h+24>>2]<<a>>>0-H|0)+e|0;a=a+A|0;}Za:{if(a>>>0>32){break Za;}j=v[h+32>>2];_a:{if(j>>>0>=y[h+40>>2]){j=j-(a>>>3|0)|0;v[h+32>>2]=j;a=a&7;break _a;}A=v[h+36>>2];if((A|0)==(j|0)){break Za;}G=a>>>3|0;A=A>>>0>j-G>>>0?j-A|0:G;j=j-A|0;v[h+32>>2]=j;a=a-(A<<3)|0;}v[h+24>>2]=w[j|0]|w[j+1|0]<<8|(w[j+2|0]<<16|w[j+3|0]<<24);}j=v[h+24>>2];a=a+s|0;v[h+44>>2]=(v[(s<<2)+4592>>2]&j>>>0-a)+(i&65535);a=a+o|0;v[h+60>>2]=(v[(o<<2)+4592>>2]&j>>>0-a)+(p&65535);$a:{if(a>>>0>32){break $a;}i=v[h+32>>2];ab:{if(i>>>0>=y[h+40>>2]){j=i-(a>>>3|0)|0;v[h+32>>2]=j;a=a&7;break ab;}p=v[h+36>>2];if((p|0)==(i|0)){break $a;}A=i;j=a>>>3|0;i=p>>>0>i-j>>>0?i-p|0:j;j=A-i|0;v[h+32>>2]=j;a=a-(i<<3)|0;}j=w[j|0]|w[j+1|0]<<8|(w[j+2|0]<<16|w[j+3|0]<<24);v[h+24>>2]=j;}i=a;a=n>>>24|0;i=i+a|0;v[h+28>>2]=i;v[h+52>>2]=(v[(a<<2)+4592>>2]&j>>>0-i)+(n&65535);v[h+96>>2]=e;v[h+100>>2]=b;v[h+104>>2]=g;bb:{cb:{i=v[h+92>>2];o=i+e|0;db:{if(o>>>0>u>>>0){break db;}j=b+e|0;if(I>>>0<j+c>>>0){break db;}if(j+32>>>0<=r-c>>>0){break cb;}}a=v[h+108>>2];v[h+16>>2]=v[h+104>>2];v[h+20>>2]=a;a=v[h+100>>2];v[h+8>>2]=v[h+96>>2];v[h+12>>2]=a;j=ha(c,r,h+8|0,h+92|0,u,l,z,D);break bb;}a=c+e|0;p=w[i+4|0]|w[i+5|0]<<8|(w[i+6|0]<<16|w[i+7|0]<<24);n=w[i|0]|w[i+1|0]<<8|(w[i+2|0]<<16|w[i+3|0]<<24);t[c|0]=n;t[c+1|0]=n>>>8;t[c+2|0]=n>>>16;t[c+3|0]=n>>>24;t[c+4|0]=p;t[c+5|0]=p>>>8;t[c+6|0]=p>>>16;t[c+7|0]=p>>>24;p=w[i+12|0]|w[i+13|0]<<8|(w[i+14|0]<<16|w[i+15|0]<<24);n=w[i+8|0]|w[i+9|0]<<8|(w[i+10|0]<<16|w[i+11|0]<<24);t[c+8|0]=n;t[c+9|0]=n>>>8;t[c+10|0]=n>>>16;t[c+11|0]=n>>>24;t[c+12|0]=p;t[c+13|0]=p>>>8;t[c+14|0]=p>>>16;t[c+15|0]=p>>>24;if(e>>>0>=17){e=c+16|0;while(1){p=w[i+20|0]|w[i+21|0]<<8|(w[i+22|0]<<16|w[i+23|0]<<24);n=w[i+16|0]|w[i+17|0]<<8|(w[i+18|0]<<16|w[i+19|0]<<24);t[e|0]=n;t[e+1|0]=n>>>8;t[e+2|0]=n>>>16;t[e+3|0]=n>>>24;t[e+4|0]=p;t[e+5|0]=p>>>8;t[e+6|0]=p>>>16;t[e+7|0]=p>>>24;p=w[i+28|0]|w[i+29|0]<<8|(w[i+30|0]<<16|w[i+31|0]<<24);n=w[i+24|0]|w[i+25|0]<<8|(w[i+26|0]<<16|w[i+27|0]<<24);t[e+8|0]=n;t[e+9|0]=n>>>8;t[e+10|0]=n>>>16;t[e+11|0]=n>>>24;t[e+12|0]=p;t[e+13|0]=p>>>8;t[e+14|0]=p>>>16;t[e+15|0]=p>>>24;i=i+16|0;e=e+16|0;if(e>>>0<a>>>0){continue;}break;}}e=a-g|0;v[h+92>>2]=o;if(a-l>>>0<g>>>0){if(a-z>>>0<g>>>0){j=-20;break bb;}e=e-l|0;i=e+D|0;if(D>>>0>=i+b>>>0){Z(a,i,b);break bb;}a=Z(a,i,0-e|0);b=b+e|0;v[h+100>>2]=b;a=a-e|0;e=l;}if(g>>>0>=16){i=a+b|0;while(1){b=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=b;t[a+5|0]=b>>>8;t[a+6|0]=b>>>16;t[a+7|0]=b>>>24;b=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);g=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[a+8|0]=g;t[a+9|0]=g>>>8;t[a+10|0]=g>>>16;t[a+11|0]=g>>>24;t[a+12|0]=b;t[a+13|0]=b>>>8;t[a+14|0]=b>>>16;t[a+15|0]=b>>>24;e=e+16|0;a=a+16|0;if(i>>>0>a>>>0){continue;}break;}break bb;}eb:{if(g>>>0<=7){t[a|0]=w[e|0];t[a+1|0]=w[e+1|0];t[a+2|0]=w[e+2|0];t[a+3|0]=w[e+3|0];i=g<<2;e=v[i+4752>>2]+e|0;g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a+4|0]=g;t[a+5|0]=g>>>8;t[a+6|0]=g>>>16;t[a+7|0]=g>>>24;e=e-v[i+4784>>2]|0;break eb;}g=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);i=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=i;t[a+1|0]=i>>>8;t[a+2|0]=i>>>16;t[a+3|0]=i>>>24;t[a+4|0]=g;t[a+5|0]=g>>>8;t[a+6|0]=g>>>16;t[a+7|0]=g>>>24;}if(b>>>0<9){break bb;}i=a+b|0;a=a+8|0;e=e+8|0;if((a-e|0)<=15){while(1){b=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=b;t[a+5|0]=b>>>8;t[a+6|0]=b>>>16;t[a+7|0]=b>>>24;e=e+8|0;a=a+8|0;if(i>>>0>a>>>0){continue;}break bb;}}while(1){b=w[e+4|0]|w[e+5|0]<<8|(w[e+6|0]<<16|w[e+7|0]<<24);g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);t[a|0]=g;t[a+1|0]=g>>>8;t[a+2|0]=g>>>16;t[a+3|0]=g>>>24;t[a+4|0]=b;t[a+5|0]=b>>>8;t[a+6|0]=b>>>16;t[a+7|0]=b>>>24;b=w[e+12|0]|w[e+13|0]<<8|(w[e+14|0]<<16|w[e+15|0]<<24);g=w[e+8|0]|w[e+9|0]<<8|(w[e+10|0]<<16|w[e+11|0]<<24);t[a+8|0]=g;t[a+9|0]=g>>>8;t[a+10|0]=g>>>16;t[a+11|0]=g>>>24;t[a+12|0]=b;t[a+13|0]=b>>>8;t[a+14|0]=b>>>16;t[a+15|0]=b>>>24;e=e+16|0;a=a+16|0;if(i>>>0>a>>>0){continue;}break;}}a=v[h+28>>2];fb:{if(a>>>0>32){b=a;break fb;}e=v[h+32>>2];if(e>>>0>=y[h+40>>2]){b=a&7;v[h+28>>2]=b;a=e-(a>>>3|0)|0;v[h+32>>2]=a;v[h+24>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);break fb;}b=v[h+36>>2];if((b|0)==(e|0)){b=a;break fb;}i=a;a=a>>>3|0;a=b>>>0>e-a>>>0?e-b|0:a;b=i-(a<<3)|0;v[h+28>>2]=b;a=e-a|0;v[h+32>>2]=a;v[h+24>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);}a=j>>>0<4294967177;f=a?f:j;c=(a?j:0)+c|0;F=F-1|0;if(F){g=v[h+52>>2];o=v[h+56>>2];i=v[h+60>>2];n=v[h+64>>2];a=v[h+44>>2];e=v[h+48>>2];continue;}break;}if(f>>>0>4294967176){break Ga;}if(b>>>0<=32){a=v[h+32>>2];if(a>>>0>=y[h+40>>2]){f=-20;break Ga;}if((a|0)!=v[h+36>>2]){f=-20;break Ga;}f=-20;if((b|0)!=32){break Ga;}}b=v[h+72>>2];a=C;v[a>>2]=v[h+68>>2];v[a+4>>2]=b;v[a+8>>2]=v[h+76>>2];e=v[h+92>>2];}f=-70;a=u-e|0;if(a>>>0>r-c>>>0){break Ga;}if(c){a=X(c,e,a)+a|0;}else {a=0;}f=a-d|0;}Q=h+112|0;p=f;}Q=k+192|0;return p;}function Aa(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,x=0,z=0,A=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,R=0,T=0,U=0,V=0,W=0,Z=0;u=Q-16|0;Q=u;i=v[c+8>>2];k=v[c+4>>2];a:{if(i>>>0>k>>>0){e=-72;break a;}g=v[b+8>>2];f=v[b+4>>2];if(g>>>0>f>>>0){e=-70;break a;}d=v[b>>2];p=v[c>>2];if(!(!v[a+28964>>2]|v[a+29024>>2]!=1)){e=-104;if((d|0)!=v[a+29028>>2]|(g|0)!=v[a+29036>>2]|(f|0)!=v[a+29032>>2]){break a;}}H=d+f|0;m=a+4120|0;L=a+6176|0;M=a+16|0;q=a+26668|0;N=a+10280|0;r=a+28728|0;F=k+p|0;p=i+p|0;o=F-p|0;k=a+160144|0;i=a+28752|0;I=a+29028|0;x=a+28804|0;t=a+28972|0;C=a+28988|0;J=a+160164|0;j=a+28856|0;K=j;f=p;O=d+g|0;s=O;b:{while(1){c:{e=-1;d=i;g=k;d:{e:{f:{g:{h:{switch(v[a+28964>>2]){case 3:d=v[x>>2];e=v[a+28744>>2];break e;case 1:e=v[a+29e3>>2];break g;case 2:break f;case 0:break h;case 4:break d;default:break a;}}v[a+28964>>2]=1;v[a+28992>>2]=0;v[a+28996>>2]=0;v[a+29012>>2]=0;v[a+29016>>2]=0;v[a+29e3>>2]=0;v[a+28976>>2]=0;e=v[b+4>>2];v[I>>2]=v[b>>2];v[I+4>>2]=e;v[I+8>>2]=v[b+8>>2];e=0;}e=aa(d,g,e,v[a+28908>>2]);if(e>>>0>4294967176){break a;}if(e){d=v[a+29e3>>2];h=e-d|0;g=F-f|0;if(h>>>0>g>>>0){if(g){X((a+d|0)+160144|0,f,g);d=g+v[a+29e3>>2]|0;v[a+29e3>>2]=d;}v[c+8>>2]=v[c+4>>2];a=v[a+28908>>2]?2:6;e=((a>>>0>e>>>0?a:e)-d|0)+3|0;break a;}X((a+d|0)+160144|0,f,h);v[a+29e3>>2]=e;f=f+h|0;continue;}i:{d=v[i>>2];e=v[i+4>>2];if((d|0)==-1&(e|0)==-1|v[a+28772>>2]==1){break i;}G=H-s|0;if(!e&G>>>0<d>>>0|e){break i;}n=0;l=Q-48|0;Q=l;j:{if(!(((w[p|0]|w[p+1|0]<<8|(w[p+2|0]<<16|w[p+3|0]<<24))&-16)!=407710288|o>>>0<8)){e=w[p+4|0]|w[p+5|0]<<8|(w[p+6|0]<<16|w[p+7|0]<<24);v[u+8>>2]=0;v[u+12>>2]=0;v[u+4>>2]=0;d=e+8|0;v[u>>2]=e>>>0>4294967287?-14:d>>>0>o>>>0?-72:d;break j;}h=u;e=aa(l+8|0,p,o,0);k:{if(e>>>0>=4294967177){v[u>>2]=e;e=-2;d=-1;break k;}if(e){v[u>>2]=-72;e=-2;d=-1;break k;}e=v[l+32>>2];d=o-e|0;e=e+p|0;l:{while(1){if(d>>>0<3){D=-72;break l;}D=-20;m:{n:{E=w[e|0]|w[e+1|0]<<8;g=E>>>1&3;switch(g-1|0){case 2:break l;case 0:break m;default:break n;}}g=(E|w[e+2|0]<<16)>>>3|0;}g=g+3|0;if(g>>>0>d>>>0){v[u>>2]=-72;e=-2;d=-1;break k;}n=n+1|0;d=d-g|0;e=e+g|0;if(!(E&1)){continue;}break;}if(v[l+40>>2]){if(d>>>0<=3){v[u>>2]=-72;e=-2;d=-1;break k;}e=e+4|0;}D=v[l+24>>2];d=v[l+8>>2];g=v[l+12>>2];v[u+4>>2]=0;v[u>>2]=e-p;e=d;d=(d|0)==-1&(g|0)==-1;e=d?B(n,D):e;d=d?0:g;break k;}v[u>>2]=D;e=-2;d=-1;}v[h+8>>2]=e;v[h+12>>2]=d;}Q=l+48|0;n=v[u>>2];if(n>>>0>o>>>0){break i;}g=s;k=p;h=n;o=0;x=0;D=0;o:{p:{switch(v[a+28960>>2]+1|0){default:e=v[a+28944>>2];q:{if(!e){break q;}d=v[e+26692>>2];f=v[e+26688>>2];r:{s:{i=v[e>>2];if(i){if(!f){break s;}S[f|0](d,i);S[f|0](d,e);break q;}if(!f){break r;}S[f|0](d,e);break q;}Y(i);}Y(e);}v[a+28960>>2]=0;v[a+28944>>2]=0;v[a+28948>>2]=0;r=0;break o;case 2:v[a+28960>>2]=0;break;case 0:break p;}}r=v[a+28948>>2];}if(r){x=v[r+8>>2];o=v[r+4>>2];}f=v[a+28908>>2]?1:5;t:{u:{if(h>>>0<f>>>0){e=g;break u;}K=a+28816|0;L=a+28752|0;M=r+10276|0;N=r+4116|0;P=r+6172|0;R=r+12|0;T=a+4120|0;U=a+6176|0;V=a+16|0;J=a+26668|0;W=a+10280|0;C=a+28728|0;l=a+28856|0;E=l;e=g;while(1){if(((w[k|0]|w[k+1|0]<<8|(w[k+2|0]<<16|w[k+3|0]<<24))&-16)==407710288){d=-72;if(h>>>0<8){break t;}d=-14;i=w[k+4|0]|w[k+5|0]<<8|(w[k+6|0]<<16|w[k+7|0]<<24);if(i>>>0>4294967287){break t;}d=i+8|0;d=d>>>0>h>>>0?-72:d;if(d>>>0>4294967176){break t;}k=d+k|0;h=h-d|0;if(h>>>0>=f>>>0){continue;}break u;}v:{if(r){d=v[r+8>>2];i=v[r+4>>2];v[a+28804>>2]=0;v[a+28744>>2]=f;v[a+28792>>2]=0;v[a+28796>>2]=0;v[a+28956>>2]=v[a+28740>>2]!=(d+i|0);f=C;v[f+8>>2]=0;v[f+12>>2]=0;v[f>>2]=0;v[f+4>>2]=0;v[a+10280>>2]=201326604;v[a+28808>>2]=0;v[a+28812>>2]=0;v[a+28800>>2]=3;v[J+8>>2]=v[814];f=v[813];v[J>>2]=v[812];v[J+4>>2]=f;v[a+12>>2]=W;v[a+8>>2]=T;v[a+4>>2]=U;v[a>>2]=V;v[a+28952>>2]=v[r+26676>>2];f=v[r+4>>2];v[a+28736>>2]=f;v[a+28732>>2]=f;d=f+v[r+8>>2]|0;v[a+28728>>2]=d;v[a+28740>>2]=d;if(v[r+26680>>2]){v[a+28808>>2]=1;v[a+28812>>2]=1;v[a+12>>2]=M;v[a+8>>2]=N;v[a+4>>2]=P;v[a>>2]=R;v[a+26668>>2]=v[r+26664>>2];v[a+26672>>2]=v[r+26668>>2];v[a+26676>>2]=v[r+26672>>2];break v;}v[a+28808>>2]=0;v[a+28812>>2]=0;break v;}d=0;v[a+28792>>2]=0;v[a+28796>>2]=0;v[a+28728>>2]=0;v[a+28732>>2]=0;v[a+28952>>2]=0;v[a+28808>>2]=0;v[a+28812>>2]=0;v[a+28800>>2]=3;v[a+28804>>2]=0;f=a+28736|0;v[f>>2]=0;v[f+4>>2]=0;f=a+10280|0;v[f>>2]=201326604;v[a+28744>>2]=v[a+28908>>2]?1:5;v[a+12>>2]=f;v[a+8>>2]=a+4120;v[a+4>>2]=a+6176;v[a>>2]=a+16;i=v[813];f=a+26668|0;v[f>>2]=v[812];v[f+4>>2]=i;v[a+26676>>2]=v[814];w:{if(!o|!x){break w;}Z=a+28728|0;x:{if(!((w[o|0]|w[o+1|0]<<8|(w[o+2|0]<<16|w[o+3|0]<<24))!=-332356553|x>>>0<=7)){v[a+28952>>2]=w[o+4|0]|w[o+5|0]<<8|(w[o+6|0]<<16|w[o+7|0]<<24);d=-30;t=a+16|0;i=Q-128|0;Q=i;f=-30;y:{if(x>>>0<9){break y;}q=o+8|0;j=ia(t+10264|0,q,x-8|0,t,10264);if(j>>>0>4294967176){break y;}v[i+124>>2]=31;j=q+(j>>>0<4294967177?j:0)|0;q=o+x|0;m=$(i,i+124|0,i+120|0,j,q-j|0);if(m>>>0>4294967176){break y;}A=v[i+124>>2];if(A>>>0>31){break y;}z=v[i+120>>2];if(z>>>0>=9){break y;}ba(t+4104|0,i,A,2256,2384,z);v[i+124>>2]=52;j=j+m|0;m=$(i,i+124|0,i+120|0,j,q-j|0);if(m>>>0>4294967176){break y;}A=v[i+124>>2];if(A>>>0>52){break y;}z=v[i+120>>2];if(z>>>0>=10){break y;}ba(t+6160|0,i,A,2512,2736,z);v[i+124>>2]=35;j=j+m|0;m=$(i,i+124|0,i+120|0,j,q-j|0);if(m>>>0>4294967176){break y;}A=v[i+124>>2];if(A>>>0>35){break y;}z=v[i+120>>2];if(z>>>0>=10){break y;}ba(t,i,A,2960,3104,z);j=j+m|0;A=j+12|0;if(A>>>0>q>>>0){break y;}m=w[j|0]|w[j+1|0]<<8|(w[j+2|0]<<16|w[j+3|0]<<24);if(!m){break y;}q=q-A|0;if(q>>>0<m>>>0){break y;}v[t+26652>>2]=m;m=w[j+4|0]|w[j+5|0]<<8|(w[j+6|0]<<16|w[j+7|0]<<24);if(!m|m>>>0>q>>>0){break y;}v[t+26656>>2]=m;j=j+4|0;m=w[j+4|0]|w[j+5|0]<<8|(w[j+6|0]<<16|w[j+7|0]<<24);if(!m|m>>>0>q>>>0){break y;}v[t+26660>>2]=m;f=(j-o|0)+8|0;}Q=i+128|0;if(f>>>0>4294967176){break w;}v[a+28808>>2]=1;v[a+28812>>2]=1;i=v[a+28728>>2];v[a+28740>>2]=i;j=v[a+28732>>2];d=(f>>>0<4294967177?f:0)+o|0;v[a+28732>>2]=d;v[a+28736>>2]=d+(j-i|0);d=d+(x-f|0)|0;break x;}v[a+28736>>2]=o;v[a+28740>>2]=0;v[a+28732>>2]=o;d=o+x|0;}v[Z>>2]=d;d=0;}if(d>>>0>4294967176){break t;}d=v[C>>2];}if((e|0)!=(d|0)){v[a+28740>>2]=d;v[a+28728>>2]=e;f=v[a+28732>>2];v[a+28732>>2]=e;v[a+28736>>2]=(f-d|0)+e;}z:{d=v[a+28908>>2];A:{if((d?5:9)>>>0>h>>>0){f=-72;break A;}j=d?1:5;f=w[(j+k|0)-1|0];i=f&32;f=(!i+(v[(f>>>4&12)+4736>>2]+(j+v[((f&3)<<2)+4720>>2]|0)|0)|0)+(i>>>5&f>>>0<64)|0;if(f>>>0>4294967176){break A;}if(f+3>>>0>h>>>0){f=-72;break A;}d=aa(L,k,f,d);if(d>>>0>4294967176){f=d;break A;}if(d){f=-72;break A;}d=v[a+28780>>2];if(!(!d|(d|0)==v[a+28952>>2])){f=-32;break A;}if(v[a+28784>>2]){v[a+28848>>2]=2048144761;v[a+28852>>2]=1640531534;v[a+28840>>2]=0;v[a+28844>>2]=0;v[a+28832>>2]=668265295;v[a+28836>>2]=-1028477379;v[a+28824>>2]=-1379879466;v[a+28828>>2]=1625958382;v[a+28816>>2]=0;v[a+28820>>2]=0;v[l+32>>2]=0;v[l+36>>2]=0;v[E+24>>2]=0;v[E+28>>2]=0;d=l;v[d+16>>2]=0;v[d+20>>2]=0;v[d+8>>2]=0;v[d+12>>2]=0;v[d>>2]=0;v[d+4>>2]=0;}t=e+G|0;h=h-f|0;k=f+k|0;j=e;while(1){if(h>>>0<3){f=-72;break A;}q=w[k|0]|w[k+1|0]<<8;m=q|w[k+2|0]<<16;i=m>>>3|0;f=-20;B:{C:{z=q>>>1&3;d=z;switch(d-1|0){case 2:break A;case 0:break B;default:break C;}}d=i;}h=h-3|0;if(h>>>0<d>>>0){f=-72;break A;}k=k+3|0;D:{E:{switch(z-1|0){default:if(!j){f=0;if(!d){break D;}f=-74;break A;}if(t-j>>>0<d>>>0){f=-70;break A;}X(j,k,d);f=d;break D;case 0:if(!j){f=0;if(m>>>0<8){break D;}f=-74;break A;}if(i>>>0>t-j>>>0){f=-70;break A;}_(j,w[k|0],i);f=i;break D;case 1:break E;}}f=qa(a,j,t-j|0,k,d);if(f>>>0>4294967176){break A;}}if(v[a+28784>>2]){pa(K,j,f);}h=h-d|0;k=d+k|0;j=f+j|0;if(!(q&1)){continue;}break;}f=v[a+28756>>2];d=f;i=v[a+28752>>2];if((i|0)!=-1|(d|0)!=-1){f=-20;z=i;i=j-e|0;if((z|0)!=(i|0)|i>>31!=(d|0)){break A;}}if(v[a+28784>>2]){f=-22;d=oa(K);if((d|0)!=(w[k|0]|w[k+1|0]<<8|(w[k+2|0]<<16|w[k+3|0]<<24))|h>>>0<4){break A;}h=h-4|0;k=k+4|0;}f=j-e|0;if(f>>>0<4294967177){break z;}}d=(f|0)==-10?D?-72:f:f;break t;}D=1;G=G-f|0;e=e+f|0;f=v[a+28908>>2]?1:5;if(h>>>0>=f>>>0){continue;}break;}}d=-72;if(h){break t;}d=e-g|0;}e=d;if(d>>>0>4294967176){break a;}v[a+28744>>2]=0;s=e+s|0;f=p+n|0;break c;}F:{if(v[a+28772>>2]==1|v[a+29024>>2]!=1){break F;}e=v[i>>2];d=v[i+4>>2];if((e|0)==-1&(d|0)==-1|!d&H-s>>>0>=e>>>0){break F;}e=-70;break a;}G:{H:{switch(v[a+28960>>2]+1|0){default:e=v[a+28944>>2];I:{if(!e){break I;}g=v[e+26692>>2];d=v[e+26688>>2];J:{K:{h=v[e>>2];if(h){if(!d){break K;}S[d|0](g,h);S[d|0](g,e);break I;}if(!d){break J;}S[d|0](g,e);break I;}Y(h);}Y(e);}e=0;v[a+28960>>2]=0;v[a+28944>>2]=0;v[a+28948>>2]=0;g=1;break G;case 2:v[a+28960>>2]=0;break;case 0:break H;}}e=v[a+28948>>2];if(!e){e=0;g=1;break G;}v[a+28956>>2]=v[a+28740>>2]!=(v[e+4>>2]+v[e+8>>2]|0);g=0;}v[a+28792>>2]=0;v[a+28796>>2]=0;v[x>>2]=0;h=v[a+28908>>2];v[a+28744>>2]=h?1:5;d=r;v[d+8>>2]=0;v[d+12>>2]=0;v[d>>2]=0;v[d+4>>2]=0;v[a+10280>>2]=201326604;v[a+28952>>2]=0;v[a+28808>>2]=0;v[a+28812>>2]=0;v[a+28800>>2]=3;v[q+8>>2]=v[814];d=v[813];v[q>>2]=v[812];v[q+4>>2]=d;v[a+12>>2]=N;v[a+8>>2]=m;v[a+4>>2]=L;v[a>>2]=M;L:{if(g){break L;}v[a+28952>>2]=v[e+26676>>2];d=v[e+4>>2];v[a+28736>>2]=d;v[a+28732>>2]=d;d=d+v[e+8>>2]|0;v[a+28728>>2]=d;v[a+28740>>2]=d;if(v[e+26680>>2]){v[a+28808>>2]=1;v[a+28812>>2]=1;v[a+12>>2]=e+10276;v[a+8>>2]=e+4116;v[a+4>>2]=e+6172;v[a>>2]=e+12;v[a+26668>>2]=v[e+26664>>2];v[a+26672>>2]=v[e+26668>>2];v[a+26676>>2]=v[e+26672>>2];break L;}v[a+28808>>2]=0;v[a+28812>>2]=0;}M:{if(((w[k|0]|w[k+1|0]<<8|(w[k+2|0]<<16|w[k+3|0]<<24))&-16)==407710288){e=w[a+160148|0]|w[a+160149|0]<<8|(w[a+160150|0]<<16|w[a+160151|0]<<24);g=7;break M;}e=aa(i,k,v[a+29e3>>2],h);if(e>>>0>4294967176){break a;}if(e){e=-72;break a;}e=v[a+28780>>2];if(!(!e|(e|0)==v[a+28952>>2])){e=-32;break a;}g=2;e=3;if(!v[a+28784>>2]){break M;}v[a+28848>>2]=2048144761;v[a+28852>>2]=1640531534;v[a+28840>>2]=0;v[a+28844>>2]=0;v[a+28832>>2]=668265295;v[a+28836>>2]=-1028477379;v[a+28824>>2]=-1379879466;v[a+28828>>2]=1625958382;v[a+28816>>2]=0;v[a+28820>>2]=0;v[K+32>>2]=0;v[K+36>>2]=0;d=j;v[d+24>>2]=0;v[d+28>>2]=0;v[d+16>>2]=0;v[d+20>>2]=0;v[d+8>>2]=0;v[d+12>>2]=0;v[d>>2]=0;v[d+4>>2]=0;}v[a+28744>>2]=e;v[x>>2]=g;e=v[a+28760>>2];d=v[a+28764>>2];g=!d&e>>>0>1024|(d|0)!=0;e=g?e:1024;d=g?d:0;h=d;v[a+28760>>2]=e;v[a+28764>>2]=d;if(!d&e>>>0>y[a+28980>>2]|d){e=-16;break a;}d=v[a+28768>>2];l=d>>>0>4?d:4;d=0;g=0;if(!v[a+29024>>2]){g=v[i+4>>2];D=g;G=v[i>>2];n=e;e=!h&e>>>0<131072;E=e?n:131072;n=n+E|0;e=(e?h:0)+h|0;e=n>>>0<E>>>0?e+1|0:e;h=n;n=h- -64|0;e=e-((h>>>0<4294967232)-1|0)|0;g=(g|0)==(e|0)&n>>>0>G>>>0|e>>>0>g>>>0;g=(g?D:e)?-16:g?G:n;}e=v[C>>2];n=v[t>>2];h=g+l|0;d=e+n>>>0>=B(h,3)>>>0?v[J>>2]+1|0:d;v[J>>2]=d;if(!(!(e>>>0<g>>>0|l>>>0>n>>>0)&d>>>0<128)){N:{O:{e=v[a+28936>>2];if(e){if(h>>>0<=e-160168>>>0){break O;}e=-64;break a;}e=v[a+28968>>2];P:{if(!e){break P;}d=w[a+28920|0]|w[a+28921|0]<<8|(w[a+28922|0]<<16|w[a+28923|0]<<24);if(d){S[d|0](w[a+28924|0]|w[a+28925|0]<<8|(w[a+28926|0]<<16|w[a+28927|0]<<24),e);break P;}Y(e);}v[C>>2]=0;v[t>>2]=0;e=a;d=w[a+28916|0]|w[a+28917|0]<<8|(w[a+28918|0]<<16|w[a+28919|0]<<24);Q:{if(d){d=S[d|0](w[a+28924|0]|w[a+28925|0]<<8|(w[a+28926|0]<<16|w[a+28927|0]<<24),h)|0;break Q;}d=ea(h);}v[e+28968>>2]=d;if(d){break N;}e=-64;break a;}d=v[a+28968>>2];}v[C>>2]=g;v[a+28984>>2]=d+l;v[t>>2]=l;}v[a+28964>>2]=2;}h=F-f|0;d=v[x>>2];R:{S:{if(!(v[a+28800>>2]|d-3>>>0>1)){e=v[a+28744>>2];g=h>>>0>1?h:1;if(e>>>0<=g>>>0){break S;}break R;}e=v[a+28744>>2];}g=e;if(!e){break c;}}if(g>>>0<=h>>>0){h=a;T:{if(!v[a+29024>>2]){l=(d|0)!=7;U:{if(!l){e=v[a+28992>>2];d=0;break U;}e=v[a+28992>>2];d=v[C>>2]-e|0;}e=ca(a,v[a+28984>>2]+e|0,d,f,g);if(e>>>0>4294967176){break a;}if(!e){d=2;if(l){break T;}}v[a+28996>>2]=v[a+28992>>2]+e;d=4;break T;}e=ca(a,s,(d|0)==7?0:H-s|0,f,g);if(e>>>0>4294967176){break a;}s=e+s|0;d=2;}v[h+28964>>2]=d;f=f+g|0;continue;}if((f|0)==(F|0)){f=F;break b;}v[a+28964>>2]=3;}h=v[a+28976>>2];g=e-h|0;V:{if((d|0)==7){d=F-f|0;d=d>>>0>g>>>0?g:d;break V;}if(g>>>0>v[t>>2]-h>>>0){e=-20;break a;}d=F-f|0;d=d>>>0>g>>>0?g:d;if(!d){d=0;break V;}X(v[a+28968>>2]+h|0,f,d);h=v[a+28976>>2];}v[a+28976>>2]=d+h;f=d+f|0;if(d>>>0<g>>>0){break b;}v[a+28976>>2]=0;g=v[x>>2];h=v[a+28968>>2];d=a;W:{if(!v[a+29024>>2]){n=(g|0)!=7;X:{if(!n){g=v[a+28992>>2];l=0;break X;}g=v[a+28992>>2];l=v[C>>2]-g|0;}e=ca(a,v[a+28984>>2]+g|0,l,h,e);if(e>>>0>4294967176){break a;}if(!e){g=2;if(n){break W;}}v[a+28996>>2]=v[a+28992>>2]+e;g=4;break W;}e=ca(a,s,(g|0)==7?0:H-s|0,h,e);if(e>>>0>4294967176){break a;}s=e+s|0;g=2;}v[d+28964>>2]=g;continue;}d=a;h=H-s|0;e=v[a+28992>>2];l=v[a+28996>>2]-e|0;n=h>>>0<l>>>0;g=n?h:l;if(g){X(s,e+v[a+28984>>2]|0,g);e=v[a+28992>>2];}e=e+g|0;v[d+28992>>2]=e;Y:{if(n){break Y;}v[a+28964>>2]=2;d=v[C>>2];if(!v[a+28756>>2]&d>>>0>=y[a+28752>>2]|d>>>0>=e+v[a+28768>>2]>>>0){break Y;}v[a+28992>>2]=0;v[a+28996>>2]=0;}s=g+s|0;if(h>>>0>=l>>>0){continue;}break b;}break;}v[a+28964>>2]=0;}v[c+8>>2]=f-v[c>>2];e=s-v[b>>2]|0;v[b+8>>2]=e;v[I+8>>2]=e;e=v[b+4>>2];v[I>>2]=v[b>>2];v[I+4>>2]=e;Z:{if(!((f|0)!=(p|0)|(s|0)!=(O|0))){b=v[a+29020>>2];v[a+29020>>2]=b+1;if((b|0)<15){break Z;}e=-70;if((H|0)==(O|0)){break a;}e=-72;if((p|0)!=(F|0)){break Z;}break a;}v[a+29020>>2]=0;}b=v[a+28744>>2];if(!b){b=v[a+29016>>2];if(v[a+28996>>2]==v[a+28992>>2]){e=0;if(!b){break a;}b=v[c+8>>2];if(b>>>0>=y[c+4>>2]){v[a+28964>>2]=2;e=1;break a;}v[c+8>>2]=b+1;break a;}e=1;if(b){break a;}v[c+8>>2]=v[c+8>>2]-1;v[a+29016>>2]=1;break a;}e=(b-v[a+28976>>2]|0)+(v[a+28804>>2]==3?3:0)|0;}Q=u+16|0;return e|0;}function na(a,b,c,d,e,f){var g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,y=0,z=0,A=0,B=0,C=0;r=Q-784|0;Q=r;j=-72;a:{if(!f){break a;}g=t[e|0];A=g&255;b:{c:{if((g|0)<0){g=A-126>>>1|0;if(g>>>0>=f>>>0){break a;}j=-20;i=A-127|0;if(i>>>0>=256){break a;}if(!i){break b;}n=e+1|0;j=A-128|0;e=(j>>>1|0)+1|0;k=e&1;f=0;if(j>>>0>=2){e=e&-2;while(1){j=n+(f>>>1|0)|0;t[a+f|0]=w[j|0]>>>4;t[(f|1)+a|0]=w[j|0]&15;j=f|2;l=n+(j>>>1|0)|0;t[a+j|0]=w[l|0]>>>4;t[(f|3)+a|0]=w[l|0]&15;f=f+4|0;e=e-2|0;if(e){continue;}break;}}if(k){e=n+(f>>>1|0)|0;t[a+f|0]=w[e|0]>>>4;t[(f|1)+a|0]=w[e|0]&15;}A=g;break c;}if(f>>>0<=A>>>0){break a;}v[r+264>>2]=255;q=e+1|0;g=$(r+272|0,r+264|0,r+268|0,q,A);if(g>>>0>4294967176){j=g;break a;}j=-44;m=v[r+268>>2];if(m>>>0>6){break a;}z=r+272|0;p=Q-512|0;Q=p;j=-46;s=v[r+264>>2];d:{if(s>>>0>255){break d;}j=-44;if(m>>>0>12){break d;}B=r+4|0;o=1<<m;f=o-1|0;h=1;e=s+1|0;C=e&1;y=65536<<m-1>>16;e:{if(!s){e=f;break e;}j=e&-2;e=f;while(1){k=l<<1;i=x[k+z>>1];f:{if((i|0)==65535){t[(B+(e<<2)|0)+2|0]=l;e=e-1|0;i=1;break f;}h=(y|0)>i<<16>>16?h:0;}u[k+p>>1]=i;n=l|1;k=n<<1;i=x[z+k>>1];g:{if((i|0)!=65535){h=(y|0)>i<<16>>16?h:0;break g;}t[(B+(e<<2)|0)+2|0]=n;e=e-1|0;i=1;}u[k+p>>1]=i;l=l+2|0;j=j-2|0;if(j){continue;}break;}}if(C){i=x[z+(l<<1)>>1];h:{if((i|0)!=65535){h=(y|0)>i<<16>>16?h:0;break h;}t[(B+(e<<2)|0)+2|0]=l;e=e-1|0;i=1;}u[p+(l<<1)>>1]=i;}u[r+2>>1]=h;u[r>>1]=m;n=((o>>>3)+(o>>>1)|0)+3|0;l=0;j=0;while(1){i=j;k=u[z+(i<<1)>>1];i:{if((k|0)<=0){break i;}if((k|0)!=1){j=k&-2;while(1){t[(B+(l<<2)|0)+2|0]=i;while(1){l=f&l+n;if(l>>>0>e>>>0){continue;}break;}t[(B+(l<<2)|0)+2|0]=i;while(1){l=f&l+n;if(l>>>0>e>>>0){continue;}break;}j=j-2|0;if(j){continue;}break;}}if(!(k&1)){break i;}t[(B+(l<<2)|0)+2|0]=i;while(1){l=f&l+n;if(l>>>0>e>>>0){continue;}break;}}j=i+1|0;if((i|0)!=(s|0)){continue;}break;}j=-1;if(l){break d;}f=m+1|0;j=0;l=0;while(1){i=B+(l<<2)|0;e=p+(w[i+2|0]<<1)|0;k=x[e>>1];u[e>>1]=k+1;e=f+(E(k)^-32)|0;t[i+3|0]=e;u[i>>1]=(k<<e)-o;l=l+1|0;if((o|0)!=(l|0)){continue;}break;}}Q=p+512|0;if(j>>>0>=4294967177){break a;}m=g+q|0;f=A-g|0;C=a;s=a+255|0;y=s-3|0;j:{k:{l:{m:{n:{if(x[r+2>>1]){i=-72;if(!f){break j;}o:{p:{if(f>>>0>=4){q=-1;e=w[(f+m|0)-1|0];if(!e){break l;}if(f>>>0<=4294967176){break p;}i=f;break j;}g=w[m|0];q:{switch(f-2|0){case 1:g=w[m+2|0]<<16|g;case 0:g=(w[m+1|0]<<8)+g|0;break;default:break q;}}j=w[(f+m|0)-1|0];i=-20;if(!j){break j;}h=0;e=(E(j)-(f<<3)|0)+9|0;break o;}h=f-4|0;f=m+h|0;g=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);e=E(e)-23|0;}l=x[r>>1];k=l+e|0;f=g>>>0-k|0;i=v[(l<<2)+4592>>2];r:{if(k>>>0>32){break r;}s:{if((h|0)>=4){g=k>>>3|0;k=k&7;break s;}if(!h){h=0;break r;}e=k>>>3|0;g=m>>>0>(h+m|0)-e>>>0?h:e;k=k-(g<<3)|0;}h=h-g|0;e=m+h|0;g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);}j=f&i;p=r+4|0;f=k+l|0;n=i&g>>>0-f;if(f>>>0>32){e=f;f=a;break m;}if((h|0)>=4){e=f&7;h=h-(f>>>3|0)|0;f=m+h|0;g=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);break n;}if(!h){h=0;e=f;break n;}e=f>>>3|0;e=m>>>0>(h+m|0)-e>>>0?h:e;h=h-e|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);e=f-(e<<3)|0;if(e>>>0<=32){break n;}f=a;break m;}i=-72;if(!f){break j;}t:{u:{if(f>>>0>=4){q=-1;e=w[(f+m|0)-1|0];if(!e){break l;}if(f>>>0<=4294967176){break u;}i=f;break j;}g=w[m|0];v:{switch(f-2|0){case 1:g=w[m+2|0]<<16|g;case 0:g=(w[m+1|0]<<8)+g|0;break;default:break v;}}j=w[(f+m|0)-1|0];i=-20;if(!j){break j;}h=0;e=(E(j)-(f<<3)|0)+9|0;break t;}h=f-4|0;f=m+h|0;g=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);e=E(e)-23|0;}l=x[r>>1];k=l+e|0;f=g>>>0-k|0;i=v[(l<<2)+4592>>2];w:{if(k>>>0>32){break w;}x:{if((h|0)>=4){g=k>>>3|0;k=k&7;break x;}if(!h){h=0;break w;}e=k>>>3|0;g=m>>>0>(h+m|0)-e>>>0?h:e;k=k-(g<<3)|0;}h=h-g|0;e=m+h|0;g=w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24);}j=f&i;p=r+4|0;f=k+l|0;n=i&g>>>0-f;y:{if(f>>>0>32){e=f;f=a;break y;}z:{if((h|0)>=4){e=f&7;h=h-(f>>>3|0)|0;f=m+h|0;g=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);break z;}if(!h){h=0;e=f;break z;}e=f>>>3|0;e=m>>>0>(h+m|0)-e>>>0?h:e;h=h-e|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);e=f-(e<<3)|0;if(e>>>0<=32){break z;}f=a;break y;}f=a;while(1){A:{if((h|0)>=4){g=e>>>3|0;k=0;e=e&7;break A;}if(!h){h=0;break y;}g=e>>>3|0;k=m>>>0>(h+m|0)-g>>>0;g=k?h:g;e=e-(g<<3)|0;}h=h-g|0;o=m+h|0;g=w[o|0]|w[o+1|0]<<8|(w[o+2|0]<<16|w[o+3|0]<<24);if(k|f>>>0>=y>>>0){break y;}i=(j<<2)+p|0;j=x[i>>1];q=w[i+3|0];t[f|0]=w[i+2|0];l=(n<<2)+p|0;k=x[l>>1];i=w[l+3|0];t[f+1|0]=w[l+2|0];e=e+q|0;j=j+(v[(q<<2)+4592>>2]&g>>>0-e)|0;l=v[(i<<2)+4592>>2];i=e+i|0;n=k+(l&g>>>0-i)|0;B:{C:{if(i>>>0>32){e=i;break C;}if((h|0)>=4){e=i&7;h=h-(i>>>3|0)|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);break B;}if(!h){h=0;e=i;break C;}e=i>>>3|0;k=o-e|0;g=k>>>0<m>>>0?h:e;e=i-(g<<3)|0;h=h-g|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);if(k>>>0>=m>>>0){break B;}}f=f+2|0;break y;}i=(j<<2)+p|0;j=x[i>>1];q=w[i+3|0];t[f+2|0]=w[i+2|0];l=(n<<2)+p|0;i=x[l>>1];k=w[l+3|0];t[f+3|0]=w[l+2|0];e=e+q|0;j=j+(v[(q<<2)+4592>>2]&g>>>0-e)|0;e=e+k|0;n=i+(v[(k<<2)+4592>>2]&g>>>0-e)|0;f=f+4|0;if(e>>>0<33){continue;}break;}}q=-70;o=s-2|0;if(o>>>0<f>>>0){break l;}z=2;while(1){j=(j<<2)+p|0;y=x[j>>1];s=w[j+3|0];t[f|0]=w[j+2|0];i=f+1|0;e=e+s|0;if(e>>>0>32){j=n;break k;}D:{E:{if((h|0)>=4){j=e>>>3|0;l=e&7;break E;}if(!h){h=0;l=e;k=g;break D;}j=e>>>3|0;j=m>>>0>(h+m|0)-j>>>0?h:j;l=e-(j<<3)|0;}h=h-j|0;j=m+h|0;k=w[j|0]|w[j+1|0]<<8|(w[j+2|0]<<16|w[j+3|0]<<24);}if(i>>>0>o>>>0){break l;}j=y+(v[(s<<2)+4592>>2]&g>>>0-e)|0;e=(n<<2)+p|0;n=x[e>>1];g=w[e+3|0];t[f+1|0]=w[e+2|0];i=f+2|0;e=g+l|0;if(e>>>0>32){z=3;break k;}f=v[(g<<2)+4592>>2]&k>>>0-e;F:{G:{if((h|0)>=4){l=e>>>3|0;e=e&7;break G;}if(!h){h=0;g=k;break F;}g=e;e=e>>>3|0;l=m>>>0>(h+m|0)-e>>>0?h:e;e=g-(l<<3)|0;}h=h-l|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);}n=f+n|0;f=i;if(o>>>0>=f>>>0){continue;}break;}break l;}f=a;while(1){H:{if((h|0)>=4){g=e>>>3|0;k=0;e=e&7;break H;}if(!h){h=0;break m;}g=e>>>3|0;k=m>>>0>(h+m|0)-g>>>0;g=k?h:g;e=e-(g<<3)|0;}h=h-g|0;o=m+h|0;g=w[o|0]|w[o+1|0]<<8|(w[o+2|0]<<16|w[o+3|0]<<24);if(k|f>>>0>=y>>>0){break m;}i=(j<<2)+p|0;j=x[i>>1];q=w[i+3|0];t[f|0]=w[i+2|0];l=(n<<2)+p|0;i=x[l>>1];k=w[l+3|0];t[f+1|0]=w[l+2|0];j=j+(g<<e>>>0-q|0)|0;e=e+q|0;n=i+(g<<e>>>0-k|0)|0;I:{i=e+k|0;J:{if(i>>>0>32){e=i;break J;}if((h|0)>=4){e=i&7;h=h-(i>>>3|0)|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);break I;}if(!h){h=0;e=i;break J;}e=i>>>3|0;k=o-e|0;g=k>>>0<m>>>0?h:e;e=i-(g<<3)|0;h=h-g|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);if(k>>>0>=m>>>0){break I;}}f=f+2|0;break m;}i=(j<<2)+p|0;j=x[i>>1];q=w[i+3|0];t[f+2|0]=w[i+2|0];l=(n<<2)+p|0;i=x[l>>1];k=w[l+3|0];t[f+3|0]=w[l+2|0];j=j+(g<<e>>>0-q|0)|0;e=e+q|0;n=i+(g<<e>>>0-k|0)|0;f=f+4|0;e=e+k|0;if(e>>>0<33){continue;}break;}}q=-70;o=s-2|0;if(o>>>0<f>>>0){break l;}z=2;while(1){j=(j<<2)+p|0;y=x[j>>1];s=w[j+3|0];t[f|0]=w[j+2|0];i=f+1|0;k=e+s|0;if(k>>>0>32){j=n;break k;}K:{L:{if((h|0)>=4){l=k>>>3|0;k=k&7;break L;}if(!h){h=0;l=g;break K;}j=k>>>3|0;l=m>>>0>(h+m|0)-j>>>0?h:j;k=k-(l<<3)|0;}h=h-l|0;j=m+h|0;l=w[j|0]|w[j+1|0]<<8|(w[j+2|0]<<16|w[j+3|0]<<24);}if(i>>>0>o>>>0){break l;}j=y+(g<<e>>>0-s|0)|0;e=(n<<2)+p|0;n=x[e>>1];g=w[e+3|0];t[f+1|0]=w[e+2|0];i=f+2|0;e=g+k|0;if(e>>>0>32){z=3;break k;}f=l<<k>>>0-g|0;M:{N:{if((h|0)>=4){l=e>>>3|0;e=e&7;break N;}if(!h){h=0;g=l;break M;}g=e;e=e>>>3|0;l=m>>>0>(h+m|0)-e>>>0?h:e;e=g-(l<<3)|0;}h=h-l|0;g=m+h|0;g=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);}n=f+n|0;f=i;if(o>>>0>=f>>>0){continue;}break;}}i=q;break j;}t[i|0]=w[((j<<2)+p|0)+2|0];i=(f+z|0)-C|0;}j=i;if(i>>>0>=4294967177){break a;}}f=b;v[f>>2]=0;v[f+4>>2]=0;e=0;v[f+48>>2]=0;v[f+40>>2]=0;v[f+44>>2]=0;v[f+32>>2]=0;v[f+36>>2]=0;v[f+24>>2]=0;v[f+28>>2]=0;v[f+16>>2]=0;v[f+20>>2]=0;v[f+8>>2]=0;v[f+12>>2]=0;j=-20;if(!i){break a;}f=0;while(1){k=a+f|0;g=w[k|0];if(g>>>0>11){break a;}g=(g<<2)+b|0;v[g>>2]=v[g>>2]+1;e=(1<<w[k|0]>>1)+e|0;f=f+1|0;if((i|0)!=(f|0)){continue;}break;}if(!e|e>>>0>4095){break a;}f=d;d=32-E(e)|0;v[f>>2]=d;e=(1<<d)-e|0;d=E(e)^31;if(1<<d!=(e|0)){break a;}e=a+i|0;a=d+1|0;t[e|0]=a;a=(a<<2)+b|0;v[a>>2]=v[a>>2]+1;a=v[b+4>>2];if(a>>>0<2|a&1){break a;}v[c>>2]=i+1;j=A+1|0;break a;}v[b>>2]=0;v[b+4>>2]=0;v[b+48>>2]=0;v[b+40>>2]=0;v[b+44>>2]=0;v[b+32>>2]=0;v[b+36>>2]=0;v[b+24>>2]=0;v[b+28>>2]=0;v[b+16>>2]=0;v[b+20>>2]=0;v[b+8>>2]=0;v[b+12>>2]=0;}Q=r+784|0;return j;}function ra(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,u=0,y=0,z=0,A=0,B=0,C=0,D=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,R=0,S=0,T=0;n=Q-32|0;Q=n;f=-20;a:{if(d>>>0<10){break a;}j=w[c+4|0]|w[c+5|0]<<8;h=w[c|0]|w[c+1|0]<<8;m=h+6|0;i=w[c+2|0]|w[c+3|0]<<8;C=j+(m+i|0)|0;if(C>>>0>d>>>0){break a;}if(!h){f=-72;break a;}g=c+6|0;z=x[e+2>>1];b:{if(h>>>0>=4){f=-1;g=w[(h+g|0)-1|0];if(!g){break a;}r=h+2|0;h=r+c|0;k=w[h|0]|w[h+1|0]<<8|(w[h+2|0]<<16|w[h+3|0]<<24);h=E(g)-23|0;break b;}k=w[g|0];c:{switch(h-2|0){case 1:k=w[c+8|0]<<16|k;case 0:k=(w[c+7|0]<<8)+k|0;break;default:break c;}}g=w[(h+g|0)-1|0];if(!g){break a;}r=6;h=(E(g)-(h<<3)|0)+9|0;}if(!i){f=-72;break a;}B=c+m|0;d:{if(i>>>0>=4){f=-1;m=w[(i+B|0)-1|0];if(!m){break a;}s=i-4|0;g=B+s|0;o=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);g=E(m)-23|0;break d;}o=w[B|0];e:{switch(i-2|0){case 1:o=w[B+2|0]<<16|o;case 0:o=(w[B+1|0]<<8)+o|0;break;default:break e;}}g=w[(i+B|0)-1|0];if(!g){f=-20;break a;}g=(E(g)-(i<<3)|0)+9|0;}f=-72;if(!j){break a;}F=i+B|0;m=F+j|0;f:{if(j>>>0>=4){f=-1;l=w[m-1|0];if(!l){break a;}u=j-4|0;i=F+u|0;D=w[i|0]|w[i+1|0]<<8|(w[i+2|0]<<16|w[i+3|0]<<24);i=E(l)-23|0;break f;}D=w[F|0];g:{switch(j-2|0){case 1:D=w[F+2|0]<<16|D;case 0:D=(w[F+1|0]<<8)+D|0;break;default:break g;}}i=w[m-1|0];if(!i){f=-20;break a;}i=(E(i)-(j<<3)|0)+9|0;}f=ja(n+8|0,m,d-C|0);if(f>>>0>4294967176){break a;}l=e+4|0;p=0-z&31;A=v[n+16>>2];f=v[n+12>>2];q=v[n+8>>2];d=b+3>>>2|0;m=d+a|0;M=a+b|0;N=M-3|0;C=d+m|0;z=C+d|0;h:{if(N>>>0<=z>>>0){e=z;j=C;d=m;break h;}P=v[n+24>>2];d=m;j=C;e=z;while(1){y=(k<<h>>>p<<2)+l|0;G=x[y>>1];t[a|0]=G;t[a+1|0]=G>>>8;G=w[y+2|0];I=w[y+3|0];y=(o<<g>>>p<<2)+l|0;H=x[y>>1];t[d|0]=H;t[d+1|0]=H>>>8;H=w[y+2|0];J=w[y+3|0];y=(D<<i>>>p<<2)+l|0;K=x[y>>1];t[j|0]=K;t[j+1|0]=K>>>8;K=w[y+2|0];O=w[y+3|0];y=(q<<f>>>p<<2)+l|0;L=x[y>>1];t[e|0]=L;t[e+1|0]=L>>>8;L=w[y+2|0];R=w[y+3|0];y=a+I|0;h=h+G|0;a=(k<<h>>>p<<2)+l|0;G=x[a>>1];t[y|0]=G;t[y+1|0]=G>>>8;G=w[a+2|0];S=w[a+3|0];d=d+J|0;I=g+H|0;a=(o<<I>>>p<<2)+l|0;g=x[a>>1];t[d|0]=g;t[d+1|0]=g>>>8;H=w[a+2|0];T=w[a+3|0];j=j+O|0;i=i+K|0;a=(D<<i>>>p<<2)+l|0;g=x[a>>1];t[j|0]=g;t[j+1|0]=g>>>8;J=w[a+2|0];K=w[a+3|0];e=e+R|0;f=f+L|0;g=(q<<f>>>p<<2)+l|0;a=x[g>>1];t[e|0]=a;t[e+1|0]=a>>>8;h=h+G|0;if((r|0)<10){G=3;}else {r=r-(h>>>3|0)|0;a=r+c|0;k=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);h=h&7;G=0;}O=w[g+3|0];L=w[g+2|0];g=H+I|0;I=3;if((s|0)<4){H=3;}else {s=s-(g>>>3|0)|0;a=B+s|0;o=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);g=g&7;H=0;}i=i+J|0;if((u|0)>=4){u=u-(i>>>3|0)|0;a=F+u|0;D=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);I=0;i=i&7;}e=e+O|0;f=f+L|0;if(A>>>0<P>>>0){J=3;}else {A=A-(f>>>3|0)|0;q=w[A|0]|w[A+1|0]<<8|(w[A+2|0]<<16|w[A+3|0]<<24);f=f&7;J=0;}a=y+S|0;d=d+T|0;j=j+K|0;if(e>>>0>=N>>>0){break h;}if(!(J|(G|H|I))){continue;}break;}}v[n+16>>2]=A;v[n+12>>2]=f;v[n+8>>2]=q;if(a>>>0>m>>>0){f=-20;break a;}if(d>>>0>C>>>0){f=-20;break a;}f=-20;if(j>>>0>z>>>0){break a;}i:{j:{k:{if(h>>>0<=32){A=m-3|0;while(1){l:{if((r|0)>=10){k=h>>>3|0;q=0;f=h&7;break l;}if((r|0)==6){q=m-2|0;r=6;f=h;break j;}f=h>>>3|0;q=(r-f|0)<6;k=q?r-6|0:f;f=h-(k<<3)|0;}r=r-k|0;h=r+c|0;k=w[h|0]|w[h+1|0]<<8|(w[h+2|0]<<16|w[h+3|0]<<24);if(q|a>>>0>=A>>>0){break k;}h=(k<<f>>>p<<2)+l|0;q=x[h>>1];t[a|0]=q;t[a+1|0]=q>>>8;a=w[h+3|0]+a|0;f=w[h+2|0]+f|0;h=(k<<f>>>p<<2)+l|0;q=x[h>>1];t[a|0]=q;t[a+1|0]=q>>>8;a=a+w[h+3|0]|0;h=f+w[h+2|0]|0;if(h>>>0<33){continue;}break;}}q=m-2|0;break i;}q=m-2|0;if(f>>>0<=32){break j;}h=f;break i;}while(1){m:{if((r|0)>=10){k=f>>>3|0;A=0;h=f&7;break m;}if((r|0)==6){r=6;h=f;break i;}h=f>>>3|0;A=(r-h|0)<6;k=A?r-6|0:h;h=f-(k<<3)|0;}r=r-k|0;f=r+c|0;k=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);if(A|a>>>0>q>>>0){break i;}f=(k<<h>>>p<<2)+l|0;A=x[f>>1];t[a|0]=A;t[a+1|0]=A>>>8;a=w[f+3|0]+a|0;f=w[f+2|0]+h|0;if(f>>>0<=32){continue;}break;}h=f;}if(a>>>0<=q>>>0){while(1){c=(k<<h>>>p<<2)+l|0;f=x[c>>1];t[a|0]=f;t[a+1|0]=f>>>8;h=w[c+2|0]+h|0;a=w[c+3|0]+a|0;if(q>>>0>=a>>>0){continue;}break;}}n:{if(a>>>0>=m>>>0){break n;}f=a;c=k<<h>>>p|0;a=(c<<2)+l|0;t[f|0]=w[a|0];if(w[a+3|0]==1){h=w[a+2|0]+h|0;break n;}if(h>>>0>31){break n;}a=w[((c<<2)+l|0)+2|0]+h|0;h=a>>>0<32?a:32;}o:{p:{q:{if(g>>>0<=32){m=C-3|0;while(1){r:{if((s|0)>=4){f=g>>>3|0;a=0;c=g&7;break r;}if(!s){f=C-2|0;s=0;k=B;c=g;break p;}c=g>>>3|0;a=(B+s|0)-c>>>0<B>>>0;f=a?s:c;c=g-(f<<3)|0;}s=s-f|0;k=B+s|0;o=w[k|0]|w[k+1|0]<<8|(w[k+2|0]<<16|w[k+3|0]<<24);if(a|d>>>0>=m>>>0){break q;}a=(o<<c>>>p<<2)+l|0;g=x[a>>1];t[d|0]=g;t[d+1|0]=g>>>8;d=w[a+3|0]+d|0;c=w[a+2|0]+c|0;a=(o<<c>>>p<<2)+l|0;g=x[a>>1];t[d|0]=g;t[d+1|0]=g>>>8;d=d+w[a+3|0]|0;g=c+w[a+2|0]|0;if(g>>>0<33){continue;}break;}}k=B+s|0;f=C-2|0;break o;}f=C-2|0;if(c>>>0<=32){break p;}g=c;break o;}while(1){s:{if((s|0)>=4){a=c>>>3|0;q=0;g=c&7;break s;}if(!s){g=c;break o;}a=c>>>3|0;q=k-a>>>0<B>>>0;a=q?s:a;g=c-(a<<3)|0;}s=s-a|0;k=B+s|0;o=w[k|0]|w[k+1|0]<<8|(w[k+2|0]<<16|w[k+3|0]<<24);if(q|d>>>0>f>>>0){break o;}a=(o<<g>>>p<<2)+l|0;c=x[a>>1];t[d|0]=c;t[d+1|0]=c>>>8;d=w[a+3|0]+d|0;c=w[a+2|0]+g|0;if(c>>>0<=32){continue;}break;}g=c;}if(d>>>0<=f>>>0){while(1){a=(o<<g>>>p<<2)+l|0;c=x[a>>1];t[d|0]=c;t[d+1|0]=c>>>8;g=w[a+2|0]+g|0;d=w[a+3|0]+d|0;if(d>>>0<=f>>>0){continue;}break;}}t:{if(d>>>0>=C>>>0){break t;}c=o<<g>>>p|0;a=(c<<2)+l|0;t[d|0]=w[a|0];if(w[a+3|0]==1){g=w[a+2|0]+g|0;break t;}if(g>>>0>31){break t;}a=w[((c<<2)+l|0)+2|0]+g|0;g=a>>>0<32?a:32;}u:{v:{w:{if(i>>>0<=32){m=z-3|0;while(1){x:{if((u|0)>=4){f=i>>>3|0;a=0;c=i&7;break x;}if(!u){f=z-2|0;u=0;o=F;c=i;break v;}c=i>>>3|0;a=F>>>0>(u+F|0)-c>>>0;f=a?u:c;c=i-(f<<3)|0;}u=u-f|0;o=F+u|0;D=w[o|0]|w[o+1|0]<<8|(w[o+2|0]<<16|w[o+3|0]<<24);if(a|j>>>0>=m>>>0){break w;}a=(D<<c>>>p<<2)+l|0;d=x[a>>1];t[j|0]=d;t[j+1|0]=d>>>8;d=w[a+3|0]+j|0;c=w[a+2|0]+c|0;a=(D<<c>>>p<<2)+l|0;i=x[a>>1];t[d|0]=i;t[d+1|0]=i>>>8;j=d+w[a+3|0]|0;i=c+w[a+2|0]|0;if(i>>>0<33){continue;}break;}}o=u+F|0;f=z-2|0;break u;}f=z-2|0;if(c>>>0<=32){break v;}i=c;break u;}while(1){y:{if((u|0)>=4){a=c>>>3|0;d=0;i=c&7;break y;}if(!u){i=c;break u;}a=c>>>3|0;d=F>>>0>o-a>>>0;a=d?u:a;i=c-(a<<3)|0;}u=u-a|0;o=F+u|0;D=w[o|0]|w[o+1|0]<<8|(w[o+2|0]<<16|w[o+3|0]<<24);if(d|f>>>0<j>>>0){break u;}a=(D<<i>>>p<<2)+l|0;c=x[a>>1];t[j|0]=c;t[j+1|0]=c>>>8;j=w[a+3|0]+j|0;c=w[a+2|0]+i|0;if(c>>>0<=32){continue;}break;}i=c;}if(f>>>0>=j>>>0){while(1){a=(D<<i>>>p<<2)+l|0;c=x[a>>1];t[j|0]=c;t[j+1|0]=c>>>8;i=w[a+2|0]+i|0;j=w[a+3|0]+j|0;if(j>>>0<=f>>>0){continue;}break;}}z:{if(j>>>0>=z>>>0){break z;}c=D<<i>>>p|0;a=(c<<2)+l|0;t[j|0]=w[a|0];if(w[a+3|0]==1){i=w[a+2|0]+i|0;break z;}if(i>>>0>31){break z;}a=w[((c<<2)+l|0)+2|0]+i|0;i=a>>>0<32?a:32;}A:{B:{C:{c=v[n+12>>2];if(c>>>0<=32){while(1){a=n;f=v[a+16>>2];C=v[a+24>>2];D:{if(f>>>0>=C>>>0){f=f-(c>>>3|0)|0;v[n+16>>2]=f;d=0;c=c&7;break D;}j=v[n+20>>2];if((j|0)==(f|0)){a=M-2|0;j=f;break B;}m=c>>>3|0;d=j>>>0>f-m>>>0;j=d?f-j|0:m;f=f-j|0;v[n+16>>2]=f;c=c-(j<<3)|0;}v[a+12>>2]=c;a=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);v[n+8>>2]=a;if(d|e>>>0>=N>>>0){break C;}d=(a<<c>>>p<<2)+l|0;f=x[d>>1];t[e|0]=f;t[e+1|0]=f>>>8;e=w[d+3|0]+e|0;c=w[d+2|0]+c|0;a=(a<<c>>>p<<2)+l|0;d=x[a>>1];t[e|0]=d;t[e+1|0]=d>>>8;c=c+w[a+2|0]|0;v[n+12>>2]=c;e=e+w[a+3|0]|0;if(c>>>0<33){continue;}break;}}a=M-2|0;break A;}a=M-2|0;if(c>>>0>32){break A;}j=v[n+20>>2];}while(1){m=n;E:{if(f>>>0>=C>>>0){f=f-(c>>>3|0)|0;v[n+16>>2]=f;d=0;c=c&7;break E;}if((f|0)==(j|0)){break A;}z=c>>>3|0;d=j>>>0>f-z>>>0;z=d?f-j|0:z;f=f-z|0;v[n+16>>2]=f;c=c-(z<<3)|0;}v[m+12>>2]=c;m=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);v[n+8>>2]=m;if(d|a>>>0<e>>>0){break A;}d=(m<<c>>>p<<2)+l|0;m=x[d>>1];t[e|0]=m;t[e+1|0]=m>>>8;c=w[d+2|0]+c|0;v[n+12>>2]=c;e=w[d+3|0]+e|0;if(c>>>0<=32){continue;}break;}}if(a>>>0>=e>>>0){while(1){d=(v[n+8>>2]<<c>>>p<<2)+l|0;c=x[d>>1];t[e|0]=c;t[e+1|0]=c>>>8;c=v[n+12>>2]+w[d+2|0]|0;v[n+12>>2]=c;e=w[d+3|0]+e|0;if(e>>>0<=a>>>0){continue;}break;}}F:{if(e>>>0>=M>>>0){break F;}d=v[n+8>>2]<<c>>>p|0;a=(d<<2)+l|0;t[e|0]=w[a|0];if(w[a+3|0]==1){c=v[n+12>>2]+w[a+2|0]|0;break F;}c=v[n+12>>2];if(c>>>0>31){break F;}a=w[((d<<2)+l|0)+2|0]+c|0;c=a>>>0<32?a:32;}f=(r|0)==6?(h|0)==32?(k|0)==(B|0)?(g|0)==32?(o|0)==(F|0)?(i|0)==32?v[n+16>>2]==v[n+20>>2]?(c|0)==32?b:-20:-20:-20:-20:-20:-20:-20:-20;}Q=n+32|0;return f;}function ka(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,u=0,y=0,z=0,A=0,C=0,D=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,R=0,S=0,T=0,U=0;n=Q-32|0;Q=n;f=-20;a:{if(d>>>0<10){break a;}k=w[c+4|0]|w[c+5|0]<<8;h=w[c|0]|w[c+1|0]<<8;j=h+6|0;g=w[c+2|0]|w[c+3|0]<<8;q=k+(j+g|0)|0;if(q>>>0>d>>>0){break a;}if(!h){f=-72;break a;}i=c+6|0;l=x[e+2>>1];b:{if(h>>>0>=4){f=-1;i=w[(h+i|0)-1|0];if(!i){break a;}r=h+2|0;f=r+c|0;m=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);h=E(i)-23|0;break b;}m=w[i|0];c:{switch(h-2|0){case 1:m=w[c+8|0]<<16|m;case 0:m=(w[c+7|0]<<8)+m|0;break;default:break c;}}f=w[(h+i|0)-1|0];if(!f){f=-20;break a;}r=6;h=(E(f)-(h<<3)|0)+9|0;}if(!g){f=-72;break a;}y=c+j|0;d:{if(g>>>0>=4){f=-1;i=w[(g+y|0)-1|0];if(!i){break a;}J=g-4|0;f=J+y|0;z=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);i=E(i)-23|0;break d;}z=w[y|0];e:{switch(g-2|0){case 1:z=w[y+2|0]<<16|z;case 0:z=(w[y+1|0]<<8)+z|0;break;default:break e;}}f=w[(g+y|0)-1|0];if(!f){f=-20;break a;}i=(E(f)-(g<<3)|0)+9|0;}f=-72;if(!k){break a;}C=g+y|0;j=k+C|0;f:{if(k>>>0>=4){f=-1;g=w[j-1|0];if(!g){break a;}G=k-4|0;f=G+C|0;A=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);g=E(g)-23|0;break f;}A=w[C|0];g:{switch(k-2|0){case 1:A=w[C+2|0]<<16|A;case 0:A=(w[C+1|0]<<8)+A|0;break;default:break g;}}f=w[j-1|0];if(!f){f=-20;break a;}g=(E(f)-(k<<3)|0)+9|0;}f=ja(n+8|0,j,d-q|0);if(f>>>0>4294967176){break a;}o=e+4|0;p=0-l&31;f=v[n+16>>2];D=v[n+12>>2];N=v[n+8>>2];L=b+3>>>2|0;F=L+a|0;H=F+L|0;I=H+L|0;K=a+b|0;O=K-3|0;h:{if(I>>>0>=O>>>0){u=f;q=J;l=G;j=r;s=I;k=H;d=F;e=a;break h;}P=1;S=v[n+24>>2];e=a;d=F;k=H;s=I;while(1){j=(m<<h>>>p<<1)+o|0;q=w[j+1|0];t[e|0]=w[j|0];j=(z<<i>>>p<<1)+o|0;l=w[j+1|0];t[d|0]=w[j|0];j=(A<<g>>>p<<1)+o|0;u=w[j+1|0];t[k|0]=w[j|0];j=(N<<D>>>p<<1)+o|0;M=w[j+1|0];t[s|0]=w[j|0];h=h+q|0;j=(m<<h>>>p<<1)+o|0;q=w[j+1|0];t[e+1|0]=w[j|0];i=i+l|0;j=(z<<i>>>p<<1)+o|0;l=w[j+1|0];t[d+1|0]=w[j|0];u=g+u|0;g=(A<<u>>>p<<1)+o|0;R=w[g+1|0];t[k+1|0]=w[g|0];D=D+M|0;g=(N<<D>>>p<<1)+o|0;M=w[g+1|0];t[s+1|0]=w[g|0];h=h+q|0;i:{if((r|0)<10){j=r;break i;}j=r-(h>>>3|0)|0;g=j+c|0;m=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);h=h&7;}i=i+l|0;j:{if((J|0)<4){q=J;break j;}q=J-(i>>>3|0)|0;g=y+q|0;z=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);i=i&7;}l=u+R|0;k:{if((G|0)<4){g=l;l=G;break k;}g=l&7;l=G-(l>>>3|0)|0;u=C+l|0;A=w[u|0]|w[u+1|0]<<8|(w[u+2|0]<<16|w[u+3|0]<<24);}D=D+M|0;s=s+2|0;l:{if(f>>>0<S>>>0){u=f;break l;}u=f-(D>>>3|0)|0;N=w[u|0]|w[u+1|0]<<8|(w[u+2|0]<<16|w[u+3|0]<<24);D=D&7;}k=k+2|0;d=d+2|0;e=e+2|0;M=(J|0)>3;R=(G|0)>3;T=(r|0)>9;U=f>>>0>=S>>>0;r=j;G=l;J=q;f=u;P=T&(M&R)&P&U;if(P&s>>>0<O>>>0){continue;}break;}}v[n+16>>2]=u;v[n+12>>2]=D;v[n+8>>2]=N;if(e>>>0>F>>>0){f=-20;break a;}if(d>>>0>H>>>0){f=-20;break a;}f=-20;if(k>>>0>I>>>0){break a;}m:{n:{o:{p:{if(h>>>0>32){break p;}u=F-3|0;q:{while(1){r:{if((j|0)>=10){m=h>>>3|0;r=0;f=h&7;break r;}if((j|0)==6){f=h;j=6;break q;}f=h>>>3|0;r=(j-f|0)<6;m=r?j-6|0:f;f=h-(m<<3)|0;}j=j-m|0;h=j+c|0;m=w[h|0]|w[h+1|0]<<8|(w[h+2|0]<<16|w[h+3|0]<<24);if(!(r|e>>>0>=u>>>0)){h=(m<<f>>>p<<1)+o|0;r=w[h+1|0];t[e|0]=w[h|0];f=f+r|0;h=(m<<f>>>p<<1)+o|0;r=w[h+1|0];t[e+1|0]=w[h|0];e=e+2|0;h=f+r|0;if(h>>>0<=32){continue;}break p;}break;}if(f>>>0<=32){break q;}h=f;break p;}h=f;while(1){s:{if((j|0)>=10){m=h>>>3|0;r=0;h=h&7;break s;}if((j|0)==6){j=6;break p;}f=h>>>3|0;r=(j-f|0)<6;m=r?j-6|0:f;h=h-(m<<3)|0;}j=j-m|0;f=j+c|0;m=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);f=e>>>0>=F>>>0;if(r|f){break o;}f=(m<<h>>>p<<1)+o|0;r=w[f+1|0];t[e|0]=w[f|0];e=e+1|0;h=h+r|0;if(h>>>0<=32){continue;}break;}}if(e>>>0<F>>>0){break n;}break m;}if(f){break m;}}c=e+1|0;if(F-e&1){f=(m<<h>>>p<<1)+o|0;r=w[f+1|0];t[e|0]=w[f|0];h=h+r|0;e=c;}if((c|0)==(F|0)){break m;}while(1){c=(m<<h>>>p<<1)+o|0;f=w[c+1|0];t[e|0]=w[c|0];c=f+h|0;f=(m<<c>>>p<<1)+o|0;h=w[f+1|0];t[e+1|0]=w[f|0];h=c+h|0;e=e+2|0;if((F|0)!=(e|0)){continue;}break;}}t:{u:{v:{w:{x:{if(i>>>0<=32){r=H-3|0;while(1){y:{if((q|0)>=4){f=i>>>3|0;e=0;c=i&7;break y;}if(!q){q=0;m=y;c=i;break w;}c=i>>>3|0;e=(q+y|0)-c>>>0<y>>>0;f=e?q:c;c=i-(f<<3)|0;}q=q-f|0;m=y+q|0;z=w[m|0]|w[m+1|0]<<8|(w[m+2|0]<<16|w[m+3|0]<<24);if(e|d>>>0>=r>>>0){break x;}e=(z<<c>>>p<<1)+o|0;f=w[e+1|0];t[d|0]=w[e|0];c=c+f|0;e=(z<<c>>>p<<1)+o|0;f=w[e+1|0];t[d+1|0]=w[e|0];d=d+2|0;i=c+f|0;if(i>>>0<33){continue;}break;}}m=q+y|0;break v;}if(c>>>0<=32){break w;}i=c;break v;}i=c;while(1){z:{if((q|0)>=4){f=i>>>3|0;e=0;i=i&7;break z;}if(!q){break v;}c=i>>>3|0;e=m-c>>>0<y>>>0;f=e?q:c;i=i-(f<<3)|0;}q=q-f|0;m=y+q|0;z=w[m|0]|w[m+1|0]<<8|(w[m+2|0]<<16|w[m+3|0]<<24);c=d>>>0>=H>>>0;if(e?1:c){if(c){break t;}break u;}c=(z<<i>>>p<<1)+o|0;e=w[c+1|0];t[d|0]=w[c|0];d=d+1|0;i=e+i|0;if(i>>>0<=32){continue;}break;}}if(d>>>0>=H>>>0){break t;}}c=d+1|0;if(H-d&1){e=(z<<i>>>p<<1)+o|0;f=w[e+1|0];t[d|0]=w[e|0];i=f+i|0;d=c;}if((c|0)==((L<<1)+a|0)){break t;}while(1){c=(z<<i>>>p<<1)+o|0;e=w[c+1|0];t[d|0]=w[c|0];c=e+i|0;e=(z<<c>>>p<<1)+o|0;f=w[e+1|0];t[d+1|0]=w[e|0];i=c+f|0;d=d+2|0;if((H|0)!=(d|0)){continue;}break;}}A:{B:{C:{D:{E:{if(g>>>0<=32){q=I-3|0;while(1){F:{if((l|0)>=4){f=g>>>3|0;e=0;c=g&7;break F;}if(!l){l=0;d=C;c=g;break D;}c=g>>>3|0;e=(l+C|0)-c>>>0<C>>>0;f=e?l:c;c=g-(f<<3)|0;}l=l-f|0;d=C+l|0;A=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);if(e|k>>>0>=q>>>0){break E;}d=(A<<c>>>p<<1)+o|0;e=w[d+1|0];t[k|0]=w[d|0];c=c+e|0;d=(A<<c>>>p<<1)+o|0;e=w[d+1|0];t[k+1|0]=w[d|0];k=k+2|0;g=c+e|0;if(g>>>0<33){continue;}break;}}d=l+C|0;break C;}if(c>>>0<=32){break D;}g=c;break C;}g=c;while(1){G:{if((l|0)>=4){f=g>>>3|0;e=0;g=g&7;break G;}if(!l){break C;}c=g>>>3|0;e=d-c>>>0<C>>>0;f=e?l:c;g=g-(f<<3)|0;}l=l-f|0;d=C+l|0;A=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);c=k>>>0>=I>>>0;if(e?1:c){if(c){break A;}break B;}c=(A<<g>>>p<<1)+o|0;e=w[c+1|0];t[k|0]=w[c|0];k=k+1|0;g=e+g|0;if(g>>>0<=32){continue;}break;}}if(k>>>0>=I>>>0){break A;}}c=k+1|0;if(I-k&1){e=(A<<g>>>p<<1)+o|0;f=w[e+1|0];t[k|0]=w[e|0];k=c;g=f+g|0;}if((c|0)==(B(L,3)+a|0)){break A;}while(1){a=(A<<g>>>p<<1)+o|0;c=w[a+1|0];t[k|0]=w[a|0];a=c+g|0;c=(A<<a>>>p<<1)+o|0;e=w[c+1|0];t[k+1|0]=w[c|0];g=a+e|0;k=k+2|0;if((I|0)!=(k|0)){continue;}break;}}c=v[n+12>>2];H:{I:{J:{if(c>>>0>32){break J;}K:{while(1){e=n;G=e;f=v[e+16>>2];q=v[e+24>>2];L:{if(f>>>0>=q>>>0){f=f-(c>>>3|0)|0;v[n+16>>2]=f;a=0;c=c&7;break L;}k=v[n+20>>2];a=f;if((k|0)==(f|0)){break K;}l=c>>>3|0;a=k>>>0>f-l>>>0;k=a?f-k|0:l;f=f-k|0;v[n+16>>2]=f;c=c-(k<<3)|0;}v[G+12>>2]=c;e=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);v[n+8>>2]=e;if(!(a|s>>>0>=O>>>0)){a=(e<<c>>>p<<1)+o|0;f=w[a+1|0];t[s|0]=w[a|0];a=c+f|0;c=(e<<a>>>p<<1)+o|0;e=w[c|0];c=a+w[c+1|0]|0;v[n+12>>2]=c;t[s+1|0]=e;s=s+2|0;if(c>>>0<=32){continue;}break J;}break;}if(c>>>0>32){break J;}a=v[n+20>>2];}k=a;while(1){e=n;M:{if(f>>>0>=q>>>0){f=f-(c>>>3|0)|0;v[n+16>>2]=f;a=0;c=c&7;break M;}if((f|0)==(k|0)){break J;}l=c>>>3|0;a=k>>>0>f-l>>>0;l=a?f-k|0:l;f=f-l|0;v[n+16>>2]=f;c=c-(l<<3)|0;}v[e+12>>2]=c;e=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);v[n+8>>2]=e;l=s>>>0>=K>>>0;if(a?1:l){if(l){break H;}break I;}a=(e<<c>>>p<<1)+o|0;e=w[a|0];c=w[a+1|0]+c|0;v[n+12>>2]=c;t[s|0]=e;s=s+1|0;if(c>>>0<=32){continue;}break;}}if(s>>>0>=K>>>0){break H;}e=v[n+8>>2];}a=(e<<c>>>p<<1)+o|0;e=w[a|0];v[n+12>>2]=w[a+1|0]+c;t[s|0]=e;if((K-s|0)==1){break H;}a=K-2|0;if((s^-1)+K&1){c=v[n+12>>2];e=(v[n+8>>2]<<c>>>p<<1)+o|0;f=w[e|0];v[n+12>>2]=c+w[e+1|0];t[s+1|0]=f;c=s+2|0;}else {c=s+1|0;}if((a|0)==(s|0)){break H;}while(1){a=v[n+12>>2];e=(v[n+8>>2]<<a>>>p<<1)+o|0;f=w[e|0];v[n+12>>2]=a+w[e+1|0];t[c|0]=f;a=v[n+12>>2];e=(v[n+8>>2]<<a>>>p<<1)+o|0;f=w[e|0];v[n+12>>2]=a+w[e+1|0];t[c+1|0]=f;c=c+2|0;if((K|0)!=(c|0)){continue;}break;}}f=(j|0)==6?(h|0)==32?(m|0)==(y|0)?(i|0)==32?(d|0)==(C|0)?(g|0)==32?v[n+16>>2]==v[n+20>>2]?v[n+12>>2]==32?b:-20:-20:-20:-20:-20:-20:-20:-20;}Q=n+32|0;return f;}function ia(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,x=0,y=0,z=0,A=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0;h=Q-144|0;Q=h;f=-44;a:{if(e>>>0<1500){break a;}e=v[a>>2];m=_(d+624|0,0,108);s=e&255;if(s>>>0>12){break a;}k=d+1244|0;D=na(k,m,h+8|0,h+12|0,b,c);if(D>>>0<=4294967176){q=v[h+12>>2];if(q>>>0>s>>>0){break a;}z=d+732|0;G=d+676|0;A=a+4|0;H=e&-16777216;c=d+680|0;b=q;while(1){e=b;b=b-1|0;if(!v[m+(e<<2)>>2]){continue;}break;}b=1;o=e+1|0;b:{if(o>>>0<2){break b;}i=e&3;if(e-1>>>0>=3){f=e&-4;while(1){g=b<<2;l=v[g+m>>2];v[c+g>>2]=p;n=g+4|0;r=v[n+m>>2];p=l+p|0;v[c+n>>2]=p;l=g+8|0;n=v[l+m>>2];p=p+r|0;v[c+l>>2]=p;g=g+12|0;l=v[g+m>>2];j=c+g|0;g=p+n|0;v[j>>2]=g;p=g+l|0;b=b+4|0;f=f-4|0;if(f){continue;}break;}}if(!i){break b;}while(1){f=b<<2;g=v[f+m>>2];v[c+f>>2]=p;b=b+1|0;p=g+p|0;i=i-1|0;if(i){continue;}break;}}v[c>>2]=p;f=v[h+8>>2];c:{if(!f){break c;}b=0;if((f|0)!=1){g=f&-2;while(1){l=w[b+k|0];n=c+(l<<2)|0;i=v[n>>2];v[n>>2]=i+1;i=(i<<1)+z|0;t[i+1|0]=l;t[i|0]=b;l=b|1;n=w[l+k|0];r=c+(n<<2)|0;i=v[r>>2];v[r>>2]=i+1;i=(i<<1)+z|0;t[i+1|0]=n;t[i|0]=l;b=b+2|0;g=g-2|0;if(g){continue;}break;}}if(!(f&1)){break c;}f=w[b+k|0];g=c+(f<<2)|0;c=v[g>>2];v[g>>2]=c+1;c=(c<<1)+z|0;t[c+1|0]=f;t[c|0]=b;}c=0;v[d+680>>2]=0;d:{if(o>>>0>=2){b=1;n=e-1|0;if(n){f=(q^-1)+s|0;k=e&-2;while(1){g=b<<2;i=v[g+m>>2];v[d+g>>2]=c;g=b+1|0;l=g<<2;r=v[l+m>>2];c=(i<<b+f)+c|0;v[d+l>>2]=c;c=c+(r<<f+g)|0;b=b+2|0;k=k-2|0;if(k){continue;}break;}}if(e&1){v[(b<<2)+d>>2]=c;}l=q+1|0;q=l-e|0;i=(s-q|0)+1|0;if(o>>>0<2|i>>>0<=q>>>0){break d;}c=e&-4;k=e&3;e=q;while(1){f=1;g=c;if(n>>>0>=3){while(1){m=B(e,52)+d|0;b=f<<2;v[m+b>>2]=v[b+d>>2]>>>e;o=b+4|0;v[o+m>>2]=v[d+o>>2]>>>e;o=b+8|0;v[o+m>>2]=v[d+o>>2]>>>e;b=b+12|0;v[b+m>>2]=v[b+d>>2]>>>e;f=f+4|0;g=g-4|0;if(g){continue;}break;}}b=k;if(b){while(1){g=f<<2;v[g+(B(e,52)+d|0)>>2]=v[d+g>>2]>>>e;f=f+1|0;b=b-1|0;if(b){continue;}break;}}e=e+1|0;if(i>>>0>e>>>0){continue;}break;}break d;}l=q+1|0;q=l-e|0;}v[h- -64>>2]=v[d+48>>2];b=v[d+44>>2];v[h+56>>2]=v[d+40>>2];v[h+60>>2]=b;b=v[d+36>>2];v[h+48>>2]=v[d+32>>2];v[h+52>>2]=b;b=v[d+28>>2];v[h+40>>2]=v[d+24>>2];v[h+44>>2]=b;b=v[d+20>>2];v[h+32>>2]=v[d+16>>2];v[h+36>>2]=b;b=v[d+4>>2];v[h+16>>2]=v[d>>2];v[h+20>>2]=b;b=v[d+12>>2];v[h+24>>2]=v[d+8>>2];v[h+28>>2]=b;if(p){I=l-s|0;n=0;while(1){b=(n<<1)+z|0;c=w[b+1|0];m=l-c|0;o=s-m|0;r=1<<o;C=w[b|0];E=(h+16|0)+(c<<2)|0;k=v[E>>2];e:{if(o>>>0>=q>>>0){c=m+I|0;e=((c|0)>1?c:1)<<2;x=v[e+G>>2];b=B(m,52)+d|0;v[h+128>>2]=v[b+48>>2];f=v[b+44>>2];v[h+120>>2]=v[b+40>>2];v[h+124>>2]=f;f=v[b+36>>2];v[h+112>>2]=v[b+32>>2];v[h+116>>2]=f;f=v[b+28>>2];v[h+104>>2]=v[b+24>>2];v[h+108>>2]=f;f=v[b+20>>2];v[h+96>>2]=v[b+16>>2];v[h+100>>2]=f;f=v[b+12>>2];v[h+88>>2]=v[b+8>>2];v[h+92>>2]=f;f=v[b+4>>2];v[h+80>>2]=v[b>>2];v[h+84>>2]=f;F=p-x|0;f=(k<<2)+A|0;f:{if((c|0)<2){break f;}e=v[e+(h+80|0)>>2];if(!e){break f;}b=m<<16&16711680|C|16777216;g=e&7;c=0;if(e-1>>>0>=7){i=e&-8;while(1){e=c<<2;j=e+f|0;u[j>>1]=b;y=b>>>16|0;u[j+2>>1]=y;j=f+(e|4)|0;u[j>>1]=b;u[j+2>>1]=y;j=f+(e|8)|0;u[j>>1]=b;u[j+2>>1]=y;j=f+(e|12)|0;u[j>>1]=b;u[j+2>>1]=y;j=f+(e|16)|0;u[j>>1]=b;u[j+2>>1]=y;j=f+(e|20)|0;u[j>>1]=b;u[j+2>>1]=y;j=f+(e|24)|0;u[j>>1]=b;u[j+2>>1]=y;e=f+(e|28)|0;u[e>>1]=b;u[e+2>>1]=y;c=c+8|0;i=i-8|0;if(i){continue;}break;}}if(!g){break f;}while(1){e=f+(c<<2)|0;u[e>>1]=b;u[e+2>>1]=b>>>16;c=c+1|0;g=g-1|0;if(g){continue;}break;}}if(F){i=(x<<1)+z|0;g=0;while(1){x=i+(g<<1)|0;c=w[x+1|0];b=l-c|0;j=(h+80|0)+(c<<2)|0;e=v[j>>2];c=e+(1<<o-b)|0;b=b+m<<16&16711680|(w[x|0]<<8|C)|33554432;while(1){x=f+(e<<2)|0;u[x>>1]=b;u[x+2>>1]=b>>>16;e=e+1|0;if(c>>>0>e>>>0){continue;}break;}v[j>>2]=c;g=g+1|0;if((F|0)!=(g|0)){continue;}break;}}b=k+r|0;break e;}b=k+r|0;if(k>>>0>=b>>>0){break e;}c=m<<16&16711680|C|16777216;if(o>>>0<=2){f=r&7;while(1){e=(k<<2)+A|0;u[e>>1]=c;u[e+2>>1]=c>>>16;k=k+1|0;f=f-1|0;if(f){continue;}break;}}if(o>>>0<3){break e;}while(1){e=(k<<2)+A|0;u[e>>1]=c;f=c>>>16|0;u[e+2>>1]=f;u[e+28>>1]=c;u[e+30>>1]=f;u[e+24>>1]=c;u[e+26>>1]=f;u[e+20>>1]=c;u[e+22>>1]=f;u[e+16>>1]=c;u[e+18>>1]=f;u[e+12>>1]=c;u[e+14>>1]=f;u[e+8>>1]=c;u[e+10>>1]=f;u[e+4>>1]=c;u[e+6>>1]=f;k=k+8|0;if((k|0)!=(b|0)){continue;}break;}}v[E>>2]=b;n=n+1|0;if((p|0)!=(n|0)){continue;}break;}}v[a>>2]=s<<16|H|s|256;}f=D;}Q=h+144|0;return f;}function ha(a,b,c,d,e,f,g,h){var i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0;n=-70;l=v[c+4>>2];j=v[c>>2];p=l+j|0;a:{if(p>>>0>b-a>>>0){break a;}n=-20;i=v[d>>2];if(j>>>0>e-i>>>0){break a;}e=b-32|0;q=i+j|0;b=a+j|0;o=v[c+8>>2];b:{if((j|0)<=7){if((j|0)<=0){break b;}while(1){t[a|0]=w[i|0];i=i+1|0;a=a+1|0;if(b>>>0>a>>>0){continue;}break;}break b;}if(b>>>0<=e>>>0){while(1){j=w[i+4|0]|w[i+5|0]<<8|(w[i+6|0]<<16|w[i+7|0]<<24);k=w[i|0]|w[i+1|0]<<8|(w[i+2|0]<<16|w[i+3|0]<<24);t[a|0]=k;t[a+1|0]=k>>>8;t[a+2|0]=k>>>16;t[a+3|0]=k>>>24;t[a+4|0]=j;t[a+5|0]=j>>>8;t[a+6|0]=j>>>16;t[a+7|0]=j>>>24;j=w[i+12|0]|w[i+13|0]<<8|(w[i+14|0]<<16|w[i+15|0]<<24);k=w[i+8|0]|w[i+9|0]<<8|(w[i+10|0]<<16|w[i+11|0]<<24);t[a+8|0]=k;t[a+9|0]=k>>>8;t[a+10|0]=k>>>16;t[a+11|0]=k>>>24;t[a+12|0]=j;t[a+13|0]=j>>>8;t[a+14|0]=j>>>16;t[a+15|0]=j>>>24;i=i+16|0;a=a+16|0;if(b>>>0>a>>>0){continue;}break b;}}if(a>>>0<=e>>>0){r=e-a|0;j=i;while(1){k=w[j+4|0]|w[j+5|0]<<8|(w[j+6|0]<<16|w[j+7|0]<<24);m=w[j|0]|w[j+1|0]<<8|(w[j+2|0]<<16|w[j+3|0]<<24);t[a|0]=m;t[a+1|0]=m>>>8;t[a+2|0]=m>>>16;t[a+3|0]=m>>>24;t[a+4|0]=k;t[a+5|0]=k>>>8;t[a+6|0]=k>>>16;t[a+7|0]=k>>>24;k=w[j+12|0]|w[j+13|0]<<8|(w[j+14|0]<<16|w[j+15|0]<<24);m=w[j+8|0]|w[j+9|0]<<8|(w[j+10|0]<<16|w[j+11|0]<<24);t[a+8|0]=m;t[a+9|0]=m>>>8;t[a+10|0]=m>>>16;t[a+11|0]=m>>>24;t[a+12|0]=k;t[a+13|0]=k>>>8;t[a+14|0]=k>>>16;t[a+15|0]=k>>>24;j=j+16|0;a=a+16|0;if(e>>>0>a>>>0){continue;}break;}i=i+r|0;a=e;}if(a>>>0>=b>>>0){break b;}while(1){t[a|0]=w[i|0];i=i+1|0;a=a+1|0;if(b>>>0>a>>>0){continue;}break;}}a=b-o|0;v[d>>2]=q;c:{d:{if(b-f>>>0<o>>>0){if(b-g>>>0<o>>>0){break a;}a=a-f|0;d=a+h|0;if(d+l>>>0<=h>>>0){Z(b,d,l);break c;}b=Z(b,d,0-a|0);l=a+l|0;v[c+4>>2]=l;b=b-a|0;break d;}f=a;}c=b+l|0;if((l|0)<=7){if((l|0)<=0){break c;}while(1){t[b|0]=w[f|0];f=f+1|0;b=b+1|0;if(c>>>0>b>>>0){continue;}break;}break c;}a=b-f|0;e:{if(a>>>0<=7){t[b|0]=w[f|0];t[b+1|0]=w[f+1|0];t[b+2|0]=w[f+2|0];t[b+3|0]=w[f+3|0];d=f;f=a<<2;a=d+v[f+4752>>2]|0;d=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);t[b+4|0]=d;t[b+5|0]=d>>>8;t[b+6|0]=d>>>16;t[b+7|0]=d>>>24;f=a-v[f+4784>>2]|0;break e;}a=w[f+4|0]|w[f+5|0]<<8|(w[f+6|0]<<16|w[f+7|0]<<24);d=w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24);t[b|0]=d;t[b+1|0]=d>>>8;t[b+2|0]=d>>>16;t[b+3|0]=d>>>24;t[b+4|0]=a;t[b+5|0]=a>>>8;t[b+6|0]=a>>>16;t[b+7|0]=a>>>24;}a=b+8|0;i=f+8|0;if(c>>>0<=e>>>0){d=a+l|0;if((a-i|0)<=15){while(1){b=w[i+4|0]|w[i+5|0]<<8|(w[i+6|0]<<16|w[i+7|0]<<24);c=w[i|0]|w[i+1|0]<<8|(w[i+2|0]<<16|w[i+3|0]<<24);t[a|0]=c;t[a+1|0]=c>>>8;t[a+2|0]=c>>>16;t[a+3|0]=c>>>24;t[a+4|0]=b;t[a+5|0]=b>>>8;t[a+6|0]=b>>>16;t[a+7|0]=b>>>24;i=i+8|0;a=a+8|0;if(d>>>0>a>>>0){continue;}break c;}}while(1){b=w[i+4|0]|w[i+5|0]<<8|(w[i+6|0]<<16|w[i+7|0]<<24);c=w[i|0]|w[i+1|0]<<8|(w[i+2|0]<<16|w[i+3|0]<<24);t[a|0]=c;t[a+1|0]=c>>>8;t[a+2|0]=c>>>16;t[a+3|0]=c>>>24;t[a+4|0]=b;t[a+5|0]=b>>>8;t[a+6|0]=b>>>16;t[a+7|0]=b>>>24;b=w[i+12|0]|w[i+13|0]<<8|(w[i+14|0]<<16|w[i+15|0]<<24);c=w[i+8|0]|w[i+9|0]<<8|(w[i+10|0]<<16|w[i+11|0]<<24);t[a+8|0]=c;t[a+9|0]=c>>>8;t[a+10|0]=c>>>16;t[a+11|0]=c>>>24;t[a+12|0]=b;t[a+13|0]=b>>>8;t[a+14|0]=b>>>16;t[a+15|0]=b>>>24;i=i+16|0;a=a+16|0;if(d>>>0>a>>>0){continue;}break;}break c;}f:{if(a>>>0>e>>>0){e=a;break f;}g=e-a|0;g:{if((a-i|0)<=15){b=i;while(1){d=w[b+4|0]|w[b+5|0]<<8|(w[b+6|0]<<16|w[b+7|0]<<24);f=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);t[a|0]=f;t[a+1|0]=f>>>8;t[a+2|0]=f>>>16;t[a+3|0]=f>>>24;t[a+4|0]=d;t[a+5|0]=d>>>8;t[a+6|0]=d>>>16;t[a+7|0]=d>>>24;b=b+8|0;a=a+8|0;if(e>>>0>a>>>0){continue;}break;}break g;}b=i;while(1){d=w[b+4|0]|w[b+5|0]<<8|(w[b+6|0]<<16|w[b+7|0]<<24);f=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);t[a|0]=f;t[a+1|0]=f>>>8;t[a+2|0]=f>>>16;t[a+3|0]=f>>>24;t[a+4|0]=d;t[a+5|0]=d>>>8;t[a+6|0]=d>>>16;t[a+7|0]=d>>>24;d=w[b+12|0]|w[b+13|0]<<8|(w[b+14|0]<<16|w[b+15|0]<<24);f=w[b+8|0]|w[b+9|0]<<8|(w[b+10|0]<<16|w[b+11|0]<<24);t[a+8|0]=f;t[a+9|0]=f>>>8;t[a+10|0]=f>>>16;t[a+11|0]=f>>>24;t[a+12|0]=d;t[a+13|0]=d>>>8;t[a+14|0]=d>>>16;t[a+15|0]=d>>>24;b=b+16|0;a=a+16|0;if(e>>>0>a>>>0){continue;}break;}}i=g+i|0;}if(c>>>0<=e>>>0){break c;}while(1){t[e|0]=w[i|0];i=i+1|0;e=e+1|0;if(c>>>0>e>>>0){continue;}break;}}n=p;}return n;}function ca(a,b,c,d,e){var f=0,g=0,h=0;h=v[a+28804>>2];g=v[a+28744>>2];a:{if(h-3>>>0>=2){break a;}g=v[a+28744>>2];if(v[a+28800>>2]){break a;}f=e>>>0>1?e:1;g=v[a+28744>>2];g=f>>>0<g>>>0?f:g;}f=-72;b:{c:{d:{if((e|0)!=(g|0)){break d;}e:{if(!c){break e;}f=v[a+28728>>2];if((f|0)==(b|0)){break e;}v[a+28740>>2]=f;v[a+28728>>2]=b;g=v[a+28732>>2];v[a+28732>>2]=b;v[a+28736>>2]=(g-f|0)+b;}f=-1;f:{g:{h:{i:{j:{switch(h|0){case 0:f=1;k:{if(v[a+28908>>2]){break k;}f=5;if(((w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24))&-16)!=407710288){break k;}X(a+160144|0,d,e);v[a+28804>>2]=6;v[a+28744>>2]=8-e;break b;}if(e>>>0<f>>>0){v[a+28904>>2]=-72;return  -72;}b=w[(d+f|0)-1|0];c=b&32;f=(!c+(v[(b>>>4&12)+4736>>2]+(v[((b&3)<<2)+4720>>2]+f|0)|0)|0)+(c>>>5&b>>>0<64)|0;v[a+28904>>2]=f;if(f>>>0>4294967176){break d;}X(a+160144|0,d,e);v[a+28804>>2]=1;v[a+28744>>2]=f-e;break b;case 1:b=a+160144|0;X(b+(v[a+28904>>2]-e|0)|0,d,e);b=aa(a+28752|0,b,v[a+28904>>2],v[a+28908>>2]);if(b>>>0>4294967176){return b;}f=-72;if(b){break d;}b=v[a+28780>>2];if(b){f=-32;if((b|0)!=v[a+28952>>2]){break d;}}if(v[a+28784>>2]){v[a+28816>>2]=0;v[a+28820>>2]=0;b=a+28856|0;v[b>>2]=0;v[b+4>>2]=0;b=a+28848|0;v[b>>2]=2048144761;v[b+4>>2]=1640531534;b=a+28840|0;v[b>>2]=0;v[b+4>>2]=0;b=a+28832|0;v[b>>2]=668265295;v[b+4>>2]=-1028477379;b=a+28824|0;v[b>>2]=-1379879466;v[b+4>>2]=1625958382;b=a+28864|0;v[b>>2]=0;v[b+4>>2]=0;b=a+28872|0;v[b>>2]=0;v[b+4>>2]=0;b=a+28880|0;v[b>>2]=0;v[b+4>>2]=0;b=a+28888|0;v[b>>2]=0;v[b+4>>2]=0;}break c;case 2:c=w[d|0]|w[d+1|0]<<8;e=c&1;d=c|w[d+2|0]<<16;b=d>>>3|0;f=-20;l:{m:{n:{o:{c=c>>>1&3;switch(c-1|0){case 0:break o;case 2:break d;default:break n;}}if(!v[a+28768>>2]){break d;}v[a+28932>>2]=b;v[a+28800>>2]=1;v[a+28744>>2]=1;break m;}if(b>>>0>y[a+28768>>2]){break d;}v[a+28932>>2]=b;v[a+28800>>2]=c;v[a+28744>>2]=b;if(d>>>0<8){break l;}}v[a+28804>>2]=e?4:3;break b;}if(e){if(!v[a+28784>>2]){break i;}v[a+28804>>2]=5;v[a+28744>>2]=4;break b;}break c;case 3:case 4:f=-20;p:{q:{switch(v[a+28800>>2]){case 2:f=qa(a,b,c,d,e);break p;case 0:if(!b){f=-74;if(e){break d;}break g;}f=-70;if(c>>>0<e>>>0){break d;}X(b,d,e);if(e>>>0<=4294967176){break g;}return e;case 1:break q;default:break d;}}e=v[a+28932>>2];f=e?-74:0;if(!b){break p;}f=-70;if(c>>>0<e>>>0){break p;}_(b,w[d|0],e);f=e;}g=0;v[a+28744>>2]=0;if(f>>>0>4294967176){break d;}break f;case 6:break h;case 7:break i;case 5:break j;default:break d;}}f=-22;if((w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24))!=(oa(a+28816|0)|0)){break d;}}f=0;v[a+28804>>2]=0;v[a+28744>>2]=0;break d;}X((a-e|0)+160152|0,d,e);v[a+28804>>2]=7;b=a;a=a+160148|0;v[b+28744>>2]=w[a|0]|w[a+1|0]<<8|(w[a+2|0]<<16|w[a+3|0]<<24);break b;}g=v[a+28744>>2]-e|0;v[a+28744>>2]=g;f=e;}c=f;if(c>>>0>y[a+28768>>2]){return  -20;}f=v[a+28796>>2];e=c;h=e+v[a+28792>>2]|0;f=h>>>0<e>>>0?f+1|0:f;v[a+28792>>2]=h;v[a+28796>>2]=f;if(v[a+28784>>2]){pa(a+28816|0,b,c);g=v[a+28744>>2];}v[a+28728>>2]=b+c;if(g){return c;}if(v[a+28804>>2]==4){b=v[a+28756>>2];d=b;e=v[a+28752>>2];if((e|0)!=-1|(b|0)!=-1){f=-20;if((e|0)!=v[a+28792>>2]|(d|0)!=v[a+28796>>2]){break d;}}if(v[a+28784>>2]){v[a+28804>>2]=5;v[a+28744>>2]=4;return c;}v[a+28804>>2]=0;v[a+28744>>2]=0;return c;}v[a+28744>>2]=3;v[a+28804>>2]=2;return c;}return f;}v[a+28804>>2]=2;v[a+28744>>2]=3;}return 0;}function pa(a,b,c){var d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0;e=v[a+4>>2];h=c+v[a>>2]|0;v[a>>2]=h;v[a+4>>2]=c>>>0>h>>>0?e+1|0:e;d=v[a+72>>2];f=d+c|0;a:{b:{if(f>>>0<=31){if(!b){break b;}X((a+d|0)+40|0,b,c);f=v[a+72>>2]+c|0;break b;}j=b+c|0;if(d){X(d+(a+40|0)|0,b,32-d|0);h=v[a+72>>2];v[a+72>>2]=0;f=v[a+12>>2];c=v[a+8>>2];i=Ga(w[a+40|0]|w[a+41|0]<<8|(w[a+42|0]<<16|w[a+43|0]<<24),w[a+44|0]|w[a+45|0]<<8|(w[a+46|0]<<16|w[a+47|0]<<24),668265295,-1028477379);d=c+i|0;e=R+f|0;v[a+8>>2]=Ga(Ha(d,d>>>0<i>>>0?e+1|0:e,31),R,-2048144761,-1640531535);v[a+12>>2]=R;d=v[a+20>>2];c=v[a+16>>2];e=Ga(w[a+48|0]|w[a+49|0]<<8|(w[a+50|0]<<16|w[a+51|0]<<24),w[a+52|0]|w[a+53|0]<<8|(w[a+54|0]<<16|w[a+55|0]<<24),668265295,-1028477379);f=c+e|0;d=R+d|0;v[a+16>>2]=Ga(Ha(f,e>>>0>f>>>0?d+1|0:d,31),R,-2048144761,-1640531535);v[a+20>>2]=R;d=v[a+28>>2];c=v[a+24>>2];e=Ga(w[a+56|0]|w[a+57|0]<<8|(w[a+58|0]<<16|w[a+59|0]<<24),w[a+60|0]|w[a+61|0]<<8|(w[a+62|0]<<16|w[a+63|0]<<24),668265295,-1028477379);f=c+e|0;d=R+d|0;v[a+24>>2]=Ga(Ha(f,e>>>0>f>>>0?d+1|0:d,31),R,-2048144761,-1640531535);v[a+28>>2]=R;f=v[a+36>>2];c=v[a+32>>2];d=a- -64|0;i=Ga(w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24),w[d+4|0]|w[d+5|0]<<8|(w[d+6|0]<<16|w[d+7|0]<<24),668265295,-1028477379);d=c+i|0;e=R+f|0;v[a+32>>2]=Ga(Ha(d,d>>>0<i>>>0?e+1|0:e,31),R,-2048144761,-1640531535);v[a+36>>2]=R;b=(b-h|0)+32|0;}if(j>>>0>=b+32>>>0){n=j-32|0;c=v[a+32>>2];i=v[a+36>>2];d=v[a+24>>2];k=v[a+28>>2];f=v[a+16>>2];l=v[a+20>>2];h=v[a+8>>2];m=v[a+12>>2];while(1){g=Ga(w[b+24|0]|w[b+25|0]<<8|(w[b+26|0]<<16|w[b+27|0]<<24),w[b+28|0]|w[b+29|0]<<8|(w[b+30|0]<<16|w[b+31|0]<<24),668265295,-1028477379)+c|0;e=i+R|0;c=Ga(Ha(g,c>>>0>g>>>0?e+1|0:e,31),R,-2048144761,-1640531535);i=R;g=Ga(w[b+16|0]|w[b+17|0]<<8|(w[b+18|0]<<16|w[b+19|0]<<24),w[b+20|0]|w[b+21|0]<<8|(w[b+22|0]<<16|w[b+23|0]<<24),668265295,-1028477379)+d|0;e=k+R|0;d=Ga(Ha(g,d>>>0>g>>>0?e+1|0:e,31),R,-2048144761,-1640531535);k=R;g=Ga(w[b+8|0]|w[b+9|0]<<8|(w[b+10|0]<<16|w[b+11|0]<<24),w[b+12|0]|w[b+13|0]<<8|(w[b+14|0]<<16|w[b+15|0]<<24),668265295,-1028477379)+f|0;e=l+R|0;f=Ga(Ha(g,f>>>0>g>>>0?e+1|0:e,31),R,-2048144761,-1640531535);l=R;g=Ga(w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24),w[b+4|0]|w[b+5|0]<<8|(w[b+6|0]<<16|w[b+7|0]<<24),668265295,-1028477379)+h|0;e=m+R|0;h=Ga(Ha(g,g>>>0<h>>>0?e+1|0:e,31),R,-2048144761,-1640531535);m=R;b=b+32|0;if(n>>>0>=b>>>0){continue;}break;}v[a+32>>2]=c;v[a+36>>2]=i;v[a+24>>2]=d;v[a+28>>2]=k;v[a+16>>2]=f;v[a+20>>2]=l;v[a+8>>2]=h;v[a+12>>2]=m;}if(b>>>0>=j>>>0){break a;}f=j-b|0;X(a+40|0,b,f);}v[a+72>>2]=f;}}function oa(a){var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;f=a+40|0;i=v[a+72>>2];g=f+i|0;b=v[a+4>>2];n=b;e=v[a>>2];a:{if(!b&e>>>0>=32|b){b=v[a+20>>2];o=b;j=v[a+16>>2];b=Ha(j,b,7);c=R;d=v[a+12>>2];p=d;k=v[a+8>>2];d=Ha(k,d,1);b=d+b|0;c=R+c|0;c=b>>>0<d>>>0?c+1|0:c;d=v[a+28>>2];q=d;l=v[a+24>>2];h=Ha(l,d,12);d=h+b|0;b=R+c|0;b=d>>>0<h>>>0?b+1|0:b;c=d;d=v[a+36>>2];h=d;m=v[a+32>>2];d=Ha(m,d,18);c=d+c|0;b=R+b|0;b=Ga(Ga(Ha(Ga(k,p,668265295,-1028477379),R,31),R,-2048144761,-1640531535)^c,R^(c>>>0<d>>>0?b+1|0:b),-2048144761,-1640531535);c=b-1028477341|0;b=R-((b>>>0<1028477341)+2048144776|0)|0;b=Ga(Ga(Ha(Ga(j,o,668265295,-1028477379),R,31),R,-2048144761,-1640531535)^c,R^b,-2048144761,-1640531535);c=b-1028477341|0;b=R-((b>>>0<1028477341)+2048144776|0)|0;b=Ga(Ga(Ha(Ga(l,q,668265295,-1028477379),R,31),R,-2048144761,-1640531535)^c,R^b,-2048144761,-1640531535);c=b-1028477341|0;b=R-((b>>>0<1028477341)+2048144776|0)|0;b=Ga(Ga(Ha(Ga(m,h,668265295,-1028477379),R,31),R,-2048144761,-1640531535)^c,R^b,-2048144761,-1640531535);c=b-1028477341|0;b=R-((b>>>0<1028477341)+2048144776|0)|0;break a;}b=v[a+28>>2]+668265263|0;c=v[a+24>>2]+374761413|0;b=c>>>0<374761413?b+1|0:b;}d=c+e|0;c=b+n|0;c=d>>>0<e>>>0?c+1|0:c;e=a+48|0;b:{if(g>>>0<e>>>0){b=f;break b;}while(1){b=Ga(Ha(Ga(Ha(Ga(w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24),w[f+4|0]|w[f+5|0]<<8|(w[f+6|0]<<16|w[f+7|0]<<24),668265295,-1028477379),R,31),R,-2048144761,-1640531535)^d,c^R,27),R,-2048144761,-1640531535);d=b-1028477341|0;c=R-((b>>>0<1028477341)+2048144776|0)|0;b=e;f=b;e=b+8|0;if(g>>>0>=e>>>0){continue;}break;}}e=b+4|0;c:{if(g>>>0<e>>>0){e=b;break c;}c=Ga(Ha(Ga(w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24),0,-2048144761,-1640531535)^d,c^R,23),R,668265295,-1028477379)-1640531463|0;b=R+374761393|0;d=c;c=c>>>0<2654435833?b+1|0:b;}d:{if(e>>>0>=g>>>0){break d;}a=a+i|0;f=a+39|0;a=a+40|0;if(a-e&1){d=Ga(Ha(Ga(w[e|0],0,374761413,668265263)^d,c^R,11),R,-2048144761,-1640531535);c=R;b=e+1|0;}else {b=e;}if((e|0)==(f|0)){break d;}while(1){e=Ga(w[b+1|0],0,374761413,668265263);f=R;d=Ga(Ha(Ga(Ha(Ga(w[b|0],0,374761413,668265263)^d,c^R,11),R,-2048144761,-1640531535)^e,R^f,11),R,-2048144761,-1640531535);c=R;b=b+2|0;if((a|0)!=(b|0)){continue;}break;}}a=Ga(d^c>>>1,c,668265295,-1028477379);c=R;b=a;a=Ga(((c&536870911)<<3|b>>>29)^b,c^c>>>29,-1640531463,374761393);b=R;R=b;return a^b;}function aa(a,b,c,d){var e=0,f=0,g=0,h=0,i=0,j=0,k=0;v[a>>2]=0;v[a+4>>2]=0;v[a+32>>2]=0;v[a+36>>2]=0;v[a+24>>2]=0;v[a+28>>2]=0;v[a+16>>2]=0;v[a+20>>2]=0;v[a+8>>2]=0;v[a+12>>2]=0;f=d?1:5;if(f>>>0>c>>>0){return f;}if(!b){return  -1;}e=1;a:{b:{c:{d:{e:{f:{g:{h:{if((d|0)==1){d=b;if(c){break h;}d=-72;break g;}e=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);if((e|0)!=-47205080){break f;}e=f;d=(b+f|0)-1|0;}g=w[d|0];d=g&32;d=(!d+(v[(g>>>4&12)+4736>>2]+(v[((g&3)<<2)+4720>>2]+e|0)|0)|0)+(d>>>5&g>>>0<64)|0;}if(d>>>0>c>>>0){break a;}v[a+24>>2]=d;d=-14;c=b+f|0;g=w[c-1|0];if(g&8){break a;}i=g&32;if(!i){d=-16;c=w[c|0];if(c>>>0>167){break a;}d=c&7;c=(c>>>3|0)+10|0;h=c&31;if((c&63)>>>0>=32){e=1<<h;c=0;}else {c=1<<h;e=c-1&1>>>32-h;}d=Ga(d,0,(e&7)<<29|c>>>3,e>>>3|0)+c|0;h=e+R|0;h=c>>>0>d>>>0?h+1|0:h;j=d;f=f+1|0;}k=g>>>6|0;e=g>>>2|0;d=0;switch((g&3)-1|0){case 2:break c;case 1:break d;case 0:break e;default:break b;}}d=-10;if((e&-16)!=407710288){break a;}d=8;if(c>>>0<8){break a;}b=w[b+4|0]|w[b+5|0]<<8|(w[b+6|0]<<16|w[b+7|0]<<24);v[a+20>>2]=1;v[a>>2]=b;v[a+4>>2]=0;return 0;}d=w[b+f|0];f=f+1|0;break b;}c=b+f|0;d=w[c|0]|w[c+1|0]<<8;f=f+2|0;break b;}c=b+f|0;d=w[c|0]|w[c+1|0]<<8|(w[c+2|0]<<16|w[c+3|0]<<24);f=f+4|0;}g=e&1;i:{j:{switch(k-1|0){default:e=-1;c=-1;if(!i){break i;}e=w[b+f|0];c=0;break i;case 0:c=0;b=b+f|0;b=(w[b|0]|w[b+1|0]<<8)+256|0;c=b>>>0<256?1:c;e=b;break i;case 1:b=b+f|0;e=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);c=0;break i;case 2:break j;}}b=b+f|0;e=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);c=w[b+4|0]|w[b+5|0]<<8|(w[b+6|0]<<16|w[b+7|0]<<24);}v[a+32>>2]=g;v[a+28>>2]=d;b=e;v[a>>2]=b;v[a+4>>2]=c;d=0;v[a+20>>2]=0;e=i?b:j;v[a+8>>2]=e;b=i?c:h;v[a+12>>2]=b;v[a+16>>2]=!b&e>>>0<131072?e:131072;}return d;}function la(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0;if(!d){return  -72;}i=x[e+2>>1];a:{b:{c:{if(d>>>0>=4){g=w[(c+d|0)-1|0];f=-1;if(!g){break a;}if(d>>>0<=4294967176){break c;}return d;}h=w[c|0];d:{switch(d-2|0){case 1:h=w[c+2|0]<<16|h;case 0:h=(w[c+1|0]<<8)+h|0;break;default:break d;}}f=w[(c+d|0)-1|0];if(!f){return  -20;}f=(E(f)-(d<<3)|0)+9|0;d=0;break b;}f=E(g)-23|0;d=d-4|0;g=d+c|0;h=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);}k=e+4|0;l=a+b|0;i=0-i&31;e:{f:{g:{h:{i:{if(f>>>0>32){break i;}j=l-3|0;while(1){j:{if((d|0)>=4){e=f&7;h=f>>>3|0;f=0;break j;}if(!d){d=0;g=c;break h;}e=f;g=f>>>3|0;f=(c+d|0)-g>>>0<c>>>0;h=f?d:g;e=e-(h<<3)|0;}d=d-h|0;g=d+c|0;h=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);if(!(f?0:a>>>0<j>>>0)){f=e;break i;}f=(h<<e>>>i<<1)+k|0;m=w[f+1|0];t[a|0]=w[f|0];e=e+m|0;f=(h<<e>>>i<<1)+k|0;m=w[f+1|0];t[a+1|0]=w[f|0];a=a+2|0;f=e+m|0;if(f>>>0<=32){continue;}break;}break g;}g=c+d|0;if(f>>>0>32){break g;}}while(1){k:{if((d|0)>=4){e=f&7;h=f>>>3|0;f=0;break k;}if(!d){break g;}e=f;h=g;g=f>>>3|0;f=h-g>>>0<c>>>0;h=f?d:g;e=e-(h<<3)|0;}d=d-h|0;g=d+c|0;h=w[g|0]|w[g+1|0]<<8|(w[g+2|0]<<16|w[g+3|0]<<24);j=a>>>0>=l>>>0;if(f?1:j){f=e;if(!j){break f;}break e;}f=(h<<e>>>i<<1)+k|0;j=w[f+1|0];t[a|0]=w[f|0];a=a+1|0;f=e+j|0;if(f>>>0<=32){continue;}break;}}if(a>>>0>=l>>>0){break e;}}d=a+1|0;if(l-a&1){e=(h<<f>>>i<<1)+k|0;j=w[e+1|0];t[a|0]=w[e|0];f=f+j|0;a=d;}if((d|0)==(l|0)){break e;}while(1){d=(h<<f>>>i<<1)+k|0;e=w[d+1|0];t[a|0]=w[d|0];d=e+f|0;e=(h<<d>>>i<<1)+k|0;f=w[e+1|0];t[a+1|0]=w[e|0];f=d+f|0;a=a+2|0;if((l|0)!=(a|0)){continue;}break;}}f=(c|0)!=(g|0)?-20:(f|0)!=32?-20:b;}return f;}function ea(a){var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0;i=8;a:{b:{if(a>>>0>4294967239){break b;}while(1){i=i>>>0>8?i:8;b=v[1467];h=b;e=v[1466];g=e;a=a>>>0>8?a+3&-4:8;c:{if(a>>>0<=127){f=(a>>>3|0)-1|0;break c;}c=E(a);f=((a>>>29-c^4)-(c<<2)|0)+110|0;if(a>>>0<=4095){break c;}c=((a>>>30-c^2)-(c<<1)|0)+71|0;f=c>>>0<63?c:63;}d=f;c=d&31;if((d&63)>>>0>=32){d=0;b=b>>>c|0;}else {d=b>>>c|0;b=((1<<c)-1&b)<<32-c|g>>>c;}c=d;if(b|c){while(1){h=b;d=c;d:{if(c|b){e=d-1|0;j=e+1|0;g=e;e=b-1|0;g=(e|0)!=-1?j:g;e=E(b^e)+32|0;b=E(d^g);b=(b|0)==32?e:b;d=63-b|0;R=0-(b>>>0>63)|0;break d;}R=0;d=64;}e=d;d=e;b=d&31;if((d&63)>>>0>=32){d=0;h=c>>>b|0;}else {d=c>>>b|0;h=((1<<b)-1&c)<<32-b|h>>>b;}c=d;f=e+f|0;e=f<<4;d=v[e+4840>>2];g=e+4832|0;e:{if((d|0)!=(g|0)){b=da(d,i,a);if(b){break b;}b=v[d+4>>2];v[b+8>>2]=v[d+8>>2];v[v[d+8>>2]+4>>2]=b;v[d+8>>2]=g;b=e+4836|0;v[d+4>>2]=v[b>>2];v[b>>2]=d;v[v[d+4>>2]+8>>2]=d;f=f+1|0;b=(c&1)<<31|h>>>1;c=c>>>1|0;break e;}b=v[1467];v[1466]=v[1466]&Ha(-2,-1,f);v[1467]=R&b;b=h^1;}if(b|c){continue;}break;}e=v[1466];h=v[1467];}f:{if(e|h){c=E(h);g=63-((c|0)==32?E(e)+32|0:c)|0;b=g<<4;c=v[b+4840>>2];g:{if(!h&e>>>0<1073741824){break g;}f=99;d=b+4832|0;if((d|0)==(c|0)){break g;}while(1){if(!f){break g;}b=da(c,i,a);if(b){break b;}f=f-1|0;c=v[c+8>>2];if((d|0)!=(c|0)){continue;}break;}c=d;}if(fa(a+48|0)){break f;}if(!c){break a;}d=(g<<4)+4832|0;if((d|0)==(c|0)){break a;}while(1){b=da(c,i,a);if(b){break b;}c=v[c+8>>2];if((d|0)!=(c|0)){continue;}break;}break a;}if(!fa(a+48|0)){break a;}}b=0;if(i-1&i){break b;}if(a>>>0<=4294967239){continue;}break;}}return b;}return 0;}function $(a,b,c,d,e){var f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0;l=Q-16|0;Q=l;a:{if(e>>>0<=3){v[l+12>>2]=0;f=l+12|0;X(f,d,e);a=$(a,b,c,f,4);i=a>>>0<4294967177?a>>>0>e>>>0?-20:a:a;break a;}o=_(a,0,(v[b>>2]<<1)+2|0);g=w[d|0]|w[d+1|0]<<8|(w[d+2|0]<<16|w[d+3|0]<<24);f=g&15;i=-44;if(f>>>0>10){break a;}v[c>>2]=f+5;c=4;a=g>>>4|0;m=f+6|0;e=d+e|0;n=e-4|0;p=e-7|0;r=e-5|0;j=32<<f;k=j|1;q=v[b>>2];f=d;e=0;g=0;while(1){b:{c:{if(!e){h=g;break c;}e=g;if((a&65535)==65535){while(1){d:{if(f>>>0<r>>>0){a=(w[f+2|0]|w[f+3|0]<<8|(w[f+4|0]<<16|w[f+5|0]<<24))>>>c|0;f=f+2|0;break d;}c=c+16|0;a=a>>>16|0;}e=e+24|0;if((a&65535)==65535){continue;}break;}}h=a&3;if((h|0)==3){while(1){c=c+2|0;e=e+3|0;a=a>>>2|0;h=a&3;if((h|0)==3){continue;}break;}}h=e+h|0;i=-48;if(q>>>0<h>>>0){break a;}c=c+2|0;e:{if(g>>>0>=h>>>0){h=g;break e;}_((g<<1)+o|0,0,h-g<<1);}e=(c>>3)+f|0;if(!(n>>>0<e>>>0&f>>>0>p>>>0)){c=c&7;a=(w[e|0]|w[e+1|0]<<8|(w[e+2|0]<<16|w[e+3|0]<<24))>>>c|0;break b;}a=a>>>2|0;}e=f;}f=j-1&a;g=(j<<1)-1|0;i=g-k|0;if(f>>>0<i>>>0){a=m-1|0;}else {a=a&g;f=a-((a|0)<(j|0)?0:i)|0;a=m;}g=f-1|0;u[(h<<1)+o>>1]=g;k=k-((f|0)<=0?1-f|0:g)|0;if((k|0)<(j|0)){while(1){m=m-1|0;j=j>>1;if((k|0)<(j|0)){continue;}break;}}a=a+c|0;f=(a>>3)+e|0;f:{if(!(n>>>0<f>>>0&e>>>0>p>>>0)){c=a&7;break f;}f=n;c=a+(e-f<<3)|0;}if((k|0)>=2){e=!g;a=(w[f|0]|w[f+1|0]<<8|(w[f+2|0]<<16|w[f+3|0]<<24))>>>c|0;g=h+1|0;if(q>>>0>=g>>>0){continue;}}break;}i=-20;if((k|0)!=1|(c|0)>32){break a;}v[b>>2]=h;i=((c+7>>3)+f|0)-d|0;}a=i;Q=l+16|0;return a;}function ba(a,b,c,d,e,f){var g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;q=Q-112|0;m=a+8|0;n=1;p=1<<f;a:{b:{if((c|0)!=-1){j=p-1|0;r=65536<<f-1>>16;g=c+1|0;s=g&1;if(!c){g=j;break b;}k=g&-2;g=j;while(1){l=h<<1;i=x[l+b>>1];c:{if((i|0)==65535){v[((g<<3)+m|0)+4>>2]=h;g=g-1|0;i=1;break c;}n=i<<16>>16<(r|0)?n:0;}u[l+q>>1]=i;o=h|1;l=o<<1;i=x[l+b>>1];d:{if((i|0)!=65535){n=i<<16>>16<(r|0)?n:0;break d;}v[((g<<3)+m|0)+4>>2]=o;g=g-1|0;i=1;}u[l+q>>1]=i;h=h+2|0;k=k-2|0;if(k){continue;}break;}break b;}v[a+4>>2]=f;v[a>>2]=1;break a;}if(s){i=x[(h<<1)+b>>1];e:{if((i|0)!=65535){n=i<<16>>16<(r|0)?n:0;break e;}v[((g<<3)+m|0)+4>>2]=h;g=g-1|0;i=1;}u[(h<<1)+q>>1]=i;}v[a+4>>2]=f;v[a>>2]=n;if((c|0)==-1){break a;}o=((p>>>3)+(p>>>1)|0)+3|0;h=0;k=0;while(1){a=k;l=u[(a<<1)+b>>1];f:{if((l|0)<=0){break f;}if((l|0)!=1){k=l&-2;while(1){v[((h<<3)+m|0)+4>>2]=a;while(1){h=j&h+o;if(h>>>0>g>>>0){continue;}break;}v[((h<<3)+m|0)+4>>2]=a;while(1){h=j&h+o;if(h>>>0>g>>>0){continue;}break;}k=k-2|0;if(k){continue;}break;}}if(!(l&1)){break f;}v[((h<<3)+m|0)+4>>2]=a;while(1){h=j&h+o;if(h>>>0>g>>>0){continue;}break;}}k=a+1|0;if((a|0)!=(c|0)){continue;}break;}}c=f+1|0;g=0;while(1){j=(g<<3)+m|0;b=v[j+4>>2];a=(b<<1)+q|0;f=x[a>>1];u[a>>1]=f+1;a=c+(E(f)^-32)|0;t[j+3|0]=a;u[j>>1]=(f<<a)-p;a=b<<2;t[j+2|0]=v[a+e>>2];v[j+4>>2]=v[a+d>>2];g=g+1|0;if((p|0)!=(g|0)){continue;}break;}}function ma(a,b,c,d){var e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;j=Q-16|0;Q=j;v[j+12>>2]=0;v[j+8>>2]=0;e=-44;n=d- -64|0;b=na(n,d,j+8|0,j+12|0,b,c);a:{b:{if(b>>>0>4294967176){break b;}g=v[j+12>>2];c=v[a>>2];if(g>>>0>(c&255)+1>>>0){break a;}v[a>>2]=c&-16776961|g<<16&16711680;c:{if(g+1>>>0<2){break c;}c=g&3;d:{if(g-1>>>0<3){e=1;break d;}i=g&-4;e=1;while(1){h=(e<<2)+d|0;k=v[h>>2];v[h>>2]=f;m=e+1|0;l=(m<<2)+d|0;o=v[l>>2];f=(k<<e-1)+f|0;v[l>>2]=f;k=e+2|0;l=(k<<2)+d|0;p=v[l>>2];f=f+(o<<e)|0;v[l>>2]=f;l=v[h+12>>2];f=f+(p<<m)|0;v[h+12>>2]=f;f=f+(l<<k)|0;e=e+4|0;i=i-4|0;if(i){continue;}break;}}if(!c){break c;}while(1){h=(e<<2)+d|0;i=v[h>>2];v[h>>2]=f;f=(i<<e-1)+f|0;e=e+1|0;c=c-1|0;if(c){continue;}break;}}k=v[j+8>>2];if(!k){break b;}h=a+4|0;m=g+1|0;f=0;while(1){g=w[f+n|0];a=(g<<2)+d|0;c=v[a>>2];e=1<<g>>1;i=c+e|0;v[a>>2]=i;a=m-g|0;e:{if(e>>>0>=4){if(c>>>0>=i>>>0){break e;}while(1){e=h+(c<<1)|0;t[e+1|0]=a;t[e|0]=f;t[e+3|0]=a;t[e+2|0]=f;t[e+5|0]=a;t[e+4|0]=f;t[e+7|0]=a;t[e+6|0]=f;c=c+4|0;if(i>>>0>c>>>0){continue;}break;}break e;}if(!g){break e;}c=h+(c<<1)|0;t[c+1|0]=a;t[c|0]=f;if(e>>>0<2){break e;}t[c+3|0]=a;t[c+2|0]=f;if(((e>>>0>1?e:1)|0)==2){break e;}t[c+5|0]=a;t[c+4|0]=f;}f=f+1|0;if((k|0)!=(f|0)){continue;}break;}}e=b;}Q=j+16|0;return e;}function X(a,b,c){var d=0,e=0,f=0;if(c>>>0>=512){O(a|0,b|0,c|0)|0;return a;}e=a+c|0;a:{if(!((a^b)&3)){b:{if(!(a&3)){c=a;break b;}if(!c){c=a;break b;}c=a;while(1){t[c|0]=w[b|0];b=b+1|0;c=c+1|0;if(!(c&3)){break b;}if(c>>>0<e>>>0){continue;}break;}}d=e&-4;c:{if(d>>>0<64){break c;}f=d+-64|0;if(f>>>0<c>>>0){break c;}while(1){v[c>>2]=v[b>>2];v[c+4>>2]=v[b+4>>2];v[c+8>>2]=v[b+8>>2];v[c+12>>2]=v[b+12>>2];v[c+16>>2]=v[b+16>>2];v[c+20>>2]=v[b+20>>2];v[c+24>>2]=v[b+24>>2];v[c+28>>2]=v[b+28>>2];v[c+32>>2]=v[b+32>>2];v[c+36>>2]=v[b+36>>2];v[c+40>>2]=v[b+40>>2];v[c+44>>2]=v[b+44>>2];v[c+48>>2]=v[b+48>>2];v[c+52>>2]=v[b+52>>2];v[c+56>>2]=v[b+56>>2];v[c+60>>2]=v[b+60>>2];b=b- -64|0;c=c- -64|0;if(f>>>0>=c>>>0){continue;}break;}}if(c>>>0>=d>>>0){break a;}while(1){v[c>>2]=v[b>>2];b=b+4|0;c=c+4|0;if(d>>>0>c>>>0){continue;}break;}break a;}if(e>>>0<4){c=a;break a;}d=e-4|0;if(d>>>0<a>>>0){c=a;break a;}c=a;while(1){t[c|0]=w[b|0];t[c+1|0]=w[b+1|0];t[c+2|0]=w[b+2|0];t[c+3|0]=w[b+3|0];b=b+4|0;c=c+4|0;if(d>>>0>=c>>>0){continue;}break;}}if(c>>>0<e>>>0){while(1){t[c|0]=w[b|0];b=b+1|0;c=c+1|0;if((e|0)!=(c|0)){continue;}break;}}return a;}function fa(a){var b=0,c=0,d=0,e=0,f=0,g=0;e=v[1204];c=a+3&-4;b=e+c|0;a:{b:{if(b>>>0<=e>>>0?c:0){break b;}if(b>>>0>T()<<16>>>0){if(!(P(b|0)|0)){break b;}}v[1204]=b;break a;}v[1468]=48;e=-1;}if((e|0)!=-1){c=a+e|0;b=c-16|0;v[b+12>>2]=16;v[b>>2]=16;a=v[1464];if(a){d=v[a+8>>2];}else {d=0;}c:{d:{if((d|0)==(e|0)){d=e-(v[e-4>>2]&-2)|0;f=v[d-4>>2];v[a+8>>2]=c;a=d-(f&-2)|0;c=-16;if(!(t[(a+v[a>>2]|0)-4|0]&1)){break d;}c=v[a+4>>2];v[c+8>>2]=v[a+8>>2];v[v[a+8>>2]+4>>2]=c;b=b-a|0;v[a>>2]=b;break c;}v[e+12>>2]=16;v[e>>2]=16;v[e+8>>2]=c;v[e+4>>2]=a;v[1464]=e;c=16;}a=e+c|0;b=b-a|0;v[a>>2]=b;}v[((b&-4)+a|0)-4>>2]=b|1;g=a;d=v[a>>2]-8|0;e:{if(d>>>0<=127){b=(d>>>3|0)-1|0;break e;}f=E(d);b=((d>>>29-f^4)-(f<<2)|0)+110|0;if(d>>>0<=4095){break e;}b=((d>>>30-f^2)-(f<<1)|0)+71|0;b=b>>>0<63?b:63;}c=b<<4;v[g+4>>2]=c+4832;c=c+4840|0;v[a+8>>2]=v[c>>2];v[c>>2]=a;v[v[a+8>>2]+4>>2]=a;c=v[1467];a=b&31;if((b&63)>>>0>=32){b=1<<a;d=0;}else {d=1<<a;b=d-1&1>>>32-a;}v[1466]=d|v[1466];v[1467]=b|c;}return (e|0)!=-1;}function da(a,b,c){var d=0,e=0,f=0,g=0;d=a+4|0;e=(d+b|0)-1&0-b;b=v[a>>2];if(e+c>>>0<=(b+a|0)-4>>>0){f=v[a+4>>2];v[f+8>>2]=v[a+8>>2];v[v[a+8>>2]+4>>2]=f;if((d|0)!=(e|0)){e=e-d|0;f=a-(v[a-4>>2]&-2)|0;d=e+v[f>>2]|0;v[f>>2]=d;v[(f+(d&-4)|0)-4>>2]=d;a=a+e|0;b=b-e|0;v[a>>2]=b;}a:{if(c+24>>>0<=b>>>0){d=(a+c|0)+8|0;b=(b-c|0)-8|0;v[d>>2]=b;v[(d+(b&-4)|0)-4>>2]=b|1;g=d;f=v[d>>2]-8|0;b:{if(f>>>0<=127){e=(f>>>3|0)-1|0;break b;}b=E(f);e=((f>>>29-b^4)-(b<<2)|0)+110|0;if(f>>>0<=4095){break b;}b=((f>>>30-b^2)-(b<<1)|0)+71|0;e=b>>>0<63?b:63;}b=e;e=b<<4;v[g+4>>2]=e+4832;e=e+4840|0;v[d+8>>2]=v[e>>2];v[e>>2]=d;v[v[d+8>>2]+4>>2]=d;e=v[1467];d=b&31;if((b&63)>>>0>=32){b=1<<d;f=0;}else {f=1<<d;b=f-1&1>>>32-d;}v[1466]=f|v[1466];v[1467]=b|e;b=c+8|0;v[a>>2]=b;v[((b&-4)+a|0)-4>>2]=b;break a;}v[(a+b|0)-4>>2]=b;}a=a+4|0;}else {a=0;}return a;}function Z(a,b,c){var d=0,e=0;a:{if((a|0)==(b|0)){break a;}e=a+c|0;if(b-e>>>0<=0-(c<<1)>>>0){return X(a,b,c);}d=(a^b)&3;b:{c:{if(a>>>0<b>>>0){if(d){d=a;break b;}if(!(a&3)){d=a;break c;}d=a;while(1){if(!c){break a;}t[d|0]=w[b|0];b=b+1|0;c=c-1|0;d=d+1|0;if(d&3){continue;}break;}break c;}d:{if(d){break d;}if(e&3){while(1){if(!c){break a;}c=c-1|0;d=c+a|0;t[d|0]=w[b+c|0];if(d&3){continue;}break;}}if(c>>>0<=3){break d;}while(1){c=c-4|0;v[c+a>>2]=v[b+c>>2];if(c>>>0>3){continue;}break;}}if(!c){break a;}while(1){c=c-1|0;t[c+a|0]=w[b+c|0];if(c){continue;}break;}break a;}if(c>>>0<=3){break b;}while(1){v[d>>2]=v[b>>2];b=b+4|0;d=d+4|0;c=c-4|0;if(c>>>0>3){continue;}break;}}if(!c){break a;}while(1){t[d|0]=w[b|0];d=d+1|0;b=b+1|0;c=c-1|0;if(c){continue;}break;}}return a;}function _(a,b,c){var d=0,e=0,f=0;a:{if(!c){break a;}f=a+c|0;t[f-1|0]=b;t[a|0]=b;if(c>>>0<3){break a;}t[f-2|0]=b;t[a+1|0]=b;t[f-3|0]=b;t[a+2|0]=b;if(c>>>0<7){break a;}t[f-4|0]=b;t[a+3|0]=b;if(c>>>0<9){break a;}f=0-a&3;e=f+a|0;d=B(b&255,16843009);v[e>>2]=d;b=c-f&-4;c=b+e|0;v[c-4>>2]=d;if(b>>>0<9){break a;}v[e+8>>2]=d;v[e+4>>2]=d;v[c-8>>2]=d;v[c-12>>2]=d;if(b>>>0<25){break a;}v[e+24>>2]=d;v[e+20>>2]=d;v[e+16>>2]=d;v[e+12>>2]=d;v[c-16>>2]=d;v[c-20>>2]=d;v[c-24>>2]=d;v[c-28>>2]=d;c=b;b=e&4|24;c=c-b|0;if(c>>>0<32){break a;}d=Ga(d,0,1,1);f=R;b=b+e|0;while(1){v[b+24>>2]=d;e=f;v[b+28>>2]=e;v[b+16>>2]=d;v[b+20>>2]=e;v[b+8>>2]=d;v[b+12>>2]=e;v[b>>2]=d;v[b+4>>2]=e;b=b+32|0;c=c-32|0;if(c>>>0>31){continue;}break;}}return a;}function ta(a){a=a|0;var b=0;b=1812;a:{b:{switch((a>>>0<4294967177?0:0-a|0)|0){case 1:b=1855;break a;case 10:b=1159;break a;case 12:b=1766;break a;case 14:b=1184;break a;case 16:b=1506;break a;case 20:b=1830;break a;case 22:b=1271;break a;case 40:b=1212;break a;case 42:b=1692;break a;case 62:b=1061;break a;case 64:b=1024;break a;case 66:b=1378;break a;case 60:b=1616;break a;case 44:b=1718;break a;case 46:b=1575;break a;case 48:b=1340;break a;case 30:b=1788;break a;case 32:b=1415;break a;case 34:b=1112;break a;case 70:b=1308;break a;case 72:b=1090;break a;case 74:b=1234;break a;case 100:b=1550;break a;case 102:b=1463;break a;case 104:b=1435;break a;case 0:break a;default:break b;}}b=1669;}return b|0;}function Y(a){var b=0,c=0,d=0,e=0,f=0;if(a){c=a-4|0;e=v[c>>2];b=e;d=c;f=v[a-8>>2];a=f&-2;if((a|0)!=(f|0)){d=c-a|0;b=v[d+4>>2];v[b+8>>2]=v[d+8>>2];v[v[d+8>>2]+4>>2]=b;b=a+e|0;}a=c+e|0;c=v[a>>2];if((c|0)!=v[(a+c|0)-4>>2]){e=v[a+4>>2];v[e+8>>2]=v[a+8>>2];v[v[a+8>>2]+4>>2]=e;b=b+c|0;}v[d>>2]=b;v[((b&-4)+d|0)-4>>2]=b|1;f=d;b=v[d>>2]-8|0;a:{if(b>>>0<=127){a=(b>>>3|0)-1|0;break a;}e=E(b);a=((b>>>29-e^4)-(e<<2)|0)+110|0;if(b>>>0<=4095){break a;}a=((b>>>30-e^2)-(e<<1)|0)+71|0;a=a>>>0<63?a:63;}c=a<<4;v[f+4>>2]=c+4832;c=c+4840|0;v[d+8>>2]=v[c>>2];v[c>>2]=d;v[v[d+8>>2]+4>>2]=d;c=v[1467];d=a&31;if((a&63)>>>0>=32){a=1<<d;b=0;}else {b=1<<d;a=b-1&1>>>32-d;}v[1466]=b|v[1466];v[1467]=a|c;}}function ga(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=0,o=0;n=Q-128|0;Q=n;v[n+124>>2]=d;o=-1;a:{b:{switch(c|0){case 1:if(!g){o=-72;break a;}o=-20;c=w[f|0];if(c>>>0>d>>>0){break a;}c=c<<2;d=v[c+i>>2];c=v[c+h>>2];t[a+11|0]=0;v[a>>2]=0;v[a+4>>2]=0;v[a+12>>2]=c;t[a+10|0]=d;u[a+8>>1]=0;v[b>>2]=a;o=1;break a;case 0:v[b>>2]=j;o=0;break a;case 3:if(!k){o=-20;break a;}o=0;if(!l|(m|0)<25){break a;}a=(8<<e)+8|0;if(!a){break a;}d=0;while(1){d=d- -64|0;if(a>>>0>d>>>0){continue;}break;}break a;case 2:break b;default:break a;}}o=-20;c=$(n,n+124|0,n+120|0,f,g);if(c>>>0>4294967176){break a;}d=v[n+120>>2];if(d>>>0>e>>>0){break a;}ba(a,n,v[n+124>>2],h,i,d);v[b>>2]=a;o=c;}Q=n+128|0;return o;}function Ea(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0;a:{b:{if(!a){break b;}b=-64;if(v[a+28936>>2]){break a;}e=v[a+28924>>2];c=v[a+28920>>2];b=v[a+28944>>2];c:{if(!b){break c;}f=v[b+26692>>2];d=v[b+26688>>2];d:{e:{g=v[b>>2];if(g){if(!d){break e;}S[d|0](f,g);S[d|0](f,b);break c;}if(!d){break d;}S[d|0](f,b);break c;}Y(g);}Y(b);}v[a+28960>>2]=0;v[a+28944>>2]=0;v[a+28948>>2]=0;f:{g:{b=v[a+28968>>2];if(b){if(!c){break g;}S[c|0](e,b);v[a+28968>>2]=0;S[c|0](e,a);break b;}v[a+28968>>2]=0;if(!c){break f;}S[c|0](e,a);break b;}Y(b);}Y(a);}b=0;}return b|0;}function ja(a,b,c){var d=0;if(!c){v[a>>2]=0;v[a+4>>2]=0;v[a+16>>2]=0;v[a+8>>2]=0;v[a+12>>2]=0;return  -72;}v[a+12>>2]=b;v[a+16>>2]=b+4;if(c>>>0>=4){d=b+c|0;b=d-4|0;v[a+8>>2]=b;v[a>>2]=w[b|0]|w[b+1|0]<<8|(w[b+2|0]<<16|w[b+3|0]<<24);b=w[d-1|0];if(!b){v[a+4>>2]=0;return  -1;}v[a+4>>2]=E(b)-23;return c;}v[a+8>>2]=b;d=w[b|0];v[a>>2]=d;a:{switch(c-2|0){case 1:d=w[b+2|0]<<16|d;v[a>>2]=d;case 0:v[a>>2]=(w[b+1|0]<<8)+d;break;default:break a;}}b=w[(b+c|0)-1|0];if(!b){v[a+4>>2]=0;return  -20;}v[a+4>>2]=(E(b)-(c<<3)|0)+9;return c;}function Fa(){var a=0,b=0;a=ea(160168);if(!a){return 0;}v[a+28924>>2]=0;v[a+28916>>2]=0;v[a+28920>>2]=0;v[a+28980>>2]=134217729;v[a+28936>>2]=0;v[a+28908>>2]=0;v[a+28948>>2]=0;v[a+160164>>2]=0;v[a+29004>>2]=0;v[a+29008>>2]=0;v[a+28988>>2]=0;v[a+28740>>2]=0;v[a+29020>>2]=0;v[a+29024>>2]=0;v[a+28940>>2]=0;v[a+28944>>2]=0;v[a+28956>>2]=0;v[a+28960>>2]=0;b=a+28964|0;v[b>>2]=0;v[b+4>>2]=0;v[a+28972>>2]=0;return a|0;}function Ha(a,b,c){var d=0,e=0,f=0,g=0;g=c&63;f=g;e=f&31;if(f>>>0>=32){f=-1>>>e|0;}else {f=-1>>>e|0;d=f;f=d|(1<<e)-1<<32-e;}f=f&a;d=b&d;e=g&31;if(g>>>0>=32){d=f<<e;g=0;}else {d=(1<<e)-1&f>>>32-e|d<<e;g=f<<e;}f=d;e=0-c&63;d=e&31;if(e>>>0>=32){d=-1<<d;c=0;}else {c=-1<<d;d=c|(1<<d)-1&-1>>>32-d;}a=c&a;b=b&d;d=e&31;if(e>>>0>=32){c=0;a=b>>>d|0;}else {c=b>>>d|0;a=((1<<d)-1&b)<<32-d|a>>>d;}a=a|g;R=c|f;return a;}function Ba(a){a=a|0;var b=0,c=0,d=0,e=0;v[a+29020>>2]=0;v[a+28964>>2]=0;b=v[a+28944>>2];a:{if(!b){break a;}d=v[b+26692>>2];c=v[b+26688>>2];b:{c:{e=v[b>>2];if(e){if(!c){break c;}S[c|0](d,e);S[c|0](d,b);break a;}if(!c){break b;}S[c|0](d,b);break a;}Y(e);}Y(b);}v[a+28960>>2]=0;v[a+28944>>2]=0;v[a+28948>>2]=0;return (v[a+28908>>2]?1:5)|0;}function Ga(a,b,c,d){var e=0,f=0,g=0,h=0,i=0,j=0;e=c>>>16|0;f=a>>>16|0;j=B(e,f);g=c&65535;h=a&65535;i=B(g,h);f=(i>>>16|0)+B(f,g)|0;e=(f&65535)+B(e,h)|0;R=(B(b,c)+j|0)+B(a,d)+(f>>>16)+(e>>>16)|0;return i&65535|e<<16;}function sa(){var a=0,b=0,c=0;while(1){b=a<<4;c=b+4832|0;v[b+4836>>2]=c;v[b+4840>>2]=c;a=a+1|0;if((a|0)!=64){continue;}break;}fa(48);}function ya(a){a=a|0;return a>>>0>4294967176|0;}function ua(a){a=a|0;a=Q-a&-16;Q=a;return a|0;}function za(a){a=a|0;return ea(a)|0;}function Da(){return 131075;}function Ca(){return 131072;}function xa(a){a=a|0;Y(a);}function wa(){return Q|0;}function va(a){a=a|0;Q=a;}// EMSCRIPTEN_END_FUNCS
  e=w;p();var S=c([]);function T(){return s.byteLength/65536|0;}return {"d":sa,"e":za,"f":xa,"g":ya,"h":ta,"i":Fa,"j":Ea,"k":Da,"l":Ca,"m":Ba,"n":Aa,"o":S,"p":wa,"q":va,"r":ua};}return U(W);}// EMSCRIPTEN_END_ASM
  (E);}function ca(){return {then:function then(c){c({instance:new ba()});}};}var da=Error,WebAssembly={};B=[];"object"!==_typeof(WebAssembly)&&F("no native wasm support detected");var G,H=false;function J(c){var f=a["_"+c];f||F("Assertion failed: Cannot call unknown function "+(c+", make sure it is exported"));return f;}function ea(c,f,d,n){var l={string:function string(b){var e=0;if(null!==b&&void 0!==b&&0!==b){var g=(b.length<<2)+1;e=K(g);var h=e,k=L;if(0<g){g=h+g-1;for(var u=0;u<b.length;++u){var p=b.charCodeAt(u);if(55296<=p&&57343>=p){var I=b.charCodeAt(++u);p=65536+((p&1023)<<10)|I&1023;}if(127>=p){if(h>=g)break;k[h++]=p;}else {if(2047>=p){if(h+1>=g)break;k[h++]=192|p>>6;}else {if(65535>=p){if(h+2>=g)break;k[h++]=224|p>>12;}else {if(h+3>=g)break;k[h++]=240|p>>18;k[h++]=128|p>>12&63;}k[h++]=128|p>>6&63;}k[h++]=128|p&63;}}k[h]=0;}}return e;},array:function array(b){var e=K(b.length);N.set(b,e);return e;}};c=J(c);var m=[],q=0;if(n)for(var r=0;r<n.length;r++){var C=l[d[r]];C?(0===q&&(q=fa()),m[r]=C(n[r])):m[r]=n[r];}d=c.apply(null,m);return d=function(b){0!==q&&ha(q);if("string"===f){if(b){for(var e=L,g=b+NaN,h=b;e[h]&&!(h>=g);)++h;if(16<h-b&&e.subarray&&ia)b=ia.decode(e.subarray(b,h));else {for(g="";b<h;){var k=e[b++];if(k&128){var u=e[b++]&63;if(192==(k&224))g+=String.fromCharCode((k&31)<<6|u);else {var p=e[b++]&63;k=224==(k&240)?(k&15)<<12|u<<6|p:(k&7)<<18|u<<12|p<<6|e[b++]&63;65536>k?g+=String.fromCharCode(k):(k-=65536,g+=String.fromCharCode(55296|k>>10,56320|k&1023));}}else g+=String.fromCharCode(k);}b=g;}}else b="";}else b="boolean"===f?!!b:b;return b;}(d);}var ia="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0,O,N,L,D=a.INITIAL_MEMORY||150994944;a.wasmMemory?G=a.wasmMemory:G=new aa();G&&(O=G.buffer);D=O.byteLength;var P=O;O=P;a.HEAP8=N=new Int8Array(P);a.HEAP16=new Int16Array(P);a.HEAP32=new Int32Array(P);a.HEAPU8=L=new Uint8Array(P);a.HEAPU16=new Uint16Array(P);a.HEAPU32=new Uint32Array(P);a.HEAPF32=new Float32Array(P);a.HEAPF64=new Float64Array(P);var ja,ka=[],la=[],ma=[];function na(){var c=a.preRun.shift();ka.unshift(c);}Math.imul||(Math.imul=function(c,f){var d=c&65535,n=f&65535;return d*n+((c>>>16)*n+d*(f>>>16)<<16)|0;});if(!Math.fround){var oa=new Float32Array(1);Math.fround=function(c){oa[0]=c;return oa[0];};}Math.clz32||(Math.clz32=function(c){var f=32,d=c>>16;d&&(f-=16,c=d);if(d=c>>8)f-=8,c=d;if(d=c>>4)f-=4,c=d;if(d=c>>2)f-=2,c=d;return c>>1?f-2:f-c;});Math.trunc||(Math.trunc=function(c){return 0>c?Math.ceil(c):Math.floor(c);});var Q=0,S=null;a.preloadedImages={};a.preloadedAudios={};function F(c){if(a.onAbort)a.onAbort(c);c="Aborted("+c+")";A(c);H=true;c=new da(c+". Build with -s ASSERTIONS=1 for more info.");v(c);throw c;}function U(c){return c.startsWith("data:application/octet-stream;base64,");}var V;if(a.locateFile){if(V="zstddec-asm.wasm",!U(V)){var pa=V;V=a.locateFile?a.locateFile(pa,y):y+pa;}}else V=new URL("zstddec-asm.wasm",(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href)).toString();function qa(){var c=V;try{if(c==V&&B)return new Uint8Array(B);if(U(c))try{var f=ra(c.slice(37)),d=new Uint8Array(f.length);for(c=0;c<f.length;++c)d[c]=f.charCodeAt(c);var n=d;}catch(m){throw Error("Converting base64 string to bytes failed.");}else n=void 0;var l=n;if(l)return l;throw "both async and sync fetching of the wasm failed";}catch(m){F(m);}}function sa(){return B||"function"!==typeof fetch?Promise.resolve().then(function(){return qa();}):fetch(V,{credentials:"same-origin"}).then(function(c){if(!c.ok)throw "failed to load wasm binary file at '"+V+"'";return c.arrayBuffer();}).catch(function(){return qa();});}function W(c){for(;0<c.length;){var f=c.shift();if("function"==typeof f)f(a);else {var d=f.H;"number"===typeof d?void 0===f.A?ta(d)():ta(d)(f.A):d(void 0===f.A?null:f.A);}}}var X=[];function ta(c){var f=X[c];f||(c>=X.length&&(X.length=c+1),X[c]=f=ja.get(c));return f;}var ra="function"===typeof atob?atob:function(c){var f="",d=0;c=c.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(d++));var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(d++));var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(d++));var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(d++));n=n<<2|l>>4;l=(l&15)<<4|m>>2;var r=(m&3)<<6|q;f+=String.fromCharCode(n);64!==m&&(f+=String.fromCharCode(l));64!==q&&(f+=String.fromCharCode(r));}while(d<c.length);return f;},E={b:Uint8Array.prototype.copyWithin?function(c,f,d){L.copyWithin(c,f,f+d);}:function(c,f,d){L.set(L.subarray(f,f+d),c);},c:function c(){F("OOM");},a:G};(function(){function c(l){a.asm=l.exports;ja=a.asm.o;la.unshift(a.asm.d);Q--;a.monitorRunDependencies&&a.monitorRunDependencies(Q);0==Q&&(S&&(l=S,S=null,l()));}function f(l){c(l.instance);}function d(l){return sa().then(function(){return ca();}).then(function(m){return m;}).then(l,function(m){A("failed to asynchronously prepare wasm: "+m);F(m);});}var n={a:E};Q++;a.monitorRunDependencies&&a.monitorRunDependencies(Q);if(a.instantiateWasm)try{return a.instantiateWasm(n,c);}catch(l){return A("Module.instantiateWasm callback failed with error: "+l),false;}(function(){return B||"function"!==typeof WebAssembly.instantiateStreaming||U(V)||"function"!==typeof fetch?d(f):fetch(V,{credentials:"same-origin"}).then(function(l){return WebAssembly.instantiateStreaming(l,n).then(f,function(m){A("wasm streaming compile failed: "+m);A("falling back to ArrayBuffer instantiation");return d(f);});});})().catch(v);return {};})();a.___wasm_call_ctors=function(){return (a.___wasm_call_ctors=a.asm.d).apply(null,arguments);};a._malloc=function(){return (a._malloc=a.asm.e).apply(null,arguments);};a._free=function(){return (a._free=a.asm.f).apply(null,arguments);};a._ZSTD_isError=function(){return (a._ZSTD_isError=a.asm.g).apply(null,arguments);};a._ZSTD_getErrorName=function(){return (a._ZSTD_getErrorName=a.asm.h).apply(null,arguments);};a._ZSTD_createDStream=function(){return (a._ZSTD_createDStream=a.asm.i).apply(null,arguments);};a._ZSTD_freeDStream=function(){return (a._ZSTD_freeDStream=a.asm.j).apply(null,arguments);};a._ZSTD_DStreamInSize=function(){return (a._ZSTD_DStreamInSize=a.asm.k).apply(null,arguments);};a._ZSTD_DStreamOutSize=function(){return (a._ZSTD_DStreamOutSize=a.asm.l).apply(null,arguments);};a._ZSTD_initDStream=function(){return (a._ZSTD_initDStream=a.asm.m).apply(null,arguments);};a._ZSTD_decompressStream=function(){return (a._ZSTD_decompressStream=a.asm.n).apply(null,arguments);};var fa=a.stackSave=function(){return (fa=a.stackSave=a.asm.p).apply(null,arguments);},ha=a.stackRestore=function(){return (ha=a.stackRestore=a.asm.q).apply(null,arguments);},K=a.stackAlloc=function(){return (K=a.stackAlloc=a.asm.r).apply(null,arguments);};a.cwrap=function(c,f,d,n){d=d||[];var l=d.every(function(m){return "number"===m;});return "string"!==f&&l&&!n?J(c):function(){return ea(c,f,d,arguments);};};var Y;S=function ua(){Y||Z();Y||(S=ua);};function Z(){function c(){if(!Y&&(Y=true,a.calledRun=true,!H)){W(la);t(a);if(a.onRuntimeInitialized)a.onRuntimeInitialized();if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var f=a.postRun.shift();ma.unshift(f);}W(ma);}}if(!(0<Q)){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)na();W(ka);0<Q||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("");},1);c();},1)):c());}}a.run=Z;if(a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();Z();return ZD.ready;};}();

  var ZD=function(){var _scriptDir=(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href);return function(ZD){ZD=ZD||{};var a;a||(a=typeof ZD!=='undefined'?ZD:{});var q,r;a.ready=new Promise(function(b,c){q=b;r=c;});var t={},w;for(w in a)a.hasOwnProperty(w)&&(t[w]=a[w]);var x="";"undefined"!==typeof document&&document.currentScript&&(x=document.currentScript.src);_scriptDir&&(x=_scriptDir);0!==x.indexOf("blob:")?x=x.substr(0,x.replace(/[?#].*/,"").lastIndexOf("/")+1):x="";var y=a.printErr||console.warn.bind(console);for(w in t)t.hasOwnProperty(w)&&(a[w]=t[w]);t=null;var z;a.wasmBinary&&(z=a.wasmBinary);a.noExitRuntime||true;"object"!==(typeof WebAssembly==="undefined"?"undefined":_typeof(WebAssembly))&&A("no native wasm support detected");var B,C=false;function E(b){var c=a["_"+b];c||A("Assertion failed: Cannot call unknown function "+(b+", make sure it is exported"));return c;}function aa(b,c,h,p){var e={string:function string(d){var m=0;if(null!==d&&void 0!==d&&0!==d){var l=(d.length<<2)+1;m=F(l);var g=m,f=G;if(0<l){l=g+l-1;for(var u=0;u<d.length;++u){var k=d.charCodeAt(u);if(55296<=k&&57343>=k){var da=d.charCodeAt(++u);k=65536+((k&1023)<<10)|da&1023;}if(127>=k){if(g>=l)break;f[g++]=k;}else {if(2047>=k){if(g+1>=l)break;f[g++]=192|k>>6;}else {if(65535>=k){if(g+2>=l)break;f[g++]=224|k>>12;}else {if(g+3>=l)break;f[g++]=240|k>>18;f[g++]=128|k>>12&63;}f[g++]=128|k>>6&63;}f[g++]=128|k&63;}}f[g]=0;}}return m;},array:function array(d){var m=F(d.length);H.set(d,m);return m;}};b=E(b);var n=[],D=0;if(p)for(var v=0;v<p.length;v++){var Q=e[h[v]];Q?(0===D&&(D=I()),n[v]=Q(p[v])):n[v]=p[v];}h=b.apply(null,n);return h=function(d){0!==D&&J(D);if("string"===c){if(d){for(var m=G,l=d+NaN,g=d;m[g]&&!(g>=l);)++g;if(16<g-d&&m.subarray&&K)d=K.decode(m.subarray(d,g));else {for(l="";d<g;){var f=m[d++];if(f&128){var u=m[d++]&63;if(192==(f&224))l+=String.fromCharCode((f&31)<<6|u);else {var k=m[d++]&63;f=224==(f&240)?(f&15)<<12|u<<6|k:(f&7)<<18|u<<12|k<<6|m[d++]&63;65536>f?l+=String.fromCharCode(f):(f-=65536,l+=String.fromCharCode(55296|f>>10,56320|f&1023));}}else l+=String.fromCharCode(f);}d=l;}}else d="";}else d="boolean"===c?!!d:d;return d;}(h);}var K="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0,H,G,L,M=[],N=[],O=[];function ba(){var b=a.preRun.shift();M.unshift(b);}var P=0,S=null;a.preloadedImages={};a.preloadedAudios={};function A(b){if(a.onAbort)a.onAbort(b);b="Aborted("+b+")";y(b);C=true;b=new WebAssembly.RuntimeError(b+". Build with -s ASSERTIONS=1 for more info.");r(b);throw b;}function T(){return U.startsWith("data:application/octet-stream;base64,");}var U;if(a.locateFile){if(U="zstddec-wasm.wasm",!T()){var V=U;U=a.locateFile?a.locateFile(V,x):x+V;}}else U=new URL("zstddec-wasm.wasm",(_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('bundle.js', document.location.href.replace(/[^/]*$/, '')).href)).toString();function ca(){var b=U;try{if(b==U&&z)return new Uint8Array(z);throw "both async and sync fetching of the wasm failed";}catch(c){A(c);}}function ea(){return z||"function"!==typeof fetch?Promise.resolve().then(function(){return ca();}):fetch(U,{credentials:"same-origin"}).then(function(b){if(!b.ok)throw "failed to load wasm binary file at '"+U+"'";return b.arrayBuffer();}).catch(function(){return ca();});}function W(b){for(;0<b.length;){var c=b.shift();if("function"==typeof c)c(a);else {var h=c.u;"number"===typeof h?void 0===c.s?fa(h)():fa(h)(c.s):h(void 0===c.s?null:c.s);}}}var X=[];function fa(b){var c=X[b];c||(b>=X.length&&(X.length=b+1),X[b]=c=L.get(b));return c;}var ha={a:function a(b,c,h){G.copyWithin(b,c,c+h);},b:function b(){A("OOM");}};(function(){function b(e){a.asm=e.exports;B=a.asm.c;e=B.buffer;a.HEAP8=H=new Int8Array(e);a.HEAP16=new Int16Array(e);a.HEAP32=new Int32Array(e);a.HEAPU8=G=new Uint8Array(e);a.HEAPU16=new Uint16Array(e);a.HEAPU32=new Uint32Array(e);a.HEAPF32=new Float32Array(e);a.HEAPF64=new Float64Array(e);L=a.asm.o;N.unshift(a.asm.d);P--;a.monitorRunDependencies&&a.monitorRunDependencies(P);0==P&&(S&&(e=S,S=null,e()));}function c(e){b(e.instance);}function h(e){return ea().then(function(n){return WebAssembly.instantiate(n,p);}).then(function(n){return n;}).then(e,function(n){y("failed to asynchronously prepare wasm: "+n);A(n);});}var p={a:ha};P++;a.monitorRunDependencies&&a.monitorRunDependencies(P);if(a.instantiateWasm)try{return a.instantiateWasm(p,b);}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),false;}(function(){return z||"function"!==typeof WebAssembly.instantiateStreaming||T()||"function"!==typeof fetch?h(c):fetch(U,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,p).then(c,function(n){y("wasm streaming compile failed: "+n);y("falling back to ArrayBuffer instantiation");return h(c);});});})().catch(r);return {};})();a.___wasm_call_ctors=function(){return (a.___wasm_call_ctors=a.asm.d).apply(null,arguments);};a._malloc=function(){return (a._malloc=a.asm.e).apply(null,arguments);};a._free=function(){return (a._free=a.asm.f).apply(null,arguments);};a._ZSTD_isError=function(){return (a._ZSTD_isError=a.asm.g).apply(null,arguments);};a._ZSTD_getErrorName=function(){return (a._ZSTD_getErrorName=a.asm.h).apply(null,arguments);};a._ZSTD_createDStream=function(){return (a._ZSTD_createDStream=a.asm.i).apply(null,arguments);};a._ZSTD_freeDStream=function(){return (a._ZSTD_freeDStream=a.asm.j).apply(null,arguments);};a._ZSTD_DStreamInSize=function(){return (a._ZSTD_DStreamInSize=a.asm.k).apply(null,arguments);};a._ZSTD_DStreamOutSize=function(){return (a._ZSTD_DStreamOutSize=a.asm.l).apply(null,arguments);};a._ZSTD_initDStream=function(){return (a._ZSTD_initDStream=a.asm.m).apply(null,arguments);};a._ZSTD_decompressStream=function(){return (a._ZSTD_decompressStream=a.asm.n).apply(null,arguments);};var I=a.stackSave=function(){return (I=a.stackSave=a.asm.p).apply(null,arguments);},J=a.stackRestore=function(){return (J=a.stackRestore=a.asm.q).apply(null,arguments);},F=a.stackAlloc=function(){return (F=a.stackAlloc=a.asm.r).apply(null,arguments);};a.cwrap=function(b,c,h,p){h=h||[];var e=h.every(function(n){return "number"===n;});return "string"!==c&&e&&!p?E(b):function(){return aa(b,c,h,arguments);};};var Y;S=function ia(){Y||Z();Y||(S=ia);};function Z(){function b(){if(!Y&&(Y=true,a.calledRun=true,!C)){W(N);q(a);if(a.onRuntimeInitialized)a.onRuntimeInitialized();if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var c=a.postRun.shift();O.unshift(c);}W(O);}}if(!(0<P)){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)ba();W(M);0<P||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("");},1);b();},1)):b());}}a.run=Z;if(a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();Z();return ZD.ready;};}();

  var ZSTDMachineType=null;// DEV: zstddec.js has been compiled with `-s EXPORT_NAME="ZD" -s MODULARIZE=1` to avoid a clash with xzdec.js
  // For explanation of loading method below to avoid conflicts, see https://github.com/emscripten-core/emscripten/blob/master/src/settings.js
  /**
   * @typedef EMSInstanceExt An object type representing an Emscripten instance with extended properties
   * @property {Integer} _decHandle The decoder stream context object in asm memory (to be re-used for each decoder operation)
   * @property {Object} _inBuffer A JS copy of the inBuffer structure to be set in asm memory (malloc)
   * @property {Object} _outBuffer A JS copy of the outBuffer structure to be set in asm memory (malloc)
   * @property {Integer} _chunkSize The number of compressed bytes to feed to the decompressor in any one read loop
   *//**
   * The ZSTD Decoder instance
   * @type EMSInstanceExt
   */var zd;var instantiateDecoder=function instantiateDecoder(instance){// Instantiate the zd object
  zd=instance;// Create JS API by wrapping C++ functions
  // DEV: Functions with simple types (integers, pointers) do not need to be wrapped
  zd.getErrorString=zd.cwrap('ZSTD_getErrorName','string',['number']);// Get a permanent decoder handle (pointer to control structure)
  // NB there is no need to change this handle even between ZIM loads: zstddeclib encourages re-using assigned structures
  zd._decHandle=zd._ZSTD_createDStream();// In-built function below provides a max recommended chunk size 
  zd._chunkSize=zd._ZSTD_DStreamInSize();// Change _chunkSize if you need a more conservative memory environment, but you may need to experiment with INITIAL_MEMORY
  // in zstddec.js (see below) for this to make any difference
  // zd._chunkSize = 5 * 1024;
  // Initialize inBuffer
  zd._inBuffer={ptr:null,/* pointer to this inBuffer structure in w/asm memory */src:null,/* void* src   < start of input buffer */size:zd._chunkSize,/* size_t size < size of input buffer */pos:0/* size_t pos; < position where reading stopped. Will be updated. Necessarily 0 <= pos <= size */};// Reserve w/asm memory for the inBuffer structure (we will populate assigned memory later)
  zd._inBuffer.ptr=mallocOrDie(3<<2);// 3 x 32bit bytes
  // Reserve w/asm memory for the inBuffer data stream
  zd._inBuffer.src=mallocOrDie(zd._inBuffer.size);// DEV: Size of outBuffer is currently set as recommended by zd._ZSTD_DStreamOutSize() below; if you are running into
  // memory issues, it may be possible to reduce memory consumption by setting a smaller outBuffer size here and
  // reompiling zstddec.js with lower TOTAL_MEMORY (or just search for INITIAL_MEMORY in zstddec.js and change it)
  var outBufSize=zd._ZSTD_DStreamOutSize();// Initialize outBuffer
  zd._outBuffer={ptr:null,/* pointer to this outBuffer structure in asm/wasm memory */dst:null,/* void* dst   < start of output buffer (pointer) */size:outBufSize,/* size_t size < size of output buffer */pos:0/* size_t pos  < position where writing stopped. Will be updated. Necessarily 0 <= pos <= size */};// Reserve w/asm memory for the outBuffer structure
  zd._outBuffer.ptr=mallocOrDie(3<<2);// 3 x 32bit bytes
  // Reserve w/asm memory for the outBuffer data steam
  zd._outBuffer.dst=mallocOrDie(zd._outBuffer.size);};// Select asm or wasm conditionally
  if('WebAssembly'in self){console.debug('Instantiating WASM zstandard decoder');ZSTDMachineType='WASM';}else {console.debug('Instantiating ASM zstandard decoder');ZSTDMachineType='ASM';}var loadASM=function loadASM(){ZD$1().then(function(inst){params.decompressorAPI.assemblerMachineType=ZSTDMachineType;instantiateDecoder(inst);}).catch(function(err){uiUtil.reportAssemblerErrorToAPIStatusPanel('ZSTD',err,ZSTDMachineType);});};if(ZSTDMachineType==='WASM'){ZD().then(function(inst){params.decompressorAPI.assemblerMachineType=ZSTDMachineType;instantiateDecoder(inst);}).catch(function(err){ZSTDMachineType='ASM';loadASM();});}else {loadASM();}/**
   * Number of milliseconds to wait for the decompressor to be available for another chunk
   * @type Integer
   */var DELAY_WAITING_IDLE_DECOMPRESSOR=50;/**
   * Is the decompressor already working?
   * @type Boolean
   */var busy=false;/**
   * @typedef Decompressor
   * @property {FileReader} _reader The filereader to use (uses plain blob reader defined in zimfile.js)
   * @property {Integer} _inStreamPos The current known position in the steam of compressed bytes 
   * @property {Integer} _inStreamChunkedPos The position once the currently loaded chunk will have been consumed
   * @property {Integer} _outStreamPos The position in the decoded byte stream (offset from start of cluster)
   * @property {Array} _outDataBuf The buffer that stores decoded bytes (it is set to the requested blob's length, and when full, the data are returned)
   * @property {Integer} _outDataBufPos The number of bytes of the requested blob decoded so far
   *//**
   * @constructor
   * @param {FileReader} reader The reader used to extract file slices (defined in zimfile.js)
   */function Decompressor(reader){params.decompressorAPI.decompressorLastUsed='ZSTD';this._reader=reader;}/**
   * Set up the decompression stream, and initiate a read loop to decompress from the beginning of the cluster
   * until we reach <offset> in the decompressed byte stream
   * @param {Integer} offset Cluster offset (in decompressed stream) from which to start reading
   * @param {Integer} length Number of decompressed bytes to read
   * @returns {Promise<ArrayBuffer>} Promise for an ArrayBuffer with decoded data
   */Decompressor.prototype.readSlice=function(offset,length){busy=true;this._inStreamPos=0;this._inStreamChunkedPos=0;this._outStreamPos=0;this._outDataBuf=new Int8Array(new ArrayBuffer(length));this._outDataBufPos=0;var ret=zd._ZSTD_initDStream(zd._decHandle);if(zd._ZSTD_isError(ret)){return Promise.reject('Failed to initialize ZSTD decompression');}return this._readLoop(offset,length).then(function(data){// DEV: We are re-using all the allocated w/asm memory, so we do not need to free any of structures assigned wiht _malloc
  // However, should you need to free assigned structures use, e.g., zd._free(zd._inBuffer.src);
  // Additionally, freeing zd._decHandle is not needed, and actually increases memory consumption (crashing zstddeclib)
  // Should you need to free the decoder stream handle, use command below, but be sure to create a new stream control object
  // before attempting further decompression
  // zd._ZSTD_freeDStream(zd._decHandle);
  busy=false;return data;});};/**
   * This function ensures that only one decompression runs at a time, launching readSlice() only when
   * the decompressor is no longer busy
   * @param {Integer} offset The cluster offset (in decompressed stream) at which the requested blob resides
   * @param {Integer} length The number of decompressed bytes to read
   * @returns {Promise} A Promise for the readSlice() function
   */Decompressor.prototype.readSliceSingleThread=function(offset,length){// Tests whether the decompressor is ready (initiated) and not busy
  if(zd&&!busy){return this.readSlice(offset,length);}else {// The decompressor is already in progress.
  // To avoid using too much memory, we wait until it has finished
  // before using it for another decompression
  var that=this;return new Promise(function(resolve,reject){setTimeout(function(){that.readSliceSingleThread(offset,length).then(resolve,reject);},DELAY_WAITING_IDLE_DECOMPRESSOR);});}};/**
   * The main loop for sending compressed data to the decompressor and retrieving decompressed bytes
   * Consecutive calls to readLoop may only advance in the stream and may not overlap
   * @param {Integer} offset The offset in the *decompressed* byte stream at which the requested blob resides
   * @returns {Promise<Int8Array>} A Promise for an Int8Array containing the requested blob's decompressed bytes
   */Decompressor.prototype._readLoop=function(offset){var that=this;return this._fillInBuffer().then(function(){var finished=false;var ret=zd._ZSTD_decompressStream(zd._decHandle,zd._outBuffer.ptr,zd._inBuffer.ptr);if(zd._ZSTD_isError(ret)){var errorMessage="Failed to decompress data stream!\n"+zd.getErrorString(ret);return Promise.reject(errorMessage);}// Get updated outbuffer values
  var obxPtr32Bit=zd._outBuffer.ptr>>2;var outPos=zd.HEAP32[obxPtr32Bit+2];// If data have been decompressed, check to see whether the data are in the offset range we need
  if(outPos>0&&that._outStreamPos+outPos>=offset){var copyStart=offset-that._outStreamPos;if(copyStart<0)copyStart=0;for(var i=copyStart;i<outPos&&that._outDataBufPos<that._outDataBuf.length;i++)that._outDataBuf[that._outDataBufPos++]=zd.HEAP8[zd._outBuffer.dst+i];}if(that._outDataBufPos===that._outDataBuf.length)finished=true;// Return without further processing if decompressor has finished
  if(finished)return that._outDataBuf;// Get updated inbuffer values for processing on the JS sice
  // NB the zd.Decoder will read these values from its own buffers
  var ibxPtr32Bit=zd._inBuffer.ptr>>2;zd._inBuffer.pos=zd.HEAP32[ibxPtr32Bit+2];// Increment the byte stream positions
  that._inStreamPos+=zd._inBuffer.pos;that._outStreamPos+=outPos;// DEV: if outPos is > 0, then we have either copied all data from outBuffer, or we can now throw those data away
  // because they are before our required offset
  // Se we can now reset the asm outBuffer.pos field to 0
  // Testing outPos is not strictly necessary, but there may be an overhead in writing to HEAP32
  if(!outPos)zd.HEAP32[obxPtr32Bit+2]=0;return that._readLoop(offset);}).catch(function(err){console.error(err);});};/**
   * Fills in the instream buffer
   * @returns {Promise<0>} A Promise for 0 when all data have been added to the stream
   */Decompressor.prototype._fillInBuffer=function(){var that=this;return this._reader(this._inStreamPos,zd._chunkSize).then(function(data){// Populate inBuffer and assign asm/wasm memory if not already assigned
  zd._inBuffer.size=data.length;// Reset inBuffer
  zd._inBuffer.pos=0;var inBufferStruct=new Int32Array([zd._inBuffer.src,zd._inBuffer.size,zd._inBuffer.pos]);// Write inBuffer structure to previously assigned w/asm memory
  zd.HEAP32.set(inBufferStruct,zd._inBuffer.ptr>>2);var outBufferStruct=new Int32Array([zd._outBuffer.dst,zd._outBuffer.size,zd._outBuffer.pos]);// Write outBuffer structure to w/asm memory
  zd.HEAP32.set(outBufferStruct,zd._outBuffer.ptr>>2);// Transfer the (new) data to be read to the inBuffer
  zd.HEAPU8.set(data,zd._inBuffer.src);that._inStreamChunkedPos+=data.length;return 0;});};/**
   * Provision asm/wasm data block and get a pointer to the assigned location
   * Code used from excellent WASM tutorial here: https://marcoselvatici.github.io/WASM_tutorial/
   * @param {Integer} sizeOfData The number of bytes to be allocated
   * @returns {Integer} Pointer to the assigned data block
   */function mallocOrDie(sizeOfData){var dataPointer=zd._malloc(sizeOfData);if(dataPointer===0){// error allocating memory
  var errorMessage='Failed allocation of '+sizeOfData+' bytes.';console.error(errorMessage);throw new Error(errorMessage);}return dataPointer;}var zstd = {Decompressor:Decompressor};

  var utf8={};/**
   * Convert a String into a byte Array, with UTF8 encoding
   * @param {String} str
   * @returns {Array}
   */utf8.toByteArray=function(str){var byteArray=[];for(var i=0;i<str.length;i++){if(str.charCodeAt(i)<=0x7F){byteArray.push(str.charCodeAt(i));}else {var h=encodeURIComponent(str.charAt(i)).substr(1).split('%');for(var j=0;j<h.length;j++){byteArray.push(parseInt(h[j],16));}}}return byteArray;};/**
   * Convert a byte Array into a String, with UTF8 encoding
   * @param {Array} data
   * @param {Boolean} zeroTerminated
   * @returns {String}
   */utf8.parse=function(data,zeroTerminated){var u0,u1,u2,u3,u4,u5;var str='';for(var idx=0;idx<data.length;){u0=data[idx++];if(u0===0&&zeroTerminated){break;}if(!(u0&0x80)){str+=String.fromCharCode(u0);continue;}u1=data[idx++]&63;if((u0&0xe0)==0xc0){str+=String.fromCharCode((u0&31)<<6|u1);continue;}u2=data[idx++]&63;if((u0&0xf0)==0xe0){u0=(u0&15)<<12|u1<<6|u2;}else {u3=data[idx++]&63;if((u0&0xF8)==0xF0){u0=(u0&7)<<18|u1<<12|u2<<6|u3;}else {u4=data[idx++]&63;if((u0&0xFC)==0xF8){u0=(u0&3)<<24|u1<<18|u2<<12|u3<<6|u4;}else {u5=data[idx++]&63;u0=(u0&1)<<30|u1<<24|u2<<18|u3<<12|u4<<6|u5;}}}if(u0<0x10000){str+=String.fromCharCode(u0);}else {var ch=u0-0x10000;str+=String.fromCharCode(0xD800|ch>>10,0xDC00|ch&0x3FF);}}return str;};var utf8$1 = {toByteArray:utf8.toByteArray,parse:utf8.parse};

  function DirEntry(zimfile,dirEntryData){this._zimfile=zimfile;this.redirect=dirEntryData.redirect;this.offset=dirEntryData.offset;this.mimetypeInteger=dirEntryData.mimetypeInteger;this.namespace=dirEntryData.namespace;this.redirectTarget=dirEntryData.redirectTarget;this.cluster=dirEntryData.cluster;this.blob=dirEntryData.blob;this.url=dirEntryData.url;this.title=dirEntryData.title;this.fromArticleList=dirEntryData.fromArticleList||false;}/**
   * Serialize some attributes of a DirEntry, to be able to store them in a HTML tag attribute,
   * and retrieve them later.
   *
   * @returns {String}
   */DirEntry.prototype.toStringId=function(){return this.offset+'|'+this.mimetypeInteger+'|'+this.namespace+'|'+this.cluster+'|'+this.blob+'|'+this.url+'|'+this.title+'|'+this.redirect+'|'+this.redirectTarget;};/**
   *
   * @returns {Boolean}
   */DirEntry.prototype.isRedirect=function(){return this.redirect;};/**
   *
   * @returns {Promise}
   */DirEntry.prototype.readData=function(){return this._zimfile.blob(this.cluster,this.blob);};/**
   *
   * @param {File} zimfile
   * @param {String} stringId
   * @returns {DirEntry}
   */DirEntry.fromStringId=function(zimfile,stringId){var data={};var idParts=stringId.split('|');data.offset=parseInt(idParts[0],10);data.mimetypeInteger=parseInt(idParts[1],10);data.namespace=idParts[2];data.cluster=parseInt(idParts[3],10);data.blob=parseInt(idParts[4],10);data.url=idParts[5];data.title=idParts[6];data.redirect=idParts[7]==='true';data.redirectTarget=idParts[8];data.fromArticleList=true;return new DirEntry(zimfile,data);};/**
   * Defines a function that returns the URL if the title is empty, as per the specification
   * See https://wiki.openzim.org/wiki/ZIM_file_format#Directory_Entries
   *
   * @returns {String} The dirEntry's title or, if empty, the dirEntry's (unescaped) URL
   */DirEntry.prototype.getTitleOrUrl=function(){return this.title?this.title:this.url;};/**
   * Looks up the dirEntry's mimetype number in the ZIM file's MIME type list, and returns the corresponding MIME type
   *
   * @return {String} The MIME type corresponding to mimetypeInteger in the ZIM file's MIME type list
   */DirEntry.prototype.getMimetype=function(){return this._zimfile.mimeTypes.get(this.mimetypeInteger);};var zimDirEntry = {DirEntry:DirEntry};

  var MAX_CACHE_SIZE=4000;/**
   * The maximum blocksize to read or store via the block cache (bytes)
   * @constant
   * @type {Number}
   */var BLOCK_SIZE=4096;/**
   * A Block Cache employing a Least Recently Used caching strategy
   * @typedef {Object} BlockCache
   * @property {Number} capacity The maximum number of entries in the cache
   * @property {Map} cache A map to store the cache keys and data
   *//**
   * Creates a new cache with max size limit of MAX_CACHE_SIZE blocks
   * LRUCache implemnentation with Map adapted from https://markmurray.co/blog/lru-cache/
   */function LRUCache(){/** CACHE TUNING **/// console.log('Creating cache of size ' + MAX_CACHE_SIZE + ' * ' + BLOCK_SIZE + ' bytes');
  // Initialize persistent Cache properties
  this.capacity=MAX_CACHE_SIZE;this.cache=new Map();}/**
   * Tries to retrieve an element by its id. If it is not present in the cache, returns undefined; if it is present,
   * then the value is returned and the entry is moved to the bottom of the cache
   * @param {String} key The block cache entry key (file.id + ':' + byte offset)
   * @returns {Uint8Array | undefined} The requested cache data or undefined
   */LRUCache.prototype.get=function(key){var entry=this.cache.get(key);// If the key does not exist, return
  if(!entry)return entry;// Remove the key and re-insert it (this moves the key to the bottom of the Map: bottom = most recent)
  this.cache.delete(key);this.cache.set(key,entry);// Return the cached data
  return entry;};/**
   * Stores a value in the cache by id and prunes the least recently used entry if the cache is larger than MAX_CACHE_SIZE
   * @param {String} key The key under which to store the value (file.id + ':' + byte offset from start of ZIM archive)
   * @param {Uint8Array} value The value to store in the cache
   */LRUCache.prototype.store=function(key,value){// We get the existing entry's object for memory-management purposes; if it exists, it will contain identical data
  // to <value>, but <entry> is strongly referenced by the Map. (It should be rare that two async Promises attempt to
  // store the same data in the Cache, once the Cache is sufficiently populated.)
  var entry=this.cache.get(key);// If the key already exists, delete it and re-insert it, so that it will be added
  // to the bottom of the Map (bottom = most recent)
  if(entry)this.cache.delete(key);else entry=value;this.cache.set(key,entry);// If we've exceeded the cache capacity, then delete the least recently accessed value,
  // which will be the item at the top of the Map, i.e the first position
  if(this.cache.size>this.capacity){if(this.cache.keys){var firstKey=this.cache.keys().next().value;this.cache.delete(firstKey);}else {// IE11 doesn't support the keys iterator, so we have to do a forEach loop through all 4000 entries
  // to get the oldest values. To prevent excessive iterations, we delete 25% at a time.
  var q=Math.floor(0.25*this.capacity);var c=0;// console.log('Deleteing ' + q + ' cache entries');
  this.cache.forEach(function(v,k,map){if(c>q)return;map.delete(k);c++;});}}};/**
   * A new Block Cache
   * @type {BlockCache}
   */var cache$1=new LRUCache();/** CACHE TUNING **/// DEV: Uncomment this block and blocks below marked 'CACHE TUNING' to measure Cache hit and miss rates for different Cache sizes
  // var hits = 0;
  // var misses = 0;
  /**
   * Read a certain byte range in the given file, breaking the range into chunks that go through the cache
   * If a read of more than BLOCK_SIZE * 2 (bytes) is requested, do not use the cache
   * @param {Object} file The requested ZIM archive to read from
   * @param {Number} begin The byte from which to start reading
   * @param {Number} end The byte at which to stop reading (end will not be read)
   * @return {Promise<Uint8Array>} A Promise that resolves to the correctly concatenated data from the cache
   *     or from the ZIM archive
   */var read=function read(file,begin,end){// Read large chunks bypassing the block cache because we would have to
  // stitch together too many blocks and would clog the cache
  if(end-begin>BLOCK_SIZE*2)return file._readSplitSlice(begin,end);var readRequests=[];var blocks={};// Look for the requested data in the blocks: we may need to stitch together data from two or more blocks
  for(var id=Math.floor(begin/BLOCK_SIZE)*BLOCK_SIZE;id<end;id+=BLOCK_SIZE){var block=cache$1.get(file.id+':'+id);if(block===undefined){// Data not in cache, so read from archive
  /** CACHE TUNING **/// misses++;
  // DEV: This is a self-calling function, i.e. the function is called with an argument of <id> which then
  // becomes the <offset> parameter
  readRequests.push(function(offset){return file._readSplitSlice(offset,offset+BLOCK_SIZE).then(function(result){cache$1.store(file.id+':'+offset,result);blocks[offset]=result;});}(id));}else {/** CACHE TUNING **/// hits++;
  blocks[id]=block;}}/** CACHE TUNING **/// if (misses + hits > 2000) {
  //     console.log('** Block cache hit rate: ' + Math.round(hits / (hits + misses) * 1000) / 10 + '% [ hits:' + hits +
  //         ' / misses:' + misses + ' ] Size: ' + cache.cache.size);
  //     hits = 0;
  //     misses = 0;
  // }
  // Wait for all the blocks to be read either from the cache or from the archive
  return Promise.all(readRequests).then(function(){var result=new Uint8Array(end-begin);var pos=0;// Stitch together the data parts in the right order
  for(var i=Math.floor(begin/BLOCK_SIZE)*BLOCK_SIZE;i<end;i+=BLOCK_SIZE){var b=Math.max(i,begin)-i;var e=Math.min(end,i+BLOCK_SIZE)-i;if(blocks[i].subarray)result.set(blocks[i].subarray(b,e),pos);pos+=e-b;}return result;});};var FileCache = {read:read};

  /**
   * This code makes an assumption that no Directory Entry will be larger that MAX_SUPPORTED_DIRENTRY_SIZE bytes.
   * If a larger dirEntry is encountered, a warning will display in console. Increase this value if necessary.
   * See https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers to understand
   * why 5120 has been chosen here (maximum that IE11 can deal with in code).
   */var MAX_SUPPORTED_DIRENTRY_SIZE=5120;/**
   * Add Polyfill currently required by IE11 to run zstddec-asm and xzdec-asm
   * See https://github.com/emscripten-core/emscripten/issues/14700
   * If this is resolved upstream, remove this polyfill
   * Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith
   */if(!String.prototype.startsWith){Object.defineProperty(String.prototype,'startsWith',{value:function value(search,rawPos){var pos=rawPos>0?rawPos|0:0;return this.substring(pos,pos+search.length)===search;}});}/**
   * A global variable to track the assembler machine type and the last used decompressor (for reporting to the API panel)
   * This is populated in the Emscripten wrappers
   * @type {Object}
   * @property {String} assemblerMachineType The assembler machine type supported and/or loaded by this app: 'ASM' or 'WASM'
   * @property {String} decompressorLastUsed The decompressor that was last used to decode a compressed cluster (currently 'XZ' or 'ZSTD')
   * @property {String} errorStatus A description of any detected error in loading a decompressor
   */params.decompressorAPI={assemblerMachineType:null,decompressorLastUsed:null,errorStatus:null};/**
   * A variable to keep track of the currently loaded ZIM archive, e.g., for labelling cache entries
   * The ID is temporary and is reset to a random number at each session start; it is incremented by 1 each time a new ZIM is loaded
   * It allows for up to 10,000 distinct ZIM archives to be loaded in any one session
   * @type {Integer}
   */var tempFileId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER/10000);/**
   * A Map to keep track of temporary File IDs
   * @type {Map}
   */var fileIDs=new Map();var readInt=function readInt(data,offset,size){var r=0;for(var i=0;i<size;i++){var c=data[offset+i]+256&0xff;r+=util.leftShift(c,8*i);}return r;};/**
   * A ZIM File
   *
   * See https://wiki.openzim.org/wiki/ZIM_file_format#Header
   * Some properties below are extended and are not part of the official OpenZIM specification
   *
   * @typedef {Object} ZIMFile
   * @property {Array<File>} _files Array of ZIM files
   * @property {String} name Abstract archive name for file set
   * @property {Integer} id Arbitrary numeric ZIM id used to track the currently loaded archive
   * @property {Integer} entryCount Total number of entries in the URL pointerlist
   * @property {Integer} articleCount Total number of article titles in the v1 article-only pointerlist (async calculated entry)
   * @property {Integer} clusterCount Total number of clusters
   * @property {Integer} urlPtrPos Position of the directory pointerlist ordered by URL
   * @property {Integer} titlePtrPos Position of the legacy v0 pointerlist ordered by title
   * @property {Integer} articlePtrPos Position of the v1 article-only pointerlist ordered by title (async calculated entry)
   * @property {Integer|String} fullTextIndex Extended property: position of the full text index, or its path if it exists but has no metadata
   * @property {Integer} fullTextIndexSize Extended property: the size of the full text index as indicated in the metadata, or null if not specified
   * @property {Integer} clusterPtrPos Position of the cluster pointer list
   * @property {Integer} mimeListPos Position of the MIME type list (also header size)
   * @property {Integer} mainPage Main page or 0xffffffff if no main page
   * @property {Integer} layoutPage Layout page or 0xffffffffff if no layout page
   * @property {Map} mimeTypes Extended property: the ZIM file's MIME type table rendered as a Map (calculated entry)
   *//**
   * Abstract an array of one or more (split) ZIM archives
   * @param {Array<File>} abstractFileArray An array of ZIM file parts
   */function ZIMFile(abstractFileArray){this._files=abstractFileArray;}/**
   * Read and decode an integer value from the ZIM archive
   * @param {Integer} offset The offset at which the integer is found
   * @param {Integer} size The size of data to read
   * @returns {Promise<Integer>} A Promise for the returned value
   */ZIMFile.prototype._readInteger=function(offset,size){return this._readSlice(offset,size).then(function(data){return readInt(data,0,size);});};/**
   * Read a slice from the FileCache or ZIM set, starting at offset for size of bytes
   * @param {Integer} offset The absolute offset from the start of the ZIM file or file set at which to start reading
   * @param {Integer} size The number of bytes to read
   * @returns {Promise<Uint8Array>} A Promise for a Uint8Array containing the requested data
   */ZIMFile.prototype._readSlice=function(offset,size){return FileCache.read(this,offset,offset+size);};/**
   * Read a slice from a set of one or more ZIM files constituting a single archive, and concatenate the data parts
   * @param {Integer} begin The absolute byte offset from which to start reading
   * @param {Integer} end The absolute byte offset where reading should stop (the end byte is not read)
   * @returns {Promise<Uint8Array>} A Promise for a Uint8Array containing the concatenated data
   */ZIMFile.prototype._readSplitSlice=function(begin,end){var file=this;var readRequests=[];var currentOffset=0;for(var i=0;i<file._files.length;currentOffset+=file._files[i].size,++i){var currentSize=file._files[i].size;if(begin<currentOffset+currentSize&&currentOffset<end){// DEV: Math.max is used below because we could be reading the last part of a blob split across two files,
  // in which case (begin - currentOffset) could be negative!
  var readStart=Math.max(0,begin-currentOffset);var readEnd=Math.min(currentSize,end-currentOffset);readRequests.push(util.readFileSlice(file._files[i],readStart,readEnd));}}if(readRequests.length===0){return Promise.resolve(new Uint8Array(0).buffer);}else if(readRequests.length===1){return readRequests[0];}else {// Wait until all are resolved and concatenate.
  return Promise.all(readRequests).then(function(arrays){var concatenated=new Uint8Array(end-begin);var offset=0;arrays.forEach(function(item){concatenated.set(new Uint8Array(item),offset);offset+=item.byteLength;});return concatenated;});}};/**
   * Read and parse a Directory Entry at the given archive offset
   * @param {Integer} offset The offset at which the DirEntry is located
   * @returns {Promise<DirEntry>} A Promise for the requested DirEntry
   */ZIMFile.prototype.dirEntry=function(offset){var that=this;return this._readSlice(offset,MAX_SUPPORTED_DIRENTRY_SIZE).then(function(data){var dirEntry={offset:offset,mimetypeInteger:readInt(data,0,2),namespace:String.fromCharCode(data[3])};dirEntry.redirect=dirEntry.mimetypeInteger===0xffff;if(dirEntry.redirect){dirEntry.redirectTarget=readInt(data,8,4);}else {dirEntry.cluster=readInt(data,8,4);dirEntry.blob=readInt(data,12,4);}var pos=dirEntry.redirect?12:16;if(data.subarray){dirEntry.url=utf8$1.parse(data.subarray(pos),true);for(pos;pos<=MAX_SUPPORTED_DIRENTRY_SIZE;pos++){if(data[pos]===0)break;}if(data[pos]===0){dirEntry.title=utf8$1.parse(data.subarray(pos+1),true);}else {// DEV: If you encounter this warning in console, it means that a very large dirEntry.url has exceeded the maximum supported
  // dirEntry size. Consider increasing MAX_SUPPORTED_DIRENTRY_SIZE if such warnings are encountered regularly with a ZIM.
  console.warn('WARNING! A Directory Entry URL larger than '+MAX_SUPPORTED_DIRENTRY_SIZE+' bytes was encountered! '+'The dirEntry.url is likely to be invalid.',dirEntry.url);}return new zimDirEntry.DirEntry(that,dirEntry);}});};/**
   * Find a Directory Entry based on its URL Pointer index
   * @param {Integer} index The URL Pointer index to the DirEntry
   * @returns {Promise<DirEntry>} A Promise for the requested DirEntry
   */ZIMFile.prototype.dirEntryByUrlIndex=function(index){var that=this||appstate.selectedArchive.file;return that._readInteger(that.urlPtrPos+index*8,8).then(function(dirEntryPos){return that.dirEntry(dirEntryPos);});};/**
   * Find a Directory Entry based on its Title Pointer index
   * @param {Integer} index The Title Pointer index to the DirEntry
   * @returns {Promise<DirEntry>} A Promise for the requested DirEntry
   */ZIMFile.prototype.dirEntryByTitleIndex=function(index){var that=this||appstate.selectedArchive.file;// Use v1 title pointerlist if available, or fall back to legacy v0 list
  var ptrList=that.articlePtrPos||that.titlePtrPos;return that._readInteger(ptrList+index*4,4).then(function(urlIndex){return that.dirEntryByUrlIndex(urlIndex);});};/**
   * Read and if necessary decompress a BLOB based on its cluster number and blob number
   * @param {Integer} cluster The cluster number where the blob is to be found
   * @param {Integer} blob The blob number within the cluster
   * @param {Boolean} meta If true, and if the cluster is uncompressed, the function will return only the blob's metadata
   *        (its archive offset and its size), otherwise return null
   * @returns {Promise<Uint8Array>} A Promise for the BLOB's data
   */ZIMFile.prototype.blob=function(cluster,blob,meta){var that=this;return this._readSlice(this.clusterPtrPos+cluster*8,16).then(function(clusterOffsets){var clusterOffset=readInt(clusterOffsets,0,8);var nextCluster=readInt(clusterOffsets,8,8);// DEV: The method below of calculating cluster size is not safe: see https://github.com/openzim/libzim/issues/84#issuecomment-612962250
  // var thisClusterLength = nextCluster - clusterOffset - 1;
  return that._readSlice(clusterOffset,1).then(function(compressionType){var decompressor;var plainBlobReader=function plainBlobReader(offset,size,dataPass){// Check that we are not reading beyond the end of the cluster
  var offsetStart=clusterOffset+1+offset;if(offsetStart<nextCluster){// Gratuitous parentheses added for legibility
  size=offsetStart+size<=nextCluster?size:nextCluster-offsetStart;// DEV: This blob reader is called twice: on the first pass it reads the cluster's blob list,
  // and on the second pass ("dataPass") it is ready to read the blob's data
  if(meta&&dataPass){// If only metadata were requested and we are on the data pass, we should now have them
  return {ptr:offsetStart,size:size};}else {return that._readSlice(offsetStart,size);}}else {return Promise.resolve(new Uint8Array(0).buffer);}};// If only metadata were requested and the cluster is compressed, return null (this is probably a ZIM format error)
  // DEV: This is because metadata are only requested for finding absolute offsets into uncompressed clusters,
  // principally for finding the start and size of a title pointer listing
  if(meta&&compressionType[0]>1)return null;if(compressionType[0]===0||compressionType[0]===1){// uncompressed
  decompressor={readSliceSingleThread:plainBlobReader};}else if(compressionType[0]===4){decompressor=new xz.Decompressor(plainBlobReader);}else if(compressionType[0]===5){decompressor=new zstd.Decompressor(plainBlobReader);}else {return new Uint8Array();// unsupported compression type
  }return decompressor.readSliceSingleThread(blob*4,8,false).then(function(data){var blobOffset=readInt(data,0,4);var nextBlobOffset=readInt(data,4,4);return decompressor.readSliceSingleThread(blobOffset,nextBlobOffset-blobOffset,true);});});});};/**
   * A Directory Listing object
   * @typedef {Object} DirListing A list of pointers to directory entries (via the URL pointerlist)
   * @property {String} path The path (url) to the directory entry for the Listing
   * @property {String} ptrName The name of the pointer to the Listing's data that will be added to the ZIMFile obect
   * @property {String} countName The name of the key that will contain the number of entries in the Listing, to be added to the ZIMFile object
   *//**
   * Read the metadata (archive offset pointer, and number of entiries) of one or more ZIM directory Listings.
   * This supports reading a subset of user content that might be ordered differently from the main URL pointerlist.
   * In particular, it supports the v1 article pointerlist, which contains articles sorted by title, superseding the article
   * namespace ('A') in legazy ZIM archives.
   * @param {Array<DirListing>} listings An array of DirListing objects (see zimArchive.js for examples)
   * @returns {Promise} A promise that populates calculated entries in the ZIM file header
   */ZIMFile.prototype.setListings=function(listings){var that=this;// If we are in a legacy ZIM archive, we need to calculate the true article count (of entries in the A namespace)
  // This effectively emulates the v1 article pointerlist
  if(this.minorVersion===0){// Initiate a binary search for the first or last article
  var getArticleIndexByOrdinal=function getArticleIndexByOrdinal(ordinal){return util.binarySearch(0,that.entryCount,function(i){return that.dirEntryByTitleIndex(i).then(function(dirEntry){var ns=dirEntry.namespace;var url=ns+'/'+dirEntry.getTitleOrUrl();var prefix=ordinal==='first'?'A':'B';if(prefix<ns)return  -1;else if(prefix>ns)return 1;return prefix<url?-1:1;});},true).then(function(index){return index;});};getArticleIndexByOrdinal('first').then(function(idxFirstArticle){return getArticleIndexByOrdinal('last').then(function(idxLastArticle){// Technically idxLastArticle points to the entry after the last article in the 'A' namespace,
  // We subtract the first from the last to get the number of entries in the 'A' namespace
  that.articlePtrPos=that.titlePtrPos+idxFirstArticle*4;that.articleCount=idxLastArticle-idxFirstArticle;console.debug('Calculated article count is: '+that.articleCount);});});}var highestListingVersion=0;var _listingAccessor=function listingAccessor(listing){if(!listing){// No more listings, so exit
  console.debug('ZIM DirListing version: '+highestListingVersion+(highestListingVersion?'':' (legacy)'),that);console.debug('Article count is: '+that.articleCount);if(that.fullTextIndex)console.debug('ZIM has fullTextIndex with listed size: '+that.fullTextIndexSize);return null;}// Check if we already have this listing's values, so we don't do redundant binary searches
  if(that[listing.ptrName]&&that[listing.countName]){highestListingVersion=Math.max(~~listing.path.replace(/.+(\d)$/,'$1'),highestListingVersion);// Get the next listing
  return _listingAccessor(listings.pop());}// Initiate a binary search for the listing URL
  return util.binarySearch(0,that.entryCount,function(i){return that.dirEntryByUrlIndex(i).then(function(dirEntry){var url=dirEntry.namespace+'/'+dirEntry.url;if(listing.path<url){return  -1;}else if(listing.path>url){return 1;}else {return 0;}});}).then(function(index){if(index===null)return null;return that.dirEntryByUrlIndex(index);}).then(function(dirEntry){if(!dirEntry)return null;// Detect a full text index
  if(/fulltext\//.test(dirEntry.url)){that[listing.ptrName]=dirEntry.namespace+'/'+dirEntry.url;}// Request the metadata for the blob represented by the dirEntry
  return that.blob(dirEntry.cluster,dirEntry.blob,true);}).then(function(metadata){// Note that we do not accept a listing if its size is 0, i.e. if it contains no data
  // (although this should not occur, we have been asked to handle it - see kiwix-js #708)
  if(metadata&&metadata.size){that[listing.ptrName]=metadata.ptr;that[listing.countName]=metadata.size/4;// Each entry uses 4 bytes
  highestListingVersion=Math.max(~~listing.path.replace(/.+(\d)$/,'$1'),highestListingVersion);}// Get the next Listing
  return _listingAccessor(listings.pop());}).catch(function(err){console.warn('There was an error accessing a Directory Listing',err);});};return _listingAccessor(listings.pop());};/**
   * Reads the whole MIME type list and returns it as a populated Map
   * The mimeTypeMap is extracted once after the user has picked the ZIM file
   * and is stored as ZIMFile.mimeTypes
   * @param {File} file The ZIM file (or first file in array of files) from which the MIME type list
   *      is to be extracted
   * @param {Integer} mimeListPos The offset in <file> at which the MIME type list is found
   * @param {Integer} urlPtrPos The offset of URL Pointer List in the archive
   * @returns {Promise} A promise for the MIME Type list as a Map
   */function readMimetypeMap(file,mimeListPos,urlPtrPos){var typeMap=new Map();var size=urlPtrPos-mimeListPos;// ZIM archives produced since May 2020 relocate the URL Pointer List to the end of the archive
  // so we limit the slice size to max 1024 bytes in order to prevent reading the entire archive into an array buffer
  // See https://github.com/openzim/libzim/issues/353
  size=size>1024?1024:size;return util.readFileSlice(file,mimeListPos,mimeListPos+size).then(function(data){if(data.subarray){var i=0;var pos=-1;var mimeString;while(pos<size){pos++;mimeString=utf8$1.parse(data.subarray(pos),true);// If the parsed data is an empty string, we have reached the end of the MIME type list, so break
  if(!mimeString)break;// Store the parsed string in the Map
  typeMap.set(i,mimeString);i++;while(data[pos]){pos++;}}}return typeMap;}).catch(function(err){console.error('Unable to read MIME type list',err);return new Map();});}var zimfile = {/**
       * @param {Array<File>} fileArray An array of picked archive files
       * @returns {Promise<Object>} A Promise for the ZimFile Object
       */fromFileArray:function fromFileArray(fileArray){// Array of blob objects should be sorted by their name property
  fileArray.sort(function(a,b){var nameA=a.name.toUpperCase();var nameB=b.name.toUpperCase();if(nameA<nameB)return  -1;if(nameA>nameB)return 1;return 0;});return util.readFileSlice(fileArray[0],0,80).then(function(header){var mimeListPos=readInt(header,56,8);var urlPtrPos=readInt(header,32,8);return readMimetypeMap(fileArray[0],mimeListPos,urlPtrPos).then(function(mapData){var zf=new ZIMFile(fileArray);// Add an abstract archive name (ignoring split file extensions)
  zf.name=fileArray[0].name.replace(/(\.zim)\w\w$/i,'$1');// Provide a temporary, per-session numeric ZIM ID used in filecache.js
  zf.id=fileIDs.get(zf.name);if(zf.id===undefined){zf.id=tempFileId++;fileIDs.set(zf.name,zf.id);}// For a description of these values, see https://wiki.openzim.org/wiki/ZIM_file_format
  zf.majorVersion=readInt(header,4,2);// Not currently used by this implementation
  zf.minorVersion=readInt(header,6,2);// Used to determine the User Content namespace
  zf.entryCount=readInt(header,24,4);zf.articleCount=null;// Calculated async by setListings() called from zimArchive.js
  zf.clusterCount=readInt(header,28,4);zf.urlPtrPos=urlPtrPos;zf.titlePtrPos=readInt(header,40,8);zf.articlePtrPos=null;// Calculated async by setListings()
  zf.fullTextIndex=null;// Calculated async by setListings()
  zf.fullTextIndexSize=null;// Calbulated async by setListings()
  zf.clusterPtrPos=readInt(header,48,8);zf.mimeListPos=mimeListPos;zf.mainPage=readInt(header,64,4);zf.layoutPage=readInt(header,68,4);zf.mimeTypes=mapData;return zf;});});}};

  /* global appstate, params *//**
   * Filters out the Replay system files (since these cannot be loaded alongside a Service Worker without error)
   * In the case of the H prefix or the landing page, an 'inspect' property is added to the dirEntry, so that we can discover
   * the underlying Zimit landing page below
   * @param {dirEntry} dirEntry The directory entry to modify or anull
   * @returns {dirEntry} The modified directory entry
   */function filterReplayFiles(dirEntry){if(!(dirEntry&&dirEntry.url))return null;if(dirEntry.namespace==='H'||dirEntry.namespace==='C'&&/^H\//.test(dirEntry.url)||params.isLandingPage&&/^(A\/)?index\.html(?:[?#]|$)/.test(dirEntry.url)){dirEntry.inspect=true;}if(/(?:\bload\.js|\bsw\.js|analytics.*\.js|update\.googleapis|play\.google.*(?:stats|logs)|youtube\.com.*\/stats|google\.internal|syndication|survey\.js|yuiloader\.js|doubleclick|play\.google\.|developer\.mozilla\.org\/static\/js\/main\..+\.js|webpushr.*\.com.*\.js)(?:[?#]|$)/i.test(dirEntry.url)){dirEntry.nullify=true;}return dirEntry;}/**
   * Inspects the HTML of the ZIM archive's landing page or of the requested Header to discover the URL to redirect to
   * adds a custom redirect to the dirEntry
   * @param {dirEntry} dirEntry The directory entry of the landing page or H-prefixed header to process
   * @param {String} data The decoded data which the dirEntry points to
   * @param {String} cns The Content Name Space of the ZIM (usually 'C' or 'A')
   * @returns {dirEntry} The modified directory entry
   */function getZimitRedirect(dirEntry,data,cns){var redirect;// Type 1 ZIMs don't use the H namespace, and instead use H as prefix to the URL
  if(dirEntry.namespace==='H'||cns==='C'&&/^H\//.test(dirEntry.url)){// We are dealing with a Header redirect, so we need to find the Location: field
  redirect=data.match(/^Location:\s*https?:\/\/([^/]+)(.*)$/m);if(!redirect)redirect=data.match(/^WARC-Target-URI:\s*https?:\/\/([^/]+)(.*)$/m);if(redirect&&redirect[1]){// Type 1 Zimit ZIMs need intermediary 'A' prefix, since there is no longer any A namespace
  params.zimitPrefix=(cns==='C'?'A/':'')+redirect[1];dirEntry.zimitRedirect=cns+'/'+params.zimitPrefix+redirect[2];}else {dirEntry.zimitRedirect=null;}}else if(/301\s*moved\s+permanently/i.test(data)){redirect=data.match(/moved\s+permanently(?:[^<]|<(?!a\s))+<a\s[^"']+["'](?:https?:)?\/?\/?([^"']+)/i);if(redirect&&redirect[1]){// Remove any port
  var zimitRedirect=redirect[1].replace(/^([^/]+):\d+(\/)/,'$1$2');dirEntry.zimitRedirect=cns+'/'+(cns==='C'?'A/':'')+zimitRedirect;}console.debug('*** Asset moved permanently! Redirecting to: '+dirEntry.zimitRedirect+' ***');}else {redirect=data.match(/window\.mainUrl\s*=\s*(['"])https?:\/\/([^/]+)(.+?)\1/);if(redirect&&redirect[2]&&redirect[3]){// Logic added for Type 1 Zimit ZIMs
  params.zimitPrefix=(dirEntry.namespace==='C'?'A/':'')+redirect[2];params.zimitStartPage=dirEntry.namespace+'/'+params.zimitPrefix+redirect[3];}else {params.zimitStartPage=null;}dirEntry.zimitRedirect=params.zimitStartPage;}return dirEntry;}/**
   * Establish some Regular Expressions used by the transformReplayUrls function
   */var regexpZimitHtmlLinks=/(<(?:a|img|script|link|track|meta|iframe)\b[^>]*?[\s;])(?:src\b|href|url)\s*(=\s*(["']))(?=[./]+|https?)((?:[^>](?!\3|\?|#))+[^>])([^>]*>)/ig;var regexpZimitJavascriptLinks=/['"(]((?=[^'"?#)]+\.(?:com?\b|net\b|org\b))|(?:(?:https?:)?\/\/)[^'"?#)]*)['"?#)]/ig;var regexpZimitCssLinks=/\burl\s*\(['"\s]*([^)'"\s]+)['"\s]*\)/ig;var regexpGetZimitPrefix=/link\s+rel=["']canonical["']\s+href="https?:\/\/([^/"]+)/i;var regexpRemoveAnalytics1=/<script\b([^<]|<(?!\/script>))+?(?:google.*?analytics|adsbygoogle|googleads|doubleclick|pubads|syndication)([^<]|<(?!\/script>))+<\/script>\s*/ig;var regexpRemoveAnalytics2=/<ins\b(?:[^<]|<(?!\/ins>))+?adsbygoogle(?:[^<]|<(?!\/ins>))+<\/ins>\s*/ig;var regexpInlineScriptsNotMaths=/<(script\b(?![^>]+type\s*=\s*["'](?:math\/|text\/html|[^"']*?math))(?:[^<]|<(?!\/script>))+<\/script)>/ig;/**
   * The main function for transforming Zimit URLs into standard ZIM URLs.
   * @param {dirEntry} dirEntry The directory entry that points to the extracted data
   * @param {String} data The deocmpressed and extracted textual data that the dirEntry points to
   * @param {String} mimetype The reported mimetype of the data (this is also in the dirEntry)
   * @returns {String} The transformed data string
   */function transformReplayUrls(dirEntry,data,mimetype){/**
       * Transform URL links in HTML files
       * Note that some Zimit ZIMs have mimeteypes like 'text/html;raw=true', so we can't simply match 'text/html'
       * Other ZIMs have a mimetype like 'html' (with no 'text/'), so we have to match as generically as possible
       */// console.debug('**** Transforming URLs in ' + dirEntry.namespace + '/' + dirEntry.url + ' ****');
  var indexRoot=window.location.pathname.replace(/[^/]+$/,'')+encodeURI(appstate.selectedArchive.file.name);if(/\bx?html\b/i.test(mimetype)){var zimitPrefix=data.match(regexpGetZimitPrefix);// If the URL is the same as the URL with everything after the first / removed, then we are in the root directory
  // We use this to decide whether to remove any relative link prefixes like ../
  var rootDirectory=dirEntry.url===dirEntry.url.replace(/^((?:A\/)?[^/]+\/?).*/,'$1');params.zimitPrefix=zimitPrefix?(dirEntry.namespace==='C'?'A/':'')+zimitPrefix[1]:params.zimitPrefix;// Remove lazyimgage system and noscript tags that comment out images
  // DEV: Check if this is still necessary
  data=data.replace(/<noscript>\s*(<img\b[^>]+>)\s*<\/noscript>/ig,'$1');data=data.replace(/<span\b[^>]+lazy-image-placeholder[^<]+<\/span>\s*/ig,'');// Remove meta http-equiv refresh from assets
  if(dirEntry.isAsset)data=data.replace(/<meta\s+http-equiv[^>]+refresh\b[^>]+>\s*/i,'');// // Inject the helper script wombat.js
  // data = data.replace(/(<\/head>\s*)/i, '<script src="https://' + params.zimitPrefix + '/static/wombat.js"></script>\n');
  // Get stem for constructing an absolute URL
  data=data.replace(regexpZimitHtmlLinks,function(match,blockStart,equals,quote,relAssetUrl,blockClose){var newBlock=match;var assetUrl=relAssetUrl;// console.log('Asset URL: ' + assetUrl);
  // Remove google analytics and other analytics files that cause stall
  if(/analytics|typepad.*stats|googleads|doubleclick|syndication/i.test(assetUrl))return '';// For root-relative links, we need to add the zimitPrefix
  assetUrl=assetUrl.replace(/^\/(?!\/)/,indexRoot+'/'+dirEntry.namespace+'/'+params.zimitPrefix+'/');// For Zimit assets that begin with https: or // the zimitPrefix is derived from the URL
  assetUrl=assetUrl.replace(/^(?:https?:)?\/\//i,indexRoot+'/'+dirEntry.namespace+'/'+(dirEntry.namespace==='C'?'A/':''));// For fully relative links, we have to remove any '..' if we are in root directory
  if(rootDirectory)assetUrl=assetUrl.replace(/^(\.\.\/?)+/,indexRoot+'/'+dirEntry.namespace+'/'+params.zimitPrefix+'/');// Add placeholder to prevent further transformations
  if(/^<a\s/i.test(newBlock))newBlock=newBlock.replace(relAssetUrl,'@kiwixtrans@'+assetUrl+(params.contentInjectionMode==='serviceworker'?'?isKiwixHref':''));// But for non-anchor URLs, We have to mark potential assets that are not easily identified as assets, due to so many html mimetypes being returned for them
  else newBlock=newBlock.replace(relAssetUrl,'@kiwixtransformed@'+assetUrl);// console.debug('Transform: \n' + match + '\n -> ' + newBlock);
  return newBlock;});// Deal with image srcsets
  data=data.replace(/<img\b[^>]+srcset=["']([^"']+)/ig,function(match,srcset){var srcsetArr=srcset.split(',');var swPrefix=params.contentInjectionMode==='serviceworker'?indexRoot+'/':'';for(var i=0;i<srcsetArr.length;i++){// For root-relative links, we need to add the zimitPrefix
  srcsetArr[i]=srcsetArr[i].replace(/^\s*\/(?!\/)/,swPrefix+dirEntry.namespace+'/'+params.zimitPrefix+'/');// Zimit prefix is in the URL for absolute URLs
  srcsetArr[i]=srcsetArr[i].replace(/^(?:\s*https?:)?\/\//i,swPrefix+dirEntry.namespace+'/'+(dirEntry.namespace==='C'?'A/':''));if(rootDirectory)srcsetArr[i]=srcsetArr[i].replace(/^(\.\.\/?)+/,swPrefix+dirEntry.namespace+'/'+params.zimitPrefix+'/');srcsetArr[i]='@kiwixtransformed@'+srcsetArr[i];}match=match.replace(srcset,srcsetArr.join(', '));return match;});// Deal with regex-style urls embedded in page
  data=data.replace(/https?:\\\/\\\/[^"']+/gi,function(assetUrl){assetUrl=assetUrl.replace(/^https?:\\\/\\\//i,'\\/'+dirEntry.namespace+'\\/'+(dirEntry.namespace==='C'?'A\\/':''));assetUrl=indexRoot.replace(/\\/g,'\\\\').replace(/\//g,'\\/')+assetUrl;return assetUrl;});// Remove any <base href...> statements
  // DEV: You should probably deal with this more intelligently, changing absolute links rather than just removing,
  // but so far, removing it seems to do the job
  data=data.replace(/<base\b[^>]+href\b[^>]+>\s*/i,'');// Remove wordpress link tracker
  data=data.replace(/<script[^>]+type="text\/javascript"[^<]+setTrackerUrl[^<]+<\/script>/i,'');// Remove any residual analytics and ads
  data=data.replace(regexpRemoveAnalytics1,'');data=data.replace(regexpRemoveAnalytics2,'');// ZIM-specific overrides
  // Deal with YouTube embedded keys
  var youTubeKey=data.match(/INNERTUBE_API_KEY['":]+([^'"]+)/);if(youTubeKey&&youTubeKey[1]){var videoId=data.match(/originalUrl['":]+[^'"]+?youtube.com\/embed\/([^'"]+)/);if(videoId&&videoId[1]){var rgxYouTubeKey=new RegExp(youTubeKey[1].replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g');data=data.replace(rgxYouTubeKey,videoId[1]);}}if(/(?:journals\.openedition\.org)/i.test(params.zimitPrefix)){// DEV: Checked still necessary as of 8-6-2022
  // Neutralize all inline scripts, excluding math blocks or react templates, as they cause a loop on loading article
  data=data.replace(regexpInlineScriptsNotMaths,function(p0,p1){return '<!-- '+p1+' --!>';});// data = data.replace(/<script\b[^>]+tarteaucitron[^"']*?\.js(?:[^<]|<(?!\/script>))+<\/script>\s*/i, '');
  }// Remove shopping cart that attempts to post to server or scripts that take a very long time to fail and block page
  if(/passco/i.test(params.zimitPrefix)){data=data.replace(/<script\b[^>]+(?:cart-fragments|lp-global\.min\.js)(?:[^<]|<(?!\/script>))+<\/script>\s*/,'');}}// End of html transformations
  /**
       * Transform css-style links in stylesheet files and stylesheet blocks in HTML
       */if(/\b(css|x?html)\b/i.test(mimetype)){data=data.replace(regexpZimitCssLinks,function(match,url){var newBlock=match;var assetUrl=url;// For root-relative links, we need to add the zimitPrefix
  assetUrl=assetUrl.replace(/^\/(?!\/)/,indexRoot+'/'+dirEntry.namespace+'/'+params.zimitPrefix+'/');// Deal with absolute URLs
  assetUrl=assetUrl.replace(/^(https?:)?\/\//i,indexRoot+'/'+dirEntry.namespace+'/'+(dirEntry.namespace==='C'?'A/':''));if(rootDirectory)assetUrl=assetUrl.replace(/^(\.\.\/?)+/,indexRoot+'/'+dirEntry.namespace+'/'+params.zimitPrefix+'/');// Relative assets
  newBlock=assetUrl===url?newBlock:newBlock.replace(url,'@kiwixtransformed@'+assetUrl);// console.debug('Transform: \n' + match + '\n -> ' + newBlock);
  return newBlock;});}// End of css transformations
  /**
       * Transform links in JavaScript files or script blocks in the html
       */if(/\b(javascript|x?html)\b/i.test(mimetype)){data=data.replace(regexpZimitJavascriptLinks,function(match,url){if(/www\.w3\.org\/XML\//i.test(url))return match;var newBlock=match;var assetUrl=url;assetUrl=assetUrl.replace(/^\/(?!\/)/,indexRoot+'/'+dirEntry.namespace+'/'+params.zimitPrefix+'/');assetUrl=assetUrl.replace(/^\/\//,indexRoot+'/'+dirEntry.namespace+'/'+(dirEntry.namespace==='C'?'A/':''));assetUrl=assetUrl.replace(/^https?:\/\//i,indexRoot+'/'+dirEntry.namespace+'/'+(dirEntry.namespace==='C'?'A/':''));// Remove analytics
  assetUrl=/analytics|(typepad|api).*stats|googleads|doubleclick|syndication|jnn-pa\.googleapis|play\.google\.com/i.test(assetUrl)?'':assetUrl;// Relative assets
  newBlock=newBlock.replace(url,'@kiwixtransformed@'+assetUrl);// console.debug('Transform: \n' + match + '\n -> ' + newBlock);
  return newBlock;});data=data.replace(/(['"])(?:\/?)((?:static|api)\/)/ig,'$1'+indexRoot+'/'+dirEntry.namespace+'/'+params.zimitPrefix+'/$2');}// End of JavaScript transformations
  // Remove the placeholders used to prevent further matching
  data=data.replace(/@kiwixtransformed@(?!\.)/g,'');data=data.replace(/@kiwixtrans(?:formed)?@/g,'');return data;}/**
   * Transform video URL through fuzzy matching
   * Rules adapted from https://github.com/webrecorder/wabac.js/blob/main/src/fuzzymatcher.js
   * @param {String} url The URL to transform through fuzzy matching
   * @param {Function} callback The function to call with the transformed url
   */function transformVideoUrl(url,articleDocument,callback){if(/youtu(?:be(?:-nocookie)?\.com|\.be)/i.test(url)){var cns=appstate.selectedArchive.getContentNamespace();var rgxTrimUrl=new RegExp('(?:[^/]|\\/(?!'+cns+'\\/))+\\/');var pureUrl=url.replace(rgxTrimUrl,'');// See https://webapps.stackexchange.com/questions/54443/format-for-id-of-youtube-video for explanation of format
  var videoId=pureUrl.match(/(?:videoid=|watch\?v=|embed\/|\/)([a-zA-Z0-9_-]{10}[048AEIMQUYcgkosw])(?:[&?#%]|\s*$)/i);videoId=videoId?videoId[1]:null;if(!videoId){callback(url);return;}var prefix=(cns==='C'?cns+'/':'')+'H/www.youtube.com/ptracking';// Set up regular expression search of URL index (aka fuzzy search)
  var search={rgxPrefix:new RegExp('.*'+videoId,'i'),searchUrlIndex:true,size:1};appstate.selectedArchive.findDirEntriesWithPrefixCaseSensitive(prefix,search,function(dirEntry){if(dirEntry&&dirEntry[0]&&dirEntry[0].url){dirEntry=dirEntry[0];var cpn=dirEntry.url.match(/cpn=([^&]+)/i);cpn=cpn?cpn[1]:null;var ei=dirEntry.url.match(/ei=([^&]+)/i);ei=ei?ei[1]:null;if(cpn||ei){prefix=(cns==='C'?cns+'/':'')+'A/rr';search={rgxPrefix:new RegExp('.*'+(ei?'ei='+ei:'')+(cpn?'.*cpn='+cpn:''),'i'),searchUrlIndex:true,size:1};appstate.selectedArchive.findDirEntriesWithPrefixCaseSensitive(prefix,search,function(dirEntry){if(dirEntry&&dirEntry[0]&&dirEntry[0].url&&!search.found){dirEntry=dirEntry[0];search.found=true;var transUrl=url.replace(pureUrl,dirEntry.namespace+'/'+dirEntry.url);console.debug('TRANSFORMED VIDEO URL '+pureUrl+' --> \n'+transUrl);// If we are dealing with embedded video, we have to find the embedded URL and subsitute it
  if(/\/embed\//i.test(pureUrl)){var indexRoot=window.location.pathname.replace(/[^/]+$/,'')+encodeURI(appstate.selectedArchive.file.name);Array.prototype.slice.call(articleDocument.querySelectorAll('iframe')).forEach(function(frame){if(~frame.src.indexOf(videoId)){var newUrl=window.location.origin+indexRoot+transUrl.replace(/videoembed/,'');frame.src=newUrl;}});}callback(transUrl);}},null);// null prevents callbacks with incomplete results
  }else {callback(url);}}else {callback(url);if(/youtube\.com\/embed\//i.test(pureUrl)){var anchor={protocol:'https:',href:'https://www.youtube.com/watch?v='+videoId,type:'video'};uiUtil.warnAndOpenExternalLinkInNewTab(null,anchor,'This video is not available offline in this ZIM. To view online, please open the following URL');}}},null);}else {callback(url);}}var transformZimit = {filterReplayFiles:filterReplayFiles,getZimitRedirect:getZimitRedirect,transformReplayUrls:transformReplayUrls,transformVideoUrl:transformVideoUrl};

  /**
   * ZIM Archive
   *
   * @typedef ZIMArchive
   * @property {ZIMFile} file The ZIM file (instance of ZIMFile, that might physically be split into several actual _files)
   * @property {String} counter Counter of various types of content in the archive
   * @property {String} creator Creator of the content
   * @property {String} date Date of the creation of the archive
   * @property {String} description Description of the content
   * @property {String} language Language of the content
   * @property {String} name Name of the archive
   * @property {String} publisher Publisher of the content
   * @property {String} title Title of the content
   * @property {String} zimType Extended property: currently either 'open' for OpenZIM file type, or 'zimit' for the warc2zim file type used by Zimit
   *//**
   * @callback callbackZIMArchive
   * @param {ZIMArchive} zimArchive Ready-to-use ZIMArchive
   *//**
   * @callback callbackMetadata
   * @param {String} data metadata string
   *//**
   * @param {Worker} LZ A Web Worker to run the libzim Web Assembly binary
   */var LZ;/**
   * Creates a ZIM archive object to access the ZIM file at the given path in the given storage.
   * This constructor can also be used with a single File parameter.
   *
   * @param {StorageFirefoxOS|Array<Blob>} storage Storage (in this case, the path must be given) or Array of Files (path parameter must be omitted)
   * @param {String} path The Storage path for an OS that requires this to be specified
   * @param {callbackZIMArchive} callbackReady The function to call when the archive is ready to use
   * @param {callbackZIMArchive} callbackError The function to call when an error occurs
   */function ZIMArchive(storage,path,callbackReady,callbackError){var that=this;that.file=null;var whenZimReady=function whenZimReady(){// Add time-critical metadata from the M/ namespace that you need early access to here
  // Note that adding metadata here delays the reporting of the ZIM archive as ready
  // Further metadata are added in the background below, and can be accessed later
  return Promise.all([that.addMetadataToZIMFile('Creator'),that.addMetadataToZIMFile('Language'),that.addMetadataToZIMFile('Publisher')]).then(function(){console.debug('ZIMArchive ready, metadata will be added in the background');// Add non-time-critical metadata to archive in background so as not to delay opening of the archive
  // DEV: Note that it does not make sense to extract illustration (icon) metadata here. Instead, if you implement use of the illustration
  // metadata as icons for the loaded ZIM [kiwix-js #886], you should simply use the ZIMArdhive.getMetadata() function when needed
  setTimeout(function(){Promise.all([that.addMetadataToZIMFile('Counter'),that.addMetadataToZIMFile('Date'),that.addMetadataToZIMFile('Description'),that.addMetadataToZIMFile('Name'),that.addMetadataToZIMFile('Source'),that.addMetadataToZIMFile('Title')]).then(function(){console.debug('ZIMArchive metadata loaded:',that);});},1000);// DEV: If you need any of the above earlier, you can alter this delay
  // We need to get the landing page of any Zimit archive opened
  // Note that the test below catches both zimit and zimit2 types
  if(/zimit/.test(that.zimType)){return that.setZimitMetadata().then(function(){callbackReady(that);});}else {// All listings should be loaded, so we can now call the callback
  callbackReady(that);}});};var createZimfile=function createZimfile(fileArray){return zimfile.fromFileArray(fileArray).then(function(file){that.file=file;// Clear the previous libzimWoker
  LZ=null;// Set a global parameter to report the search provider type
  params.searchProvider='title';// File has been created, but we need to add any Listings which extend the archive metadata
  return that.file.setListings([// Provide here any Listings for which we need to extract metadata as key:value obects to be added to the file
  // 'ptrName' and 'countName' contain the key names to be set in the archive file object
  {// This defines the standard v0 (legacy) title index that contains listings for every entry in the ZIM (not just articles)
  // It represents the same index that is referenced in the ZIM archive header
  path:'X/listing/titleOrdered/v0',ptrName:'titlePtrPos',countName:'entryCount'},{// This defines a new version 1 index that is present in no-namespace ZIMs, and contains a title-ordered list of articles
  path:'X/listing/titleOrdered/v1',ptrName:'articlePtrPos',countName:'articleCount'},{// This tests for and specifies the existence of any Xapian Full Text Index
  path:'X/fulltext/xapian',ptrName:'fullTextIndex',countName:'fullTextIndexSize'}]).then(function(){that.libzimReady=null;// There is currently an exception thrown in the libzim wasm if we attempt to load a split ZIM archive, so we work around
  var isSplitZim=/\.zima.$/i.test(that.file._files[0].name);var libzimReaderType=params.debugLibzimASM||('WebAssembly'in self?'wasm':'asm');if((that.file.fullTextIndex||params.useLibzim)&&params.debugLibzimASM!=='disable'&&(params.debugLibzimASM||!isSplitZim&&(// The ASM implementation requires Atomics support, whereas the WASM implementation does not
  typeof Atomics!=='undefined'||libzimReaderType==='wasm')&&// Note that NWJS currently throws due to problems with Web Worker context
  !(window.nw&&that.file._files[0].readMode==='electron'))){that.libzimReady='loading';console.log('Instantiating libzim '+libzimReaderType+' Web Worker...');if(params.useLibzim)uiUtil.pollSpinner('Waiting for libzim...',true);LZ=new Worker('js/libzim-'+libzimReaderType+'.js');that.callLibzimWorker({action:'init',files:that.file._files}).then(function(){that.libzimReady='ready';// If user is using libzim for reading the file, we have delayed the callback till now
  if(params.useLibzim)whenZimReady();params.searchProvider='fulltext: '+libzimReaderType;// Update the API panel
  uiUtil.reportSearchProviderToAPIStatusPanel(params.searchProvider);}).catch(function(err){uiUtil.reportSearchProviderToAPIStatusPanel(params.searchProvider+': ERROR');console.error('The libzim worker could not be instantiated!',err);that.libzimReady='error';});}else {// var message = 'Full text searching is not available because ';
  if(!that.file.fullTextIndex){params.searchProvider+=': no_fulltext';// message += 'this ZIM does not have a full-text index.';
  }else if(isSplitZim){params.searchProvider+=': split_zim';// message += 'the ZIM archive is split.';
  }else if(typeof Atomics==='undefined'){params.searchProvider+=': no_atomics';// message += 'this browser does not support Atomic operations.';
  }else if(/Android/.test(params.appType)){params.searchProvider+=': no_sharedArrayBuffer';}else if(params.debugLibzimASM==='disable'){params.searchProvider+=': disabled';}else {params.searchProvider+=': unknown';}uiUtil.reportSearchProviderToAPIStatusPanel(params.searchProvider);}// Set the archive file type ('open', 'zimit' or 'zimit2')
  return that.addMetadataToZIMFile('Scraper').then(function(){params.zimType=that.setZimType();// If user is not using libzim for reading the file, we can call the ready callback now
  if(!params.useLibzim)whenZimReady();});}).catch(function(err){console.warn('Error setting archive listings: ',err);});});};if(storage&&!path){var fileList=storage;// We need to convert the FileList into an Array
  var fileArray=[].slice.call(fileList);// The constructor has been called with an array of File/Blob parameter
  createZimfile(fileArray);}else {if(/.*zim..$/.test(path)){// split archive
  that._searchArchiveParts(storage,path.slice(0,-2)).then(function(fileArray){createZimfile(fileArray);}).catch(function(error){callbackError('Error reading files in split archive '+path+': '+error,'Error reading archive files');});}else {storage.get(path).then(function(file){createZimfile([file]);}).catch(function(error){callbackError('Error reading ZIM file '+path+' : '+error,'Error reading archive file');});}}}/**
   * Searches the directory for all parts of a split archive.
   * @param {Storage} storage storage interface
   * @param {String} prefixPath path to the split files, missing the "aa" / "ab" / ... suffix.
   * @returns {Promise} that resolves to the array of file objects found.
   */ZIMArchive.prototype._searchArchiveParts=function(storage,prefixPath){var fileArray=[];var _nextFile=function nextFile(part){var suffix=String.fromCharCode(0x61+Math.floor(part/26))+String.fromCharCode(0x61+part%26);return storage.get(prefixPath+suffix).then(function(file){fileArray.push(file);return _nextFile(part+1);},function(error){console.error('Error reading split archive file '+prefixPath+suffix+': ',error);return fileArray;});};return _nextFile(0);};/**
   *
   * @returns {Boolean}
   */ZIMArchive.prototype.isReady=function(){return this.file!==null;};/**
   * Detects whether the supplied archive is a Zimit-style archive or an OpenZIM archive and
   * sets a zimType property accordingly; also returns the detected type. Extends ZIMArchive.
   * @returns {String} 'zimit' for a classic Zimit archive, 'zimit2' for a zimit2 archive, or 'open' for an OpenZIM archive
   */ZIMArchive.prototype.setZimType=function(){var archiveType=null;if(this.isReady()){archiveType='open';this.file.mimeTypes.forEach(function(v){if(/warc-headers/i.test(v))archiveType='zimit';});if(archiveType!=='zimit'&&this.scraper){// Check if it's a zimit2 type archive by seeing if the scraper contains 'warc2zim'
  archiveType=/warc2zim|zimit/i.test(this.scraper)?'zimit2':archiveType;}this.zimType=archiveType;console.debug('Archive type set to: '+archiveType);}else {console.error('ZIMArchive is not ready! Cannot set ZIM type.');}return archiveType;};/**
   * Looks for the DirEntry of the main page
   * @param {callbackDirEntry} callback
   * @returns {Promise} that resolves to the DirEntry
   */ZIMArchive.prototype.getMainPageDirEntry=function(callback){if(this.isReady()){var mainPageUrlIndex=this.file.mainPage;var that=this;this.file.dirEntryByUrlIndex(mainPageUrlIndex).then(function(dirEntry){// Filter out Zimit files that we cannot handle without error
  if(that.zimType==='zimit'&&!appstate.isReplayWorkerAvailable)dirEntry=transformZimit.filterReplayFiles(dirEntry);callback(dirEntry);});}};/**
   *
   * @param {String} dirEntryId
   * @returns {DirEntry}
   */ZIMArchive.prototype.parseDirEntryId=function(dirEntryId){return zimDirEntry.DirEntry.fromStringId(this.file,dirEntryId);};/**
   * @callback callbackDirEntryList
   * @param {Array.<DirEntry>} dirEntryArray Array of DirEntries found
   *//**
   * Look for DirEntries with title starting with the prefix of the current search object.
   * For now, ZIM titles are case sensitive.
   * So, as workaround, we try several variants of the prefix to find more results.
   * This should be enhanced when the ZIM format will be modified to store normalized titles
   * See https://phabricator.wikimedia.org/T108536
   *
   * @param {Object} search The current appstate.search object
   * @param {callbackDirEntryList} callback The function to call with the result
   * @param {Boolean} noInterim A flag to prevent callback until all results are ready (used in testing)
   */ZIMArchive.prototype.findDirEntriesWithPrefix=function(search,callback,noInterim){var that=this;// Establish array of initial values that must be searched first. All of these patterns are generated by the full
  // search type, and some by basic, but we need the most common patterns to be searched first, as it returns search
  // results much more quickly if we do this (and the user can click on a result before the rarer patterns complete)
  // NB duplicates are removed before processing search array
  var startArray=[];var cns=this.getContentNamespace();var dirEntries=[];search.scanCount=0;// Check if user prefixed search with a namespace-like pattern. If so, do a search for namespace + url
  if(/^[-ABCHIJMUVWX]\//.test(search.prefix))search.searchUrlIndex=true;// Regex below breaks the string into the pattern: group 1: alphanumericsearch; group 2: regex beginning with .* or .+, or contained in (?:regex)
  var isPrefixRegExp=search.prefix.match(/^((?:[^(.]|\((?!\?:)|\.(?![*+]))*)(\(\?:.*\)|\.[*+].*)$/);search.rgxPrefix=null;var prefix=search.prefix;// Launch a full-text search if possible
  if(LZ&&params.searchProvider!=='titleOnly'&&!(search.searchUrlIndex||search.searchTitleIndex)){that.findDirEntriesFromFullTextSearch(search,dirEntries).then(function(fullTextDirEntries){// If user initiated a new search, cancel this one
  // In particular, do not set the search status back to 'complete'
  // as that would cause outdated results to unexpectedly pop up
  if(search.status==='cancelled')return callback([],search);dirEntries=fullTextDirEntries;search.status='complete';callback(dirEntries,search);});}if(isPrefixRegExp){// User has initiated a regular expression search - note the only regexp special character allowed in the alphanumeric part is \s
  prefix=isPrefixRegExp[1].replace(/\\s/g,' ');var regexCorrect=true;try{search.rgxPrefix=new RegExp(isPrefixRegExp[2],'i');}catch(err){// User has incorrect regular expression syntax
  regexCorrect=false;}if(!regexCorrect){search.status='error';callback([],search);return;}}var prefixNameSpaces='';if(search.searchUrlIndex){var rgxSplitPrefix=/^[-ABCHIJMUVWX]\//;if(that.zimType==='zimit'&&cns==='C'){// We have to account for the Zimit prefix in Type 1 ZIMs
  rgxSplitPrefix=/^(?:[CMWX]\/)?(?:[AH]\/)?/;}var splitPrefix=prefix.match(rgxSplitPrefix);prefixNameSpaces=splitPrefix?splitPrefix[0]:'';var splitSuffix=prefix.split(rgxSplitPrefix);prefix=splitSuffix?splitSuffix[1]:prefix;}// Ensure a search is done on the string exactly as typed
  startArray.push(prefix);// Normalize any spacing and make string all lowercase
  prefix=prefix.replace(/\s+/g,' ').toLocaleLowerCase();// Add lowercase string with initial uppercase (this is a very common pattern)
  startArray.push(prefix.replace(/^./,function(m){return m.toLocaleUpperCase();}));// Add pure lowercase string (rarer)
  startArray.push(prefix);// Add a case-insensitive search for the string (pseudo-regex notation)
  startArray.push('/'+prefix+'/i');// Get the full array of combinations to check number of combinations
  var fullCombos=util.removeDuplicateStringsInSmallArray(util.allCaseFirstLetters(prefix,'full'));// Put cap on exponential number of combinations (five words = 3^5 = 243 combinations)
  search.type=fullCombos.length<300?'full':'basic';// We have to remove duplicate string combinations because util.allCaseFirstLetters() can return some combinations
  // where uppercase and lowercase combinations are exactly the same, e.g. where prefix begins with punctuation
  // or currency signs, for languages without case, or where user-entered case duplicates calculated case
  var prefixVariants=util.removeDuplicateStringsInSmallArray(startArray.concat(// Get basic combinations first for speed of returning results
  util.allCaseFirstLetters(prefix).concat(search.type==='full'?fullCombos:[])));function searchNextVariant(){// If user has initiated a new search, cancel this one
  if(search.status==='cancelled')return callback([],search);var remaining=search.size-dirEntries.length;if(prefixVariants.length===0||remaining<1){// We have found all the title-search entries we are going to get, so indicate search type if we're still searching
  if(LZ&&!search.searchUrlIndex&&search.status!=='complete')search.type='fulltext';else if(LZ&&search.searchUrlIndex&&remaining>0){search.type='fulltext';that.findDirEntriesFromFullTextSearch(search,dirEntries,remaining).then(function(fullTextDirEntries){if(search.status==='cancelled')return callback([],search);dirEntries=fullTextDirEntries;search.status='complete';callback(dirEntries,search);});}else search.status='complete';return callback(dirEntries,search);}// Dynamically populate list of articles
  search.status='interim';if(!noInterim)callback(dirEntries,search);search.found=dirEntries.length;var prefix=prefixNameSpaces+prefixVariants[0];search.lc=false;// If it's pseudo-regex with a case-insensitive flag like '/my search/i', do an enhanced case-insensitive search
  if(/^\/.+\/i$/.test(prefixVariants[0])){search.lc=true;prefix=prefixNameSpaces+prefixVariants[0].replace(/^\/(.+)\/i/,'$1').toLocaleLowerCase();console.debug('Searching case-insensitively for: "'+prefix+'"');}// Remove in-progress search variant from array
  prefixVariants=prefixVariants.slice(1);// Search window sets an upper limit on how many matching dirEntries will be scanned in a full index search
  search.window=search.rgxPrefix?10000*search.size:search.size;that.findDirEntriesWithPrefixCaseSensitive(prefix,search,function(newDirEntries,countReport,interim){search.countReport=countReport;if(search.status==='cancelled')return callback([],search);if(!noInterim&&countReport===true)return callback(dirEntries,search);// Only push interim results to the dirEntries array (otherwise we get a duplicated array when the final results are reported to this function)
  if(interim){// Collect all the found paths for the dirEntries so far
  var dirEntryPaths=[];for(var i=0;i<dirEntries.length;i++){dirEntryPaths.push(dirEntries[i].url);}// Push new directory entries to the end of the global array so long as they are not duplicates
  for(var j=0;j<newDirEntries.length;j++){if(~dirEntryPaths.indexOf(newDirEntries[j].url))continue;dirEntries.push(newDirEntries[j]);}search.found=dirEntries.length;if(!noInterim&&newDirEntries.length)return callback(dirEntries,search);}else return searchNextVariant();});}searchNextVariant();};/**
   * A method to return the namespace in the ZIM file that contains the primary user content. In old-format ZIM files (minor
   * version 0) there are a number of content namespaces, but the primary one in which to search for titles is 'A'. In new-format
   * ZIMs (minor version >= 1) there is a single content namespace 'C'. See https://openzim.org/wiki/ZIM_file_format. This method
   * throws an error if it cannot determine the namespace or if the ZIM is not ready.
   * @returns {String} The content namespace for the ZIM archive
   */ZIMArchive.prototype.getContentNamespace=function(){if(this.isReady()){var ver=this.file.minorVersion;// DEV: There are currently only four defined values for minorVersion in the OpenZIM specification
  // For meaning of minorVersion values, see https://openzim.org/wiki/ZIM_file_format#Major_.26_Minor_versions
  // If this changes, adapt the error checking and return values
  if(ver>3){console.warn('Unknown ZIM minor version: '+ver+'! Assuming content namespace is C.');}return ver===0?'A':'C';// Only minorVersion 0 uses namespace A (for Articles)
  }else {throw new Error('We could not determine the content namespace because the ZIM file is not ready!');}};/**
   * Look for dirEntries with title starting with the given prefix (case-sensitive)
   *
   * @param {String} prefix The case-sensitive value against which dirEntry titles (or url) will be compared
   * @param {Object} search The appstate.search object (for comparison, so that we can cancel long binary searches)
   * @param {callbackDirEntryList} callback The function to call with the array of dirEntries with titles that begin with prefix
   * @param {Integer} startIndex The index number with which to commence the search, or null
   */ZIMArchive.prototype.findDirEntriesWithPrefixCaseSensitive=function(prefix,search,callback,startIndex){// Save the value of startIndex because value of null has a special meaning in combination with prefix:
  // produces a list of matches starting with first match and then next x dirEntries thereafter
  var saveStartIndex=startIndex;startIndex=startIndex||0;prefix=prefix||'';var cns=this.getContentNamespace();// Search v1 article listing if available, otherwise fallback to v0
  var articleCount=this.file.articleCount||this.file.entryCount;var searchFunction=appstate.selectedArchive.file.dirEntryByTitleIndex;if(search.searchUrlIndex){articleCount=this.file.entryCount;searchFunction=appstate.selectedArchive.file.dirEntryByUrlIndex;}util.binarySearch(startIndex,articleCount,function(i){return searchFunction(i).then(function(dirEntry){if(search.status==='cancelled')return 0;var ns=dirEntry.namespace;var ti=search.searchUrlIndex?dirEntry.url:dirEntry.getTitleOrUrl();if(!search.searchUrlIndex){// DEV: This search is redundant if we managed to populate articlePtrLst and articleCount, but it only takes two instructions and
  // provides maximum compatibility with rare ZIMs where attempts to find first and last article (in zimArchive.js) may have failed
  if(ns<cns)return 1;if(ns>cns)return  -1;// We should now be in namespace A (old format ZIM) or C (new format ZIM)
  if(search.lc){// Search comparator should be lowercase (for case-insensitive search)
  ti=ti.toLocaleLowerCase();prefix=prefix.toLocaleLowerCase();}return prefix<=ti?-1:1;}else {if(search.lc){// Search comparator should be lowercase (for case-insensitive search)
  ns=ns+'/'+ti.replace(/^((?:[AH])?)\/?.*/,'$1');ti=ti.replace(/^[AH]\//,'').toLocaleLowerCase();}// if (search.rgxPrefix && search.rgxPrefix.test(ti)) return -1;
  return prefix<=ns+'/'+ti?-1:1;}});},true).then(function(firstIndex){var vDirEntries=[];var _addDirEntries=function addDirEntries(index,lastTitle){if(search.status==='cancelled'||search.found>=search.size||index>=articleCount||lastTitle&&!~lastTitle.indexOf(prefix)||index-firstIndex>=search.window){// DEV: Diagnostics to be removed before merge
  if(vDirEntries.length){console.debug('Scanned '+(index-firstIndex)+' titles for "'+prefix+'" (found '+vDirEntries.length+' match'+(vDirEntries.length===1?')':'es)'));}return {dirEntries:vDirEntries,nextStart:index};}return searchFunction(index).then(function(dirEntry){search.scanCount++;var title=dirEntry.getTitleOrUrl();// If we are searching by URL, display namespace also
  if(search.searchUrlIndex)title=dirEntry.namespace+'/'+dirEntry.url;if(search.lc&&!search.rgxPrefix){// Search comparator should be lowercase if not using regex (for case-insensitive search)
  var ns=title.replace(/^((?:C\/)?(?:[AH]\/)?).*/,'$1');title=ns+title.replace(ns,'').toLocaleLowerCase();}// Only return dirEntries with titles that actually begin with prefix
  if(saveStartIndex===null||(search.searchUrlIndex||dirEntry.namespace===cns)&&title.indexOf(prefix)===0){if(!search.rgxPrefix||search.rgxPrefix&&search.rgxPrefix.test(title)){// Regex test case-insensitive if i flag set
  vDirEntries.push(dirEntry);// Report interim result
  if(typeof saveStartIndex==='undefined')callback([dirEntry],false,true);}}// Report number of titles scanned every 5000 titles
  if(!(search.scanCount%5000)&&typeof saveStartIndex==='undefined')callback([],true,true);return _addDirEntries(index+1,title);});};return _addDirEntries(firstIndex);}).then(function(objWithIndex){// If we have found the requested number of results, we can stop the search
  if(objWithIndex.dirEntries.length>=search.size){search.status='complete';}return callback(objWithIndex.dirEntries,objWithIndex.nextStart);});};/**
   * Find Directory Entries corresponding to the requested search using Full Text search provided by libzim
   *
   * @param {Object} search The appstate.search object
   * @param {Array} dirEntries The array of already found Directory Entries
   * @param {Integer} number Override number of results requested in search object (used to get remaining results)
   * @returns {Promise<callbackDirEntry>} The augmented array of Directory Entries with titles that correspond to search
   */ZIMArchive.prototype.findDirEntriesFromFullTextSearch=function(search,dirEntries,number){var cns=this.getContentNamespace();var that=this;// We give ourselves an overhead in caclulating the results needed, because full-text search will return some results already found
  // var resultsNeeded = Math.floor(params.maxSearchResultsSize - dirEntries.length / 2);
  var resultsNeeded=number||search.size;var searchType=params.libzimSearchType||'search';return this.callLibzimWorker({action:searchType,text:search.prefix,numResults:resultsNeeded}).then(function(returned){if(returned){var dirEntryPaths=[];var fullTextPaths=[];var snippets=[];// Collect all the found paths for the dirEntries
  for(var i=0;i<dirEntries.length;i++){dirEntryPaths.push(dirEntries[i].namespace+'/'+dirEntries[i].url);}// Collect all the paths for full text search, pruning as we go
  var path;var snippet;for(var j=0;j<returned.results.length;j++){search.scanCount++;path=returned.results[j].path;snippet=returned.results[j].snippet;// Full-text search result paths are missing the namespace in Type 1 ZIMs, so we add it back
  path=cns==='C'?cns+'/'+path:path;// If the path is already in the dirEntries, we do not need to add it again
  if(~dirEntryPaths.indexOf(path)){// Add the snippet to the existing DirEntry
  for(var k=0;k<dirEntries.length;k++){if(dirEntries[k].namespace+'/'+dirEntries[k].url===path){dirEntries[k].snippet=snippet;break;}}// We do not need to add it again, so we continue
  continue;}fullTextPaths.push(path);snippets.push(snippet);}var promisesForDirEntries=[];for(var _k=0;_k<fullTextPaths.length;_k++){promisesForDirEntries.push(that.getDirEntryByPath(fullTextPaths[_k]));}return Promise.all(promisesForDirEntries).then(function(fullTextDirEntries){for(var l=0;l<fullTextDirEntries.length;l++){// Add snippet to the new DirEntry
  fullTextDirEntries[l].snippet=snippets[l];dirEntries.push(fullTextDirEntries[l]);}return dirEntries;});}else {return dirEntries;}});};/**
   * Calls the libzim Web Worker with the given parameters, and returns a Promise with its response
   *
   * @param {Object} parameters
   * @returns {Promise}
   */ZIMArchive.prototype.callLibzimWorker=function(parameters){return new Promise(function(resolve,reject){console.debug('Calling libzim WebWorker with parameters',parameters);var tmpMessageChannel=new MessageChannel();// var t0 = performance.now();
  tmpMessageChannel.port1.onmessage=function(event){// var t1 = performance.now();
  // var readTime = Math.round(t1 - t0);
  // console.debug("Response given by the WebWorker in " + readTime + " ms", event.data);
  resolve(event.data);};tmpMessageChannel.port1.onerror=function(event){// var t1 = performance.now();
  // var readTime = Math.round(t1 - t0);
  // console.error("Error sent by the WebWorker in " + readTime + " ms", event.data);
  reject(event.data);};LZ.postMessage(parameters,[tmpMessageChannel.port2]);});};/**
   * @callback callbackDirEntry
   * @param {DirEntry} dirEntry The DirEntry found
   *//**
   *
   * @param {DirEntry} dirEntry
   * @param {callbackDirEntry} callback
   */ZIMArchive.prototype.resolveRedirect=function(dirEntry,callback){var that=this;this.file.dirEntryByUrlIndex(dirEntry.redirectTarget).then(function(resolvedDirEntry){if(that.zimType==='zimit'&&!appstate.isReplayWorkerAvailable)resolvedDirEntry=transformZimit.filterReplayFiles(resolvedDirEntry);callback(resolvedDirEntry);});};/**
   * @callback callbackStringContent
   * @param {String} content String content
   *//**
   *
   * @param {DirEntry} dirEntry
   * @param {callbackStringContent} callback
   */ZIMArchive.prototype.readUtf8File=function(dirEntry,callback){if(params.isLandingPage&&appstate.selectedArchive.zimType==='zimit'&&!appstate.isReplayWorkerAvailable&&dirEntry.namespace!=='M'){// Mark the directory entry as a redirect
  dirEntry.zimitRedirect=this.zimitStartPage;// Prevent reload loop!
  params.isLandingPage=false;}var that=this||appstate.selectedArchive;if(!dirEntry){console.warn('No directory entry found for requested URL!');return callback(dirEntry,'');}var cns=that.getContentNamespace();return dirEntry.readData().then(function(data){var mimetype=dirEntry.getMimetype();var html=that.getUtf8FromData(data);// Bypass everything if we're using Replay Worker
  if(appstate.isReplayWorkerAvailable){callback(dirEntry,html);return;}if(/\bx?html\b/i.test(mimetype)&&params.zimType==='zimit'){// If the data were encoded with a different mimtype, here is how to change it
  // var encoding = decData.match(/<meta\b[^>]+?Content-Type[^>]+?charset=([^'"\s]+)/i);
  // encoding = encoding ? encoding[1] : '';
  // if (encoding && !/utf-8/i.test(encoding)) decData = new TextDecoder(encoding).decode(data);
  // Some Zimit assets have moved location and we need to follow the moved permanently data
  if(/301\s*moved\s+permanently/i.test(html))dirEntry=transformZimit.getZimitRedirect(dirEntry,html,cns);// Some Zimit archives have an incorrect meta charset tag. See https://github.com/openzim/warc2zim/issues/88.
  // So we remove it!
  html=html.replace(/<meta\b[^>]+?Content-Type[^>]+?charset=([^'"\s]+)[^>]+>\s*/i,function(m0,m1){if(!/utf-8/i.test(m1)){return '';}return m0;});}if(dirEntry.inspect||dirEntry.zimitRedirect){if(dirEntry.inspect)dirEntry=transformZimit.getZimitRedirect(dirEntry,html,cns);if(dirEntry.zimitRedirect){return that.getDirEntryByPath(dirEntry.zimitRedirect).then(function(rd){return that.readUtf8File(rd,callback);});}}else {// DEV: Note that we cannot terminate regex below with $ because there is a (rogue?) mimetype
  // of 'text/html;raw=true'
  if(params.zimType==='zimit'&&/\/(?:x?html|css|javascript)\b/i.test(mimetype)&&// DEV: We do not want to transform CSS and JS files that the user wishes to inspect the contents of
  !(dirEntry.fromArticleList&&/\/(?:css|javascript)\b/i.test(mimetype))){html=transformZimit.transformReplayUrls(dirEntry,html,mimetype);}callback(dirEntry,html);}}).catch(function(e){console.error('Error reading directory entry',e);callback(dirEntry,'');});};/**
   * @callback callbackBinaryContent
   * @param {Uint8Array} content binary content
   *//**
   * Read a binary file.
   * @param {DirEntry} dirEntry
   * @param {callbackBinaryContent} callback
   */ZIMArchive.prototype.readBinaryFile=function(dirEntry,callback){if(!dirEntry){console.warn('Directory entry for requested URL was empty!');return callback(dirEntry,'');}return dirEntry.readData().then(function(data){// Bypass everything if we're using Replay Worker
  if(appstate.selectedArchive.zimType==='zimit'&&appstate.isReplayWorkerAvailable){callback(dirEntry,data);return;}var mimetype=dirEntry.getMimetype();if(dirEntry.inspect){dirEntry=transformZimit.getZimitRedirect(dirEntry,utf8$1.parse(data),appstate.selectedArchive.getContentNamespace());if(dirEntry.zimitRedirect){return appstate.selectedArchive.getDirEntryByPath(dirEntry.zimitRedirect).then(function(rd){return appstate.selectedArchive.readBinaryFile(rd,callback);});}}else {// DEV: Note that we cannot terminate regex below with $ because there is a (rogue?) mimetype
  // of 'text/html;raw=true'
  if(params.zimType==='zimit'&&/\/(?:x?html|css|javascript)\b/i.test(mimetype)&&// DEV: We do not want to transform CSS and JS files that the user wishes to inspect the contents of
  !(dirEntry.fromArticleList&&/\/(?:css|javascript)\b/i.test(mimetype))){data=transformZimit.transformReplayUrls(dirEntry,utf8$1.parse(data),mimetype);}callback(dirEntry,data);}});};/**
   * Gets the UTF-8 string from the binary data
   * @param {Blob} data Binary content
   * @returns {String} UTF-8 string
   */ZIMArchive.prototype.getUtf8FromData=function(data){var decData;if(window.TextDecoder){decData=new TextDecoder('utf-8').decode(data);}else {// Support for IE11 and Edge Legacy - only support UTF-8 decoding
  decData=utf8$1.parse(data);}return decData;};/**
   * Searches the URL pointer list of Directory Entries by pathname
   * @param {String} path The pathname of the DirEntry that is required (namespace + filename)
   * @param {Boolean} zimitResolving A flag to indicate that the a Zimit path is in a lookup loop
   * @param {String} originalPath Optional string used internally to prevent infinite loop
   * @param {Boolean} followRedirects A flag to indicate that redirects should be followed
   * @return {Promise<DirEntry>} A Promise that resolves to a Directory Entry, or null if not found.
   */ZIMArchive.prototype.getDirEntryByPath=function(path,zimitResolving,originalPath,followRedirects){var that=this||appstate.selectedArchive;if(that.zimType==='zimit'&&(!appstate.isReplayWorkerAvailable||followRedirects)){if(originalPath)appstate.originalPath=originalPath;path=path.replace(/\?kiwix-display/,'');// Correct obvious errors
  if(!originalPath){var revisedPath=path.replace(/.*?((?:C\/A|A)\/(?!.*(?:C\/A|A)).+)$/,'$1');if(revisedPath!==path){console.warn('*** Revised path from '+path+'\nto: '+revisedPath+' ***');if(appstate.selectedArchive.zimType==='zimit'){console.debug('*** DEV: Consider correcting this error in tranformZimit.js ***');}path=revisedPath;}}}return util.binarySearch(0,that.file.entryCount,function(i){return that.file.dirEntryByUrlIndex(i).then(function(dirEntry){var url=dirEntry.namespace+'/'+dirEntry.url;if(path<url){return  -1;}else if(path>url){return 1;}else {return 0;}});}).then(function(index){if(index===null)return null;return that.file.dirEntryByUrlIndex(index);}).then(function(dirEntry){// Filter Zimit dirEntries and do somee initial transforms
  if(that.zimType==='zimit'&&!appstate.isReplayWorkerAvailable){dirEntry=transformZimit.filterReplayFiles(dirEntry);}if(!dirEntry&&(!appstate.isReplayWorkerAvailable||followRedirects)){// We couldn't get the dirEntry, so look it up the Zimit header
  if(!zimitResolving&&that.zimType==='zimit'&&!/^(H|C\/H)\//.test(path)&&path!==appstate.originalPath){// We need to look the file up in the Header namespace (double replacement ensures both types of ZIM are supported)
  var oldPath=path;path=path.replace(/^A\//,'H/').replace(/^(C\/)A\//,'$1H/');console.debug('DirEntry '+oldPath+' not found, looking up header: '+path);return that.getDirEntryByPath(path,true,oldPath,followRedirects);}else if(zimitResolving&&!appstate.isReplayWorkerAvailable&&appstate.originalPath&&appstate.originalPath===appstate.expectedArticleURLToBeDisplayed){// We couldn't find the Header, so try a fuzzy search only if the user is loading an article
  path=appstate.originalPath;var ns=path.replace(/^((?:C\/)?A\/).*/,'$1');// If Zimit pseudo-namespaces are changed, will need to edit this
  path=path.replace(ns,'');path=path.toLocaleLowerCase();// We are going to combine case-insensitive string comparison with regex matching
  var rgxPath=path.replace(/([-/?.$^|*+()[{])/g,'\\$1');// Make sure we escape regex characters
  path=ns+path;// Add namespace back to path for full matching
  // path = ns;
  var search={rgxPrefix:new RegExp('.*'+rgxPath,'i'),searchUrlIndex:true,lc:true,// Make the comparator (e.g. dirEntry.url) lowercase
  size:1,found:0};return fuzzySearch(path,search);}else if(!appstate.isReplayWorkerAvailable){var newpath=path.replace(/^((?:A|C\/A)\/)[^/]+\/(.+)$/,'$1$2');if(newpath===path)return null;// No further paths to explore!
  console.log('Article '+path+' not available, but moving up one directory to compensate for ZIM coding error...');return that.getDirEntryByPath(newpath);}else {// Not found!
  return null;}}else {// DEBUG: List found Directory Entry
  // if (dirEntry) console.debug('Found ' + path);
  return dirEntry;}});};/**
   * Initiate a fuzzy search for dirEntries matching the search object
   * @param {String} path Human-readable path to search for
   * @param {Object} search The search object
   * @returns {Promise<DirEntry>} A Promise that resolves to a Directory Entry, or null if not found
   */function fuzzySearch(path,search){return new Promise(function(resolve,reject){console.log('Initiating fuzzy search for '+path+'...');uiUtil.pollSpinner('Fuzzy search for '+path+'...',true);//     if (!searchResolved) uiUtil.pollSpinner('Fuzzy search for ' + path + '...', true);
  // }, 5000);
  appstate.selectedArchive.findDirEntriesWithPrefixCaseSensitive(path,search,function(dirEntry){if(!search.found&&dirEntry&&dirEntry[0]&&dirEntry[0].url){search.found++;dirEntry=dirEntry[0];dirEntry=transformZimit.filterReplayFiles(dirEntry);if(dirEntry)console.debug('Found '+dirEntry.url+' in fuzzy search');resolve(dirEntry);}else {console.debug('No fuzzy search results found');resolve(null);}},null);});}/**
   *
   * @param {callbackDirEntry} callback
   */ZIMArchive.prototype.getRandomDirEntry=function(callback){// Prefer an article-only (v1) title pointer list, if available
  var articleCount=this.file.articleCount||this.file.entryCount;var index=Math.floor(Math.random()*articleCount);this.file.dirEntryByTitleIndex(index).then(callback);};/**
   * Read a Metadata string inside the ZIM file.
   * @param {String} key
   * @param {callbackMetadata} callback
   */ZIMArchive.prototype.getMetadata=function(key,callback){var that=this;this.getDirEntryByPath('M/'+key).then(function(dirEntry){if(dirEntry===null||dirEntry===undefined){console.warn('Title M/'+key+' not found in the archive');callback();}else {that.readUtf8File(dirEntry,function(dirEntryRead,data){callback(data);});}}).catch(function(e){console.warn('Metadata with key '+key+' not found in the archive',e);callback();});};/**
   * Add Metadata to the ZIM file
   * @param {String} key The key of the metadata to add to the ZIM file
   * @returns {Promise<String>} A Promise that resolves with the metadata string, if it exists
   */ZIMArchive.prototype.addMetadataToZIMFile=function(key){var that=this;var lcaseKey=key.toLocaleLowerCase();return new Promise(function(resolve,reject){that.getMetadata(key,function(data){data=data||'';that[lcaseKey]=data;resolve(data);});});};/**
   * Sets the Zimit metadata for the archive
   */ZIMArchive.prototype.setZimitMetadata=function(){var that=this;// Get the landing page
  return this.file.dirEntryByUrlIndex(this.file.mainPage).then(function(dirEntry){var findRedirectTarget=dirEntry.redirect?function(dirEntry){// If the landing page is a redirect, we need to find the target
  return that.file.dirEntryByUrlIndex(dirEntry.redirectTarget).then(function(newEntry){return newEntry;});}:function(dirEntry){return Promise.resolve(dirEntry);};return findRedirectTarget(dirEntry).then(function(reEntry){// Note that in the case of zimit classic, the values below will be overwritten in the conditional clause
  that.zimitPseudoContentNamespace=reEntry.namespace+'/';that.zimitStartPage=reEntry.namespace+'/'+reEntry.url;that.zimitPrefix=reEntry.url.replace(/\/.*$/,'')+'/';if(that.zimType==='zimit'){return reEntry.readData().then(function(data){var html=that.getUtf8FromData(data);var redirect=html.match(/window\.mainUrl\s*=\s*(['"])https?:\/\/([^/]+)(.+?)\1/);if(redirect&&redirect[2]&&redirect[3]){// Logic added to distinguish between Type 0 and Type 1 Zimit ZIMs
  var relativeZimitPrefix=(reEntry.namespace==='C'?'A/':'')+redirect[2];var zimitStartPage=reEntry.namespace+'/'+relativeZimitPrefix+redirect[3];// Store a full Zimit prefix in the archive object
  that.zimitPrefix=relativeZimitPrefix+'/';that.zimitStartPage=zimitStartPage;that.zimitPseudoContentNamespace=reEntry.namespace+'/'+(reEntry.namespace==='C'?'A/':'');}});}});}).catch(function(e){console.warn('Zimit metadata not found in this archive!',e);});};var zimArchive = {ZIMArchive:ZIMArchive};

  /**
   * Create a ZIMArchive from DeviceStorage location
   * @param {DeviceStorage} storage
   * @param {String} path
   * @param {callbackZIMArchive} callbackReady
   * @param {callbackZIMArchive} callbackError
   * @returns {ZIMArchive}
   */function loadArchiveFromDeviceStorage(storage,path,callbackReady,callbackError){return new zimArchive.ZIMArchive(storage,path,callbackReady,callbackError);}/**
   * Create a ZIMArchive from Files
   * @param {Array.<File>} files
   * @param {callbackZIMArchive} callbackReady
   * @param {callbackZIMArchive} callbackError
   * @returns {ZIMArchive}
   */function loadArchiveFromFiles(files,callbackReady,callbackError){if(files.length>=1){return new zimArchive.ZIMArchive(files,null,callbackReady,callbackError);}}/**
   * @callback callbackPathList
   * @param {Array.<String>} directoryList List of directories
   *//**
   *  Scans the DeviceStorage for archives
   *
   * @param {Array.<DeviceStorage>} storages List of DeviceStorage instances
   * @param {callbackPathList} callbackFunction Function to call with the list of directories where archives are found
   * @param {callbackPathList} callbackError Function to call in case of an error
   */function scanForArchives(storages,callbackFunction,callbackError){var directories=[];var promises=$.map(storages,function(storage){return storage.scanForArchives().then(function(dirs){$.merge(directories,dirs);return true;});});$.when.apply(null,promises).then(function(){callbackFunction(directories);}).catch(function(error){callbackError('Error scanning your device storage : '+error+". If you're using the Firefox OS Simulator, please put the archives in "+"a 'fake-sdcard' directory inside your Firefox profile "+'(ex : ~/.mozilla/firefox/xxxx.default/extensions/fxos_2_x_simulator@mozilla.org/'+'profile/fake-sdcard/wikipedia_en_ray_charles_2015-06.zim)','Error reading Device Storage');});}var zimArchiveLoader = {loadArchiveFromDeviceStorage:loadArchiveFromDeviceStorage,loadArchiveFromFiles:loadArchiveFromFiles,scanForArchives:scanForArchives};

  var PROPER_FUNCTION_NAME = functionName.PROPER;
  var fails = fails$V;
  var whitespaces = whitespaces$5;

  var non = '\u200B\u0085\u180E';

  // check that a method works with the correct list
  // of whitespaces and has a correct name
  var stringTrimForced = function (METHOD_NAME) {
    return fails(function () {
      return !!whitespaces[METHOD_NAME]()
        || non[METHOD_NAME]() !== non
        || (PROPER_FUNCTION_NAME && whitespaces[METHOD_NAME].name !== METHOD_NAME);
    });
  };

  var $$4 = _export;
  var $trim = stringTrim.trim;
  var forcedStringTrimMethod = stringTrimForced;

  // `String.prototype.trim` method
  // https://tc39.es/ecma262/#sec-string.prototype.trim
  $$4({ target: 'String', proto: true, forced: forcedStringTrimMethod('trim') }, {
    trim: function trim() {
      return $trim(this);
    }
  });

  var $$3 = _export;
  var call = functionCall;
  var aCallable = aCallable$h;
  var anObject = anObject$s;
  var getIteratorDirect = getIteratorDirect$4;
  var createIteratorProxy = iteratorCreateProxy;
  var callWithSafeIterationClosing = callWithSafeIterationClosing$3;

  var IteratorProxy = createIteratorProxy(function () {
    var iterator = this.iterator;
    var predicate = this.predicate;
    var next = this.next;
    var result, done, value;
    while (true) {
      result = anObject(call(next, iterator));
      done = this.done = !!result.done;
      if (done) return;
      value = result.value;
      if (callWithSafeIterationClosing(iterator, predicate, [value, this.counter++], true)) return value;
    }
  });

  // `Iterator.prototype.filter` method
  // https://github.com/tc39/proposal-iterator-helpers
  $$3({ target: 'Iterator', proto: true, real: true }, {
    filter: function filter(predicate) {
      anObject(this);
      aCallable(predicate);
      return new IteratorProxy(getIteratorDirect(this), {
        predicate: predicate
      });
    }
  });

  /**
   * Parses a linked article in a loaded document in order to extract the first main paragraph (the 'lede') and first
   * main image (if any). This function currently only parses Wikimedia articles. It returns an HTML string, formatted
   * for display in a popover
   * @param {String} href The href of the article link from which to extract the lede
   * @param {String} baseUrl The base URL of the currently loaded article
   * @param {Document} articleDocument The DOM of the currently loaded article
   * @param {ZIMArchive} archive The archive from which to extract the lede
   * @returns {Promise<String>} A Promise for the linked article's lede HTML including first main image URL if any
   */function getArticleLede(href,baseUrl,articleDocument,archive){var uriComponent=uiUtil.removeUrlParameters(href);var zimURL=uiUtil.deriveZimUrlFromRelativeUrl(uriComponent,baseUrl);console.debug('Previewing '+zimURL);var promiseForArticle=function promiseForArticle(dirEntry){var _this=this;// Wrap legacy callback-based code in a Promise
  return new Promise(function(resolve,reject){_newArrowCheck(this,_this);// As we're reading Wikipedia articles, we can assume that they are UTF-8 encoded HTML data
  archive.readUtf8File(dirEntry,function(fileDirEntry,htmlArticle){var parser=new DOMParser();var doc=parser.parseFromString(htmlArticle,'text/html');var articleBody=doc.body;if(articleBody){// Establish the popup balloon's base URL and the absolute path for calculating the ZIM URL of links and images
  var balloonBaseURL=encodeURI(fileDirEntry.namespace+'/'+fileDirEntry.url.replace(/[^/]+$/,''));var docUrl=new URL(articleDocument.location.href);var rootRelativePathPrefix=docUrl.pathname.replace(/([^.]\.zim\w?\w?\/).+$/i,'$1');// Clean up the lede content
  var nonEmptyParagraphs=cleanUpLedeContent(articleBody);// Concatenate paragraphs to fill the balloon
  var balloonString='';if(nonEmptyParagraphs.length>0){balloonString=fillBalloonString(nonEmptyParagraphs,balloonBaseURL,rootRelativePathPrefix);}// If we have a lede, we can now add an image to the balloon, but only if we are in ServiceWorker mode
  if(balloonString&&params.contentInjectionMode==='serviceworker'){var imageHTML=getImageHTMLFromNode(articleBody,balloonBaseURL,rootRelativePathPrefix);if(imageHTML){balloonString=imageHTML+balloonString;}}if(!balloonString){reject(new Error('No article lede or image'));}else {resolve(balloonString);}}else {reject(new Error('No article body found'));}});}.bind(this));};var processDirEntry=function processDirEntry(dirEntry){var _this2=this;if(!dirEntry)throw new Error('No directory entry found');if(dirEntry.redirect){return new Promise(function(resolve,reject){_newArrowCheck(this,_this2);archive.resolveRedirect(dirEntry,function(reDirEntry){if(!reDirEntry)reject(new Error('Could not resolve redirect'));resolve(promiseForArticle(reDirEntry));});}.bind(this));}else {return promiseForArticle(dirEntry);}};// Do a binary search in the URL index to get the directory entry for the requested article
  return archive.getDirEntryByPath(zimURL).then(processDirEntry).catch(function(err){throw new Error('Could not get Directory Entry for '+zimURL,err);});}function cleanUpLedeContent(node){var _this3=this;// Define an array of exclusion filters
  // (note `.exclude-this-class` is a dummy class used as an example for any future exclusion filters)
  var exclusionFilters=['#pcs-edit-section-title-description','.exclude-this-class'];// Construct the `:not()` CSS exclusion selector list
  var notSelector=exclusionFilters.map(function(filter){_newArrowCheck(this,_this3);return ":not(".concat(filter,")");}.bind(this)).join('');// Remove all standalone style elements from the given DOM node, because their content is shown by innerText and textContent
  var styleElements=Array.from(node.querySelectorAll('style'));styleElements.forEach(function(style){_newArrowCheck(this,_this3);style.parentNode.removeChild(style);}.bind(this));// Apply this style-based exclusion filter to remove unwanted paragraphs in the popover
  var paragraphs=Array.from(node.querySelectorAll("p".concat(notSelector)));// Filter out empty paragraphs or those with less than 50 characters
  var parasWithContent=paragraphs.filter(function(para){_newArrowCheck(this,_this3);// DEV: Note that innerText is not supported in Firefox OS, so we need to use textContent as a fallback
  // The reason we prefer innerText is that it strips out hidden text and unnecessary whitespace, which is not the case with textContent
  var innerText=para.innerText?para.innerText:para.textContent;var text=innerText.trim();return !/^\s*$/.test(text)&&text.length>=50;}.bind(this));return parasWithContent;}// Helper function to concatenate paragraphs to fill the balloon
  function fillBalloonString(paras,baseURL,pathPrefix){var _this4=this;var cumulativeCharCount=0;var concatenatedText='';// Add enough paras to complete the word count
  for(var i=0;i<paras.length;i++){// Get the character count: to fill the larger box we need ~850 characters (815 plus leeway)
  // DEV: Note that innerText is not supported in Firefox OS, so we need to use textContent as a fallback
  var plainText=paras[i].innerText?paras[i].innerText:paras[i].textContent;cumulativeCharCount+=plainText.length;// In ServiceWorker mode, we need to transform the URLs of any links in the paragraph
  if(params.contentInjectionMode==='serviceworker'){var links=Array.from(paras[i].querySelectorAll('a'));links.forEach(function(link){_newArrowCheck(this,_this4);var href=link.getAttribute('href');if(href&&!/^#/.test(href)){var zimURL=uiUtil.deriveZimUrlFromRelativeUrl(href,baseURL);link.href=pathPrefix+encodeURI(zimURL);}}.bind(this));}// Get the transformed HTML. Note that in Restricted mode, we risk breaking the UI if user clicks on an
  // embedded link, so only use plainText in that case
  var content=params.contentInjectionMode==='jquery'?plainText:paras[i].innerHTML;concatenatedText+='<p>'+content+'</p>';// If we have enough characters to fill the box, break
  if(cumulativeCharCount>=850)break;}return concatenatedText;}// Helper function to get the first main image from the given node
  function getImageHTMLFromNode(node,baseURL,pathPrefix){var images=node.querySelectorAll('img');var firstImage=null;if(images){// Iterate over images until we find one with a width greater than 50 pixels
  // (this filters out small icons)
  var imageArray=Array.from(images);for(var j=0;j<imageArray.length;j++){if(imageArray[j]&&imageArray[j].width>50){firstImage=imageArray[j];break;}}}if(firstImage){// Calculate root relative URL of image
  var imageZimURL=encodeURI(uiUtil.deriveZimUrlFromRelativeUrl(firstImage.getAttribute('src'),baseURL));firstImage.src=pathPrefix+imageZimURL;return firstImage.outerHTML;}}/**
   * A function to attach the tooltip CSS for popovers (NB this does not attach the box itself, only the CSS)
   * @param {Document} doc The document to which to attach the popover stylesheet
   * @param {Boolean} dark An optional parameter to adjust the background colour for dark themes (generally not needed for inversion-based themes)
   */function attachKiwixPopoverCss(doc,dark){var colour=dark&&!/invert/i.test(params.cssTheme)?'lightgray':'black';var backgroundColour=dark&&!/invert/i.test(params.cssTheme)?'#121e1e':'#ebf4fb';var borderColour='skyblue !important';// DEV: Firefox OS blocks loading stylesheet files into iframe DOM content even if it is same origin, so we are forced to insert a style element instead
  uiUtil.insertLinkElement(doc,"\n        .kiwixtooltip {\n            position: absolute;\n            bottom: 1em;\n            /* prettify */\n            padding: 0 5px 5px;\n            color: ".concat(colour,";\n            background: ").concat(backgroundColour,";\n            border: 0.1em solid ").concat(borderColour,";\n            /* round the corners */\n            border-radius: 0.5em;\n            /* handle overflow */\n            overflow: visible;\n            text-overflow: ellipsis;\n            /* handle text wrap */\n            overflow-wrap: break-word;\n            word-wrap: break-word;\n            /* add fade-in transition */\n            opacity: 0;\n            transition: opacity 0.3s;\n            z-index: 2;\n        }\n        \n        .kiwixtooltip img {\n            float: right;\n            margin-left: 5px;\n            max-width: 40%;\n            height: auto;\n        }\n        \n        #popcloseicon {\n            padding-top: 1px;\n            padding-right: 2px;\n            font-size: 20px;\n            font-family: sans-serif;\n        }\n        \n        #popcloseicon:hover { \n            cursor: pointer;\n        }\n        \n        #popbreakouticon {\n            height: 18px;\n            margin-right: 18px;\n        }\n        \n        #popbreakouticon:hover {\n            cursor: pointer;\n        }\n        \n        /* Prevent native iOS popover on Safari if option is enabled */\n        body { \n            -webkit-touch-callout: none !important;\n        }\n        "),// The id of the style element for easy manipulation
  'kiwixtooltipstylesheet');}/**
   * Attaches a popover div for the given link to the given document's DOM
   * @param {Event} ev The event which has fired this popover action
   * @param {Element} link The link element that is being actioned
   * @param {Object} state The globlal object defined in app.js that holds the current state of the app
   * @param {Boolean} dark An optional value to switch colour theme to dark if true
   * @param {ZIMArchive} archive The archive from which the popover information is extracted
   * @returns {Promise<div>} A Promise for the attached popover div or undefined if the popover is not attached
   */function populateKiwixPopoverDiv(ev,link,state,dark,archive){// Do not show popover if the user has initiated an article load (set in filterClickEvent)
  if(link.articleisloading||link.popoverisloading)return Promise.resolve();var linkHref=link.getAttribute('href');// Do not show popover if there is no href or with certain landing pages
  if(!linkHref||/^wikivoyage/i.test(archive.file.name)&&(state.expectedArticleURLToBeDisplayed===archive.landingPageUrl||state.expectedArticleURLToBeDisplayed==='A/Wikivoyage:Offline_reader_Expedition/Home_page')){return Promise.resolve();}link.popoverisloading=true;// Do not display a popover if one is already showing for the current link
  var kiwixPopover=ev.target.ownerDocument.querySelector('.kiwixtooltip');// DEV: popoverIsLoading will get reset in app.js after user deselects link
  if(kiwixPopover&&kiwixPopover.dataset.href===linkHref)return Promise.resolve();// console.debug('Attaching popover...');
  var currentDocument=ev.target.ownerDocument;var articleWindow=currentDocument.defaultView;// Remove any existing popover(s) that the user may not have closed before creating a new one
  removeKiwixPopoverDivs(currentDocument);// Timeout below ensures that popovers are not loaded if a user is simply moving their mouse around on a page
  // without hovering. It provides a 600ms pause before app begins the process of binary search and decompression
  setTimeout(function(){// Check if the user has moved away from the link or has clicked it, and abort display of popover if so
  if(link.articleisloading||!link.matches(':hover')&&!link.touched&&currentDocument.activeElement!==link){// Aborting popover display because user has moved away from link or clicked it
  link.popoverisloading=false;return;}// Create a new Kiwix popover container
  var divWithArrow=createNewKiwixPopoverCointainer(articleWindow,link,ev);var div=divWithArrow.div;var span=divWithArrow.span;// Get the article's 'lede' (first main paragraph or two) and the first main image (if any)
  getArticleLede(linkHref,state.baseUrl,currentDocument,archive).then(function(html){div.style.justifyContent='';div.style.alignItems='';div.style.display='block';var breakoutIconFile=window.location.pathname.replace(/\/[^/]*$/,'')+(dark?'/img/icons/new_window_white.svg':'/img/icons/new_window_black.svg');var backgroundColour=dark&&!/invert/i.test(params.cssTheme)?'black':'#ebf4fb';// DEV: Most style declarations in this div only work properly inline. If added in stylesheet, even with !important, the positioning goes awry
  // (appears to be a timing issue related to the reservation of space given that the div is inserted dynamically).
  div.innerHTML="<div style=\"position: relative; overflow: hidden; height: ".concat(div.style.height,";\">\n                <div style=\"background: ").concat(backgroundColour," !important; opacity: 70%; position: absolute; top: 0; right: 0; display: flex; align-items: center; padding: 0; z-index: 1;\">\n                    <img id=\"popbreakouticon\" src=\"").concat(breakoutIconFile,"\" />\n                    <span id=\"popcloseicon\">X</span>\n                </div>\n                <div style=\"padding-top: 3px\">").concat(html,"</div>\n            </div>");// Now it is populated, we can attach the arrow to the div
  div.appendChild(span);// Programme the icons
  addEventListenersToPopoverIcons(link,div,currentDocument);setTimeout(function(){div.popoverisloading=false;},900);}).catch(function(err){console.warn(err);// Remove the div
  div.style.opacity='0';div.parentElement.removeChild(div);link.dataset.touchevoked=false;link.popoverisloading=false;});},600);}/**
   * Create a new empty Kiwix popover container and attach it to the current document appropriately sized and positioned
   * in relation to the given anchor and available screen width and height. Also returns the arrow span element which can be
   * attached to the div after the div is populated with content.
   * @param {Window} win The window of the article DOM
   * @param {Element} anchor The anchor element that is being actioned
   * @param {Event} event The event which has fired this popover action
   * @returns {Object} An object containing the popover div and the arrow span elements
   */function createNewKiwixPopoverCointainer(win,anchor,event){var div=document.createElement('div');var linkHref=anchor.getAttribute('href');var currentDocument=win.document;div.popoverisloading=true;var zoomFactor='zoom'in currentDocument.documentElement.style&&!isSafari()?params.relativeFontSize/100:1;// Account for zoom when calculating available screen width
  var screenWidth=(win.innerWidth-40)/zoomFactor;var screenHeight=document.documentElement.clientHeight;var margin=40;// Base width scaled by zoom factor
  var divWidth=Math.min(512,screenWidth);if(screenWidth<=512){margin=10;}// Check if we have restricted screen height
  var divHeight=screenHeight<512?160:256;div.style.width=divWidth+'px';div.style.height=divHeight+'px';div.style.display='flex';div.style.justifyContent='center';div.style.alignItems='center';div.className='kiwixtooltip';div.innerHTML='<p>Loading ...</p>';div.dataset.href=linkHref;// DEV: We need to insert the div into the target document before we can obtain its computed dimensions accurately
  currentDocument.body.appendChild(div);// Calculate the position of the link that is being hovered
  var rect=anchor.getBoundingClientRect();var linkRect={top:rect.top,bottom:rect.bottom,left:rect.left,right:rect.right,width:rect.width};// Note that since Chromium 128 getBoundingClientRect() now returns zoom-adjusted values, but if this is the case,
  // then currentCSSZoom will be defined as well, so we can adjust for this. Note that UWP also requires adjustment.
  if(/UWP/.test(params.appType)||'MSBlobBuilder'in window||anchor.currentCSSZoom||isSafari()){linkRect.top=linkRect.top/zoomFactor;linkRect.bottom=linkRect.bottom/zoomFactor;linkRect.left=linkRect.left/zoomFactor;linkRect.right=linkRect.right/zoomFactor;linkRect.width=linkRect.width/zoomFactor;}// Initially position the div 20px above the link
  var spacing=20;var triangleDirection='top';var divOffsetHeight=div.offsetHeight+spacing;var divRectY=linkRect.top-divOffsetHeight;var triangleY=divHeight+6;// If we're less than half margin from the top, move the div below the link
  if(divRectY<margin/2){triangleDirection='bottom';divRectY=linkRect.bottom+spacing;triangleY=-16;}// Position it horizontally in relation to the pointer position
  var divRectX,triangleX;if(event.type==='touchstart'){divRectX=event.touches[0].clientX-divWidth/2;triangleX=event.touches[0].clientX-divRectX-spacing;}else if(event.type==='focus'){divRectX=linkRect.left*zoomFactor+linkRect.width/2-divWidth/2;triangleX=linkRect.left*zoomFactor+linkRect.width/2-divRectX-spacing;}else {divRectX=event.clientX-divWidth/2;triangleX=event.clientX-divRectX-spacing;}// If right edge of div is greater than margin from the right side of window, shift it to margin
  if(divRectX+divWidth*zoomFactor>screenWidth-margin){triangleX+=divRectX;divRectX=screenWidth-divWidth*zoomFactor-margin;triangleX-=divRectX;}// If we're less than margin to the left, shift it to margin px from left
  if(divRectX*zoomFactor<margin){triangleX+=divRectX;divRectX=margin;triangleX-=divRectX;}// Adjust triangleX if necessary
  if(triangleX<10)triangleX=10;if(triangleX>divWidth-10)triangleX=divWidth-10;// Adjust positions to take into account the font zoom factor
  var adjustedScrollY=win.scrollY/zoomFactor;if(isSafari()){// We have to reinstate zoomFactor as it is only applied to horizontal positioning in Safari
  zoomFactor=params.relativeFontSize/100;}divRectX=divRectX/zoomFactor;triangleX=triangleX/zoomFactor;// Now set the calculated x and y positions
  div.style.top=divRectY+adjustedScrollY+'px';div.style.left=divRectX+'px';div.style.opacity='1';// Now create the arrow span element. Note that we cannot attach it yet as we need to populate the div first
  // and doing so will overwrite the innerHTML of the div
  var triangleColour=getComputedStyle(div).borderBottomColor;// Same as border colour of div (UWP needs specific border colour)
  var span=document.createElement('span');span.style.cssText="\n        width: 0;\n        height: 0;\n        border-".concat(triangleDirection,": 16px solid ").concat(triangleColour," !important;\n        border-left: 8px solid transparent !important;\n        border-right: 8px solid transparent !important;\n        position: absolute;\n        top: ").concat(triangleY,"px;\n        left: ").concat(triangleX,"px;\n    ");return {div:div,span:span};}function isSafari(){return typeof navigator!=='undefined'&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&CSS.supports('-webkit-backdrop-filter','blur(1px)');}/**
   * Adds event listeners to the popover's control icons
   * @param {Element} anchor The anchor which launched the popover
   * @param {Element} popover The containing element of the popover (div)
   * @param {Document} doc The doucment on which to operate
   */function addEventListenersToPopoverIcons(anchor,popover,doc){var breakout=function breakout(e){// Adding the newcontainer property to the anchor will be cauught by the filterClickEvent function and will open in new tab
  anchor.newcontainer=true;anchor.click();closePopover(popover);};var closeIcon=doc.getElementById('popcloseicon');var breakoutIcon=doc.getElementById('popbreakouticon');// If the icons are not found, do not add event listeners
  if(!closeIcon||!breakoutIcon){console.warn('Popover icons not found in the document');return;}// Add the popoverisloading property to the popover so that it can be removed
  // Register mousedown event (should work in all contexts)
  closeIcon.addEventListener('mousedown',function(){closePopover(popover);},true);breakoutIcon.addEventListener('mousedown',breakout,true);}/**
   * Remove any preview popover DIVs found in the given document
   * @param {Document} doc The document from which to remove any popovers
   */function removeKiwixPopoverDivs(doc){var divs=doc.getElementsByClassName('kiwixtooltip');// Timeout is set to allow for a delay before removing popovers - so user can hover the popover itself to prevent it from closing,
  // or so that links and buttons in the popover can be clicked
  setTimeout(function(){// Gather any popover divs (on rare occasions, more than one may be displayed)
  Array.prototype.slice.call(divs).forEach(function(div){// Do not remove any popover in process of loading
  if(div.popoverisloading)return;var timeoutID;var _fadeOutDiv=function fadeOutDiv(){clearTimeout(timeoutID);// Do not close any div which is being hovered
  if(!div.matches(':hover')){closePopover(div);}else {timeoutID=setTimeout(_fadeOutDiv,250);}};timeoutID=setTimeout(_fadeOutDiv,0);});},400);}/**
   * Closes the specified popover div, with fadeout effect, and removes it from the DOM
   * @param {Element} div The div to close
   */function closePopover(div){div.style.opacity='0';// Timeout allows the animation to complete before removing the div
  setTimeout(function(){if(div&&div.parentElement){div.parentElement.removeChild(div);}},200);}/**
   * Helper function to update tooltip styles for the current theme
   * @param {Document} doc - The document to update
   * @param {boolean} isDark - Whether to apply dark theme styles
   */function updateTooltipStyles(doc,isDark){// Remove existing tooltip stylesheet
  var kiwixTooltipStyleSheet=doc.getElementById('kiwixtooltipstylesheet');if(kiwixTooltipStyleSheet){kiwixTooltipStyleSheet.disabled=true;kiwixTooltipStyleSheet.parentNode.removeChild(kiwixTooltipStyleSheet);}// Attach appropriate tooltip styles
  attachKiwixPopoverCss(doc,isDark);}/**
   * Functions and classes exposed by this module
   */var popovers = {attachKiwixPopoverCss:attachKiwixPopoverCss,populateKiwixPopoverDiv:populateKiwixPopoverDiv,removeKiwixPopoverDivs:removeKiwixPopoverDivs,updateTooltipStyles:updateTooltipStyles};

  var CACHEAPI=params.cacheAPI;// Set the database or cache name here, and synchronize with Service Worker
  var CACHEIDB=params.cacheIDB;// Slightly different name to disambiguate
  var objStore='kiwix-assets';// Name of the object store
  var APPCACHE='kiwix-appCache-'+params.appVersion;// Ensure this is the same as in Service Worker
  // DEV: Regex below defines the permitted MIME types for the cache; add further types as needed
  var regexpMimeTypes=/\b(?:javascript|css|ico|html)\b/;/**
   * Tests the enviornment's caching capabilities and sets assetsCache.capability to the supported level
   *
   * @param {Function} callback Function to indicate that the capability level has been set
   */function test$1(callback){// Test for indexedDB capability
  if(typeof assetsCache.capability!=='undefined'){callback(true);return;}// Set baseline capability
  assetsCache.capability='memory';idxDB('count',function(result){if(result!==false){assetsCache.capability='indexedDB|'+assetsCache.capability;}else {console.log('inexedDB is not supported');}// Test for Cache API
  if('caches'in window&&/https?:/i.test(window.location.protocol)){assetsCache.capability='cacheAPI|'+assetsCache.capability;}else {console.log('CacheAPI is not supported'+(/https?:/i.test(window.location.protocol)?'':' with the '+window.location.protocol+' protocol'));}// Test for localCache capability (this is a fallback, indexedDB is preferred because it permits more storage)
  if(typeof Storage!=='undefined'){try{// If localStorage is really supported, this won't produce an error
  // eslint-disable-next-line no-unused-vars
  var item=window.localStorage.length;assetsCache.capability=assetsCache.capability+'|localStorage';}catch(err){console.log('localStorage is not supported');}}console.log('Setting storage type to '+assetsCache.capability.match(/^[^|]+/)[0]);if(/localStorage/.test(assetsCache.capability)){console.debug("DEV: 'UnknownError' may be produced as part of localStorage capability detection");}callback(result);});}/**
   * Counts the numnber of cached assets
   *
   * @param {Function} callback which will receive an array containing [cacheType, cacheCount]
   */function count(callback){test$1(function(result){var type=null;var description=null;var cacheCount=null;switch(assetsCache.capability.match(/^[^|]+/)[0]){case 'memory':type='memory';description='Memory';cacheCount=assetsCache.size;break;case 'localStorage':type='localStorage';description='LocalStorage';cacheCount=localStorage.length;break;case 'indexedDB':type='indexedDB';description='IndexedDB';// Sometimes we already have the count as a result of test, so no need to look again
  if(typeof result!=='boolean'&&(result===0||result>0)){cacheCount=result;}else {idxDB('count',function(cacheCount){callback({type:type,description:description,count:cacheCount});});}break;case 'cacheAPI':type='cacheAPI';description='CacheAPI';caches.open(CACHEAPI).then(function(cache){cache.keys().then(function(keys){callback({type:type,description:description,count:keys.length});});});break;default:// User has turned off caching
  type='none';description='None';cacheCount='null';}if(cacheCount||cacheCount===0){callback({type:type,description:description,count:cacheCount});}});// Refresh instructions to Service Worker
  if(navigator.serviceWorker&&navigator.serviceWorker.controller){// Create a Message Channel
  var channel=new MessageChannel();navigator.serviceWorker.controller.postMessage({action:{assetsCache:params.assetsCache&&params.contentInjectionMode==='serviceworker'?'enable':'disable',appCache:params.appCache?'enable':'disable',checkCache:window.location.href}},[channel.port2]);}}/**
   * Opens an IndexedDB database and adds or retrieves a key-value pair to it, or performs utility commands
   * on the database
   *
   * @param {String} keyOrCommand The key of the value to be written or read, or commands 'clear' (clears objStore),
   *     'count' (counts number of objects in objStore), 'delete' (deletes a record with key passed in valueOrCallback),
   *      'deleteNonCurrent' (deletes all databases that do not match CACHEIDB - but only works in Chromium currently)
   * @param {Variable} valueOrCallback The value to write, or a callback function for read and command transactions
   * @param {Function} callback Callback for write transactions only - mandatory for delete and write transactions
   */function idxDB(keyOrCommand,valueOrCallback,callback){var value=callback?valueOrCallback:null;var rtnFn=callback||valueOrCallback;if(typeof window.indexedDB==='undefined'){rtnFn(false);return;}// Delete all non-curren IdxDB databases (only works in Chromium currently)
  if(keyOrCommand==='deleteNonCurrent'){if(indexedDB.databases){var result=0;indexedDB.databases().then(function(dbs){dbs.forEach(function(db){if(db.name!==CACHEIDB){result++;indexedDB.deleteDatabase(db.name);}});}).then(function(){rtnFn(result);});}else {rtnFn(false);}return;}// Open (or create) the database
  var open=indexedDB.open(CACHEIDB,1);open.onerror=function(e){// Suppress error reporting if testing (older versions of Firefox support indexedDB but cannot use it with
  // the file:// protocol, so will report an error)
  if(assetsCache.capability!=='test'){console.error('IndexedDB failed to open: '+open.error.message);}rtnFn(false);};// Create the schema
  open.onupgradeneeded=function(){var db=open.result;// eslint-disable-next-line no-unused-vars
  db.createObjectStore(objStore);};open.onsuccess=function(){// Start a new transaction
  var db=open.result;// Set the store to readwrite or read only according to presence or not of value variable
  var tx=value!==null||/clear|delete/.test(keyOrCommand)?db.transaction(objStore,'readwrite'):db.transaction(objStore);var store=tx.objectStore(objStore);var processData;// Process commands
  if(keyOrCommand==='clear'){// Delete all keys and values in the store
  processData=store.clear();}else if(keyOrCommand==='count'){// Count the objects in the store
  processData=store.count();}else if(keyOrCommand==='delete'){// Delete the record with key set to value
  processData=store.delete(value);}else {// Request addition or retrieval of data
  processData=value!==null?store.put(value,keyOrCommand):store.get(keyOrCommand);}// Call the callback with the result
  processData.onsuccess=function(e){if(keyOrCommand==='delete'){rtnFn(true);}else {rtnFn(processData.result);}};processData.onerror=function(e){console.error('IndexedDB command failed: '+processData.error);rtnFn(false);};// Close the db when the transaction is done
  tx.oncomplete=function(){db.close();};};}/**
   * Opens a CacheAPI cache and adds or retrieves a key-value pair to it, or performs utility commands
   * on the cache. This interface also allows the use of callbacks inside the Cache Promise API for ease of
   * interoperability with the interface for idxDB code above.
   *
   * @param {String} keyOrCommand The key of the value to be written or read, or commands 'clear' (clears cache),
   *     'delete' (deletes a record with key passed in valueOrCallback)
   * @param {Variable} valueOrCallback The value to write, or a callback function for read and command transactions
   * @param {Function} callback Callback for write transactions only
   * @param {String} mimetype The MIME type of any content to be stored
   */function cacheAPI(keyOrCommand,valueOrCallback,callback,mimetype){var value=callback?valueOrCallback:null;var rtnFn=callback||valueOrCallback;// Process commands
  if(keyOrCommand==='clear'){caches.delete(CACHEAPI).then(rtnFn);}else if(keyOrCommand==='delete'){caches.open(CACHEAPI).then(function(cache){cache.delete(value).then(rtnFn);});}else if(value===null){// Request retrieval of data
  caches.open(CACHEAPI).then(function(cache){cache.match('../'+keyOrCommand).then(function(response){if(!response){rtnFn(null);}else {response.text().then(function(data){rtnFn(data);});}}).catch(function(err){console.error('Unable to match assets from Cache API!',err);rtnFn(null);});});}else {// Request storing of data in cache
  caches.open(CACHEAPI).then(function(cache){var contentLength;if(typeof value==='string'){var m=encodeURIComponent(value).match(/%[89ABab]/g);contentLength=value.length+(m?m.length:0);}else {contentLength=value.byteLength||value.length;}var headers=new Headers();if(contentLength)headers.set('Content-Length',contentLength);// Prevent CORS issues in PWAs
  // if (contentLength) headers.set('Access-Control-Allow-Origin', '*');
  headers.set('Content-Security-Policy','sandbox allow-scripts allow-same-origin allow-modals allow-popups allow-forms');if(mimetype)headers.set('Content-Type',mimetype);var responseInit={status:200,statusText:'OK',headers:headers};var httpResponse=new Response(value,responseInit);cache.put('../'+keyOrCommand,httpResponse).then(function(){rtnFn(true);}).catch(function(err){console.error('Unable to store assets in Cache API!',err);rtnFn(null);});});}}/**
   * Stores information about the last visited page in a cookie and, if available, in localStorage or indexedDB
   *
   * @param {String} zimFile The filename (or name of first file in set) of the ZIM archive
   * @param {String} article The URL of the article (including namespace)
   * @param {String} content The content of the page to be stored
   * @param {Function} callback Callback function to report the outcome of the operation
   */function setArticle(zimFile,article,content,callback){// Prevent storage if user has deselected the option in Configuration
  if(!params.rememberLastPage){callback(-1);return;}settingsStore$1.setItem(zimFile,article,Infinity);setItem(zimFile,content,'text/html',function(response){callback(response);});}/**
   * Retrieves article contents from cache only if the article's key has been stored in settings store
   * (since checking the store is synchronous, it prevents unnecessary async cache lookups)
   *
   * @param {String} zimFile The filename (or name of first file in set) of the ZIM archive
   * @param {String} article The URL of the article to be retrieved (including namespace)
   * @param {Function} callback The function to call with the result
   */function getArticle(zimFile,article,callback){if(settingsStore$1.getItem(zimFile)===article){getItem(zimFile,callback);}else {callback(false);}}/**
   * Caches the contents of an asset in memory or local storage
   *
   * @param {String} key The database key of the asset to cache
   * @param {String} contents The file contents to be stored in the cache
   * @param {String} mimetype The MIME type of the contents
   * @param {Function} callback Callback function to report outcome of operation
   * @param {Boolean} isAsset Optional indicator that a file is an asset
   */function setItem(key,contents,mimetype,callback,isAsset){// Prevent use of storage if user has deselected the option in Configuration
  // or if the asset is of the wrong type
  if(params.assetsCache===false||!regexpMimeTypes.test(mimetype)){callback(-1);return;}// Check if we're actually setting an article
  // DEV: This code seems to cause more trouble than it's worth with zimit-based archives
  // The code remembers the last loaded article for each ZIM, but because zimit archives often load assets which are misclassified as html MIME types,
  // the code below ends up caching an "article" which cannot in fact be loaded as an article
  if(!/zimit/.test(params.zimType)){var keyArticle=key.match(/([^/]+)\/([AC]\/.+$)/);if(keyArticle&&!isAsset&&/\bx?html\b/i.test(mimetype)&&!/\.(png|gif|jpe?g|css|js|mpe?g|webp|webm|woff2?|eot|mp[43])(\?|$)/i.test(key)){// We're setting an article, so go to setArticle function
  setArticle(keyArticle[1],keyArticle[2],contents,callback);return;}}if(/^localStorage/.test(assetsCache.capability)){localStorage.setItem(key,contents);}else {assetsCache.set(key,contents);}if(/^indexedDB/.test(assetsCache.capability)){idxDB(key,contents,function(result){callback(result);});}else if(/^cacheAPI/.test(assetsCache.capability)){cacheAPI(key,contents,function(result){callback(result);},mimetype);}else {callback(key);}}/**
   * Retrieves a ZIM file asset that has been cached with the addItem function
   * either from the memory cache or local storage
   *
   * @param {String} key The database key of the asset to retrieve
   * @param {Function} callback The function to call with the result
   */function getItem(key,callback){// Only look up assets of the type stored in the cache
  if(params.assetsCache===false){callback(false);return;}// Check if we're actually calling an article
  // DEV: With new ZIM types, we can't know we're retrieving an article...
  // var keyArticle = key.match(/([^/]+)\/(A\/.+$)/);
  // if (keyArticle) { // We're retrieving an article, so go to getArticle function
  //     getArticle(keyArticle[1], keyArticle[2], callback);
  //     return;
  // }
  var contents=null;if(assetsCache.has(key)){contents=assetsCache.get(key);callback(contents);}else if(/^localStorage/.test(assetsCache.capability)){contents=localStorage.getItem(key);callback(contents);}else if(/^cacheAPI/.test(assetsCache.capability)){cacheAPI(key,function(contents){callback(contents);});}else if(/^indexedDB/.test(assetsCache.capability)){idxDB(key,function(contents){if(typeof contents!=='undefined'){// Also store in fast memory cache to prevent repaints
  assetsCache.set(key,contents);}callback(contents);});}else {callback(contents);}}/**
   * Gets an item from the cache, or extracts it from the ZIM if it is not cached. After extracting
   * an item from the ZIM, it is added to the cache if it is of the type specified in regexpKeyTypes.
   *
   * @param {Object} selectedArchive The ZIM archive picked by the user
   * @param {String} key The cache key of the item to retrieve
   * @param {Object} dirEntry If the item's dirEntry has already been looked up, it can optionally be
   *   supplied here (saves a redundant dirEntry lookup)
   * @returns {Promise<String|Uint8Array>} A Promise for the content
   */function getItemFromCacheOrZIM(selectedArchive,key,dirEntry){return new Promise(function(resolve,reject){// First check if the item is already in the cache
  var title=key.replace(/^[^/]+\//,'');getItem(key,function(result){if(result!==null&&result!==false&&typeof result!=='undefined'){// console.debug("Cache supplied " + title);
  if(/\.css$/.test(title)){assetsCache.cssLoading--;if(assetsCache.cssLoading<=0){document.getElementById('articleContent').style.display='';}}resolve(result);return;}// Bypass getting dirEntry if we already have it
  var getDirEntry=dirEntry?function(){return Promise.resolve(dirEntry);}:selectedArchive['getDirEntryByPath'];// Read data from ZIM
  getDirEntry(title).then(function(resolvedDirEntry){if(resolvedDirEntry===null){console.log('Error: asset file not found: '+title);resolve(null);}else {var mimetype=resolvedDirEntry.getMimetype();if(resolvedDirEntry.nullify){console.debug('Zimit filter prevented access to '+resolvedDirEntry.url+'. Storing empty contents in cache.');setItem(key,'',mimetype,function(){});resolve('');return;}var shortTitle=key.replace(/[^/]+\//g,'').substring(0,18);// Since there was no result, post UI messages and look up asset in ZIM
  if(/\bx?html\b/.test(mimetype)&&!resolvedDirEntry.isAsset&&!/\.(png|gif|jpe?g|svg|css|js|mpe?g|webp|webm|woff2?|eot|mp[43])(\?|$)/i.test(resolvedDirEntry.url)){uiUtil.pollSpinner('Loading '+shortTitle+'...');}else if(/(css|javascript|video|vtt)/i.test(mimetype)){uiUtil.pollSpinner('Getting '+shortTitle+'...');}// Set the read function to use according to filetype
  var readFile=/\b(?:x?html|css|javascript)\b/i.test(mimetype)?selectedArchive['readUtf8File']:selectedArchive['readBinaryFile'];readFile(resolvedDirEntry,function(fileDirEntry,content){if(!fileDirEntry&&!content){console.warn('Could not read asset '+title);return;}if(regexpMimeTypes.test(mimetype)){console.debug('Cache retrieved '+title+' from ZIM');// Process any pre-cache transforms
  content=transform(content,title.replace(/^.*\.([^.]+)$/,'$1'));}// Hide article while it is rendering
  if(!fileDirEntry.isAsset&&/\bx?html\b/i.test(mimetype)&&!/\.(png|gif|jpe?g|svg|css|js|mpe?g|webp|webm|woff2?|eot|mp[34])(\?|$)/i.test(key)){// Count CSS so we can attempt to show article before JS/images are fully loaded
  var cssCount=content.match(/<(?:link)[^>]+?href=["']([^"']+)[^>]+>/ig);assetsCache.cssLoading=cssCount?cssCount.length:0;if(assetsCache.cssLoading&&appstate.target==='iframe')document.getElementById('articleContent').style.display='none';}if(/\bcss\b/i.test(mimetype)){assetsCache.cssLoading--;if(assetsCache.cssLoading<=0){document.getElementById('articleContent').style.display='';}}setItem(key,content,mimetype,function(result){if(result===-1);else if(result){console.log('Cache: stored asset '+title);}else {console.error('Cache: failed to store asset '+title);}},fileDirEntry.isAsset);resolve(content);});}}).catch(function(e){reject(new Error('Could not find DirEntry for asset '+title,e));});});});}/**
   * Clears caches (including cookie) according to the scope represented by the 'items' variable
   *
   * @param {String} items 'lastpages' (last visited pages of various archives), 'all' or 'reset'
   * @param {Function} callback Callback function to report the number of items cleared
   */function clear(items,callback){if(!/lastpages|all|reset/.test(items)){if(callback)callback(false);return;}// Delete cookie entries with a key containing '.zim' or '.zimaa' etc. followed by article namespace
  var itemsCount=0;var key;var capability=assetsCache.capability;var zimRegExp=/(?:^|;)\s*([^=]+)=([^;]*)/ig;var currentCookies=document.cookie;var cookieCrumb=zimRegExp.exec(currentCookies);while(cookieCrumb!==null){if(/\.zim\w{0,2}=/i.test(decodeURIComponent(cookieCrumb[0]))){key=cookieCrumb[1];// This expiry date will cause the browser to delete the cookie on next page refresh
  document.cookie=key+'=;expires=Thu, 21 Sep 1979 00:00:01 UTC;';if(items==='lastpages'){assetsCache.delete(key);// See note on loose test below
  if(/localStorage/.test(capability)){localStorage.removeItem(key);}if(/indexedDB/.test(capability)){idxDB('delete',key,function(){});}if(/cacheAPI/.test(capability)){cacheAPI('delete',key,function(){});}itemsCount++;}}cookieCrumb=zimRegExp.exec(currentCookies);}if(items==='all'||items==='reset'){var result;if(/^(memory|indexedDB|cacheAPI)/.test(capability)){itemsCount+=assetsCache.size;result='assetsCache';}// Delete and reinitialize assetsCache
  assetsCache=new Map();assetsCache.capability=capability;// Loose test here ensures we clear localStorage even if it wasn't being used in this session
  if(/localStorage/.test(capability)){if(items==='reset'){itemsCount+=localStorage.length;localStorage.clear();}else {for(var i=localStorage.length;i--;){key=localStorage.key(i);if(/\.zim\w{0,2}/i.test(key)){localStorage.removeItem(key);itemsCount++;}}}result=result?result+' and localStorage':'localStorage';}// Loose test here ensures we clear indexedDB even if it wasn't being used in this session
  if(/indexedDB/.test(capability)){result=result?result+' and indexedDB':'indexedDB';idxDB('count',function(number){itemsCount+=number;idxDB('clear',function(){result=result?result+' ('+itemsCount+' items deleted)':'no assets to delete';console.log('cache.clear: '+result);if(!/^cacheAPI/.test(capability)&&callback)callback(itemsCount);});});}// No need to use loose test here because cacheAPI trumps the others
  if(/^cacheAPI/.test(capability)){result=result?result+' and cacheAPI':'cacheAPI';count(function(number){itemsCount+=number[1];cacheAPI('clear',function(){result=result?result+' ('+itemsCount+' items deleted)':'no assets to delete';console.log('cache.clear: '+result);if(callback)callback(itemsCount);});});}}if(!/^cacheAPI|indexedDB/.test(capability)){result=result?result+' ('+itemsCount+' items deleted)':'no assets to delete';console.log('cache.clear: '+result);if(callback)callback(itemsCount);}}/**
   * Replaces all assets that have the given attribute in the html string with inline tags containing content
   * from the cache entries corresponding to the given zimFile
   * Function is intended for link or script tags, but could be extended
   * Returns the substituted html in the callback function (even if no substitutions were made)
   *
   * @param {String} html The html string to process
   * @param {String} tags The html tag or tags ('link|script') containing the asset to replace;
   *  multiple tags must be separated with a pipe
   * @param {String} attribute The attribute that stores the URL to be substituted
   * @param {String} zimFile The name of the ZIM file (or first file in the file set)
   * @param {Object} selectedArchive The archive selected by the user in app.js
   * @param {Function} callback The function to call with the substituted html
   */function replaceAssetRefsWithUri(html,tags,attribute,zimFile,selectedArchive,callback){// Creates an array of all link tags that have the given attribute
  var regexpTagsWithAttribute=new RegExp('<(?:'+tags+')[^>]+?'+attribute+'=["\']([^"\']+)[^>]+>','ig');var titles=[];var tagArray=regexpTagsWithAttribute.exec(html);while(tagArray!==null){titles.push([tagArray[0],decodeURIComponent(tagArray[1])]);tagArray=regexpTagsWithAttribute.exec(html);}if(!titles.length){callback(html);}// Iterate through the erray of titles, populating the HTML string with substituted tags containing
  // a reference to the content from the Cache or from the ZIM
  assetsCache.busy=titles.length;titles.forEach(function(title){getItemFromCacheOrZIM(selectedArchive,zimFile+'/'+title[1],function(assetContent){assetsCache.busy--;if(assetContent||assetContent===''){var newAssetTag=uiUtil.createNewAssetElement(title[0],attribute,assetContent);html=html.replace(title[0],newAssetTag);}if(!assetsCache.busy)callback(html);});});}/**
   * Provides "Server Side" transformation of textual content "served" to app.js
   * For performance reasons, this is only hooked into content extracted from the ZIM: the transformed
   * content will then be cached in its transformed state
   *
   * @param {String} string The string to transform
   * @param {String} filter An optional filter: only transforms which match the filter will be executed
   * @returns {String} The tranformed content
   */function transform(string,filter){switch(filter){case 'html':// Filter to remove any BOM (causes quirks mode in browser)
  string=string.replace(/^[^<]*/,'');// Filter to open all heading sections
  string=string.replace(/(class=["'][^"']*?collapsible-(?:heading|block)(?!\s+open-block))/g,'$1 open-block');break;}return string;}/**
   * Provide method to verify File System Access API permissions
   *
   * @param {Object} fileHandle The file handle that we wish to verify with the Native Filesystem API
   * @param {Boolean} withWrite Indicates read only or read/write persmissions
   * @returns {Promise<Boolean>} A Promise for a Boolean value indicating whether permission has been granted or not
   */function verifyPermission(fileHandle,withWrite){if(params.useOPFS)return Promise.resolve(true);// No permission prompt required for OPFS
  var opts=withWrite?{mode:'readwrite'}:{};return fileHandle.queryPermission(opts).then(function(permission){if(permission==='granted')return true;return fileHandle.requestPermission(opts).then(function(permission){if(permission==='granted')return true;console.error('Permission for '+fileHandle.name+' was not granted: '+permission);return false;}).catch(function(error){console.warn('Cannot use previously picked file handle programmatically (this is normal) '+fileHandle.name,error);});});}/**
   * Download an archive directly into the picked folder (primarily for use with the Origin Private File System)
   *
   * @param {String} archiveName The name of the archive to download (will be used as the filename)
   * @param {String} archiveUrl An optional URL to download the archive from (if not supplied, will use params.kiwixDownloadServer)
   * @param {Function} callback Callback function to report the progress of the download
   * @returns {Promise<FileSystemFileHandle>} A Promise for a FileHandle object representing the downloaded file
   */function downloadArchiveToPickedFolder(archiveName,archiveUrl,callback){archiveUrl=archiveUrl||params.kiwixDownloadServer+archiveName;if(params.pickedFolder&&params.pickedFolder.getFileHandle){return verifyPermission(params.pickedFolder,true).then(function(permission){if(permission){return params.pickedFolder.getFileHandle(archiveName,{create:true}).then(function(fileHandle){return fileHandle.createWritable().then(function(writer){return fetch(archiveUrl).then(function(response){if(!response.ok){return writer.close().then(function(){// Delete the file
  params.pickedFolder.removeEntry(archiveName).then(function(){throw new Error('HTTP error, status = '+response.status);});});}var loaded=0;var reported=0;return new Response(new ReadableStream({start:function start(controller){var reader=response.body.getReader();var _processResult=function processResult(result){if(result.done){return controller.close();}loaded+=result.value.byteLength;if(loaded-reported>=1048576){// 1024 * 1024
  reported=loaded;if(callback){callback(reported);}else console.debug('Downloaded '+reported+' bytes so far...');}controller.enqueue(result.value);return reader.read().then(_processResult);};return reader.read().then(_processResult);}})).body.pipeTo(writer).then(function(){if(callback)callback('completed');return true;}).catch(function(err){console.error('Error downloading archive',err);if(callback)callback('error');writer.close().then(function(){// Delete the file
  params.pickedFolder.removeEntry(archiveName).then(function(){throw err;});});});});});});}else {throw new Error('Write permission not granted!');}}).catch(function(err){console.error('Error downloading archive',err);throw err;});}else {return Promise.reject(new Error('No picked folder available!'));}}/**
   * Imports the picked files into the OPFS file system
   *
   * @param {Array} files An array of File objects to import
   */function importOPFSEntries(files){return Promise.all(files.map(function(file){return params.pickedFolder.getFileHandle(file.name,{create:true}).then(function(fileHandle){return fileHandle.createWritable().then(function(writer){uiUtil.pollOpsPanel('<span class="glyphicon glyphicon-refresh spinning"></span>&emsp;<b>Please wait:</b> Importing '+file.name+'...',true);return writer.write(file).then(function(){uiUtil.pollOpsPanel('<span class="glyphicon glyphicon-refresh spinning"></span>&emsp;<b>Please wait:</b> Imported '+file.name+'...',true);return writer.close();});});});}));}/**
   * Exports an entry from the OPFS file system to the user-visible file system
   *
   * @param {String} name The filename of the entry to export
   * @returns {Promise<Boolean>} A Promise for a Boolean value indicating whether the export was successful
   */function exportOPFSEntry(name){if(navigator&&navigator.storage&&'getDirectory'in navigator.storage){return navigator.storage.getDirectory().then(function(dir){return dir.getFileHandle(name).then(function(fileHandle){try{// Obtain a file handle to a new file in the user-visible file system
  // with the same name as the file in the origin private file system.
  return window.showSaveFilePicker({suggestedName:fileHandle.name||''}).then(function(saveHandle){return saveHandle.createWritable().then(function(writable){return fileHandle.getFile().then(function(file){return writable.write(file).then(function(){writable.close();return true;});});});});}catch(err){console.error(err.name,err.message);return false;}}).catch(function(err){console.error('Unable to get file handle from OPFS',err);return false;});}).catch(function(err){console.error('Unable to get directory from OPFS',err);return false;});}}/**
   * Deletes an entry from the OPFS file system
   *
   * @param {String} name The filename of the entry to delete
   */function deleteOPFSEntry(name){if(navigator&&navigator.storage&&'getDirectory'in navigator.storage){return navigator.storage.getDirectory().then(function(dirHandle){return iterateOPFSEntries().then(function(entries){var baseName=name.replace(/\.zim[^.]*$/i,'');entries.forEach(function(entry){if(~entry.indexOf(baseName)){return dirHandle.removeEntry(entry).then(function(){console.log('Deleted '+entry+' from OPFS');populateOPFSStorageQuota();}).catch(function(err){console.error('Unable to delete '+entry+' from OPFS',err);});}});}).catch(function(err){console.error('Unable to get directory from OPFS',err);});}).catch(function(err){console.error('Unable to get directory from OPFS',err);});}}/**
   * Iterates an iterable entry list of files using the File System API and returns an array of entries found
   *
   * @param {Iterator} entries An asychronous iterator of entries derived from a directory handle
   * @param {Array} archives An array to which to add the entries (may be an empty array)
   * @param {Boolean} noFilter An optional flag to indicate that no filtering should be applied to the entries
   * @returns {Promise<Array>} A Promise for an array of entries in the file system directory
   */function iterateAsyncDirEntries(entries,archives,noFilter){return entries.next().then(function(result){if(!result.done){var entry=result.value[1];if(/\.zim(\w\w)?$/.test(entry.name)){if(noFilter)archives.push(entry);// Hide all parts of split file except first in UI
  else if(/\.zim(aa)?$/.test(entry.name))archives.push(entry.name);// In an Electron app, we should be able to get the path of the files
  if(window.fs&&!params.pickedFolder.path){entry.getFile().then(function(file){params.pickedFolder.path=file.path;});}}return iterateAsyncDirEntries(entries,archives,noFilter);}else {// We've processed all the entries
  return archives;}}).catch(function(err){throw err;});}/**
   * Iterates the OPFS file system and returns an array of entries found
   *
   * @returns {Promise<Array>} A Promise for an array of entries in the OPFS file system
   */function iterateOPFSEntries(){if(navigator&&navigator.storage&&'getDirectory'in navigator.storage){return navigator.storage.getDirectory().then(function(dirHandle){var entries=dirHandle.entries();return iterateAsyncDirEntries(entries,[]).then(function(archiveList){return archiveList;}).catch(function(err){console.error('Unable to iterate OPFS entries',err);throw err;});});}}/**
   * Gets the OPFS storage quota and populates the OPFSQuota panel
   *
   * @returns {Promise} A Promise that populates the OPFSQuota panel
   */function populateOPFSStorageQuota(){if(navigator&&navigator.storage&&'estimate'in navigator.storage){return navigator.storage.estimate().then(function(estimate){var percent=(estimate.usage/estimate.quota*100).toFixed(2);appstate.OPFSQuota=estimate.quota-estimate.usage;document.getElementById('OPFSQuota').innerHTML='<b>OPFS storage quota:</b><br />Used:&nbsp;<b>'+percent+'%</b>; Remaining:&nbsp;<b>'+(appstate.OPFSQuota/1024/1024/1024).toFixed(2)+'&nbsp;GB</b>';});}}/**
   * Request persistent storage for the app
   * This function should be called when OPFS access is first requested
   *
   * @returns {Promise} A Promise that resolves when persistent storage is granted
   */function requestPersistentStorage(){if(navigator.storage&&navigator.storage.persist){return navigator.storage.persisted().then(function(isPersisted){if(!isPersisted){return navigator.storage.persist().then(function(permission){if(permission){console.log('Persistent Storage granted.');}else {console.warn('Persistent Storage denied (this is normal in Chromium browsers).');}return true;});}else {console.debug('Persistent Storage already granted.');return true;}});}else {console.warn('Persistent Storage API not supported!');return Promise.resolve(false);}}/**
   * Wraps a semaphor in a Promise. A function can signal that it is done by setting a sempahor to true,
   * if it has first set it to false at the outset of the procedure. Ensure no other functions use the same
   * sempahor. The semaphor must be an object key of the app-wide assetsCache object.
   *
   * @param {String} semaphor The name of a semaphor key in the assetsCache object
   * @param {String|Object} value An optional value or object to pass in the resolved promise
   * @returns {Promise} A promise that resolves when assetsCache[semaphor] is true
   */function wait(semaphor,value){var p=new Promise(function(resolve){setTimeout(function awaitCache(){if(assetsCache[semaphor]){return resolve(value);}setTimeout(awaitCache,300);},0);});return p;}var cache = {APPCACHE:APPCACHE,CACHEAPI:CACHEAPI,test:test$1,count:count,idxDB:idxDB,cacheAPI:cacheAPI,setArticle:setArticle,getArticle:getArticle,setItem:setItem,getItem:getItem,clear:clear,wait:wait,getItemFromCacheOrZIM:getItemFromCacheOrZIM,replaceAssetRefsWithUri:replaceAssetRefsWithUri,verifyPermission:verifyPermission,downloadArchiveToPickedFolder:downloadArchiveToPickedFolder,importOPFSEntries:importOPFSEntries,exportOPFSEntry:exportOPFSEntry,deleteOPFSEntry:deleteOPFSEntry,iterateAsyncDirEntries:iterateAsyncDirEntries,iterateOPFSEntries:iterateOPFSEntries,populateOPFSStorageQuota:populateOPFSStorageQuota,requestPersistentStorage:requestPersistentStorage};

  /**
   * The Window on which to operate
   */var container;/**
   * A variable to keep track of how many images are being extracted by the extractor
   */var extractorBusy=0;/**
   * A variable to signal that the current image processing queue should be abandoned (e.g. because user scrolled)
   */var abandon=false;/**
   * A regular expression to find MathTex in an image
   */var transformMathTextRegexp=/<img\s+(?=[^>]+?math-fallback-image)[^>]*?alt\s*=\s*(['"])((?:[^"']|(?!\1)[\s\S])+)[^>]+>/ig;/**
   * Iterates over an array or collection of image nodes, extracting the image data from the ZIM
   * and inserting a BLOB URL to each image in the image's src attribute
   *
   * @param {Object} images An array or collection of DOM image nodes
   * @param {Function} callback An optional function to call when all requested images have been loaded
   */function extractImages(images,callback){var remaining=images.length;if(!remaining&&callback)callback();var checkBatch=function checkBatch(){extractorBusy--;remaining--;if(!remaining&&callback)callback();if(!remaining)queueImages();};Array.prototype.slice.call(images).forEach(function(image){if(image.tagName!=='IMG'){insertMediaBlobsJQuery(image);return;}var imageUrl=image.getAttribute('data-kiwixurl');if(!imageUrl){remaining--;return;// Create data-kiwixsrc needed for stylesheets
  }else {image.setAttribute('data-kiwixsrc',imageUrl);}image.removeAttribute('data-kiwixurl');var title=decodeURIComponent(imageUrl);// Get any data-kiwixsrcset
  var srcset=image.getAttribute('data-kiwixsrcset');var srcsetArr=[];if(srcset){// We need to get the array of images in the srcset
  srcsetArr=srcset.split(',');}extractorBusy++;if(/^data:image\/webp/i.test(imageUrl)){image.style.transition='opacity 0.3s ease-in';image.style.opacity='1';uiUtil.feedNodeWithBlob(image,'src',imageUrl,'image/webp',params.manipulateImages||params.allowHTMLExtraction,function(){checkBatch();});return;}if(params.contentInjectionMode==='serviceworker'&&!(params.manipulateImages||params.allowHTMLExtraction)){var _transition=function transition(){image.style.transition='opacity 0.3s ease-in';image.style.opacity='1';removeEventListener('load',_transition);};image.addEventListener('load',_transition);// Let's remove kiwix-display from the end of the url so that the SW will ask for the image
  image.src=imageUrl.replace(/\?kiwix-display/,'');// Timeout allows the loop to complete so we get an accurate busy count
  setTimeout(function(){checkBatch();});return;}// Zimit files (at least) will sometimes have a ZIM prefix, but we are extracting raw here
  title=title.replace(appstate.selectedArchive.file.name+'/','');// Zimit files store URLs encoded!
  if(params.zimType==='zimit')title=encodeURI(title);appstate.selectedArchive.getDirEntryByPath(title).then(function(dirEntry){if(!dirEntry){console.warn('Could not find DirEntry for image: '+title);checkBatch();return;}return appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,content){image.style.background='';var mimetype=dirEntry.getMimetype();uiUtil.feedNodeWithBlob(image,'src',content,mimetype,params.manipulateImages||params.allowHTMLExtraction,function(){if(srcsetArr.length){// We need to process each image in the srcset
  // Empty or make a new srcset
  image.srcset='';var srcsetCount=srcsetArr.length;srcsetArr.forEach(function(imgAndResolutionUrl){srcsetCount--;// Get the url and the resolution from the srcset entry
  var urlMatch=imgAndResolutionUrl.match(/^\s*([^\s]+)\s+([0-9.]+\w+)\s*$/);var url=urlMatch?urlMatch[1]:'';var resolution=urlMatch?urlMatch[2]:'';appstate.selectedArchive.getDirEntryByPath(url).then(function(srcEntry){appstate.selectedArchive.readBinaryFile(srcEntry,function(fileDirEntry,content){var mimetype=srcEntry.getMimetype();uiUtil.getDataUriFromUint8Array(content,mimetype).then(function(dataUri){// Add the dataUri to the srcset
  image.srcset+=(image.srcset?', ':'')+dataUri+' '+resolution;if(srcsetCount===0){checkBatch();}}).catch(function(e){console.error('Could not get dataUri for image:'+url,e);if(srcsetCount===0)checkBatch();});});}).catch(function(e){console.error('Could not find DirEntry for image:'+url,e);if(srcsetCount===0)checkBatch();});});}else {checkBatch();}});image.style.transition='opacity 0.3s ease-in';image.style.opacity='1';});}).catch(function(e){console.error('Could not find DirEntry for image: '+title,e);checkBatch();});});}/**
   * Iterates over an array or collection of image nodes, preparing each node for manual image
   * extraction when user taps the indicated area
   *
   */function prepareManualExtraction(win){container=win;var doc=container.document;var documentImages=doc.querySelectorAll('img');for(var i=0,l=documentImages.length;i<l;i++){var originalHeight=documentImages[i].getAttribute('height')||'';// Ensure 36px clickable image height so user can request images by tapping
  documentImages[i].height='36';documentImages[i].style.background='lightblue';documentImages[i].style.opacity='1';documentImages[i].dataset.kiwixheight=originalHeight;documentImages[i].dataset.kiwixhidden='true';documentImages[i].addEventListener('click',function(e){// Line below ensures documentImages remains in scope
  var thisImage=e.currentTarget;// Exit function if image was already extracted
  if(!thisImage.dataset.kiwixurl)return;// Cancel event bubbling, so that we don't navigate away from the article if the image is hyperlinked
  e.preventDefault();e.stopPropagation();// DEV: Algorithm below doesn't queue webp images correctly, so for now we will extract images
  // only one-by-one on image click
  // var visibleImages = queueImages('poll', 0, function() { extractImages(visibleImages); }).visible;
  // visibleImages.forEach(function (image) {
  //    image.style.opacity = '0';
  //    if (image.dataset.kiwixheight) image.height = image.dataset.kiwixheight;
  //    else image.removeAttribute('height');
  // });
  thisImage.style.opacity='0';if(thisImage.dataset.kiwixheight)thisImage.height=thisImage.dataset.kiwixheight;else thisImage.removeAttribute('height');delete thisImage.dataset.kiwixhidden;extractImages([thisImage]);});}}// Image store is a buffer for images that are waiting for the extractor to finish
  var imageStore=[];var maxImageBatch=1;/**
   * Sorts an array or collection of image nodes, returning a list of those that are inside the visible viewport
   *
   * @param {Array} docImgs The array of images to process
   * @param {String} action If null, imageStore only will be processed; if 'extract', documentImages in viewport will be
   *     extracted; if 'poll', will just return the visible and remaining image arrays
   * @param {Number} margin An extra margin to add to the top (-) or bottom (+) of windows.innerHeight
   * @param {Function} callback Function to call when last image has been extracted (only called if <extract> is true)
   * @returns {Object} An object with two arrays of images, visible and remaining
   */function queueImages(docImgs,action,margin,callback){if(abandon){for(var q=imageStore.length;q--;){imageStore[q].queued=false;}// console.log('User scrolled: abandoning image queue...')
  imageStore=[];}if(imageStore.length&&!extractorBusy){extractImages(imageStore.splice(0,imageStore.length<maxImageBatch?imageStore.length:maxImageBatch));}if(!action||!docImgs.length){if(callback)setTimeout(callback);return;}margin=margin||0;var visible=[];var remaining=[];var batchCount=0;// console.log('Images requested...');
  for(var i=0,l=docImgs.length;i<l;i++){if(docImgs[i].queued||docImgs[i].tagName==='IMG'&&!docImgs[i].dataset.kiwixurl)continue;if(uiUtil.isElementInView(container,docImgs[i],null,margin)){visible.push(docImgs[i]);if(action!=='extract')continue;docImgs[i].queued=true;if(extractorBusy<maxImageBatch){batchCount++;console.debug('Extracting image #'+i);extractImages([docImgs[i]],function(){batchCount--;if(callback&&!batchCount)callback();});}else {console.log('Queueing image #'+i);imageStore.push(docImgs[i]);}}else {remaining.push(docImgs[i]);}}// Callback has to be run inside a timeout because receiving function will expect the visible and remaining arrays to
  // have been returned before running callback code; NB if images have been scheduled for extraction, callback will be
  // called above instead of here, but we still need this in case there are no immediately visible images
  if(callback&&!batchCount)setTimeout(callback);return {visible:visible,remaining:remaining};}/**
   * Prepares the article container in order to process the image nodes that have been disabled in Service Worker
   *
   * @param {Window} win The Window of the iframe tab that contains the document
   * @param {Boolean} forPrinting If true, extracts all images
   */function prepareImagesServiceWorker(win,forPrinting){container=win;var doc=container.document;var documentImages=doc.querySelectorAll('img:not([src^="data:"])');// Schedule loadMathJax here in case next line aborts this function
  setTimeout(function(){loadMathJax();},1000);if(!forPrinting&&!documentImages.length)return;var imageHtml;var indexRoot=window.location.pathname.replace(/[^/]+$/,'')+encodeURI(appstate.selectedArchive.file.name)+'/';for(var i=0,l=documentImages.length;i<l;i++){// Process Wikimedia MathML, but not if we'll be using the jQuery routine later
  if(!(params.manipulateImages||params.allowHTMLExtraction)){imageHtml=documentImages[i].outerHTML;if(params.useMathJax&&/\bmath\/tex\b/i.test(imageHtml)){params.containsMathTex=true;documentImages[i].outerHTML=imageHtml.replace(transformMathTextRegexp,function(p0,p1,math){// Remove any rogue ampersands in MathJax due to double escaping (by Wikipedia)
  math=math.replace(/&amp;/g,'&');return '<script type="math/tex">'+math+'</script>';});}}// Remove unneeded proprietary lazyload
  documentImages[i].removeAttribute('loading');// We exempt images that are from the file system
  var src=documentImages[i].getAttribute('src');if(!~src.indexOf(window.location.protocol)&&!/data:image/i.test(src)){documentImages[i].dataset.kiwixurl=documentImages[i].getAttribute('src');if(params.imageDisplayMode==='progressive'){documentImages[i].style.opacity='0';}if(params.manipulateImages||params.allowHTMLExtraction){documentImages[i].outerHTML=documentImages[i].outerHTML.replace(params.regexpTagsWithZimUrl,function(match,blockStart,equals,quote,relAssetUrl,querystring,blockEnd){var parameters=relAssetUrl.replace(/^[^?]+/,'');var assetZIMUrlEnc;if(params.zimType==='zimit'&&!relAssetUrl.indexOf(indexRoot)){assetZIMUrlEnc=relAssetUrl.replace(indexRoot,'');}else {// DEV: Note that deriveZimUrlFromRelativeUrl produces a *decoded* URL (and incidentally would remove any URI component
  // if we had captured it). We therefore re-encode the URI with encodeURI (which does not encode forward slashes) instead
  // of encodeURIComponent.
  assetZIMUrlEnc=encodeURI(uiUtil.deriveZimUrlFromRelativeUrl(relAssetUrl,params.baseURL))+parameters;}return blockStart+'data-kiwixurl'+equals+assetZIMUrlEnc+blockEnd;});}}}if(params.manipulateImages||params.allowHTMLExtraction){prepareImagesJQuery(win,forPrinting);return;}if(forPrinting){if(params.preloadAllImages)uiUtil.pollSpinner();extractImages(documentImages,params.preloadingAllImages?params.preloadAllImages:params.printImagesLoaded);}else {if(params.imageDisplayMode==='manual'){prepareManualExtraction(container);}else {// We need to start detecting images after the hidden articleContent has been displayed (otherwise they are not detected)
  setTimeout(function(){lazyLoad(documentImages);},400);}}}/**
   * Prepares the article container in order to process the image nodes that have been disabled in the DOM
   *
   * @param {Window} win The Window of the iframe or tab that contains the document
   * @param {Boolean} forPrinting If true, extracts all images
   */function prepareImagesJQuery(win,forPrinting){container=win;var doc=container.document;var documentImages=doc.querySelectorAll('img[data-kiwixurl], img[data-kiwixsrcset], video, audio');var indexRoot=window.location.pathname.replace(/[^/]+$/,'')+encodeURI(appstate.selectedArchive.file.name)+'/';indexRoot=indexRoot.replace(/^\//,'');// Zimit ZIMs work better if all images are extracted
  if(/zimit/.test(params.zimType))forPrinting=true;// In case there are no images in the doc, we need to schedule the loadMathJax function here
  setTimeout(function(){loadMathJax();},1000);if(!forPrinting&&!documentImages.length)return;// Firefox squashes empty images, but we don't want to alter the vertical heights constantly as we scroll
  // so substitute empty images with a plain svg
  var image;for(var i=documentImages.length;i--;){image=documentImages[i];if(image.tagName==='IMG'){image.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E";image.style.opacity='0';// Set a minimum width to avoid some images not rendering in squashed hidden tables
  if(params.displayHiddenBlockElements&&image.width&&!image.style.minWidth&&/wiki|wiktionary/i.test(appstate.selectedArchive.file.name)){var imgX=image.width+'';imgX=imgX.replace(/(\d+)$/,'$1px');image.style.minWidth=imgX;}if(params.zimType==='zimit'&&!image.dataset.kiwixurl.indexOf(indexRoot)){image.dataset.kiwixurl=image.dataset.kiwixurl.replace(indexRoot,'');}}}if(forPrinting||params.imageDisplayMode==='all'){extractImages(documentImages,params.preloadingAllImages?params.preloadAllImages:params.printImagesLoaded);}else if(params.imageDisplayMode==='progressive'){// We need to start detecting images after the hidden articleContent has been displayed (otherwise they are not detected)
  setTimeout(function(){lazyLoad(documentImages);},400);}else {// User wishes to extract images manually
  prepareManualExtraction(container);}}/**
   * Extracts media blobs in Restricted mode and offers to download them
   * @param {Node} medium A DOM node representing a medium
   */function insertMediaBlobsJQuery(medium){var trackBlob;var media=[medium];// Ensure we have a source or sources
  if(!medium.getAttribute('src')){media=medium.querySelectorAll('source');}Array.prototype.slice.call(media).forEach(function(mediaSource){var source=mediaSource.getAttribute('src');source=source?uiUtil.deriveZimUrlFromRelativeUrl(source,params.baseURL):null;if(!source||!params.regexpZIMUrlWithNamespace.test(source)){if(source)console.error('No usable media source was found for: '+source);return;}var mediaElement=/audio|video/i.test(mediaSource.tagName)?mediaSource:mediaSource.parentElement;// If the "controls" property is missing, we need to add it to ensure jQuery-only users can operate the video. See kiwix-js #760.
  if(/audio|video/i.test(mediaElement.tagName)&&!mediaElement.hasAttribute('controls'))mediaElement.setAttribute('controls','');// Create custom subtitle / cc load menu if it doesn't already exist
  if(!container.document.getElementById('kiwixCCMenu')){buildCustomCCMenu(container.document,mediaElement,function(ccBlob){trackBlob=ccBlob;});}// Load media file
  appstate.selectedArchive.getDirEntryByPath(decodeURIComponent(source)).then(function(dirEntry){return appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,mediaArray){var mimeType=mediaSource.type?mediaSource.type:dirEntry.getMimetype();var blob=new Blob([mediaArray],{type:mimeType});mediaSource.src=URL.createObjectURL(blob);// In Firefox and Chromium it is necessary to re-register the inserted media source
  // but do not reload for text tracks (closed captions / subtitles)
  if(/track/i.test(mediaSource.tagName))return;mediaElement.load();// Add a download link in case media source not supported
  if(container.kiwixType==='iframe'){var iframe=container.document;document.getElementById('alertBoxFooter').innerHTML='<div id="downloadAlert" class="alert alert-info alert-dismissible">\n'+'    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>\n'+'    <span id="alertMessage"></span>\n'+'</div>\n';var alertMessage=document.getElementById('alertMessage');var filename=iframe.title+'_'+dirEntry.url.replace(/^.*\/([^/]+)$/,'$1');// Make filename safe
  filename=filename.replace(/[/\\:*?"<>|]/g,'_');alertMessage.innerHTML='<a href="#" class="alert-link" id="downloadMedia">Download this file</a> (and any selected subtitles) to play with another app';document.getElementById('downloadMedia').addEventListener('click',function(){var downloadFiles=[];downloadFiles.push({blob:blob,filename:filename,src:mediaSource.src});// Add any selected subtitle file to the download package
  var selTextTrack=iframe.getElementById('kiwixSelCC');if(selTextTrack){var selTextExt=selTextTrack.dataset.kiwixurl.replace(/^.*\.([^.]+)$/,'$1');// Subtitle files should have same name as video + .es.vtt (for example)
  downloadFiles.push({blob:trackBlob,filename:filename.replace(/^(.*)\.[^.]+$/,'$1.'+selTextTrack.srclang+'.'+selTextExt),src:selTextTrack.src});}for(var j=downloadFiles.length;j--;){if(typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'){uiUtil.downloadBlobUWP(downloadFiles[j].blob,downloadFiles[j].filename,alertMessage);}else {var mimeType=downloadFiles[j].blob.type?downloadFiles[j].blob.type:'application/octet-stream';var a=document.createElement('a');a.href=downloadFiles[j].src;a.target='_blank';a.type=mimeType;a.download=downloadFiles[j].filename;alertMessage.appendChild(a);// NB we have to add the anchor to the document for Firefox to be able to click it
  try{a.click();}catch(err){// If the click fails, use an alternative download method
  if(window.navigator&&window.navigator.msSaveBlob){// This works for IE11
  window.navigator.msSaveBlob(downloadFiles[j].blob,downloadFiles[j].filename);}}}}articleContainer.addEventListener('unload',function(e){alertMessage.remove();});});}});});});// For TED ZIMs, the initial video div height is set incorectly, so we correct it
  var videoWrapper=container.document.getElementById('video-wrapper');if(videoWrapper)videoWrapper.style.height='auto';}/**
   * Create a custom dropdown menu item beneath the given mediaElement (audio or video block) to allow the user to
   * select the language of text tracks (subtitles/CC) to extract from the ZIM (this is necessary because there is
   * no universal onchange event that fires for subtitle changes in the html5 video widget when the URL is invalid)
   *
   * @param {Document} doc The document in which the new menu will be placed (usually window.document or iframe)
   * @param {Element} mediaElement The media element (usually audio or video block) which contains the text tracks
   * @param {Function} callback The function to call wtih the blob
   */function buildCustomCCMenu(doc,mediaElement,callback){var optionList=[];var langs='';var src='';var currentTracks=mediaElement.getElementsByTagName('track');// Extract track data from current media element
  for(var i=currentTracks.length;i--;){langs=currentTracks[i].label+' ['+currentTracks[i].srclang+']';src=currentTracks[i].getAttribute('src');src=src?uiUtil.deriveZimUrlFromRelativeUrl(src,params.baseURL):null;if(src&&params.regexpZIMUrlWithNamespace.test(src)){optionList.unshift('<option value="'+currentTracks[i].srclang+'" data-kiwixsrc="'+src+'" data-kiwixkind="'+currentTracks[i].kind+'">'+langs+'</option>');}currentTracks[i].parentNode.removeChild(currentTracks[i]);}optionList.unshift('<option value="" data-kiwixsrc="">None</option>');var newKiwixCCMenu='<select id="kiwixCCMenuLangList">\n'+optionList.join('\n')+'\n</select>';// Create the new container and menu
  var d=doc.createElement('DIV');d.id='kiwixCCMenu';d.setAttribute('style','margin-top: 1em; text-align: left; position: relative;');d.innerHTML='Please select subtitle language: '+newKiwixCCMenu;mediaElement.parentElement.insertBefore(d,mediaElement.nextSibling);// Add event listener to extract the text track from the ZIM and insert it into the media element when the user selects it
  newKiwixCCMenu=doc.getElementById('kiwixCCMenu').addEventListener('change',function(v){var existingCC=doc.getElementById('kiwixSelCC');if(existingCC)existingCC.parentNode.removeChild(existingCC);var sel=v.target.options[v.target.selectedIndex];if(!sel.value)return;// User selected "none"
  appstate.selectedArchive.getDirEntryByPath(sel.dataset.kiwixsrc).then(function(dirEntry){return appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,trackContents){var blob=new Blob([trackContents],{type:'text/vtt'});var t=doc.createElement('track');t.id='kiwixSelCC';t.kind=sel.dataset.kiwixkind;t.label=sel.innerHTML;t.srclang=sel.value;t.default=true;t.src=URL.createObjectURL(blob);t.dataset.kiwixurl=sel.dataset.kiwixsrc;mediaElement.appendChild(t);callback(blob);});});});}/**
   * Processes an array or collection of image nodes so that they will be lazy loaded (progressive extraction)
   *
   * @param {Object} documentImages An array or collection of DOM image nodes which will be processed for
   *        progressive image extraction
   */function lazyLoad(documentImages){// The amount by which to offset the second reading of the viewport
  var offset=window.innerHeight*2;// Perform an immediate extraction of visible images so as not to disconcert the user
  // We request images twice because frequently the position of all of them is not known at this stage in rendering
  queueImages(documentImages,'extract',0,function(){queueImages(documentImages,'extract',offset);});if(!documentImages.length)return;// There are images remaining, so set up an event listener to load more images once user has stopped scrolling the iframe or window
  var scrollPos;// var rateLimiter = 0;
  var rate=8;// DEV: Set the milliseconds to wait before allowing another iteration of the image stack
  var timeout;// NB we add the event listener this way so we can access it in app.js
  container.onscroll=function(){abandon=true;clearTimeout(timeout);var velo=container.pageYOffset-scrollPos;timeout=setTimeout(function(){// We have stopped scrolling
  // console.log("Stopped scrolling; velo=" + velo);
  queueImages(documentImages);abandon=false;queueImages(documentImages,'extract',0,function(){queueImages(documentImages,'extract',velo>=0?offset:-offset);});},rate);scrollPos=container.pageYOffset;};}/**
   * Attaches KaTeX scripts to the window of the document, if there is MathML to process
   *
   * @param {Object} win The window that contains the document to be processed
   * @returns {Null} Returns null if the function was aborted
   */function loadMathJax(win){if(!params.useMathJax)return;container=container||win;var doc=container.document;var prefix='';if(params.contentInjectionMode==='serviceworker'){params.containsMathSVG=/<img\s+(?=[^>]+?math-fallback-image)[^>]*?alt\s*=\s*['"][^'"]+[^>]+>/i.test(doc.body.innerHTML);prefix=document.location.href.replace(/index\.html(?:$|[#?].*$)/,'');}if(params.containsMathTexRaw||params.containsMathTex||params.containsMathSVG){var script1,script2,script3;var link=doc.createElement('link');link.rel='stylesheet';link.href=prefix+'js/katex/katex.min.css';doc.head.appendChild(link);script1=doc.createElement('script');script1.type='text/javascript';// script.src = "js/MathJax/MathJax.js?config=TeX-AMS_HTML-full";
  script1.src=prefix+'js/katex/katex.min.js';if(params.containsMathTex){script2=doc.createElement('script');script2.type='text/javascript';script2.src=prefix+'js/katex/contrib/mathtex-script-type.min.js';}if(params.containsMathTex||params.containsMathTexRaw){script3=doc.createElement('script');script3.type='text/javascript';script3.src=prefix+'js/katex/contrib/auto-render.min.js';script3.onload=function(){container.renderMathInElement(doc.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false},// {left: "\\begin{equation}", right: "\\end{equation}", display: true},
  // {left: "\\begin{align}", right: "\\end{align}", display: true},
  // {left: "\\begin{alignat}", right: "\\end{alignat}", display: true},
  // {left: "\\begin{gather}", right: "\\end{gather}", display: true},
  // {left: "\\begin{CD}", right: "\\end{CD}", display: true},
  {left:'\\[',right:'\\]',display:true}],globalGroup:true,throwOnError:false});};}script1.onload=function(){if(script2)doc.body.appendChild(script2);if(script3)doc.body.appendChild(script3);};doc.body.appendChild(script1);// if (params.containsMathTex || params.containsMathTexRaw) script.innerHTML = 'MathJax.Hub.Queue(["Typeset", MathJax.Hub]); \
  //     console.log("Typesetting maths with MathJax");';
  params.containsMathTexRaw=false;// Prevents doing a second Typeset run on the same document
  params.containsMathTex=false;}}var images = {extractImages:extractImages,setupManualImageExtraction:prepareManualExtraction,prepareImagesServiceWorker:prepareImagesServiceWorker,prepareImagesJQuery:prepareImagesJQuery,lazyLoad:lazyLoad,loadMathJax:loadMathJax};

  /* global params */var prefix$1=(window.location.protocol+'//'+window.location.host+window.location.pathname).replace(/\/[^/]*$/,'/');/* zl = zimLink; zim = zimType; cc = cssCache; cs = cssSource; i]  */function filterCSS(zl,zim,cc,cs,i){var rtnFunction='injectCSS';if(zim!==cs&&zl.match(/(-\/(?:s\/css_modules\/|mw\/)?style\.css)|minerva|mobile|parsoid/i)){// If it's the wrong ZIM type and style matches main styles...
  if(zl.match(/-\/(?:s\/|mw\/)?style\.css|minerva|style-mobile\.css|base\.css/i)){// If it matches one of the required styles...
  zl=cs==='mobile'?prefix$1+'-/s/style-mobile.css':prefix$1+'-/s/style.css';// Take it from cache, because not in the ZIM
  console.log('Matched #'+i+' ['+zl+'] from local filesystem because style is not in ZIM'+'\nbut your display options require a '+cs+' style');}if(cs==='desktop'&&/minerva|mobile|parsoid|(css_modules|mw)\/style\.css/.test(zl)&&!/(css_modules|mw)\/mobile_main_page\.css/.test(zl)){// If user selected desktop style and style is one of the mobile styles, but not mobile_main_page for newstyle all image homepages
  console.log('Voiding #'+i+' ['+zl+'] from document header \nbecause your display options require a desktop style');zl='#';// Void these mobile styles
  }// Rename this required mobile style so that we don't trigger reading ZIM as mobile in print intercept
  zl=/(css_modules|mw)\/mobile_main_page\.css/.test(zl)&&cs==='desktop'?prefix$1+'-/s/css_modules/newstyle_main_page.css':zl;}else {// If this is a standard Wikipedia css use stylesheet cached in the filesystem...
  // DEV: Although "." matches any character in regex, there is enough specificity in the patterns below
  // DEV: Add any local stylesheets you wish to include here
  if(cc&&(/-\/(?:s\/|s\/css_modules\/|mw\/)?style.css/i.test(zl)||/\/mediawiki.toc.css/i.test(zl)||/\/ext.cite.styles.css/i.test(zl)||/\/ext.timeline.styles.css/i.test(zl)||/\/ext.scribunto.logs.css/i.test(zl)||/\/mediawiki.page.gallery.styles.css/i.test(zl)||/\/ext.cite.a11y.css/i.test(zl)||/\/ext.kartographer.style.css/i.test(zl)||/\/ext.kartographer.link.css/i.test(zl)||/\/ext.kartographer.frame.css/i.test(zl)||/\/mw.TMHGalleryHook.js.css/i.test(zl)||/\/mw.PopUpMediaTransform.css/i.test(zl)||/\/mw.MediaWikiPlayer.loader.css/i.test(zl)||/\/ext.tmh.thumbnail.styles.css/i.test(zl)||/\/ext.math.styles.css/i.test(zl)||/\/ext.math.scripts.css/i.test(zl)||/\/ext.inputBox.styles.css/i.test(zl)||/\/ext.cite.ux-enhancements.css/i.test(zl)||/\/mobile_main_page.css/i.test(zl)||/\/mediawiki.ui.input.css/i.test(zl)||/\/mediawiki.ui.checkbox.css/i.test(zl)||/\/content.parsoid.css/i.test(zl)||/\/inserted_style_mobile.css/i.test(zl)||/\/inserted_style.css/i.test(zl)||/\/meta.wikimedia.org\/api\/rest_v1\/data\/css\/mobile\/base.css/i.test(zl)||/-\/static\/bootstrap\/css\/bootstrap.min.css/i.test(zl)||/-\/static\/bootstrap\/css\/bootstrap-theme.min.css/i.test(zl)||/-\/static\/main.css/i.test(zl)||/\/static\/css\/sotoki.css/i.test(zl)||/\/mobile.css/i.test(zl)||/\/style-mobile.css/i.test(zl)||/\/skins.vector.styles.css/i.test(zl)||/\/skins.minerva.base.reset\|skins.minerva.content.styles\|ext.cite.style\|mediawiki.page.gallery.styles\|mobile.app.pagestyles.android\|mediawiki.skinning.content.parsoid.css/i.test(zl))){zl=zl.replace(/\|/ig,'_');// Replace "|" with "_" (legacy for some stylesheets with pipes in filename - but next line renders this redundant in current implementation)
  if(/(-\/(?:s\/css_modules\/|mw\/)?style\.css)|minerva|inserted_style_mobile|base\.css/i.test(zl)){// If it matches one of the required styles...
  zl=cs==='mobile'?'-/s/style-mobile.css':'-/s/style.css';}// Rename this required mobile style so that we don't trigger reading ZIM as mobile in print intercept
  zl=/\/mobile_main_page\.css/.test(zl)?'-/mw/newstyle_main_page.css':zl;zl=/\/content\.parsoid\.css/.test(zl)?'-/s/css_modules/content.parsoid.css':zl;zl=/skins\.vector\.styles\.css/.test(zl)?'-/mw/skins.vector.styles.css':zl;zl=/\.\/_?mw_?\//.test(zl)?zl.replace(/\.\/_?mw_?\//,'-/mw/'):zl;// Replace "./mw/" with "-/mw/"
  zl=/\/sotoki\.css/.test(zl)?'C/static/css/sotoki.css':zl;// Replace bootstrap with own: DEV: when upgrading to Bootstrap 4, stop doing this!
  zl=zl.replace(/.+(bootstrap[^/]*?\.css)/i,'css/$1');console.debug('Matched #'+i+' ['+zl+'] from local filesystem');// Make link absolute
  zl=zl.replace(/^[/.]*/,prefix$1);// injectCSS();
  }else if(params.contentInjectionMode==='jquery'){// Try to get the stylesheet from the ZIM file unless it's the wrong ZIM type
  zl=zl.replace(/^[./]+/,'');// Remove the directory path
  console.debug('Attempting to resolve CSS link #'+i+' ['+zl+'] from ZIM file...'+(cc?'\n(Consider adding file #'+i+' to the local filesystem)':''));rtnFunction='resolveCSS';}}return {zl:zl,rtnFunction:rtnFunction};}function toMobileCSS(html,zim,cc,cs,css){// DEV: Careful not to add styles twice...
  // NB Can't relocate to filterCSS function above because it filters styles serially and code would be called for every style...
  if(zim==='desktop'&&zim!==cs){// If ZIM doesn't match user-requested style, add in stylesheets if they're missing
  css+=/\/content\.parsoid\.css/i.test(css)?'':'<link href="'+prefix$1+'-/s/css_modules/content.parsoid.css" rel="stylesheet" type="text/css">\r\n';css+=/\/inserted_style_mobile\.css/i.test(css)?'':'<link href="'+prefix$1+'-/s/style-mobile.css" rel="stylesheet" type="text/css">\r\n';css+=/\/mobile\.css/i.test(css)?'':'<link href="'+prefix$1+'-/s/css_modules/mobile.css" rel="stylesheet" type="text/css">\r\n';}if(cc||zim==='desktop'){// If user requested cached styles OR the ZIM does not contain mobile styles
  console.log(zim==='desktop'?'Transforming display style to mobile...':'Optimizing cached styles for mobile display...');// Add styling to image captions that is hard-coded in Wikipedia mobile
  html=html.replace(/class\s*=\s*["']\s*thumbcaption\s*["']\s*/ig,'style="margin: 0.5em 0 0.5em; font-size: 0.8em; line-height: 1.5; padding: 0 !important; color: #54595d; width: auto !important;"');// Wrap <h2> tags in <div> to control bottom border width if there's an infobox, but not if it's a new-style ZIM with collapsible details tags
  if(!/<details[\s\S]+?<summary\b/i.test(html)){html=/<table\s+(?=[^>]*class\s*=\s*["'][^"']*(?:mw-stack|infobox|vertical-navbox|qbRight|wv-quickbar))/i.test(html)?html.replace(/(<h2\s+[^<]*<\/h2>)/ig,'<div style="width: 60%;">$1</div>'):html;}if(zim==='desktop'){var infobox=[];if(/<(?:table|div)\b[^>]+(?:mw-stack|infobox|vertical-navbox|qbRight|wv-quickbar)/i.test(html)){infobox=util.matchOuter(html,'<(?:table|div)\\b[^>]+(?:mw-stack|infobox|vertical-navbox|qbRight|wv-quickbar)[^>]+>','</(?:table|div)>','i');}if(infobox.length){var temphtml=html.replace(infobox[0],'<!-- @@@kiwixmarker@@@ -->');var paras=util.matchInner(temphtml,'<p\\b[^>]*>','</p>','gi');var matched=false;if(paras.length){for(var g=0;g<3;g++){// Check if the paragraph is a proper sentence, i.e. contains at least 50 non-HTML-delimetered non-full-stop characters, followed by a punctuation character
  if(paras[g]&&/[^.]{50,}[^.]*[.,;:?!-]/.test(paras[g].replace(/<style[^<]+<\/style>/g,'').replace(/<[^>]+>/g,''))){matched=true;break;}}if(matched){// If there are navboxes below the infobox, hide them in mobile view
  // temphtml = temphtml.replace(/(<div\b(?=[^>]+navbox))(?:([^>]+?)style\s*=\s*["']([^"']+)["'])?/ig, '$1$2style="display:none;$3"');
  // Ensure mobile styling in infobox
  infobox[0]=infobox[0].replace(/(<(?:table|div)\b(?=[^>]+?class\s*=\s*["'][^"']*(?:mw-stack|infobox|navbox)))([^>]+?style\s*=\s*["'])(?:([^"']*?)margin\s*:[^;"']*[;"'])?/ig,'$1$2margin:0 auto;$3');// Clear any fixed width but set it to max-width
  infobox[0]=infobox[0].replace(/^(<(?:table|div)\b[^>]+?;\s*width\s*:\s*)([^;"']+)/i,'$1auto;max-width:$2');// Hide any navboxes inside the infobox
  // infobox[0] = infobox[0].replace(/(<(?:table|div)\b(?=[^>]+?class\s*=\s*["'][^"']*navbox))(?:([^>]+?)style\s*=\s*["'])(?:([^"']*?)display\s*:[^;"']*[;"'])?/ig, '$1$2style="display:none;$3');
  // We already deleted the table above
  html='';// First try to move the lede paragraph
  /* NOTE CODE BELOW CAUSES HATNOTES TO GET SWAPPED TOO, so we will only use the simple swap method instead
                          html = temphtml.replace(/(<div\s+[^>]*?\bid\s*=\s*["']mw-content-text\s*[^>]*>\s*)/i, '$1\r\n' + paras[g].replace(/(<p\s+)/i, '$1data-kiwix-id="lede" ') + '\r\n');
                          if (html) { // Looks like we succeeded so clean up
                              html = html.replace(paras[g], '');
                              html = html.replace('<!-- @@@kiwixmarker@@@ -->', infobox[0]);
                          } else {
                          */// So there was no match, let's try just swapping para and infobox
  html=temphtml.replace(paras[g],paras[g].replace(/(<p\s+)/i,'$1data-kiwix-id="lede" ')+'\r\n'+infobox[0]);html=html.replace('<!-- @@@kiwixmarker@@@ -->','');// }  // End of commented else block
  }}}}// Set infobox styling hard-coded in Wikipedia mobile
  html=html.replace(/(table\s+(?=[^>]*class\s*=\s*["'][^"']*(?:mw-stack|infobox|vertical-navbox|qbRight|wv-quickbar))[^>]*style\s*=\s*["'][^"']+[^;'"]);?\s*["']/ig,'$1; position: relative; border: 1px solid #eaecf0; text-align: left; background-color: #f8f9fa;"');}// Remove hard-coded style on h1
  html=html.replace(/(<h1\b[^>]+)background-color\s*:\s*white;\s*/i,'$1');return {html:html,css:css};}function toDesktopCSS(html,zim,cc,cs,css){if(cc||zim!==cs){if(/class\s*=\s*["']gallery/i.test(html)&&!/gallery/i.test(css)){console.log('Inserting missing css required for gallery display [mediawiki.page.gallery.styles.css]...');css+=/\/mediawiki\.page\.gallery\.styles\.css/i.test(css)?'':'<link href="'+prefix$1+'-/s/css_modules/mediawiki.page.gallery.styles.css" rel="stylesheet" type="text/css">\r\n';}}if(cc||zim==='mobile'){// If user requested cached styles OR the ZIM does not contain desktop styles
  console.log(zim==='mobile'?'Transforming display style to desktop...':'Optimizing cached styles for desktop display...');// If it's in mobile position, move info-box above lede paragraph like on Wikipedia desktop
  if(zim==='mobile'){// Attempt to match div-style infobox first
  var tableBox=util.matchOuter(html,'<div\\b[^>]+?(?:infobox[^-]|vertical-navbox|qbRight|wv-quickbar)[^>]*>','</div>','i');// If above failed we may have traditional table-style infobox
  tableBox=!(tableBox&&tableBox.length)?util.matchOuter(html,'<table\\b[^>]+?(?:mw-stack|infobox[^-]|vertical-navbox|qbRight|wv-quickbar)[^>]*>','</table>','i'):tableBox;if(tableBox&&tableBox.length){html=html.replace(tableBox,'');html=html.replace(/(<\/h1>\s*)/i,'$1'+tableBox);}}// Ensure white background colour
  html=html.replace(/(class\s*=\s*["']\s*mw-body\s*["'][^>]*?style\s*=\s*["'])/i,'$1background-color:white;');// Void empty header title
  html=html.replace(/<h1\s*[^>]+titleHeading[^>]+>\s*<\/h1>\s*/ig,'');}// Remove hard-coded style on h1
  html=html.replace(/(<h1\b[^>]+)background-color\s*:\s*white;\s*/i,'$1');// Remove hard-coded style on infobox
  html=html.replace(/(<table\s+(?=[^>]*?\bclass=['"][^'"]*infobox)[^>]*\bstyle=['"][^'"]*\b)(?:float:\s*none\s*;?\s*)(?:clear:\s*none\s*;?\s*)?/gi,'$1');// Remove any residual references to mobile styles (e.g. in data-kiwixhref) because they trigger page reload when printing
  css=css.replace(/(<link\b[^>]+)(minerva|mobile)/ig,'$1');return {html:html,css:css};}var transformStyles = {toMobileCSS:toMobileCSS,toDesktopCSS:toDesktopCSS,filterCSS:filterCSS};

  var $$2 = _export;
  var uncurryThis$1 = functionUncurryThis;
  var isArray = isArray$6;

  var nativeReverse = uncurryThis$1([].reverse);
  var test = [1, 2];

  // `Array.prototype.reverse` method
  // https://tc39.es/ecma262/#sec-array.prototype.reverse
  // fix for Safari 12.0 bug
  // https://bugs.webkit.org/show_bug.cgi?id=188794
  $$2({ target: 'Array', proto: true, forced: String(test) === String(test.reverse()) }, {
    reverse: function reverse() {
      // eslint-disable-next-line no-self-assign -- dirty hack
      if (isArray(this)) this.length = this.length;
      return nativeReverse(this);
    }
  });

  /* globals params, appstate */var langCodes={aa:'Afar (Afar)',ab:'Аҧсуа (Abkhazian)',ace:'Acèh (Achinese)',ady:'Адыгэбзэ (Adyghe (Adygei))',af:'Afrikaans (Afrikaans)',ak:'Akana (Akan)',ale:'Aleut (Aleut)',als:'Alemannisch (Alemannic (Swiss German))',am:'አማርኛ (Amharic)',an:'Aragonés (Aragonese)',ang:'Englisc (Anglo-Saxon / Old English)',ar:'العربية (Arabic)',arc:'ܣܘܪܬ (Aramaic)',arp:'Arapaho (Arapaho)',arz:'مصرى (Egyptian Arabic)',as:'অসমীয়া (Assamese)',ast:'Asturianu (Asturian)',atj:'Atikamekw (Atikamekw)',av:'Авар (Avar)',ay:'Aymar (Aymara)',az:'Azərbaycanca / آذربايجان (Azerbaijani)',azb:'تۆرکجه (South Azerbaijani)',ba:'Башҡорт (Bashkir)',ban:'Bhāṣa Bali (Balinese)',bar:'Boarisch (Bavarian)',batSmg:'Žemaitėška (Samogitian)',sgs:'Žemaitėška (Samogitian)',bcl:'Bikol Central (Bikol)',be:'Беларуская (Belarusian)',beXOld:'Беларуская (тарашкевіца) (Belarusian (Taraškievica))',beTarask:'Беларуская (тарашкевіца) (Belarusian (Taraškievica))',bg:'Български (Bulgarian)',bgs:'Tagabawa (Tagabawa (Manobo))',bh:'भोजपुरी (Bihari)',bho:'भोजपुरी (Bhojpuri)',bi:'Bislama (Bislama)',bjn:'Bahasa Banjar (Banjar)',bm:'Bamanankan (Bambara)',bn:'বাংলা (Bengali)',bo:'བོད་ཡིག / Bod skad (Tibetan)',bpy:'ইমার ঠার/বিষ্ণুপ্রিয়া মণিপুরী (Bishnupriya Manipuri)',br:'Brezhoneg (Breton)',brx:'बड़ो (Bodo)',bs:'Bosanski (Bosnian)',bug:'ᨅᨔ ᨕᨘᨁᨗ / Basa Ugi (Buginese)',bxr:'Буряад хэлэн (Buriat (Russia))',ca:'Català (Catalan)',cbk:'Chavacano (Chavacano)',cbkZam:'Chavacano de Zamboanga (Chavacano)',cdo:'Mìng-dĕ̤ng-ngṳ̄ / 閩東語 (Min Dong Chinese)',ce:'Нохчийн (Chechen)',ceb:'Sinugboanong Binisaya (Cebuano)',ch:'Chamoru (Chamorro)',cho:'Choctaw (Choctaw)',chr:'ᏣᎳᎩ (Cherokee)',chy:'Tsetsêhestâhese (Cheyenne)',ckb:'کوردی (Central Kurdish)',co:'Corsu (Corsican)',cr:'Nehiyaw (Cree)',crh:'Qırımtatarca (Crimean Tatar)',cs:'Česky (Czech)',csb:'Kaszëbsczi (Kashubian)',cu:'словѣньскъ / slověnĭskŭ (Old Church Slavonic)',cv:'Чăваш (Chuvash)',cy:'Cymraeg (Welsh)',da:'Dansk (Danish)',dag:'Dagbanli (Dagbanli)',de:'Deutsch (German)',din:'Thuɔŋjäŋ (Dinka)',diq:'Zazaki (Dimli)',dsb:'Dolnoserbski (Lower Sorbian)',dty:'डोटेली (Doteli (Dotyali))',dv:'ދިވެހިބަސް (Divehi)',dz:'ཇོང་ཁ (Dzongkha)',ee:'Ɛʋɛ (Ewe)',el:'Ελληνικά (Greek)',eml:'Emiliàn e rumagnòl (Emiliano-Romagnolo)',en:'English (English)',eng:'English (English)',enm:'Middle English',eo:'Esperanto (Esperanto)',es:'Español (Spanish)',et:'Eesti (Estonian)',eu:'Euskara (Basque)',ext:'Estremeñu (Extremaduran)',fa:'فارسی (Farsi (Persian))',far:'فارسی (Farsi (Persian))',ff:'Fulfulde (Peul)',fi:'Suomi (Finnish)',fiuVro:'Võro (Võro)',vro:'Võro (Võro)',fj:'Na Vosa Vakaviti (Fijian)',frr:'Nordfriisk (North Frisian)',fo:'Føroyskt (Faroese)',fr:'Français (French)',frp:'Arpitan/francoprovençal (Arpitan/Provençal)',fur:'Furlan (Friulian)',fy:'Frysk (West Frisian)',ga:'Gaeilge (Irish)',gag:'Gagauz (Gagauz)',gan:'贛語 (Gan Chinese)',gbm:'गढ़वळी (Garhwali)',gd:'Gàidhlig (Scottish Gaelic)',gil:'Taetae ni kiribati (Gilbertese)',gl:'Galego (Galician)',gla:'Gàidhlig (Scottish Gaelic)',glk:'گیلکی (Gilaki)',gn:'Avañe’ẽ (Guarani)',gor:'Bahasa Hulontalo (Gorontalo)',got:'gutisk (Gothic)',grc:'Ἑλληνικὴ ἀρχαία (Ancient Greek)',gu:'ગુજરાતી (Gujarati)',guw:'Gungbe (Gun)',gv:'Gaelg (Manx)',ha:'هَوُسَ (Hausa)',hak:'客家語/Hak-kâ-ngî (Hakka Chinese)',haw:'Hawai`i (Hawaiian)',he:'עברית (Hebrew)',hi:'हिन्दी (Hindi)',hif:'Fiji Hindi (Fiji Hindi)',ho:'Hiri Motu (Hiri Motu)',hr:'Hrvatski (Croatian)',hsb:'Hornjoserbsce (Upper Sorbian)',ht:'Krèyol ayisyen (Haitian)',hu:'Magyar (Hungarian)',hy:'Հայերեն (Armenian)',hz:'Otsiherero (Herero)',ia:'Interlingua (Interlingua)',id:'Bahasa Indonesia (Indonesian)',ie:'Interlingue (Interlingue)',ig:'Igbo (Igbo)',ii:'ꆇꉙ / 四川彝语 (Sichuan Yi)',ik:'Iñupiak (Inupiak)',ilo:'Ilokano (Ilokano)',in:'Bahasa Indonesia (Indonesian)',inh:'ГӀалгӀай (Ingush)',io:'Ido (Ido)',is:'Íslenska (Icelandic)',it:'Italiano (Italian)',iu:'ᐃᓄᒃᑎᑐᑦ (Inuktitut)',iw:'עברית (Hebrew)',ja:'日本語 (Japanese)',jbo:'Lojban (Lojban)',jv:'Basa Jawa (Javanese)',ka:'ქართული (Georgian)',kaa:'Qaraqalpaqsha (Karakalpak)',kab:'Taqbaylit (Kabyle)',kbd:'Адыгэбзэ (Kabardian)',kbp:'Kabɩyɛ (Kabiye)',kg:'KiKongo (Kongo)',kha:'Ka Ktien Khasi (Khasi)',ki:'Gĩkũyũ (Kikuyu)',kj:'Kuanyama (Kuanyama)',kk:'Қазақша (Kazakh)',kl:'Kalaallisut (Greenlandic)',kld:'Gamilaraay / Kamilaroi (Gamilaraay)',km:'ភាសាខ្មែរ (Cambodian)',kn:'ಕನ್ನಡ (Kannada)',khw:'کھوار (Khowar)',ko:'한국어 (Korean)',kr:'Kanuri (Kanuri)',ks:'कश्मीरी / كشميري (Kashmiri)',ksh:'Ripoarisch (Ripuarian)',ku:'Kurdî / كوردی (Kurdish)',kv:'Коми (Komi)',kw:'Kernewek (Cornish)',ky:'Kırgızca / Кыргызча (Kirghiz)',la:'Latina (Latin)',lad:'Dzhudezmo / Djudeo-Espanyol (Ladino)',lan:'Leb Lango / Luo (Lango)',lb:'Lëtzebuergesch (Luxembourgish)',lbe:'лакку (Lak)',lfn:'Lingua Franca Nova (Lingua Franca Nova)',lg:'Luganda (Ganda)',li:'Limburgs (Limburgian)',lij:'Líguru (Ligurian)',lmo:'Lumbaart (Lombard)',ln:'Lingála (Lingala)',lo:'ລາວ / Pha xa lao (Laotian)',lt:'Lietuvių (Lithuanian)',lv:'Latviešu (Latvian)',mapBms:'Basa Banyumasan (Banyumasan)',mg:'Malagasy (Malagasy)',man:'官話/官话 (Mandarin)',mh:'Kajin Majel / Ebon (Marshallese)',mi:'Māori (Maori)',min:'Minangkabau (Minangkabau)',mk:'Македонски (Macedonian)',ml:'മലയാളം (Malayalam)',mn:'Монгол (Mongolian)',mnw:'ဘာသာမန် / မန် (Mon)',mo:'Moldovenească (Moldovan)',mr:'मराठी (Marathi)',ms:'Bahasa Melayu (Malay)',mt:'bil-Malti (Maltese)',mul:'Multiple Languages',mus:'Mvskoke (Creek / Muskogee)',mwl:'Mirandés (Mirandese)',my:'Myanmasa (Burmese)',myn:'Maya (Mayan Languages)',na:'Dorerin Naoero (Nauruan)',nah:'Nahuatl (Nahuatl)',nai:'North American Indian (North American Indian Languages)',nap:'Nnapulitano (Neapolitan)',nav:'Diné bizaad (Navajo)',nb:'Norsk (bokmål / riksmål) (Norwegian Bokmål)',nd:'Sindebele (North Ndebele)',nds:'Plattdüütsch (Low German / Low Saxon)',ndsNl:'Nedersaksisch (Dutch Low Saxon)',ne:'नेपाली (Nepali)',new:'नेपालभाषा / Newah Bhaye (Newar)',no:'Norsk (bokmål / riksmål) (Norwegian)',ng:'Oshiwambo (Ndonga)',nl:'Nederlands (Dutch)',nn:'Norsk (nynorsk) (Norwegian Nynorsk)',nr:'isiNdebele (South Ndebele)',nso:'Sesotho sa Leboa / Sepedi (Northern Sotho)',nrm:'Nouormand / Normaund (Norman)',nv:'Diné bizaad (Navajo)',ny:'Chi-Chewa (Chichewa)',oc:'Occitan (Occitan)',oj:'ᐊᓂᔑᓈᐯᒧᐎᓐ / Anishinaabemowin (Ojibwa)',oji:'ᐊᓂᔑᓈᐯᒧᐎᓐ / Anishinaabemowin (Ojibwa)',om:'Oromoo (Oromo)',or:'ଓଡ଼ିଆ (Oriya)',os:'Иронау (Ossetian / Ossetic)',pa:'ਪੰਜਾਬੀ / पंजाबी / پنجابي (Panjabi / Punjabi)',pag:'Pangasinan (Pangasinan)',pam:'Kapampangan (Kapampangan)',pap:'Papiamentu (Papiamentu)',pcm:'Naijíríà (Nigerian Pidgin)',pdc:'Deitsch (Pennsylvania German)',pi:'Pāli / पाऴि (Pali)',pih:'Norfuk (Norfolk)',pl:'Polski (Polish)',pms:'Piemontèis (Piedmontese)',pnb:'پنجابی (Western Punjabi)',pnt:'Ποντιακά (Pontic)',ps:'پښتو (Pashto)',pt:'Português (Portuguese)',ptbr:'Português brasileiro (Brazilian Portuguese)',qu:'Runa Simi (Quechua)',rm:'Rumantsch (Raeto Romance)',rmr:'Caló (Caló (Romani))',rmy:'Romani / रोमानी (Romani)',rn:'Kirundi (Kirundi)',ro:'Română (Romanian)',roaRup:'Armâneashti (Aromanian)',roaTara:'Tarandíne (Tarantino)',rup:'Armâneashti (Aromanian)',ru:'Русский (Russian)',rue:'Русиньскый (Rusyn)',rw:'Kinyarwandi (Rwandi)',sa:'संस्कृतम् (Sanskrit)',sat:'ᱥᱟᱱᱛᱟᱲᱤ (Santali)',sc:'Sardu (Sardinian)',scn:'Sicilianu (Sicilian)',sco:'Scots (Scots)',sd:'सिनधि (Sindhi)',se:'Davvisámegiella (Northern Sami)',sg:'Sängö (Sango)',sh:'Srpskohrvatski/Српскохрватски (Serbo-Croatian)',shn:'ရှမ်း (Shan)',si:'සිංහල (Sinhalese)',simple:'Simple English (Simple English)',sk:'Slovenčina (Slovak)',sl:'Slovenščina (Slovenian)',sm:'Gagana Samoa (Samoan)',sn:'chiShona (Shona)',so:'Soomaaliga (Somalia)',sq:'Shqip (Albanian)',sr:'Српски (Serbian)',ss:'SiSwati (Swati)',st:'Sesotho (Southern Sotho)',stq:'Saterfriesisch / Seeltersk (Saterland Frisian)',su:'Basa Sunda (Sundanese)',sv:'Svenska (Swedish)',sw:'Kiswahili (Swahili)',szl:'Ślůnski (Silesian)',ta:'தமிழ் (Tamil)',tcy:'ತುಳು (Tulu)',te:'తెలుగు (Telugu)',tet:'Tetun (Tetum)',tg:'Тоҷикӣ (Tajik)',th:'ไทย / Phasa Thai (Thai)',ti:'ትግርኛ (Tigrinya)',tk:'Туркмен / تركمن (Turkmen)',tl:'Tagalog (Tagalog)',tlh:'tlhIngan-Hol (Klingon)',tn:'Setswana (Tswana)',to:'Lea Faka-Tonga (Tonga)',tpi:'Tok Pisin (Tok Pisin)',tr:'Türkçe (Turkish)',ts:'Xitsonga (Tsonga)',tt:'Tatarça (Tatar)',tum:'chiTumbuka (Tumbuka)',tw:'Twi (Twi)',ty:'Reo Mā`ohi (Tahitian)',tyv:'Тыва дыл (Tuvinian)',udm:'Удмурт кыл (Udmurt)',ug:'Uyƣurqə / ئۇيغۇرچە (Uyghur)',uk:'Українська (Ukrainian)',ur:'اردو (Urdu)',uz:'Ўзбек (Uzbek)',ve:'Tshivenḓa (Venda)',vi:'Việtnam (Vietnamese)',vec:'Vèneto (Venetian)',vls:'West-Vlaoms (West Flemish)',vo:'Volapük (Volapük)',wa:'Walon (Walloon)',war:'Winaray / Binisaya Lineyte-Samarnon (Waray)',wo:'Wollof (Wolof)',wuu:'吴语 (Wu Chinese)',xal:'Хальмг (Kalmyk)',xh:'isiXhosa (Xhosa)',xmf:'მარგალური (Mingrelian)',yi:'ייִדיש (Yiddish)',yo:'Yorùbá (Yoruba)',za:'Cuengh / Tôô / 壮语 (Zhuang)',zh:'中文 (Chinese)',lzh:'文言 (Classical Chinese)',zhClassical:'文言 (Classical Chinese)',nan:'Bân-lâm-gú (Minnan)',yue:'粵語 / 粤语 (Cantonese)',zu:'isiZulu (Zulu)',gom:'Goan Konkani',gsw:'Swiss German-Alemannic-Alsatian',jam:'Jamaican Creole English',koi:'Komi-Permyak',krc:'Karachay-Balkar',lez:'Lezghian',lrc:'Northern Luri',ltg:'Latgalian',mai:'Maithili',mdf:'Moksha',mhr:'Eastern Mari',mrj:'Western Mari',myv:'Erzya',mzn:'Mazanderani',nov:'Novial',olo:'Livvi',pcd:'Picard',pfl:'Pfaelzisch',sah:'Yakut',srn:'Sranan Tongo',vep:'Veps',zea:'Zeeuws'};var downloadLinks=document.getElementById('downloadLinks');var serverResponse=document.getElementById('serverResponse');// Used to decide the target for download links
  var target=/Electron/.test(params.appType)?'':' target="_blank"';// DEV: If you support more packaged files, add to this list
  var regexpFilter=/_medicine|mdwiki_/.test(params.packagedFile)?/^(?!.+(_medicine_|mdwiki_))[^_\n\r]+_([^_\n\r]+)_.+\.zi[mp].+$\s+/mig:null;regexpFilter=/wikivoyage/.test(params.packagedFile)?/^(?!.+wikivoyage_)[^_\n\r]+_([^_\n\r]+)_.+\.zi[mp].+$\s+/mig:regexpFilter;/**
   * Makes a request to the Kiwix Download server and processes the output for ease of user selection
   *
   * @param {String} URL The URL of the download server
   * @param {String} lang The selected language code (optional helper value used internally)
   * @param {String} subj The selected subject (optional helper value)
   * @param {String} kiwixDate The selected date (optional helper value)
   */function requestXhttpData(URL,lang,subj,kiwixDate){if(!params.allowInternetAccess){document.getElementById('serverResponse').innerHTML="Blocked: select 'Allow Internet access'";document.getElementById('serverResponse').style.display='inline';return;}if(!URL){document.getElementById('serverResponse').innerHTML='Unrecognized filetype, please try different link';document.getElementById('serverResponse').style.display='inline';return;}var xhttp=new XMLHttpRequest();// DEV: timeout set here to 20s (except for meta4 links); if this isn't long enough for your target countries, increase
  var timeout=/\.magnet$/i.test(URL)?3000:/\.meta4$/i.test(URL)?6000:20000;var xhttpTimeout=setTimeout(ajaxTimeout,timeout);function ajaxTimeout(){xhttp.abort();var responseMessageBox=document.getElementById('serverResponse');responseMessageBox.innerHTML='Connection attempt timed out (failed)';if(/https?:|file:/.test(window.location.protocol))responseMessageBox.innerHTML="Browser's CORS Policy disallowed access!";if(/\.meta4$/i.test(URL))responseMessageBox.innerHTML='Archive descriptor xml file (meta4) is missing!';if(/\.magnet$/i.test(URL))responseMessageBox.innerHTML='Unable to get magnet link!';document.getElementById('serverResponse').style.display='inline';if(!/\.magnet$/i.test(URL))serverError(URL);}xhttp.onreadystatechange=function(){serverResponse.innerHTML='Server response: 0 Waiting...';serverResponse.style.display='inline';console.debug('Server responded: readyState '+this.readyState+'; status '+this.status);if(this.readyState===4){serverResponse.innerHTML='Server response: '+this.status+' '+this.statusText+' Waiting....';if(this.status===200){clearTimeout(xhttpTimeout);serverResponse.innerHTML='Server response: '+this.status+' '+this.statusText+' (data received)';// Strip sorting querystring
  URL=URL.replace(/\?.*/,'');if(/\.meta4$/i.test(URL)){processMetaLink(this.responseText);}else if(/\.magnet$/i.test(URL)){processMagnetLink(this.responseText);}else {processXhttpData(this.responseText);}}else if(this.status===0){if(window.location.protocol==='file:'){document.getElementById('serverResponse').innerHTML='Cannot use XMLHttpRequest with file:// protocol';document.getElementById('serverResponse').style.display='inline';}else {clearTimeout(xhttpTimeout);serverResponse.innerHTML='Archive descriptor xml file (meta4) is missing!';}serverError(URL);}}else {serverResponse.innerHTML='Server response: '+this.status+'/'+this.readyState+' '+this.statusText+' Waiting...';}};// var urlArr = URL.split('?');
  xhttp.open('GET',URL,true);xhttp.send(null);function serverError(URL){var requestedURL,altURL,torrentURL;if(/\.meta4$/i.test(URL)){requestedURL=URL.replace(/\.meta4$/i,'');altURL=/wikipedia|wikisource|wikivoyage|wiktionary/i.test(URL)?requestedURL.replace(/(download\.kiwix\.org)/i,'www.mirrorservice.org/sites/$1'):'';torrentURL=URL.replace(/\.meta4$/i,'.torrent');var header=document.getElementById('dl-panel-heading');var headerDoc='There is a server issue, but please try the following links to your file:';if(~URL.indexOf(params.kiwixhiddenDownloadServer)){headerDoc='This file is only available via browser-managed download:';altURL=requestedURL.replace(/\/master\./i,'/mirror.');}header.outerHTML=header.outerHTML.replace(/<pre\b([^>]*)>[\s\S]*?<\/pre>/i,'<div$1>'+headerDoc+'</div>');var body=document.getElementById('dl-panel-body');var bodyDoc='<p><a id="returnLink" href="#" data-kiwix-dl="'+URL.replace(/\/[^/]*\.meta4$/i,'/')+'">&lt;&lt; Back to list of files</a></p>\r\n';bodyDoc+='<p><b><i><a id="preview" target="_blank">Preview this archive</a></i></b> in your browser before downloading it</p>';bodyDoc+='<p><b>Browser-managed download of ZIM archive:</b></p>'+'<p><a href="'+requestedURL+'"'+target+' class="download">'+requestedURL+'</a></p>'+(altURL?'<p><b>Possible mirror:</b></p>'+'<p><a href="'+altURL+'"'+target+' class="download">'+altURL+'</a></p>':'')+(~URL.indexOf(params.kiwixhiddenDownloadServer)?'':'<p><b>Download with bittorrent:</b></p>'+'<p><a href="'+torrentURL+'"'+target+'>'+torrentURL+'</a></p>');body.outerHTML=body.outerHTML.replace(/<pre\b([^>]*)>[\s\S]*?<\/pre>/i,'<div$1>'+bodyDoc+'</div>');downloadLinks.innerHTML=downloadLinks.innerHTML.replace(/Index\s+of/ig,'File in');downloadLinks.innerHTML=downloadLinks.innerHTML.replace(/panel-success/i,'panel-warning');document.getElementById('preview').href=URL.replace(/^([^/]+\/\/[^/]+\/)(.+\/)([^/]+)\.zim.+$/i,function(m0,domain,path,file){domain=domain.replace(/download/,'library');domain=domain.replace(/master/,'dev');return domain+file;});var langSel=document.getElementById('langs');var subjSel=document.getElementById('subjects');var dateSel=document.getElementById('dates');var submitSelectValues=function submitSelectValues(){var langID=langSel?langSel.value==='All'?'':langSel.value:'';var subjID=subjSel?subjSel.value==='All'?'':subjSel.value:'';var dateID=dateSel?dateSel.value==='All'?'':dateSel.value:'';requestXhttpData(this.dataset.kiwixDl,langID,subjID,dateID);};// Add event listener for click on return link, to go back to list of archives
  document.getElementById('returnLink').addEventListener('click',submitSelectValues);}else {downloadLinks.innerHTML='<div class="console">'+'<p style="color:salmon;">Unable to access the server. Please see message below for reason.</p>'+'<p>Try one of these mirror links (opens in a new browser window):</p><ul>';params.kiwixDownloadMirrors.forEach(function(mirror){downloadLinks.innerHTML+='<li class="console"><a href="'+mirror+'" target="_blank">'+mirror.replace(/^([^/]+\/\/[^/]+).*/,'$1')+'</a></li>';});downloadLinks.innerHTML+='</ul></div><br />';}downloadLinks.style.display='block';}function processMetaLink(doc){// It's the metalink with download links
  var linkArray=doc.match(/<url\b[^>]*>[^<]*<\/url>/ig);var size=doc.match(/<size>(\d+)<\/size>/i);// Filter value (add comma separators if required)
  size=size.length?size[1]:'';var megabytes=size?Math.round(size*10/(1024*1024))/10:size;// Use the lookbehind reversal trick to add commas....
  size=size.toString().split('').reverse().join('').replace(/(\d{3}(?!.*\.|$))/g,'$1,').split('').reverse().join('');var megabytes$=megabytes.toString().split('').reverse().join('').replace(/(\d{3}(?!.*\.|$))/g,'$1,').split('').reverse().join('');doc='';for(var i=1;i<linkArray.length;i++){// NB we'ere intentionally discarding first link to kiwix.org (not to zim)
  doc+=linkArray[i].replace(/<url\b[^>]*>([^<]*)<\/url>/i,'<li><a href="$1"'+target+'>$1</a></li>\r\n');}var headerDoc='We found the following links to your file:';var bodyDoc='<p><a id="returnLink" href="#" data-kiwix-dl="'+URL.replace(/\/[^/]*\.meta4$/i,'/')+'">&lt;&lt; Back to list of files</a></p>\r\n';bodyDoc+=/\/(ted|videos)\//i.test(URL)&&/UWP/.test(params.appType)?'<h4 style="color:red">IMPORTANT: <b>VIDEOS</b> (e.g. TED Talks, Khan Academy, etc.) can be played in the UWP app on Windows 10, but on Windows 10 Mobile you may need to play the videos with an external app such as VLC Media Player (from the Store).</h4>\r\n<p>Please note if you cannot switch to Service Worker mode (see Configuration - Expert Settings) you will need to search for the videos using standard ZIM search or by typing a space in search to show the ZIM Archive Index, because the ZIM\'s proprietary UI does not work in Restricted mode.':'';bodyDoc+=/\/gutenberg\//i.test(URL)?'<p>You can read Gutenberg books in this app, but please note that if you cannot switch to Service Worker mode (see Configuration - Expert Settings) you will need to search for books using standard or wildcard ZIM search (e.g. \'.*quixote\') or by typing a space in search to show the ZIM Archive Index, because the ZIM\'s proprietary UI does not work in Restricted mode.':'';bodyDoc+='<h5';bodyDoc+=megabytes>2000?' style="color:red;"> WARNING: ':'>';bodyDoc+='File size is <b>'+(megabytes?megabytes$+'MB':'unknown')+'</b>'+(size?' ('+size+' bytes)':'')+'</h5>\r\n';bodyDoc+='<p><b>New! <i><a id="preview" target="_blank">Preview this archive</a></i></b> in your browser before downloading it</p>';if(megabytes>1000){bodyDoc+='<p><b>Consider using BitTorrent to download file:</b></p>\r\n<ul>'+'<li><b>BitTorrent file</b>: <a href="'+URL.replace(/\.meta4$/,'.torrent')+'"'+target+'>'+URL.replace(/\.meta4$/,'.torrent')+'</a></li>\r\n'+'<li><b>Magnet link</b>: <a id="magnet" href="'+URL.replace(/\.meta4$/,'.magnet')+'"'+target+'>'+URL.replace(/\.meta4$/,'.magnet')+'</a> (if torrent app doesn\'t launch, <a id="magnetAlt" href="#" target="_blank">tap here</a> and copy/paste link into your app)<br /></li></ul>\r\n';}if(megabytes>4000&&/\.zim\.meta4$/i.test(URL)){bodyDoc+='<p style="color:red;">If you plan to store this archive on a drive/microSD formatted as <b>FAT32</b> (most are not), then you will need to download the file on a PC and split it into chunks less than 4GB: see <a href="https://github.com/kiwix/kiwix-js-pwa/tree/main/AppPackages#download-a-zim-archive-all-platforms" target="_blank">Download a ZIM archive</a>.</p>\r\n';// bodyDoc += '<p><b>To browse for a split version of this archive click here: <a id="portable" href="#" data-kiwix-dl="' +
  //    URL.replace(/\/zim\/([^/]+\/).*$/m, "/portable/$1") + '">' + URL.replace(/\/zim\/([^/]+\/).*$/m, "/portable/$1") +
  //    '</a>.</b></p>\r\n';
  }if(/\.zip\.meta4$/i.test(URL)){if(megabytes>4000)bodyDoc+='<p style="color:red;">This ZIP file contains a split version of the archive, but the ZIP itself is larger than the maximum file size permitted on an SD card formatted as FAT32. Be sure to save it in a non-FAT32 location (e.g. a PC hard drive).</p>\r\n';bodyDoc+='<p>INSTRUCTIONS: You may need to open this ZIP file on a regular computer. After you have downloaded it, open the ZIP in\r\n'+'File Explorer. You will need to extract the contents of the folder <span style="font-family: monospace;"><b>&gt; data &gt; content</b></span>,\r\n'+'and transfer ALL of the files there to an accessible folder on your device. After that, you can search for the folder in this app (see above).</p>\r\n';}var mirrorZimUrl=URL.replace(/\.meta4$/i,'').replace(/\/download\./,'/mirror.download.');if(params.useOPFS||window.showSaveFilePicker&&params.pickedFolder&&params.pickedFolder.kind==='directory'){bodyDoc+='<p><b>Direct download';bodyDoc+=params.useOPFS?' to Origin Private File System':' to your ZIM folder';bodyDoc+=', for smaller archives:</b> (<i>downloads archive in-app</i>)</p><ul>\r\n<li>'+'<a href="'+mirrorZimUrl+'" class="download" style="background-color: green; color: white; padding: 2px 5px; border-radius: 3px; text-decoration: none;">Download now</a> '+'<a href="'+mirrorZimUrl+'" class="download">'+mirrorZimUrl+'</a></li></ul>\r\n';bodyDoc+='<p><b>Browser-managed download from mirrors, for larger archives:</b>';}else {bodyDoc+='<p><b>Browser-managed download from mirrors:</b>';}bodyDoc+=' (<i>links open in a new browser window</i>)</p><ol>\r\n'+doc+'</ol>\r\n';bodyDoc+='<br /><br />';// Try to get magnet link
  if(megabytes>200)requestXhttpData(URL.replace(/\.meta4$/,'.magnet'));var header=document.getElementById('dl-panel-heading');header.outerHTML=header.outerHTML.replace(/<pre\b([^>]*)>[\s\S]*?<\/pre>/i,'<div$1>'+headerDoc+'</div>');var body=document.getElementById('dl-panel-body');body.outerHTML=body.outerHTML.replace(/<pre\b([^>]*)>[\s\S]*?<\/pre>/i,'<div$1>'+bodyDoc+'</div>');downloadLinks.innerHTML=downloadLinks.innerHTML.replace(/Index\s+of/ig,'File in');if(megabytes>4000)downloadLinks.innerHTML=downloadLinks.innerHTML.replace(/panel-success/i,'panel-danger');if(megabytes>2000)downloadLinks.innerHTML=downloadLinks.innerHTML.replace(/panel-success/i,'panel-warning');var langSel=document.getElementById('langs');var subjSel=document.getElementById('subjects');var dateSel=document.getElementById('dates');var submitSelectValues=function submitSelectValues(){var langID=langSel?langSel.value==='All'?'':langSel.value:'';var subjID=subjSel?subjSel.value==='All'?'':subjSel.value:'';var dateID=dateSel?dateSel.value==='All'?'':dateSel.value:'';requestXhttpData(this.dataset.kiwixDl,langID,subjID,dateID);};// Add event listener for click on return link, to go back to list of archives
  document.getElementById('returnLink').addEventListener('click',submitSelectValues);// Set up preview link
  document.getElementById('preview').href=URL.replace(/^([^/]+\/\/[^/]+\/)(.+\/)([^/]+)\.zim.+$/i,function(m0,domain,path,file){domain=domain.replace(/download/,'library');return domain+file;});// If File System Access API is available, add event listeners on download links to save to local storage
  if(params.useOPFS||window.showSaveFilePicker){var downloadUrls=document.getElementsByClassName('download');for(var j=0;j<downloadUrls.length;j++){downloadUrls[j].addEventListener('click',function(e){e.preventDefault();if(!(params.pickedFolder&&params.pickedFolder.kind==='directory')||downloadSize>0)return;if(params.useOPFS){var quotaInMB=appstate.OPFSQuota/(1024*1024);if(megabytes>quotaInMB){return uiUtil.systemAlert('<p>Sorry, the archive you selected is too large to download to your Origin Private File System.</p>'+'<p>It is <b>'+megabytes$+' MB</b>, but your quota is only <b>'+quotaInMB.toFixed(1)+' MB</b>.</p>'+'<p>Please select a smaller archive, or else select a different download method.</p>','File too large');}}var archiveUrl=mirrorZimUrl;var archiveName=e.target.href.replace(/^.*\/([^/]+)$/,'$1');var downloadArchiveWithFSA=function downloadArchiveWithFSA(){downloadSize=megabytes;uiUtil.pollOpsPanel('<span class="glyphicon glyphicon-refresh spinning"></span>&emsp;<b>Please wait:</b> Downloading archive... 0%',true);return cache.downloadArchiveToPickedFolder(archiveName,archiveUrl,reportDownloadProgress).then(function(){return uiUtil.systemAlert('<p>The archive '+archiveName+' has been downloaded to your device.</p>'+(params.useOPFS?'<p><b>Reloading to activate new ZIM...</b></p>':''),'Download complete').then(function(){if(params.useOPFS){settingsStore$1.setItem('lastSelectedArchive',archiveName);window.location.reload();}else {document.getElementById('btnRefresh').click();}});}).catch(function(err){uiUtil.pollOpsPanel();console.error(err);downloadSize=0;percentageComplete=0;var message='Unable to download the archive '+archiveName+' to your device: '+err;if(/iOS/.test(params.appType)||/^((?!chrome|android).)*safari/i.test(navigator.userAgent))message='<p>Unfortunately, Safari and iOS browsers do not currently support downloading files directly into the OPFS. Please select a different download method.</p><p>Error message: '+err.message+'</p>';return uiUtil.systemAlert(message,'Download failed').then(function(){return cache.deleteOPFSEntry(archiveName);});});};if(megabytes>1000){var message='<p>Do you wish to download the following <b>large</b> archive '+(params.useOPFS?'directly into the Origin Private File System':'to the current ZIM folder')+'?</p><ul><li><i>'+archiveName+'</i> (<b>'+megabytes$+' MB</b>)</li></ul><p><b><i>If you proceed, do not close the app during the download.</i></b><p>'+'<p>If you prefer to download in the background, use a browser-managed download link instead, and '+(params.useOPFS?'afterwards import the file into the OPFS using the "Add file(s)" button':'then move the file manually into your ZIM folder')+'.</p>';var messageTitle='Download large archive to '+(params.useOPFS?'OPFS?':'folder?');uiUtil.systemAlert(message,messageTitle,true,'Cancel','Download').then(function(result){if(result)downloadArchiveWithFSA();});}else {downloadArchiveWithFSA();}});}}}function processMagnetLink(link){link=link.replace(/&amp;/g,'&');var magnetLink=document.getElementById('magnet');if(!magnetLink)return;// Set up backup link
  var magnetLinkAlt=document.getElementById('magnetAlt');magnetLinkAlt.href=magnetLink.href;// Now point main link to the magnet URL so torrent app will open if installed
  magnetLink.href=link;magnetLink.innerHTML='tap to launch link';magnetLink.removeAttribute('target');magnetLink.addEventListener('click',function(e){e.preventDefault();window.location=this.href;});}function processXhttpData(doc){// Remove images
  doc=doc.replace(/<img\b[^>]*>\s*/ig,'');// Reduce size of header
  doc=doc.replace(/<h1\b[^>]*>([^<]*)<\/h1>/ig,'<h3 id="indexHeader">$1</h3>');// Limit height of pre box and prevent word wrapping
  doc=doc.replace(/<pre>/i,'<div class="panel panel-success">\r\n'+'<pre id="dl-panel-heading" class="panel-heading" style="overflow-x:auto;word-wrap:normal;">$#$#</pre>\r\n'+'<pre id="dl-panel-body" class="panel panel-body" style="max-height:360px;word-wrap:normal;margin-bottom:10px;overflow:auto;">');// Remove hr at end of page and add extra </div>
  doc=doc.replace(/<hr\b[^>]*>(\s*<\/pre>)/i,'$1</div>');// Remove any residual hr
  doc=doc.replace(/<hr>\s*<(\/?div|\/body)/ig,'<$1');// Move header into panel-header (NB regex is deliberately redundant to increase specificity of search)
  doc=doc.replace(/\$#\$#([\s\S]+?)(<a\s+href[^>]+>name<[\s\S]+?last\s+modified<[\s\S]+?)<hr>\s*/i,'$2$1');// If this failed, we're probably in a non-mirrored directory, so add simple header
  doc=doc.replace(/\$#\$#/,'Name');if(/\dK|\dM|\dG/.test(doc)){// Swap size and date fields to make file size more prominent on narrow screens
  doc=doc.replace(/(<a\b[^>]*>last\s+modified<\/a>\s*)(<a\b[^>]*>size<\/a>)\s*/ig,' $2    $1');doc=doc.replace(/(\d{4}-\d\d-\d\d\s\d\d:\d\d)\s\s([\s\d.\w-]{7})$/img,' $2 $1');// Remove unused README file
  doc=doc.replace(/^<a\s+href\b[^<]+README.+$[\r\n]*/m,'');}// Add in some directories for developers (other than custom_apps)
  if(/wikipedia\//.test(doc)){if(!params.appCache)doc=doc.replace(/^(<a\b.+gutenberg\/)(<\/a>\s\s)([^<]+)/m,'<a href="#">archive/</a>    $3$1$2$3');doc=doc.replace(/^(<a\b.+gutenberg\/)(<\/a>\s\s)([^<]+)/m,'<a href="#">custom_apps/</a>$3$1$2$3');if(!params.appCache)doc=doc.replace(/^(<a\b.+gutenberg\/)(<\/a>\s\s)([^<]+)/m,'<a href="#">dev/</a>        $3$1$2$3');if(!params.appCache)doc=doc.replace(/^(<a\b.+gutenberg\/)(<\/a>)([^<]+)/m,'<a href="#">endless/$2  $3$1$2$3');}var stDoc;// Placeholder for standardized doc to be used to get arrays
  if(/^[^_\n\r]+_([^_\n\r]+)_.+\.zi[mp].+$/m.test(doc)){// Delete lines that do not match regexpFilter (this ensures packaged apps only show ZIMs appropriate to the package)
  doc=regexpFilter?doc.replace(regexpFilter,''):doc;stDoc=getStandardizedDoc(doc);// Get language and date arrays
  var langArray=getLangArray(stDoc);var subjectArray=getSubjectArray(stDoc);var dateArray=getDateArray(stDoc);// Create dropdown language and date selectors
  if(langArray){var dropdownLang='<select class="dropdown" id="langs">\r\n';for(var q=0;q<langArray.length;q++){dropdownLang+='<option value="'+langArray[q]+'">'+(langCodes[langArray[q]]?langArray[q]+' :  '+langCodes[langArray[q]]:langArray[q])+'</option>\r\n';}dropdownLang+='</select>\r\n';}if(subjectArray){var dropdownSubj='<select class="dropdown" id="subjects">\r\n';for(var r=0;r<subjectArray.length;r++){dropdownSubj+='<option value="'+subjectArray[r]+'">'+subjectArray[r]+'</option>\r\n';}dropdownSubj+='</select>\r\n';}if(dateArray){var dropdownDate='<select class="dropdown" id="dates">\r\n';for(var s=0;s<dateArray.length;s++){dropdownDate+='<option value="'+dateArray[s]+'">'+dateArray[s]+'</option>\r\n';}dropdownDate+='</select>\r\n';}// Add language, subject and date spans to doc
  if(/\/(mooc|phet|zimit|videos|other|dev)\b/i.test(URL)){// doc = doc.replace(/^([^_\n\r]+_([^_\n\r\d]*)_?.*?(\d[\d-]+)\.zi[mp].+)$[\n\r]*/img, '<span class="wikiLang" lang="$2" data-kiwixdate="$3">$1<br /></span>');
  doc=doc.replace(/^(.+?_(?!all_)([a-z]{2,4}|nds-nl|be-tarask|map-bms|roa-tara|zh-classical)_.*?(\d[\d-]+)\.(?:zi[mp]|err).+|.+(\d[\d-]+)\.(?:zi[mp]|err).+)$[\n\r]*/img,'<span class="wikiLang" lang="$2" data-kiwixdate="$3">$1<br /></span>');}else if(/\/stack_exchange\b/i.test(URL)){doc=doc.replace(/^([^>\n\r]+>(?:.+(stackoverflow)|([^.\n\r]+))\.([^_\n\r]+)_([^_\n\r]+)_.*?(\d[\d-]+)\.zi[mp].+)$[\n\r]*/img,'<span class="wikiLang" lang="$5" data-kiwixsubject="$2$3" data-kiwixdate="$6">$1<br /></span>');}else {doc=doc.replace(/^([^_\n\r]+_([^_\n\r]+)_((?:[^_]|_(?!maxi|mini|nopic|\d\d\d\d))+)_.*?(\d[\d-]+)\.zi[mp].+)$[\n\r]*/img,'<span class="wikiLang" lang="$2" data-kiwixsubject="$3" data-kiwixdate="$4">$1<br /></span>');}// Normalize languages with a - (from Stackexchange)
  doc=doc.replace(/(lang="\w+)-(\w+")/ig,'$1$2');doc=dropdownDate?doc.replace(/<\/h3>/i,'</h3>'+(dropdownLang||dropdownSubj?'':'\r\n<div class="row">\r\n')+'<div class="col-xs-4">Date:&nbsp;&nbsp;'+dropdownDate+'</div>\r\n</div>\r\n'):doc;doc=dropdownSubj?doc.replace(/<\/h3>/i,'</h3>'+(dropdownLang?'':'\r\n<div class="row">\r\n')+'<div class="col-xs-4">Subject:&nbsp;&nbsp;'+dropdownSubj+'</div>\r\n'+(dropdownDate?'':'</div>\r\n')):doc;doc=dropdownLang?doc.replace(/<\/h3>/i,'</h3>\r\n<div class="row">\r\n<div class="col-xs-4">Language:&nbsp;&nbsp;'+dropdownLang+'</div>\r\n'+(dropdownSubj||dropdownDate?'':'</div>\r\n')):doc;}downloadLinks.innerHTML=doc;var langSel=document.getElementById('langs');var subjSel=document.getElementById('subjects');var dateSel=document.getElementById('dates');var langPanel=document.getElementById('dl-panel-body');if(lang||subj||kiwixDate){var rgxLang=lang?new RegExp(lang,'i'):null;var selectEntries=document.querySelectorAll('.wikiLang');// Hide all entries except specified language, subject, or date
  for(var i=0;i<selectEntries.length;i++){if(lang&&lang!=='All'&&!rgxLang.test(selectEntries[i].lang))selectEntries[i].style.display='none';if(subj&&subj!=='All'&&selectEntries[i].dataset.kiwixsubject!==subj)selectEntries[i].style.display='none';if(kiwixDate&&kiwixDate!=='All'&&selectEntries[i].dataset.kiwixdate!==kiwixDate)selectEntries[i].style.display='none';}if(langSel)langSel.value=lang||'All';if(subjSel)subjSel.value=subj||'All';if(dateSel)dateSel.value=kiwixDate||'All';}if(langArray&&langSel){// Set up event listener for language selector
  langSel.addEventListener('change',function(){var dateID=dateSel?dateSel.options[dateSel.selectedIndex].value:'';var subjID=subjSel?subjSel.options[subjSel.selectedIndex].value:'';var langID=langSel?langSel.options[langSel.selectedIndex].value:'';// Make langID into case-insensitive regex
  var rgxlangID=new RegExp(langID,'i');// Reset any hidden entries
  // langPanel.innerHTML = langPanel.innerHTML.replace(/(display:\s*)none\b/mig, 'inline');
  var langEntries=langPanel.querySelectorAll('.wikiLang');// Hide all entries except specified language
  if(langID){for(var i=0;i<langEntries.length;i++){if(rgxlangID.test(langEntries[i].lang)||langID==='All')langEntries[i].style.display='inline';if(!rgxlangID.test(langEntries[i].lang)&&langID!=='All')langEntries[i].style.display='none';if(subjID&&langEntries[i].dataset.kiwixsubject!==subjID&&subjID!=='All')langEntries[i].style.display='none';if(dateID&&langEntries[i].dataset.kiwixdate!==dateID&&dateID!=='All')langEntries[i].style.display='none';}var visibleZIMs=langPanel.innerText.match(/^.*?\.zi[mp]/mgi);// Prune date list
  if(dateID==='All'){var dateList=dateArray.join('\r\n');dateList=dateList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){var rgxDate=new RegExp('_'+p1+'\\.zi','i');if(p1!=='All'&&!rgxDate.test(visibleZIMs))return '';return '<option value="'+p1+'"'+(dateID===p1?' selected':'')+'>'+p1+'</option>';});dateSel.innerHTML=dateList;}// Prune subject list
  if(subjID==='All'){var subjList=subjectArray.join('\r\n');subjList=subjList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){// DEV: innerText doesn't include hidden items
  var rgxSubject=new RegExp('_?'+p1+'[._]','i');if(p1!=='All'&&!rgxSubject.test(visibleZIMs))return '';return '<option value="'+p1+'"'+(subjID===p1?' selected':'')+'>'+p1+'</option>';});subjSel.innerHTML=subjList;}// Rebuild lang selector
  var langList=langArray.join('\r\n');langList=langList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){return '<option value="'+p1+'"'+(langID===p1?' selected':'')+'>'+p1+(p1==='All'?'':' : '+langCodes[p1])+'</option>';});langSel.innerHTML=langList;}});}if(subjectArray&&subjSel){// Set up event listener for subject selector
  subjSel.addEventListener('change',function(){var langID=langSel?langSel.options[langSel.selectedIndex].value:'';var subjID=subjSel?subjSel.options[subjSel.selectedIndex].value:'';var dateID=dateSel?dateSel.options[dateSel.selectedIndex].value:'';var subjEntries=document.querySelectorAll('.wikiLang');// Hide all entries except specified subject
  if(subjID){for(var i=0;i<subjEntries.length;i++){if(subjEntries[i].dataset.kiwixsubject===subjID||subjID==='All')subjEntries[i].style.display='inline';if(subjEntries[i].dataset.kiwixsubject!==subjID&&subjID!=='All')subjEntries[i].style.display='none';if(langID&&subjEntries[i].lang!==langID&&langID!=='All')subjEntries[i].style.display='none';if(dateID&&subjEntries[i].dataset.kiwixdate!==dateID&&dateID!=='All')subjEntries[i].style.display='none';}var visibleZIMs=langPanel.innerText.match(/^.*?\.zi[mp]/mgi);// Prune the language list
  if(langID==='All'){var langList=langArray.join('\r\n');// We need to normalize language codes in langPanel (for Stackexchange)
  // DEV: innerText doesn't include hidden items
  var langTestPanel=langPanel.innerText.replace(/(_\w+)-(\w+_)/,'$1$2');langList=langList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){if(p1!=='All'&&!~langTestPanel.indexOf('_'+p1+'_'))return '';return '<option value="'+p1+'"'+(langID===p1?' selected':'')+'>'+p1+(p1==='All'?'':' : '+langCodes[p1])+'</option>';});langSel.innerHTML=langList;}// Prune date list
  if(dateID==='All'){var dateList=dateArray.join('\r\n');dateList=dateList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){var rgxDate=new RegExp('_'+p1+'\\.zi','i');if(p1!=='All'&&!rgxDate.test(visibleZIMs))return '';return '<option value="'+p1+'"'+(dateID===p1?' selected':'')+'>'+p1+'</option>';});dateSel.innerHTML=dateList;}// Rebuild subject selector
  var subjList=subjectArray.join('\r\n');subjList=subjList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){return '<option value="'+p1+'"'+(subjID===p1?' selected':'')+'>'+p1+'</option>';});subjSel.innerHTML=subjList;}});}if(dateArray&&dateSel){// Set up event listener for date selector
  dateSel.addEventListener('change',function(){var langID=langSel?langSel.options[langSel.selectedIndex].value:'';var subjID=subjSel?subjSel.options[subjSel.selectedIndex].value:'';var dateID=dateSel?dateSel.options[dateSel.selectedIndex].value:'';var dateEntries=document.querySelectorAll('.wikiLang');// Hide all entries except specified date
  if(dateID){for(var i=0;i<dateEntries.length;i++){if(dateEntries[i].dataset.kiwixdate===dateID||dateID==='All')dateEntries[i].style.display='inline';if(dateEntries[i].dataset.kiwixdate!==dateID&&dateID!=='All')dateEntries[i].style.display='none';if(langID&&dateEntries[i].lang!==langID&&langID!=='All')dateEntries[i].style.display='none';if(subjID&&dateEntries[i].dataset.kiwixsubject!==subjID&&subjID!=='All')dateEntries[i].style.display='none';}var visibleZIMs=langPanel.innerText.match(/^.*?\.zi[mp]/mgi);// Prune the language list
  if(langID==='All'){var langList=langArray.join('\r\n');// We need to normalize language codes in langPanel (for Stackexchange)
  // DEV: innerText doesn't include hidden items
  var langTestPanel=langPanel.innerText.replace(/(_\w+)-(\w+_)/,'$1$2');langList=langList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){if(p1!=='All'&&!~langTestPanel.indexOf('_'+p1+'_'))return '';return '<option value="'+p1+'"'+(langID===p1?' selected':'')+'>'+p1+(p1==='All'?'':' : '+langCodes[p1])+'</option>';});langSel.innerHTML=langList;}// Prune subject list
  if(subjID==='All'){var subjList=subjectArray.join('\r\n');subjList=subjList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){// DEV: innerText doesn't include hidden items
  var rgxSubject=new RegExp('_?'+p1+'[._]','i');if(p1!=='All'&&!rgxSubject.test(visibleZIMs))return '';return '<option value="'+p1+'"'+(subjID===p1?' selected':'')+'>'+p1+'</option>';});subjSel.innerHTML=subjList;}// Rebuild date selector
  var dateList=dateArray.join('\r\n');dateList=dateList.replace(/^(.*)[\r\n]*/mg,function(p0,p1){return '<option value="'+p1+'"'+(dateID===p1?' selected':'')+'>'+p1+'</option>';});dateSel.innerHTML=dateList;}});}var links=downloadLinks.getElementsByTagName('a');for(i=0;i<links.length;i++){// Store the href
  links[i].setAttribute('data-kiwix-dl',links[i].getAttribute('href'));// Preserve sort order
  if(!/\?C=\w;O=\w/.test(links[i].href))links[i].href='#';if(/\.\.\//.test(links[i].innerHTML))links[i].innerHTML='Parent Directory';links[i].addEventListener('click',function(e){e.preventDefault();var langSel=document.getElementById('langs');var subjSel=document.getElementById('subjects');var dateSel=document.getElementById('dates');var langID=langSel?langSel.value:'';var dateID=dateSel?dateSel.value:'';var subjID=subjSel?subjSel.value:'';var replaceURL=URL+this.dataset.kiwixDl;replaceURL=/(custom_apps|endless|dev)\//.test(this.text)?params.kiwixhiddenDownloadServer+'.hidden/'+this.text:replaceURL;replaceURL=/(archive)\//.test(this.text)?params.kiwixDownloadServer.replace(/\/zim\//,'/archive/zim/'):replaceURL;// Allow both zim and zip format
  if(/\.zi[mp]$/i.test(this.dataset.kiwixDl)){replaceURL=replaceURL+'.meta4';}else if(/parent\s*directory|\.\.\//i.test(this.text)){replaceURL=URL.replace(/\/[^/]*\/$/i,'/');replaceURL=replaceURL.replace(params.kiwixhiddenDownloadServer,params.kiwixDownloadServer);replaceURL=replaceURL.replace(/\.hidden\//,'');replaceURL=replaceURL.replace(/\/archive\/$/,'/zim/');}else if(/Name|Size|Last\smodified|Description/.test(this.text)){replaceURL=this.getAttribute('href').replace(/;/g,'&');replaceURL=URL+replaceURL;}else if(!/\/$/.test(this.text)){// Unrecognized filetype and it's not a directory, so prevent potentially harmful download
  replaceURL='';}requestXhttpData(replaceURL,langID,subjID,dateID);});}// Display the finished panel
  downloadLinks.style.display='block';document.getElementById('indexHeader').scrollIntoView();document.getElementById('scrollbox').scrollTop+=65;// Standardize the document for array extraction
  function getStandardizedDoc(fromDoc){// Add back any missing carriage returns
  var std=fromDoc.replace(/<\/span><span\b/ig,'\n');// Delete all lines without a wiki pattern from language list
  std=std.replace(/^(?![^_\n\r]+_([\w-]+)_.+$).*[\r\n]*/mg,'');// Delete any hidden lines
  std=std.replace(/^.*?display:\s*none;.*[\r\n]*/mg,'');return std;}// Get list of languages
  function getLangArray(fromDoc){// Normalize line spacing
  fromDoc=fromDoc.replace(/[\r\n]+/g,'\n');// Deal first with two-code languages (the most common)
  // var langList = fromDoc.replace(/^[^_]+_([a-z]{2})_.+[\r\n]*/mg, '@$1\n');
  var langList=fromDoc.replace(/^.*_([a-z]{2})_.+[\r\n]*/mg,'@$1\n');// Now deal with longer language codes
  langList=langList.replace(/^(?!@).*?_(?!(?:all|maxi|mini|nopic)_)([a-z]{2,6}|nds-nl|be-tarask|map-bms|roa-tara|zh-classical)_.+[\r\n]*/mg,'@$1\n');// Normalize codes with hyphen
  langList=langList.replace(/^(@[a-z]+)-([a-z])/mg,function(p0,p1,p2){return p1+p2.toUpperCase();});// Remove placeholder
  langList=langList.replace(/^@/mg,'');// Delete recurrences
  langList=langList.replace(/\b([\w-]+\n)(?=[\s\S]*\b\1\n?)/g,'');langList='All\n'+langList;langList=langList.replace(/-/g,'');var langArray=langList.match(/^\w+$/mg);// Sort list alphabetically
  langArray.sort();return langArray;}// Get list of subjects
  function getSubjectArray(fromDoc){// Get list of all subjects
  var subList;if(/\/(mooc|phet|zimit|videos|other|dev)\b/i.test(URL)){return null;}else if(/\/stack_exchange\b/i.test(URL)){subList=fromDoc.replace(/^(?:.+(stackoverflow)|[^"]+"([^.]+)).+[\r\n]/img,'$1$2\n');}else {subList=fromDoc.replace(/^[^"]+"[^_]+_[^_]+_((?:[^_]|_(?!maxi|mini|nopic|\d\d\d\d))+).+[\r\n]*/img,'$1\n');}// Delete recurrences
  subList=subList.replace(/^([\w_-]+)$[\r\n]*(?=[\s\S]*^\1$)/gm,'');// Remove 'all'
  subList=subList.replace(/^all$/mi,'');var subArray=subList.match(/^.+$/mg);if(subArray){// Sort list alphabetically
  subArray.sort();// Add 'All' at astart
  subArray.unshift('All');}return subArray;}// Get list of dates
  function getDateArray(fromDoc){// Get list of all dates
  var dateList=fromDoc.replace(/^.*?(\d+[-]\d+)\.(?:zi[mp]|err).+[\r\n]*/mig,'$1\n');// Delete recurrences
  dateList=dateList.replace(/(\b\d+[-]\d+)\n(?=[\s\S]*\b\1\n?)/g,'');dateList='All\n'+dateList;var dateArray=dateList.match(/^.+$/mg);// Sort list alphabetically
  dateArray.sort();dateArray.reverse();return dateArray;}}}var percentageComplete=0;var downloadSize=0;/**
   * Reports download progress to the serverResponse panel
   *
   * @param {String|Integer} received A string ('completed') or integer representing the download progress (in bytes)
   * @param {Integer} total An optional integer representing the total size of the download (in bytes)
   */function reportDownloadProgress(received,total){serverResponse.style.display='inline';var colour=received==='completed'?'green':isNaN(received)?'red':'goldenrod';serverResponse.style.setProperty('color',colour,'important');var formattedData;downloadSize=total?total/1024/1024:downloadSize;if(isNaN(received)){formattedData=received;}else {var dataMB=received/1024/1024;// If data is greater than 1GB, convert to GB
  if(received>1073741824){formattedData=(dataMB/1024).toFixed(2)+' GB';}else {formattedData=dataMB.toFixed(2)+' MB';}if(downloadSize>0){var percentageData=Math.floor(dataMB/downloadSize*100);if(percentageData>percentageComplete){percentageComplete=percentageData;uiUtil.pollOpsPanel('<span class="glyphicon glyphicon-refresh spinning"></span>&emsp;<b>Do not quit app:</b> Downloading archive... '+percentageComplete+'% ('+formattedData+')',true);}}}serverResponse.innerHTML='Download progress: '+formattedData;if(received==='completed'){uiUtil.pollOpsPanel('Download complete! 100%',5000);percentageComplete=0;downloadSize=0;setTimeout(function(){serverResponse.style.removeProperty('color');if(document.getElementById('downloadLinks').style.display==='none'){serverResponse.style.display='none';}},10000);}}var kiwixServe = {// langCodes: langCodes,
  requestXhttpData:requestXhttpData,reportDownloadProgress:reportDownloadProgress};

  /**
   * The update server configuration
   */params.updateServer={url:'https://api.github.com/repos/kiwix/kiwix-js-pwa/',releases:'releases'};// A RegExp prototype string to match the current app's releases
  var baseApp=params.packagedFile&&/wikivoyage/.test(params.packagedFile)?'wikivoyage':params.packagedFile&&/wikmed|mdwiki/.test(params.packagedFile)?'wikimed':'windows|electron|kiwixwebapp_';// Default value
  // A RegExp to match download URLs of releases
  var regexpMatchGitHubReleases=RegExp('"browser_download_url[":\\s]+"(https:.*download\\/([^\\/]+).*(?:'+baseApp+')[^"]+)"','ig');/**
   * Get and return the JSON list of releases from the update server's REST API
   *
   * @param {Function} callback The function to call with the data
   * @returns {String} A JSON string containing hierarchical release data
   */function getReleasesObject(callback){uiUtil.XHR(params.updateServer.url+params.updateServer.releases,'text',function(response,mimetype,status){if(status===200){callback(response);}else callback('');});}/**
   * A function to get the latest updates from a GitHub releases source
   * Only updates that are greater than the current update are returned
   * Attempts to match by channel, but also matches non-channel releases
   *
   * @param {Function} callback A function to call back with the results
   * @returns {Object} Calls back with update tag, update URL, and array of releases
   */function getLatestUpdates(callback){var updatedReleases=[];var currentRelease=params.appVersion.replace(/^v?([\d.]+)/,'$1');var currentReleaseChannel=params.appVersion.replace(/^[v\d.]+/,'');var updateTag;var channelMatchedTag;var updateUrl;var channelMatchedUpdateUrl;getReleasesObject(function(releases){var releaseFile;var releaseVersion;var releaseChannel;// Loop through every line in releases
  var matchedRelease=regexpMatchGitHubReleases.exec(releases);while(matchedRelease!=null){releaseFile=matchedRelease[1];releaseVersion=matchedRelease[2].replace(/^v?([\d.]+).*/,'$1');releaseChannel=matchedRelease[2].replace(/^[v\d.]+/,'');// Compare the releases using a version-type comparison
  if(releaseVersion.localeCompare(currentRelease,{numeric:true,sensitivity:'base'})===1){if(!channelMatchedTag&&currentReleaseChannel===releaseChannel){channelMatchedTag=matchedRelease[2];channelMatchedUpdateUrl=releaseFile.replace(/\/download\//,'/tag/').replace(/[^/]+$/,'');}if(!updateTag)updateTag=matchedRelease[2];if(!updateUrl)updateUrl=releaseFile.replace(/\/download\//,'/tag/').replace(/[^/]+$/,'');updatedReleases.push(releaseFile);}matchedRelease=regexpMatchGitHubReleases.exec(releases);}// We should now have a list of all candidate updates, and candidate channel update
  // Compare the channel-matched update wiht the update, and if they are same underlying version number, choose channel match
  if(updateTag&&updateTag.replace(/^v?([\d.]+).*/,'$1')===channelMatchedTag.replace(/^v?([\d.]+).*/,'$1')){updateTag=channelMatchedTag;updateUrl=channelMatchedUpdateUrl;}callback(updateTag,updateUrl,updatedReleases);});}var updater = {getLatestUpdates:getLatestUpdates};

  var DESCRIPTORS = descriptors;
  var uncurryThis = functionUncurryThis;
  var objectKeys = objectKeys$4;
  var toIndexedObject = toIndexedObject$c;
  var $propertyIsEnumerable = objectPropertyIsEnumerable.f;

  var propertyIsEnumerable = uncurryThis($propertyIsEnumerable);
  var push = uncurryThis([].push);

  // `Object.{ entries, values }` methods implementation
  var createMethod = function (TO_ENTRIES) {
    return function (it) {
      var O = toIndexedObject(it);
      var keys = objectKeys(O);
      var length = keys.length;
      var i = 0;
      var result = [];
      var key;
      while (length > i) {
        key = keys[i++];
        if (!DESCRIPTORS || propertyIsEnumerable(O, key)) {
          push(result, TO_ENTRIES ? [key, O[key]] : O[key]);
        }
      }
      return result;
    };
  };

  var objectToArray = {
    // `Object.values` method
    // https://tc39.es/ecma262/#sec-object.values
    values: createMethod(false)
  };

  var $$1 = _export;
  var $values = objectToArray.values;

  // `Object.values` method
  // https://tc39.es/ecma262/#sec-object.values
  $$1({ target: 'Object', stat: true }, {
    values: function values(O) {
      return $values(O);
    }
  });

  /**
   * Performs a full app reset, deleting all caches and settings
   * Or, if a parameter is supplied, deletes or disables the object
   * @param {String} object Optional name of the object to disable or delete ('cookie', 'localStorage', 'cacheAPI')
   */function reset(object){function performReset(){var _this=this;var promises=[];// 1. Clear localStorage
  if(!object||object==='localStorage'){if(/localStorage/.test(assetsCache.capability)){promises.push(new Promise(function(resolve){_newArrowCheck(this,_this);localStorage.clear();console.debug('All Local Storage settings were deleted...');resolve();}.bind(this)));}else {console.debug('Local Storage is not available...');}}// 2. Clear sessionStorage
  if(!object||object==='sessionStorage'){promises.push(new Promise(function(resolve){_newArrowCheck(this,_this);sessionStorage.clear();console.debug('All Session Storage settings were deleted...');resolve();}.bind(this)));}// 3. Clear IndexedDB
  if(!object||object==='indexedDB'){if(/indexedDB/.test(assetsCache.capability)){promises.push(new Promise(function(resolve){_newArrowCheck(this,_this);window.indexedDB.deleteDatabase(params.indexedDB);console.debug('All IndexedDB entries were deleted...');resolve();}.bind(this)));}}// 4. Clear Cache API caches
  if(!object||object==='cacheAPI'){promises.push(new Promise(function(resolve){_newArrowCheck(this,_this);getCacheNames(function(cacheNames){var _this2=this;if(cacheNames&&!cacheNames.error){Promise.all(Object.values(cacheNames).map(function(cacheName){var _this3=this;_newArrowCheck(this,_this2);return caches.delete(cacheName).catch(function(err){_newArrowCheck(this,_this3);return console.error("Failed to delete cache ".concat(cacheName,":"),err);}.bind(this));}.bind(this))).then(function(){console.debug('All Cache API caches were deleted...');resolve();}).catch(function(err){console.error('Error clearing caches:',err);resolve();});}else {console.debug('No Cache API caches were in use.');resolve();}});}.bind(this)));}// 5. Clear any Origin Private File System Archives
  // DEV: Method is currently behind a flag, so wait till fully implemented
  // if (!object || object === 'OPFS') {
  //     if (navigator && navigator.storage && 'getDirectory' in navigator.storage) {
  //         promises.push(new Promise((resolve) => {
  //             navigator.storage.getDirectory().then(function (handle) {
  //                 handle.remove({ recursive: true }).then(function () {
  //                     console.debug('All OPFS archives were deleted...');
  //                     resolve();
  //                 }).catch(function (err) {
  //                     console.error('Error removing OPFS archives:', err);
  //                     resolve();
  //                 });
  //             }).catch(function (err) {
  //                 console.error('Error accessing OPFS directory:', err);
  //                 resolve();
  //             });
  //         }));
  //     }
  // }
  return Promise.all(promises).then(function(){if(!object||params.appCache){reloadApp();}});}// If no specific object was specified, ask for confirmation
  if(object){return performReset();}else {return uiUtil.systemAlert('<p><b>WARNING:</b> This will reset the app to a freshly installed state, deleting all app caches,'+' and settings! (Archives stored in the OPFS will be preserved.)<b></p><p>Make sure you have an Internet connection</b>'+' if this is an offline PWA, because it will be erased and reloaded.</p>','Warning!',true).then(function(confirm){if(confirm)return performReset();console.debug('User cancelled');return Promise.resolve();});}}// Gets cache names from Service Worker, as we cannot rely on having them in params.cacheNames
  function getCacheNames(callback){if(navigator.serviceWorker&&navigator.serviceWorker.controller){var channel=new MessageChannel();channel.port1.onmessage=function(event){var names=event.data;callback(names);};navigator.serviceWorker.controller.postMessage({action:'getCacheNames'},[channel.port2]);}else {callback(null);}}// Deregisters all Service Workers and reboots the app
  function reloadApp(){// Store params for reload
  var uriParams='';if(~window.location.href.indexOf(params.PWAServer)&&params.referrerExtensionURL){uriParams='?allowInternetAccess=true&contentInjectionMode=serviceworker';uriParams+='&referrerExtensionURL='+encodeURIComponent(params.referrerExtensionURL);}// Function to perform the actual reload
  var reboot=function reboot(){// Disable beforeunload interceptor
  params.interceptBeforeUnload=false;navigator.serviceWorker.controller.postMessage({action:'skipWaiting'});// Force reload from server, bypassing cache
  console.debug('Performing hard reload...');window.location.href=location.origin+location.pathname+uriParams;};if(navigator&&navigator.serviceWorker){console.debug('Deregistering Service Workers...');return navigator.serviceWorker.getRegistrations().then(function(registrations){var _this4=this;if(!registrations.length){return Promise.resolve();}return Promise.all(registrations.map(function(registration){_newArrowCheck(this,_this4);return registration.unregister();}.bind(this)));}).then(function(){var _this5=this;console.debug('Service Workers cleanup complete');// Adding a small delay before reboot to ensure cleanup
  return new Promise(function(resolve){_newArrowCheck(this,_this5);return setTimeout(resolve,200);}.bind(this));}).then(reboot).catch(function(err){console.error('SW deregistration failed:',err);reboot();});}return Promise.resolve().then(reboot);}var resetApp = {reset:reset,reloadApp:reloadApp,getCacheNames:getCacheNames};

  // document.adoptedStyleSheets = [styles, bootstrap];
  /**
   * Define global state variables:
   */// The global parameter and app state objects are defined in init.js
  /* global params, appstate, assetsCache, nw, electronAPI, Windows, webpMachine, dialog, LaunchParams, launchQueue, abstractFilesystemAccess, MSApp */// Placeholders for the article container, the article window, the article DOM and some UI elements
  var articleContainer$1=document.getElementById('articleContent');articleContainer$1.kiwixType='iframe';var articleWindow=articleContainer$1.contentWindow;var articleDocument;var scrollbox=document.getElementById('scrollbox');var prefix=document.getElementById('prefix');// The following variables are used to store the current article and its state
  var messageChannelWaiting=false;var transformedHTML='';var transDirEntry=null;/**
   * @type ZIMArchive
   */appstate.selectedArchive=null;// An object to hold the current search and its state (allows cancellation of search across modules)
  appstate['search']={prefix:'',// A field to hold the original search string
  status:'',// The status of the search: ''|'init'|'interim'|'cancelled'|'complete'
  type:''// The type of the search: 'basic'|'full' (set automatically in search algorithm)
  };// A parameter to determine the Settings Store API in use (we need to nullify before testing
  // because params.storeType is also set in a preliminary way in init.js)
  params['storeType']=null;params['storeType']=settingsStore$1.getBestAvailableStorageAPI();// A parameter to determine whether the webkitdirectory API is available
  params['webkitdirectory']=util.webkitdirectorySupported();// Retrieve UWP launch arguments when the app is started by double-clicking on a file
  if(typeof Windows!=='undefined'&&Windows.UI&&Windows.UI.WebUI&&Windows.UI.WebUI.WebUIApplication){Windows.UI.WebUI.WebUIApplication.addEventListener('activated',function(eventArgs){if(eventArgs.kind===Windows.ApplicationModel.Activation.ActivationKind.file){params.storedFile=eventArgs.files[0].name||'';if(params.storedFile){params.pickedFile=eventArgs.files[0];params.storedFilePath=eventArgs.files[0].path;console.log('App was activated with a file: '+params.storedFile);processPickedFileUWP(params.pickedFile);}}},false);}// At launch, we set the correct content injection mode
  if(params.contentInjectionMode==='serviceworker'&&window.nw){// Failsafe for Windows XP version: reset app to Restricted mode because it cannot run in SW mode in Windows XP
  if(nw.process.versions.nw==='0.14.7')setContentInjectionMode('jquery');}else {setContentInjectionMode(params.contentInjectionMode);}// Test caching capability
  cache.test(function(){});// Unique identifier of the article expected to be displayed
  appstate.expectedArticleURLToBeDisplayed='';// Check if we have managed to switch to PWA mode (if running UWP app)
  // DEV: we do this in init.js, but sometimes it doesn't seem to register, so we do it again once the app has fully launched
  if(/UWP\|PWA/.test(params.appType)&&/^http/i.test(window.location.protocol)){// We are in a PWA, so signal success
  params.localUWPSettings.PWA_launch='success';}// Make Configuration headings collapsible
  uiUtil.setupConfigurationToggles();/**
   * Resize the IFrame height, so that it fills the whole available height in the window
   * @param {Boolean} reload Allows reload of the app on resize
   */function resizeIFrame(reload){// console.debug('Resizing iframe...');
  // Re-enable top-level scrolling
  var configuration=document.getElementById('configuration');var about=document.getElementById('about');if(configuration.style.display==='none'&&about.style.display==='none'&&// Don't collapse the scrollbox if user is interacting with search
  prefix!==document.activeElement&&!appstate.snippetInteractionFlag){scrollbox.style.height=0;}else {scrollbox.style.height=window.innerHeight-document.getElementById('top').getBoundingClientRect().height+'px';}uiUtil.showSlidingUIElements();var ToCList=document.getElementById('ToCList');if(typeof ToCList!=='undefined'){ToCList.style.maxHeight=~~(window.innerHeight*0.75)+'px';ToCList.style.marginLeft=~~(window.innerWidth/2)-~~(window.innerWidth*0.16)+'px';}if(window.outerWidth<=470){document.getElementById('dropup').classList.remove('col-xs-4');document.getElementById('dropup').classList.add('col-xs-3');if(window.outerWidth<=360){document.getElementById('btnTop').classList.remove('col-xs-2');document.getElementById('btnTop').classList.add('col-xs-1');}else {document.getElementById('btnTop').classList.remove('col-xs-1');document.getElementById('btnTop').classList.add('col-xs-2');}}else {document.getElementById('dropup').classList.remove('col-xs-3');document.getElementById('dropup').classList.add('col-xs-4');}if(settingsStore$1.getItem('reloadDispatched')==='true'){setTimeout(function(){settingsStore$1.removeItem('reloadDispatched');},1000);}else if(reload&&params.resetDisplayOnResize){settingsStore$1.setItem('reloadDispatched',true,Infinity);window.location.reload();console.log('So long, and thanks for all the fish!');return;}removePageMaxWidth();checkToolbar();}window.onresize=function(){resizeIFrame(true);// Check whether fullscreen icon needs to be updated
  setDynamicIcons();// We need to load any images exposed by the resize
  var scrollFunc=document.getElementById('articleContent').contentWindow;scrollFunc=scrollFunc?scrollFunc.onscroll:null;if(scrollFunc)scrollFunc();};// Define behavior of HTML elements
  if(params.navButtonsPos==='top'){// User has requested navigation buttons should be at top, so we need to swap them
  var btnBack=document.getElementById('btnBack');var btnBackAlt=document.getElementById('btnBackAlt');btnBack.id='btnBackAlt';btnBackAlt.id='btnBack';btnBackAlt.style.display='inline';btnBack.style.display='none';var btnForward=document.getElementById('btnForward');var btnForwardAlt=document.getElementById('btnForwardAlt');btnForward.id='btnForwardAlt';btnForwardAlt.id='btnForward';btnForwardAlt.style.display='inline';btnForward.style.display='none';var btnRandom=document.getElementById('btnRandomArticle');var btnRandomAlt=document.getElementById('btnRandomArticleAlt');btnRandom.id='btnRandomArticleAlt';btnRandomAlt.id='btnRandomArticle';btnRandom.style.display='none';btnRandomAlt.style.display='inline';var btnToggleTheme=document.getElementById('btnToggleTheme');var btnToggleThemeAlt=document.getElementById('btnToggleThemeAlt');btnToggleTheme.id='btnToggleThemeAlt';btnToggleThemeAlt.id='btnToggleTheme';btnToggleTheme.style.display='none';btnToggleThemeAlt.style.display='inline';}// Process pointerup events (used for checking if mouse back / forward buttons have been clicked)
  function onPointerUp(e){if(_typeof(e)==='object'){if(e.button===3){document.getElementById('btnBack').click();}if(e.button===4){document.getElementById('btnForward').click();}}}if(/UWP/.test(params.appType))document.body.addEventListener('pointerup',onPointerUp);document.getElementById('searchArticles').addEventListener('click',function(){var val=prefix.value;// Do not initiate the same search if it is already in progress
  if(appstate.search.prefix===val&&!/^(cancelled|complete)$/.test(appstate.search.status))return;document.getElementById('welcomeText').style.display='none';document.querySelectorAll('.alert').forEach(function(el){el.style.display='none';});uiUtil.pollSpinner();pushBrowserHistoryState(null,val);// Initiate the search
  searchDirEntriesFromPrefix(val);clearFindInArticle();// Re-enable top-level scrolling
  var headerHeight=document.getElementById('top').getBoundingClientRect().height;var footerHeight=document.getElementById('footer').getBoundingClientRect().height;scrollbox.style.height=window.innerHeight-headerHeight-footerHeight+'px';});document.getElementById('formArticleSearch').addEventListener('submit',function(){document.getElementById('searchArticles').click();});// Handle keyboard events in the prefix (article search) field
  var keyPressHandled=false;prefix.addEventListener('keydown',function(e){// If user presses Escape...
  // IE11 returns "Esc" and the other browsers "Escape"; regex below matches both
  if(/^Esc/.test(e.key)){// Hide the article list
  e.preventDefault();document.getElementById('articleListWithHeader').style.display='none';document.getElementById('articleContent').focus();document.getElementById('mycloseMessage').click();// This is in case the modal box is showing with an index search
  keyPressHandled=true;}// Arrow-key selection code adapted from https://stackoverflow.com/a/14747926/9727685
  // IE11 produces "Down" instead of "ArrowDown" and "Up" instead of "ArrowUp"
  if(/^((Arrow)?(Down|Up|Left|Right)|Enter)$/.test(e.key)){// User pressed Down arrow, Up arrow, Left arrow, Right arrow, or Enter
  // This is needed to prevent processing in the keyup event : https://stackoverflow.com/questions/9951274
  keyPressHandled=true;if(/Enter/.test(e.key)){// Don't refresh the page if Enter is pressed even before any search results are selected
  e.preventDefault();// Auto-select first search result if none selected yet
  if(!document.querySelector('#articleList .hover')){var firstElement=document.querySelector('#articleList a');if(firstElement){firstElement.classList.add('hover');if(firstElement.firstElementChild)firstElement.firstElementChild.classList.add('hover');}}}var activeElement=document.querySelector('#articleList .hover')||document.querySelector('#articleList a');if(!activeElement)return;// If user presses Enter or Right arrow, read the dirEntry or open snippet
  if(/Enter|Right|Left/.test(e.key)){if(/Enter/.test(e.key)&&activeElement.classList.contains('hover')&&!activeElement.classList.contains('snippet-container')){var dirEntryId=activeElement.getAttribute('dirEntryId');findDirEntryFromDirEntryIdAndLaunchArticleRead(decodeURIComponent(dirEntryId));}else if(activeElement.classList.contains('snippet-container')){e.preventDefault();// Open the snippet container
  uiUtil.toggleSnippet(activeElement);}// Allow left/right arrow keys to move around in search text box when not opening snippet
  return;}e.preventDefault();// If user presses ArrowDown...
  // (NB selection is limited to arrow keys and Enter by regex above)
  if(/Down/.test(e.key)){if(activeElement.classList.contains('hover')){activeElement.classList.remove('hover');if(activeElement.firstElementChild)activeElement.firstElementChild.classList.remove('hover');activeElement=activeElement.nextElementSibling||activeElement;if(activeElement.classList.contains('snippet-container')){activeElement.firstElementChild.classList.add('hover');}var nextElement=activeElement.nextElementSibling||activeElement;if(!uiUtil.isElementInView(window,nextElement,true))nextElement.scrollIntoView(false);}}// If user presses ArrowUp...
  if(/Up/.test(e.key)){activeElement.classList.remove('hover');if(activeElement.firstElementChild)activeElement.firstElementChild.classList.remove('hover');activeElement=activeElement.previousElementSibling||activeElement;if(activeElement.classList.contains('snippet-container')){activeElement.firstElementChild.classList.add('hover');}var previousElement=activeElement.previousElementSibling||activeElement;if(!uiUtil.isElementInView(window,previousElement,true))previousElement.scrollIntoView();if(previousElement===activeElement){document.getElementById('articleListWithHeader').scrollIntoView();document.getElementById('top').scrollIntoView();}}activeElement.classList.add('hover');}});// Search for titles as user types characters
  prefix.addEventListener('keyup',function(e){if(appstate.selectedArchive!==null&&appstate.selectedArchive.isReady()){// Prevent processing by keyup event if we already handled the keypress in keydown event
  if(keyPressHandled){keyPressHandled=false;}else {onKeyUpPrefix();}}});// Restore the search results if user goes back into prefix field
  prefix.addEventListener('focus',function(){var val=prefix.value;if(/^\s/.test(val)){// If user had previously had the archive index open, clear it
  prefix.value='';}else if(val!==''){document.getElementById('articleListWithHeader').style.display='';}scrollbox.style.position='absolute';var headerHeight=document.getElementById('top').getBoundingClientRect().height;var footerHeight=document.getElementById('footer').getBoundingClientRect().height;scrollbox.style.height=window.innerHeight-headerHeight-footerHeight+'px';});// Hide the search results if user moves out of prefix field
  prefix.addEventListener('blur',function(){// We need to wait one tick for the activeElement to receive focus
  setTimeout(function(){// Check if a snippet was just interacted with
  if(appstate.snippetInteractionFlag){appstate.snippetInteractionFlag=false;return;// Don't hide the search results
  }if(!(/^articleList|searchSyntaxLink/.test(document.activeElement.id)||/^list-group|snippet-container/.test(document.activeElement.className))){scrollbox.style.height=0;document.getElementById('articleListWithHeader').style.display='none';appstate.tempPrefix='';uiUtil.clearSpinner();}},100);});listenForKeyboardEvents(window);// Handle listeners for print dialogue
  function printArticle(doc){uiUtil.printCustomElements(doc);uiUtil.systemAlert('<b>Document will now reload to restore the DOM after printing...</b>').then(function(){printCleanup();});// innerDocument.execCommand("print", false, null);
  // if (typeof window.nw !== 'undefined' || typeof window.fs === 'undefined') {
  doc.defaultView.print();// } else {
  //     // We are in an Electron app and need to use export to browser to print
  //     params.preloadingAllImages = false;
  //     // Add a window.print() script to the html
  //     document.getElementById('articleContent').contentDocument.head.innerHTML +=
  //         '\n<script type="text/javascript">window.onload=function() {\n' +
  //         '    alert("After you press OK, you will be asked to choose a printer.\\n" +\n' +
  //         '        "If you want to test the formatting, we suggest you print to\\n" +\n' +
  //         '        "PDF or XPS. You could then open the PDF and select specific pages.");\n' +
  //         '    window.print();\n' +
  //         '};<\/script>';
  //     //html = html.replace(/(<\/head>\s*)/i, '<script type="text/javascript">window.onload=window.print();<\/script>\n$1');
  //     uiUtil.extractHTML();
  // }
  }document.getElementById('printDesktopCheck').addEventListener('click',function(e){// Reload article if user wants to print a different style
  params.cssSource=e.target.checked?'desktop':'mobile';params.printIntercept=true;params.printInterception=false;var btnContinue=document.getElementById('printapproveConfirm');var btnCancel=document.getElementById('printdeclineConfirm');btnCancel.disabled=true;btnContinue.disabled=true;btnContinue.innerHTML='Please wait';goToArticle(params.lastPageVisit.replace(/@kiwixKey@.+/,''));});document.getElementById('printImageCheck').addEventListener('click',function(e){// Reload article if user wants to print images
  if(e.target.checked&&!params.allowHTMLExtraction){params.printIntercept=true;params.printInterception=false;params.allowHTMLExtraction=true;var btnContinue=document.getElementById('printapproveConfirm');var btnCancel=document.getElementById('printdeclineConfirm');btnCancel.disabled=true;btnContinue.disabled=true;btnContinue.innerHTML='Please wait';goToArticle(params.lastPageVisit.replace(/@kiwixKey@.+/,''));}});function printCleanup(){if(!params.printInterception){// We don't need a radical cleanup because there was no printIntercept
  removePageMaxWidth();setTab();setArticleZoom(params.relativeFontSize);params.cssTheme=settingsStore$1.getItem('cssTheme')||'light';if(document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked){// It seems darkReader has been auto-turned on, so we need to respect that
  params.cssTheme='darkReader';}switchCSSTheme();return;}params.printIntercept=false;params.printInterception=false;// Immediately restore temporarily changed values
  params.allowHTMLExtraction=settingsStore$1.getItem('allowHTMLExtraction')==='true';goToArticle(params.lastPageVisit.replace(/@kiwixKey@.+/,''));setTimeout(function(){// Restore temporarily changed value after page has reloaded
  params.rememberLastPage=settingsStore$1.getItem('rememberLastPage')==='true';if(!params.rememberLastPage){settingsStore$1.setItem('lastPageVisit','',Infinity);params.lastPageHTML='';// DEV: replace this with cache.clear when you have repaired that method
  cache.setArticle(params.lastPageVisit.replace(/.+@kiwixKey@/,''),params.lastPageVisit.replace(/@kiwixKey@.+/,''),'',function(){});}},5000);}// End of listeners for print dialogues
  function printIntercept(){params.printInterception=params.printIntercept;params.printIntercept=false;document.getElementById('btnAbout').classList.add('active');var btnContinue=document.getElementById('printapproveConfirm');var btnCancel=document.getElementById('printdeclineConfirm');btnCancel.disabled=false;btnContinue.disabled=false;btnContinue.innerHTML='Continue';var printModalContent=document.getElementById('print-modal-content');openOrCloseAllSections(true);printModalContent.classList.remove('dark');var determinedTheme=params.cssUITheme;determinedTheme=determinedTheme==='auto'?cssUIThemeGetOrSet('auto',true):determinedTheme;if(determinedTheme!=='light'){printModalContent.classList.add('dark');}// If document is in wrong style, or images are one-time BLOBs, reload it
  // var innerDoc = window.frames[0].frameElement.contentDocument;
  var innerDoc=document.getElementById('articleContent').contentDocument;if(appstate.isReplayWorkerAvailable){innerDoc=innerDoc?innerDoc.getElementById('replay_iframe').contentDocument:null;}if(!innerDoc){return uiUtil.systemAlert('Sorry, we could not find a document to print! Please load one first.','Warning');}if(params.contentInjectionMode==='serviceworker'){// Re-establish lastPageVisit because it is not always set, for example with dynamic loads, in SW mode
  params.lastPageVisit=articleWindow.location.href.replace(/^.+\/([^/]+\.[zZ][iI][mM]\w?\w?)\/([CA]\/.*$)/,function(m0,zimName,zimURL){return decodeURIComponent(zimURL)+'@kiwixKey@'+decodeURIComponent(zimName);});}var printDesktopCheck=document.getElementById('printDesktopCheck').checked;var printImageCheck=document.getElementById('printImageCheck').checked;var styleIsDesktop=!/href\s*=\s*["'][^"']*?(?:minerva|mobile)/i.test(innerDoc.head.innerHTML);// if (styleIsDesktop != printDesktopCheck || printImageCheck && !params.allowHTMLExtraction || params.contentInjectionMode == 'serviceworker') {
  if(appstate.wikimediaZimLoaded&&(styleIsDesktop!==printDesktopCheck||printImageCheck&&!params.allowHTMLExtraction)){// We need to reload the document because it doesn't match the requested style or images are one-time BLOBs
  params.cssSource=printDesktopCheck?'desktop':'mobile';params.rememberLastPage=true;// Re-enable caching to speed up reloading of page
  // params.contentInjectionMode = 'jquery'; //Much easier to count images in Restricted mode
  params.allowHTMLExtraction=true;params.printIntercept=true;params.printInterception=false;btnCancel.disabled=true;btnContinue.disabled=true;btnContinue.innerHTML='Please wait';// Show the modal so the user knows that printing is being prepared
  document.getElementById('printModal').style.display='block';goToArticle(params.lastPageVisit.replace(/@kiwixKey@.+/,''));return;}// Pre-load all images in case user wants to print them
  if(params.imageDisplay){document.getElementById('printImageCheck').disabled=false;if(printImageCheck){btnCancel.disabled=true;btnContinue.disabled=true;btnContinue.innerHTML='Loading images...';// Callback for when all images are loaded
  params.printImagesLoaded=function(){// Images have finished loading, so enable buttons
  btnCancel.disabled=false;btnContinue.disabled=false;btnContinue.innerHTML='Continue';};if(params.contentInjectionMode==='jquery'){images.prepareImagesJQuery(articleWindow,true);}else {images.prepareImagesServiceWorker(articleWindow,true);}}}else {document.getElementById('printImageCheck').checked=false;document.getElementById('printImageCheck').disabled=true;}// Remove max page-width restriction
  if(params.removePageMaxWidth!==true){var tempPageMaxWidth=params.removePageMaxWidth;params.removePageMaxWidth=true;removePageMaxWidth();params.removePageMaxWidth=tempPageMaxWidth;}// Reset zoom level to 100%
  setArticleZoom(100);// Put doc into light mode
  params.cssTheme='light';switchCSSTheme();uiUtil.systemAlert(' ','',true,null,'Continue',null,'printModal').then(function(result){// Restore temporarily changed values
  params.cssSource=settingsStore$1.getItem('cssSource')||'auto';params.cssTheme=settingsStore$1.getItem('cssTheme')||'light';if(result)printArticle(innerDoc);else printCleanup();});}// Establish some variables with global scope
  var localSearch={};var timeoutFIAKeyup=null;function clearFindInArticle(){if(document.getElementById('row2').style.display==='none')return;if(typeof localSearch!=='undefined'&&localSearch.remove){localSearch.remove();}document.getElementById('findInArticle').value='';document.getElementById('matches').innerHTML='Full: 0';document.getElementById('partial').innerHTML='Partial: 0';document.getElementById('row2').style.display='none';document.getElementById('findText').classList.remove('active');}// Helper function to perform the actual search with debouncing
  function findInArticleInitiate(val){// Ensure nothing happens if only one or two ASCII values have been entered (search is not specific enough)
  // if no value has been entered (clears highlighting if user deletes all values in search field)
  if(!/^\s*[A-Za-z\s]{1,2}$/.test(val)){localSearch.scrollFrom=0;localSearch.lastScrollValue=val;localSearch.setMatchType('open');// Change matchType to 'left' if we are dealing with an ASCII language and a space has been typed
  if(/\s/.test(val)&&/(?:^|[\s\b])[A-Za-z]+(?:[\b\s]|$)/.test(val))localSearch.setMatchType('left');localSearch.apply(val);if(val.length){var fullTotal=localSearch.countFullMatches(val);var partialTotal=localSearch.countPartialMatches();fullTotal=fullTotal>partialTotal?partialTotal:fullTotal;document.getElementById('matches').innerHTML='<a id="scrollLink" href="#">Full: '+fullTotal+'</a>';document.getElementById('partial').innerHTML='Partial: '+partialTotal;// Auto-scroll: TODO - consider making this an option
  localSearch.scrollFrom=localSearch.scrollToFullMatch(val,localSearch.scrollFrom);}else {document.getElementById('matches').innerHTML='Full: 0';document.getElementById('partial').innerHTML='Partial: 0';}}}// Helper function to debounce keyup events
  function findInArticleKeyup(val){// Use a timeout, so that very quick typing does not cause a lot of overhead
  if(timeoutFIAKeyup){window.clearTimeout(timeoutFIAKeyup);}timeoutFIAKeyup=window.setTimeout(function(){findInArticleInitiate(val);},500);}// Set up the keyup event listener for the search input (attached once)
  var findInArticle=document.getElementById('findInArticle');findInArticle.addEventListener('keyup',function(e){// If user pressed Alt-F or Ctrl-F, exit
  if((e.altKey||e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='f')return;var val=this.value;// If user pressed enter / return key
  if(val&&(e.key==='Enter'||e.keyCode===13)){if(localSearch.scrollToFullMatch){localSearch.scrollFrom=localSearch.scrollToFullMatch(val,localSearch.scrollFrom);}return;}// If value hasn't changed, exit
  if(localSearch.lastScrollValue&&val===localSearch.lastScrollValue)return;findInArticleKeyup(val);});// Set up event delegation for the scrollLink (which is dynamically created)
  document.getElementById('matches').addEventListener('click',function(e){if(e.target&&e.target.id==='scrollLink'){e.preventDefault();var val=findInArticle.value;if(localSearch.scrollToFullMatch&&val){localSearch.scrollFrom=localSearch.scrollToFullMatch(val,localSearch.scrollFrom);}}});// Set up the click event listener for the findText button
  document.getElementById('findText').addEventListener('click',function(){var searchDiv=document.getElementById('row2');if(searchDiv.style.display!=='none'){// Hide the search bar
  setNavbarHeight(params.navbarHeight,params.relativeUIFontSize);setTab();// Return sections to original state
  openOrCloseAllSections();// Return params.hideToolbars to its original state
  checkToolbar();return;}// Set the height of the navbar to accommodate the search bar
  setNavbarHeight(params.navbarHeight+35,params.relativeUIFontSize);var innerDocument=document.getElementById('articleContent').contentDocument;if(appstate.isReplayWorkerAvailable){innerDocument=innerDocument?innerDocument.getElementById('replay_iframe').contentDocument:null;}innerDocument=innerDocument?innerDocument.body:null;if(!innerDocument||innerDocument.innerHTML.length<10)return;setTab('findText');searchDiv.style.display='block';// Show the toolbar
  params.hideToolbars=false;checkToolbar();findInArticle.focus();// We need to open all sections to search
  openOrCloseAllSections(true);// TODO: MatchType should be language specific
  localSearch=new util.Hilitor(innerDocument);});document.getElementById('btnRandomArticle').addEventListener('click',function(){// In Restricted mode, only load random content in iframe (not tab or window)
  appstate.target='iframe';setTab('btnRandomArticle');// Re-enable top-level scrolling
  goToRandomArticle();});document.getElementById('btnToggleTheme').addEventListener('click',function(){var determinedTheme=cssUIThemeGetOrSet(params.cssUITheme,true);var desiredTheme=determinedTheme==='light'?'dark':'light';var themeToggle=document.getElementById('cssUIDarkThemeCheck');// This is a tri-state switch, so we may need to click up to three times
  themeToggle.click();determinedTheme=cssUIThemeGetOrSet(params.cssUITheme,true);if(determinedTheme!==desiredTheme){themeToggle.click();}determinedTheme=cssUIThemeGetOrSet(params.cssUITheme,true);if(determinedTheme!==desiredTheme){themeToggle.click();}});document.getElementById('btnRescanDeviceStorage').addEventListener('click',function(){var returnDivs=document.getElementsByClassName('returntoArticle');for(var i=0;i<returnDivs.length;i++){returnDivs[i].innerHTML='';}params.rescan=true;// Deprecated: Reload any ZIM files in local storage (which the usar can't otherwise select with the filepicker)
  // loadPackagedArchive();
  if(storages.length){searchForArchivesInStorage();}else {displayFileSelect();}// Check if we are in an Android app, and if so, auto-select use of OPFS if there is no set value in settingsStore for useOPFS
  if((/Android/.test(params.appType)||/Firefox/.test(navigator.userAgent))&&!params.useOPFS&&!settingsStore$1.hasItem('useOPFS')){// This will only run first time app is run on Android
  setTimeout(function(){uiUtil.systemAlert('<p>We are switching to the Private File System (OPFS).</p>'+'<p><b><i>If asked, please accept a one-time Storage permission prompt.</i></b></p>'+'<i>More info</i>: the OPFS provides significant benefits such as: <b>faster file system access</b>; '+'<b>no permission prompts</b>; <b>automatic reload of archive on app start</b>.</p>','Switching to OPFS',true,'Use classic file picker').then(function(response){if(response){document.getElementById('useOPFSCheck').click();}else {settingsStore$1.setItem('useOPFS',false,Infinity);}});},2000);}else if(!settingsStore$1.hasItem('useOPFS')){// This ensures that there is an explicit setting for useOPFS, which in turn allows us to tell if the
  // app is running for the first time (so we don't keep prompting the user to use the OPFS)
  settingsStore$1.setItem('useOPFS',false,Infinity);}// Since we may have changed the storage type, we should recalculate the max search size
  uiUtil.dynamicallySetMaxSearchResults();});// Bottom bar :
  // @TODO Since bottom bar now hidden in Settings and About the returntoArticle code cannot be accessed;
  // consider adding it to top home button instead
  document.getElementById('btnBack').addEventListener('click',function(){if(document.getElementById('articleContent').style.display==='none'){document.getElementById('returntoArticle').click();return;}clearFindInArticle();history.back();});document.getElementById('btnForward').addEventListener('click',function(){clearFindInArticle();history.forward();});document.getElementById('btnZoomin').addEventListener('click',function(){params.relativeFontSize=Math.min(200,params.relativeFontSize+5);setArticleZoom(params.relativeFontSize,true);});document.getElementById('btnZoomout').addEventListener('click',function(){params.relativeFontSize=Math.max(50,params.relativeFontSize-5);setArticleZoom(params.relativeFontSize,true);});var zoomLabelTimeout;function setArticleZoom(zoomLevel,set){var root=articleDocument.documentElement||articleDocument;var percentageFontSize=zoomLevel+'%';// Set CSS fontSize and zoom if supported
  // Note that the zoom property is supported in Firefox since May 2024, but it doesn't
  // scale the font size at least in Wikipedia pages, so we need to set fontSize as well
  root.style.fontSize=percentageFontSize;if('zoom'in root.style){root.style.zoom=percentageFontSize;}// If we are setting a value from the UI, update the display and settings
  if(set){// Update zoom label
  var lblZoom=document.getElementById('lblZoom');lblZoom.innerHTML=percentageFontSize;lblZoom.style.cssText='position:absolute;right:'+window.innerWidth/4+'px;bottom:50px;z-index:50;';// Clear and set timeout to hide zoom label
  if(zoomLabelTimeout)clearTimeout(zoomLabelTimeout);zoomLabelTimeout=setTimeout(function(){lblZoom.innerHTML='';},2500);settingsStore$1.setItem('relativeFontSize',zoomLevel,Infinity);document.getElementById('articleContent').contentWindow.focus();}}setRelativeUIFontSize(params.relativeUIFontSize);document.getElementById('relativeUIFontSizeSlider').addEventListener('change',function(){setRelativeUIFontSize(this.value);});// Helper function to calculate navbar height
  function setNavbarHeight(height,relativeUIFontSize){var navbar=document.getElementById('navbar');navbar.style.height=height*(relativeUIFontSize/100)+'px';}function setRelativeUIFontSize(value){value=~~value;document.getElementById('spinnerVal').innerHTML=value+'%';document.getElementById('search-article').style.fontSize=value+'%';document.getElementById('relativeUIFontSizeSlider').value=value;setNavbarHeight(params.navbarHeight,value);var forms=document.querySelectorAll('.form-control');var i;for(i=0;i<forms.length;i++){forms[i].style.fontSize=~~(value*14/100)+'px';}var buttons=document.getElementsByClassName('btn');for(i=0;i<buttons.length;i++){// Some specific buttons need to be smaller
  buttons[i].style.fontSize=/Archive|RefreshApp|Reset2/.test(buttons[i].id)?~~(value*10/100)+'px':~~(value*14/100)+'px';}var heads=document.querySelectorAll('h1, h2, h3, h4');for(i=0;i<heads.length;i++){var multiplier=1;var head=heads[i].tagName;multiplier=head==='H4'?1.4:head==='H3'?1.9:head==='H2'?2.3:head==='H1'?2.8:multiplier;heads[i].style.fontSize=~~(value*0.14*multiplier)+'px';}document.getElementById('displaySettingsDiv').scrollIntoView();// prefix.style.height = ~~(value * 14 / 100) * 1.4285 + 14 + "px";
  if(value!==params.relativeUIFontSize){params.relativeUIFontSize=value;settingsStore$1.setItem('relativeUIFontSize',value,Infinity);}}document.getElementById('btnHomeBottom').addEventListener('click',function(){document.getElementById('btnHome').click();});// Deal with the Windows Mobile / Tablet back button
  if(typeof Windows!=='undefined'&&typeof Windows.UI!=='undefined'&&typeof Windows.ApplicationModel!=='undefined'){var onBackRequested=function onBackRequested(eventArgs){window.history.back();eventArgs.handled=true;};Windows.UI.Core.SystemNavigationManager.getForCurrentView().appViewBackButtonVisibility=Windows.UI.Core.AppViewBackButtonVisibility.visible;Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener('backrequested',onBackRequested);}document.getElementById('btnTop').addEventListener('click',function(){var header=document.getElementById('top');var iframe=document.getElementById('articleContent');// If the toolbar is hidden, show it instead of jumping to top
  if(!/\(0p?x?\)/.test(header.style.transform)){header.style.transform='translateY(0)';}else {if(!params.hideToolbars)iframe.style.transform='translateY(-1px)';iframe.contentWindow.scrollTo({top:'0',behavior:'smooth'});document.getElementById('search-article').scrollTop=0;}iframe.contentWindow.focus();});// Top menu :
  document.getElementById('btnHome').addEventListener('click',function(){// In Restricted mode, only load landing page in iframe (not tab or window)
  appstate.target='iframe';setTab('btnHome');document.getElementById('search-article').scrollTop=0;var articleContent=document.getElementById('articleContent');var articleContentDoc=articleContent?articleContent.contentDocument:null;while(articleContentDoc.firstChild)articleContentDoc.removeChild(articleContentDoc.firstChild);uiUtil.clearSpinner();document.getElementById('welcomeText').style.display='';if(appstate.selectedArchive!==null&&appstate.selectedArchive.isReady()){document.getElementById('welcomeText').style.display='none';goToMainArticle();}});var currentArchive=document.getElementById('currentArchive');var currentArchiveLink=document.getElementById('currentArchiveLink');var openCurrentArchive=document.getElementById('openCurrentArchive');var archiveFilesLegacy=document.getElementById('archiveFilesLegacy');var archiveDirLegacy=document.getElementById('archiveDirLegacy');if(!params.webkitdirectory){archiveDirLegacy.style.display='none';}function setTab(activeBtn){if(params.themeChanged){params.themeChanged=false;// If we are changing theme, we need to reload the last page
  if(params.lastPageVisit){goToArticle(params.lastPageVisit.replace(/@[^@].+$/,''));}else {goToMainArticle();}}// Highlight the selected section in the navbar
  setActiveBtn(activeBtn);clearFindInArticle();// Re-enable bottom toolbar display
  document.getElementById('footer').style.display='block';// Re-enable top-level scrolling
  document.getElementById('top').style.position='relative';// Use the "light" navbar if the content is "light" (otherwise it looks shite....)
  var determinedTheme=cssUIThemeGetOrSet(params.cssUITheme);var determinedWikiTheme=params.cssTheme==='auto'?determinedTheme:params.cssTheme==='inverted'?'dark':params.cssTheme;if(determinedWikiTheme!==determinedTheme){if(determinedWikiTheme==='light'&&(!activeBtn||activeBtn==='btnHome'||activeBtn==='findText')||determinedWikiTheme==='dark'&&activeBtn&&activeBtn!=='btnHome'&&activeBtn!=='findText'){cssUIThemeGetOrSet('light');}else {cssUIThemeGetOrSet('dark');}}else {cssUIThemeGetOrSet(determinedTheme);}if(typeof Windows==='undefined'&&typeof window.showDirectoryPicker!=='function'&&!window.dialog&&!params.webkitdirectory){// If not UWP, File System Access API, webkitdirectory API or Electron methods, hide the folder picker
  document.getElementById('archiveFiles').style.display='none';document.getElementById('archiveFilesLabel').style.display='none';}// Display OPFS checkbox if the browser supports the full API
  if(navigator&&navigator.storage&&'getDirectory'in navigator.storage&&'estimate'in navigator.storage){document.getElementById('displayOPFS').style.display='';}document.getElementById('archiveFilesLegacyDiv').style.display='none';document.getElementById('chooseArchiveFromLocalStorage').style.display='block';document.getElementById('libraryArea').style.borderColor='';document.getElementById('libraryArea').style.borderStyle='';if(params.packagedFile&&params.storedFile&&params.storedFile!==params.packagedFile){currentArchiveLink.innerHTML=params.storedFile.replace(/\.zim(\w\w)?$/i,'');currentArchiveLink.dataset.archive=params.storedFile;currentArchive.style.display='block';openCurrentArchive.style.display=params.pickedFile||params.pickedFolder?'none':'';document.getElementById('downloadLinksText').style.display='none';document.getElementById('usage').style.display='none';}if(params.storedFile&&params.storedFile===params.packagedFile){if(/wikipedia.en.(100|ray.charles)/i.test(params.packagedFile))document.getElementById('usage').style.display='inline';document.getElementById('downloadLinksText').style.display='block';currentArchive.style.display='none';}var update=document.getElementById('update');if(update)document.getElementById('logUpdate').innerHTML=update.innerHTML.match(/<ul[^>]*>[\s\S]+/i);var features=document.getElementById('features');if(features)document.getElementById('logFeatures').innerHTML=features.innerHTML;// Show the selected content in the page
  document.getElementById('about').style.display='none';document.getElementById('configuration').style.display='none';document.getElementById('formArticleSearch').style.display='';if(!activeBtn||activeBtn==='btnHome'){scrollbox.style.height=0;document.getElementById('search-article').style.overflowY='hidden';setTimeout(function(){if(appstate.target==='iframe'&&appstate.selectedArchive){// Note that it is too early to display the zimit iframe due to possible loading of darkReader and other css issues
  if(articleContainer$1&&articleContainer$1.style&&articleDocument){articleContainer$1.style.display='';}if(articleWindow)articleWindow.focus();}},400);}setDynamicIcons(activeBtn);var articleList=document.getElementById('articleList');var articleListHeaderMessage=document.getElementById('articleListHeaderMessage');while(articleList.firstChild)articleList.removeChild(articleList.firstChild);while(articleListHeaderMessage.firstChild)articleListHeaderMessage.removeChild(articleListHeaderMessage.firstChild);document.getElementById('articleListWithHeader').style.display='none';prefix.value='';document.getElementById('welcomeText').style.display='none';if(params.beforeinstallpromptFired){var divInstall1=document.getElementById('divInstall1');if(activeBtn!=='btnConfigure'&&!params.installLater&&(params.pagesLoaded===3||params.pagesLoaded===9)){divInstall1.style.display='block';setTimeout(function(){// If installLater is now true, then the user clicked the Later button and the timeout in init.js will hide the display
  if(!params.installLater){divInstall1.style.display='none';resizeIFrame();}},9000);}else {divInstall1.style.display='none';}}// Check for upgrade of PWA
  if(activeBtn==='btnConfigure')checkPWAUpdate(true);// Resize iframe
  setTimeout(resizeIFrame,100);}// Set the dynamic icons in the navbar
  function setDynamicIcons(btn){var btnAbout=document.getElementById('btnAbout');if(params.lockDisplayOrientation){if(uiUtil.appIsFullScreen()){btnAbout.innerHTML='<span class="glyphicon glyphicon-resize-small"></span>';btnAbout.title='Exit fullscreen';}else {btnAbout.innerHTML='<span class="glyphicon glyphicon-fullscreen"></span>';btnAbout.title='Return to fullscreen';}}else {// When the scrollbox height is 0, we are not in Configuration or About
  if(!btn&&scrollbox.offsetHeight===0||btn==='btnHome'||btn==='findText'){btnAbout.innerHTML='<span class="glyphicon glyphicon-print"></span>';btnAbout.title='Ctrl-P: Print';}else {btnAbout.innerHTML='<span class="glyphicon glyphicon-info-sign"></span>';btnAbout.title='About';}}}// Check if a PWA update is available
  function checkPWAUpdate(noreload){if(!params.upgradeNeeded&&/PWA/.test(params.appType)){caches.keys().then(function(keyList){var cachePrefix=cache.APPCACHE.replace(/^([^\d]+).+/,'$1');document.getElementById('alertBoxPersistent').innerHTML='';keyList.forEach(function(key){if(key===cache.APPCACHE||key===cache.CACHEAPI)return;// Ignore any keys that do not begin with the APPCACHE prefix (they could be from other apps using the same domain)
  if(key.indexOf(cachePrefix))return;// If we get here, then there is a kiwix cache key that does not match our version, i.e. a PWA-in-waiting
  var version=key.replace(cachePrefix,'');var loadOrInstall=params.PWAInstalled?'install':'load';// We should check if user has allowed immediate update of PWA
  loadOrInstall=params.autoUpdatePWA?'load':loadOrInstall;if(noreload)loadOrInstall='deploy';params.upgradeNeeded=true;uiUtil.showUpgradeReady(version,loadOrInstall);});});}else if(params.upgradeNeeded){var upgradeAlert=document.getElementById('upgradeAlert');if(upgradeAlert)upgradeAlert.style.display='block';}}// Electron callback listener if an update is found by main.js
  if(window.electronAPI){electronAPI.on('update-available',function(data){console.log('Upgrade is available or in progress:'+data);params.upgradeNeeded=true;if(data.percent){var percent=data.percent.toFixed(1);uiUtil.showUpgradeReady(percent,'progress');}else {uiUtil.showUpgradeReady(data.version,'install');}});electronAPI.on('get-store-value',function(key,value){if(key==='expressPort'){params.expressPort=value;uiUtil.setExpressServerUI(value);}});electronAPI.on('dl-received',function(received,total){kiwixServe.reportDownloadProgress(received,total);});electronAPI.on('get-launch-file-path',function(fullPath){if(fullPath){fullPath=fullPath.replace(/\\/g,'/');var pathParts=fullPath.match(/^(.+[/\\])([^/\\]+)$/i);if(pathParts){params.rescan=false;console.debug('[ElectronAPI] App was launched with the following file path: '+fullPath);var archiveFolder=pathParts[1],archiveFile=pathParts[2];params.storedFile=archiveFile;// This is needed to prevent the app from trying to load the previous storedFilePath when the File System Access API is available
  params.storedFilePath=null;scanNodeFolderforArchives(archiveFolder,function(archivesInFolder){// console.debug('archivesInFolder: ' + JSON.stringify(archivesInFolder));
  setLocalArchiveFromArchiveList(archiveFile);});return;}}console.debug('[ElectronAPI] No file was launched with the app');});}// Check for GitHub and Electron updates
  var updateCheck=document.getElementById('updateCheck');params.isUWPStoreApp=/UWP/.test(params.appType)&&Windows.ApplicationModel&&Windows.ApplicationModel.Package&&!/Association.Kiwix/.test(Windows.ApplicationModel.Package.current.id.publisher)||window.electronAPI&&window.electronAPI.isMicrosoftStoreApp;// If Internet access is allowed, or it's a UWP Store app, or it's HTML5 (i.e., not Electron/NWJS or UWP) ...
  if(params.allowInternetAccess||params.isUWPStoreApp||/HTML5/.test(params.appType)){updateCheck.style.display='none';// ... hide the update check link
  if(params.isUWPStoreApp)console.debug('Hiding update check link because this is a UWP Store app.');}params.isAppxOrMSIX=window.electronAPI&&window.electronAPI.isAppxOrMSIX;// Function to check for updates from GitHub
  function checkUpdateServer(){if(!params.allowInternetAccess||params.upgradeNeeded){console.warn('The GitHub update check was blocked because '+(params.upgradeNeeded?'a PWA upgrade is needed.':'the user has not allowed Internet access.'));return;}// If it's plain HTML5 (not Electron/NWJS or UWP), don't check for updates
  if(/HTML5/.test(params.appType))return;if(params.isUWPStoreApp)return;// It's a UWP app installed from the Store, so it will self update
  // Electron updates
  if(window.electronAPI){var electronVersion=navigator.userAgent.replace(/^.*Electron.([\d.]+).*/i,'$1');var isUpdateableElectronVersion=!electronVersion.startsWith(params.win7ElectronVersion);var baseApp=params.packagedFile&&/wikivoyage/.test(params.packagedFile)?'wikivoyage':params.packagedFile&&/wikmed|mdwiki/.test(params.packagedFile)?'wikimed':'electron';if(baseApp==='electron'&&isUpdateableElectronVersion&&!params.isAppxOrMSIX){console.log('Launching Electron auto-updater...');electronAPI.checkForUpdates();}else {console.log('Auto-update: '+(params.isAppxOrMSIX?'APPX/MSIX packages cannot be':isUpdateableElectronVersion?'Packaged apps with large ZIM archives are not currently':'Versions for Windows 7+ 32bit cannot be')+' auto-updated.');}}// GitHub updates
  console.log('Checking for updates from Releases...');updater.getLatestUpdates(function(tag,url,releases){var updateSpan=document.getElementById('updateStatus');if(!tag){var upToDate='[&nbsp;<b><i>Latest&nbsp;version</i></b>&nbsp;]';updateCheck.style.display='inline';updateCheck.innerHTML=upToDate;updateSpan.innerHTML=upToDate;console.log('No new update was found.');return;}console.log('We found this update: ['+tag+'] '+url,releases);updateSpan.innerHTML='[ <b><i><a href="#alertBoxPersistent">New update!</a></i></b> ]';params.upgradeNeeded=true;uiUtil.showUpgradeReady(tag.replace(/^v/,''),'download',url);});}// Do update checks 10s after startup
  setTimeout(function(){if(/PWA/.test(params.appType)){console.log('Internally checking for updates to the PWA...');checkPWAUpdate();}// Delay GitHub checks so that any needed PWA update can be notified first
  setTimeout(checkUpdateServer,2000);},8000);function setActiveBtn(activeBtn){document.getElementById('btnHome').classList.remove('active');document.getElementById('btnRandomArticle').classList.remove('active');document.getElementById('btnConfigure').classList.remove('active');document.getElementById('btnAbout').classList.remove('active');if(activeBtn){var activeID=document.getElementById(activeBtn);if(activeID)activeID.classList.add('active');}}document.getElementById('btnConfigure').addEventListener('click',function(){var config=document.getElementById('configuration');// If Configuration is already displayed, we are "unclicking" the button...
  if(config.style.display!=='none'){setTab();}else {document.querySelectorAll('.alert').forEach(function(el){el.style.display='none';});// Highlight the selected section in the navbar
  setTab('btnConfigure');// Hide footer toolbar
  document.getElementById('footer').style.display='none';// Show the selected content in the page
  document.getElementById('configuration').style.display='';document.getElementById('articleContent').style.display='none';document.getElementById('downloadLinks').style.display='none';document.getElementById('serverResponse').style.display='none';document.getElementById('myModal').style.display='none';refreshAPIStatus();// Re-enable top-level scrolling
  scrollbox.style.height=window.innerHeight-document.getElementById('top').getBoundingClientRect().height+'px';document.getElementById('search-article').style.overflowY='auto';// If user hadn't previously picked a folder or a file, resort to the local storage folder (UWP functionality)
  if(params.localStorage&&!params.pickedFolder&&!params.pickedFile){params.pickedFolder=params.localStorage;}// If user had previously picked a file using Native FS, offer to re-open
  if((typeof window.showOpenFilePicker==='function'||params.useOPFS)&&!(params.pickedFile||params.pickedFolder)){getNativeFSHandle();}}});function getNativeFSHandle(callback){if(params.useOPFS&&navigator&&navigator.storage&&'getDirectory'in navigator.storage){// We should be able to get the folder from the OPFS entry
  console.debug('Getting the OPFS directory entry');return navigator.storage.getDirectory().then(function(handle){if(callback)callback(handle);else return processNativeDirHandle(handle);}).catch(function(err){console.warn('Unable to get the OPFS directory entry: '+err);if(callback)callback(null);});}console.debug('Getting the last serialized file or folder entry');cache.idxDB('pickedFSHandle',function(val){if(val){var handle=val;return cache.verifyPermission(handle,false).then(function(accessible){if(accessible){openCurrentArchive.style.display='none';if(callback){callback(handle);return;}if(handle.kind==='file'){return processNativeFileHandle(handle);}else if(handle.kind==='directory'){return processNativeDirHandle(handle);}}else {openCurrentArchive.style.display='inline';if(callback){callback(handle);}else {searchForArchivesInPreferencesOrStorage();}}}).catch(function(err){uiUtil.systemAlert('We could not verify permission for the requested file handle. Please try picking your archive again.','Verification failure!');console.error(err);});}else {console.warn('No file or folder handle was previously stored in indexedDB');if(callback){callback(val);}else if(window.fs){// We have failed to load a picked archive via the File System API, but if params.storedFilePath exists, then the archive
  // was launched with Electron APIs, so we can get the folder that way
  if(params.storedFile&&params.storedFilePath)params.pickedFolder=params.pickedFolder=params.storedFilePath.replace(/[^\\/]+$/,'');scanNodeFolderforArchives(params.pickedFolder,function(){// We now have the list of archives in the dropdown, so we try to select the storedFile
  setLocalArchiveFromArchiveList(params.storedFile);});}else {console.warn('Unable to get a file or folder handle from indexedDB');// Go to Configuration if it is not already open
  setTimeout(function(){if(document.getElementById('configuration').style.display==='none')document.getElementById('btnConfigure').click();},250);}}});}document.getElementById('btnAbout').addEventListener('click',function(){var btnAboutElement=document.getElementById('btnAbout');// Don't allow this button to be clicked if button is being used as exit fullscreen button
  if(/glyphicon-(fullscreen|resize-small)/.test(btnAboutElement.innerHTML))return;// Deal with use of button for printing
  if(/glyphicon-print/.test(btnAboutElement.innerHTML)){printIntercept();return;}// Check if we're 'unclicking' the button
  var searchDiv=document.getElementById('about');if(searchDiv.style.display!=='none'){setTab();return;}// Highlight the selected section in the navbar
  setTab('btnAbout');// Hide footer toolbar
  document.getElementById('footer').style.display='none';// Show the selected content in the page
  document.getElementById('about').style.display='';document.getElementById('articleContent').style.display='none';document.querySelectorAll('.alert').forEach(function(el){el.style.display='none';});// Re-enable top-level scrolling
  scrollbox.style.height=window.innerHeight-document.getElementById('top').getBoundingClientRect().height+'px';document.getElementById('search-article').style.overflowY='auto';});var selectFired=false;var archiveList=document.getElementById('archiveList');archiveList.addEventListener('keydown',function(e){e.preventDefault();if(/^Enter$/.test(e.key)){selectArchive(e);}else if(/^ArrowDown$/.test(e.key)){if(archiveList.selectedIndex===archiveList.length-1)archiveList.selectedIndex=0;else archiveList.selectedIndex++;}else if(/^ArrowUp$/.test(e.key)){if(archiveList.selectedIndex===0)archiveList.selectedIndex=archiveList.length-1;else archiveList.selectedIndex--;}});archiveList.addEventListener('change',selectArchive);archiveList.addEventListener('click',function(e){// Esnsure the clicked item is selected in the dropdown
  if(e.target.value)archiveList.value=e.target.value;// Only accept the click if there is one archive in the list
  if(archiveList.length===1)selectArchive(e);});archiveList.addEventListener('mousedown',function(){// Unselect any selected option so that the user can select the same option again
  if(archiveList.length>1&&~archiveList.selectedIndex)archiveList.selectedIndex=-1;});currentArchiveLink.addEventListener('click',function(e){e.target.value=archiveList.value=currentArchiveLink.dataset.archive;selectArchive(e);});openCurrentArchive.addEventListener('click',function(e){e.target.value=archiveList.value=currentArchiveLink.dataset.archive;selectArchive(e);});function selectArchive(list){if(selectFired)return;// If nothing was selected, user will have to click again
  if(!list.target.value)return;selectFired=true;var selected=list.target.value;// Void any previous picked file to prevent it launching
  params.storedFile=selected;if(params.pickedFile&&params.pickedFile.name!==selected){params.pickedFile='';}if(params.useOPFS&&params.deleteOPFSEntry){// User requested deletion of an OPFS entry, seek confirmation first
  var message='Are you sure you want to delete the OPFS entry for '+selected;if(/\.zimaa$/i.test(selected))message+=' <b>and all its parts</b>';message+='?';return uiUtil.systemAlert(message,'Delete OPFS entries',true,null,'Delete ZIM').then(function(confirmed){if(confirmed){cache.deleteOPFSEntry(selected).then(function(){settingsStore$1.removeItem('lastSelectedArchive');params.rescan=true;processNativeDirHandle(params.pickedFolder);});}document.getElementById('btnDeleteOPFSEntry').click();selectFired=false;});}if(params.useOPFS&&params.exportOPFSEntry){// User requested export of an OPFS entry
  // First check that user is not trying to export a split ZIM archive (which is impossible)
  if(/\.zimaa$/i.test(selected)){selectFired=false;return uiUtil.systemAlert('It is unfortunately not possible to export all the parts of a split ZIM archive using this app. '+'For split ZIMs, you are limited to opening or deleting the archive (and its parts).');}// Show the spinner while the OPFS entry is exported
  uiUtil.pollSpinner('Exporting OPFS entry...',true);document.getElementById('btnExportOPFSEntry').click();return cache.exportOPFSEntry(selected).then(function(exported){uiUtil.clearSpinner();selectFired=false;if(exported){uiUtil.systemAlert('The OPFS entry for '+selected+' was successfully exported to the selected folder.');}else {uiUtil.systemAlert('The OPFS entry for '+selected+' could not be exported.');}});}// Show the spinner because on some sytems loading the archive is slow
  uiUtil.pollSpinner('Loading archive...',9000);var resetUI=function resetUI(){document.getElementById('openLocalFiles').style.display='none';document.getElementById('rescanStorage').style.display='block';document.getElementById('usage').style.display='none';selectFired=false;};// We need to handle the case where the user dragged and dropped multiple files into the app
  if(archiveFilesLegacy.files.length>0){// Let's see if the selected file is available in the legacy archive file list
  var fileFound=false;for(var i=0;i<archiveFilesLegacy.files.length;i++){if(archiveFilesLegacy.files[i].name===selected){fileFound=true;break;}}if(fileFound){params.pickedFile=archiveFilesLegacy.files[i];setTimeout(resetUI,100);return setLocalArchiveFromFileList([params.pickedFile],true);}}if(window.showOpenFilePicker||params.useOPFS){return getNativeFSHandle(function(handle){resetUI();if(!handle){if(window.fs&&params.storedFilePath){// Fall back to using the Electron APIs
  params.pickedFolder=params.storedFilePath.replace(/[^\\/]+$/,'');return setLocalArchiveFromArchiveList(selected);}console.error('No handle was retrieved');document.getElementById('openLocalFiles').style.display='block';document.getElementById('rescanStorage').style.display='none';return uiUtil.systemAlert('We could not get a handle to the previously picked file or folder!<br>'+'This is probably because the contents of the folder have changed. Please try picking it again.');}if(handle.kind==='directory'){params.pickedFolder=handle;return setLocalArchiveFromArchiveList(params.storedFile);}else if(handle.kind==='file'){return handle.getFile().then(function(file){params.pickedFile=file;params.pickedFile.handle=handle;return setLocalArchiveFromArchiveList(selected);}).catch(function(err){console.error('Unable to read previously picked file!',err);uiUtil.systemAlert('We could not retrieve the previously picked file or folder!<br>Please try picking it again.');document.getElementById('openLocalFiles').style.display='block';document.getElementById('rescanStorage').style.display='none';});}});}else if(typeof MSApp==='undefined'&&!window.fs&&params.webkitdirectory){// If we don't have any picked files or directories...
  if(!archiveDirLegacy.files.length&&!archiveFilesLegacy.files.length){appstate.waitForFileSelect=selected;// No files are set, so we need to ask user to select the file or directory again
  if(params.pickedFolder||document.getElementById('archiveList').options.length>1){archiveDirLegacy.click();}else {archiveFilesLegacy.click();}}else {console.debug('Files are set, attempting to select '+selected);params.pickedFile=selected;if(archiveDirLegacy.files.length){params.pickedFolder=archiveDirLegacy.files[0].webkitRelativePath.replace(/\/[^/]*$/,'');params.pickedFile='';}setLocalArchiveFromArchiveList(selected);}}else {setLocalArchiveFromArchiveList(selected);}setTimeout(resetUI,0);}// Legacy file picker is used as a fallback when all other pickers are unavailable
  archiveFilesLegacy.addEventListener('change',function(files){var filesArray=Array.from(files.target.files);// Construct a list of filenames joined with <li> tags
  var filenamesList='';var filesSize=0;filesArray.forEach(function(file){filesSize+=file.size;filenamesList+='<li>'+file.name+'</li>';});if(params.useOPFS){// Abort if user didn't select any files
  if(filesArray.length===0)return;// Check the size of the files does not exceed the quota
  if(filesSize>appstate.OPFSQuota){return uiUtil.systemAlert('<p>The total size of the selected files is <b>'+(filesSize/1024/1024/1024).toFixed(2)+' GB</b>, which<br />exceeds the estimated OPFS quota of <b>'+(appstate.OPFSQuota/1024/1024/1024).toFixed(2)+' GB</b>!','OPFS Quota Exceeded',null,null,null,'Cancel');}return uiUtil.systemAlert('<p>Do you want to add these files to the Private File System?<p><ul>'+filenamesList+'</ul>','Add to OPFS',true,null,'Add to OPFS').then(function(confirmed){if(!confirmed)return;// User has chosen a file or files to store in the Origin Private File System
  // This operation can take a long time, so show opsPanel
  uiUtil.pollOpsPanel('<span class="glyphicon glyphicon-refresh spinning"></span>&emsp;<b>Please wait:</b> Importing files to OPFS...',true);return cache.importOPFSEntries(filesArray).then(function(){uiUtil.systemAlert('<p>The selected files were successfully added to the OPFS!</p><p><b>We will now reload the app, so that the file(s) can be accessed at full speed.</b></p>').then(function(){// Set the app to load this file on startup
  settingsStore$1.setItem('lastSelectedArchive',filesArray[0].name,Infinity);window.location.reload();});uiUtil.pollOpsPanel();processNativeDirHandle(params.pickedFolder);cache.populateOPFSStorageQuota();}).catch(function(err){console.error('Unable to import files to OPFS!',err);var message='<p>We could not import the selected files to the OPFS!</p><p>Reason: '+err.message+'</p>';if(/iOS/.test(params.appType)||/^((?!chrome|android).)*safari/i.test(navigator.userAgent))message='<p>Unfortunately, Safari and iOS browsers do not currently support importing files into the OPFS. Please disable the OPFS and use other file selection options.</p><p>Error message: '+err.message+'</p>';uiUtil.pollOpsPanel();uiUtil.systemAlert(message,'OPFS import error').then(function(){// Delete each of the files that failed to import
  filesArray.forEach(function(file){cache.deleteOPFSEntry(file.name);});});});});}uiUtil.pollSpinner('Loading archive...',9000);params.pickedFolder=null;params.pickedFile=null;if(params.storedFile===params.packagedFile){params.storedFile=null;params.storedFilePath=null;}if(filesArray.length===1){params.pickedFile=filesArray[0];params.storedFile=params.pickedFile.name.replace(/\.zim\w\w$/i,'.zimaa');}if(params.webkitdirectory){settingsStore$1.setItem('pickedFolder','',Infinity);processFilesArray(filesArray);}var selected=params.storedFile;if(appstate.waitForFileSelect){selected=appstate.waitForFileSelect;appstate.waitForFileSelect=null;// Select the selected file in the dropdown list of archives
  document.getElementById('archiveList').value=selected;console.debug('Files are set, attempting to select '+selected);}if(!window.fs&&(params.webkitdirectory||params.useOPFS)){// populateDropDownListOfArchives([params.pickedFile], true);
  setLocalArchiveFromArchiveList(selected);}else {setLocalArchiveFromFileList(files.target.files);}});// But in preference, use UWP, File System Access API
  document.getElementById('archiveFile').addEventListener('click',function(){if(typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'){// UWP FilePicker
  pickFileUWP();}else if(typeof window.showOpenFilePicker==='function'||params.useOPFS){if(params.useOPFS){// We need to pick a file and store it in the OPFS, so we use the legacy picker
  archiveFilesLegacy.click();}else {// File System Access API file picker
  pickFileNativeFS();}}else if(window.fs&&window.dialog){// Electron file picker if showOpenFilePicker is not available
  dialog.openFile();}else {// Legacy file picker
  archiveFilesLegacy.click();}});// Legacy webkitdirectory file picker is used as a fallback when File System Access API is unavailable
  archiveDirLegacy.addEventListener('change',function(files){if(files.target.files.length){var filesArray=Array.from(files.target.files);// Supports reading in NWJS/Electron frameworks that have a path property on the File object
  var path=filesArray[0]?filesArray[0].path?filesArray[0].path:filesArray[0].webkitRelativePath:'';params.pickedFile=null;var oldDir=params.pickedFolder;params.pickedFolder=path.replace(/[^\\/]*$/,'');// If we're picking a different directroy, don't look for the previously picked file in it
  if(params.pickedFolder!==oldDir){params.storedFile=null;params.storedFilePath=null;}settingsStore$1.setItem('pickedFolder',params.pickedFolder,Infinity);if(document.getElementById('archiveList').options.length===0){params.storedFile=null;}processFilesArray(filesArray);var selected='';if(appstate.waitForFileSelect){selected=appstate.waitForFileSelect;appstate.waitForFileSelect=null;// Select the selected file in the dropdown list of archives
  document.getElementById('archiveList').value=selected;console.debug('Files are set, attempting to select '+selected);}if(selected)setLocalArchiveFromArchiveList(selected);}else {appstate.waitForFileSelect=null;console.log('User cancelled directory picker, or chose a directory with no files');}});document.getElementById('archiveFiles').addEventListener('click',function(e){if(typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'){// UWP FolderPicker
  pickFolderUWP();}else if(typeof window.showOpenFilePicker==='function'){// Native File System API folder picker
  pickFolderNativeFS();}else if(window.fs&&window.dialog){// Electron fallback
  dialog.openDirectory();}else if(params.webkitdirectory){// Legacy webkitdirectory file picker
  archiveDirLegacy.click();}});document.getElementById('useOPFSCheck').addEventListener('change',function(e){var checkStorageType=function checkStorageType(){// Requesting persistent storage (but we'll proceed anyway if the OPFS is available, even if persistence is not granted)
  if(e.target.checked){return cache.requestPersistentStorage();}else {return Promise.resolve(false);}};if(e.target.checked&&/Electron/i.test(params.appType)){checkStorageType=function checkStorageType(){return uiUtil.systemAlert('<p>There is no advantage to using the Origin Private File System for Electron or NWJS apps.</p><p>Do you still want to use it?</p>','Use OPFS?',true,null,'Use OPFS');};}return checkStorageType().then(function(confirmed){if(confirmed){params.useOPFS=e.target.checked;setOPFSUI();if(params.useOPFS){params.storedFile=null;params.storedFilePath=null;params.pickedFile=null;params.pickedFolder=null;settingsStore$1.removeItem('lastSelectedArchive');params.rescan=true;loadOPFSDirectory();}else {populateDropDownListOfArchives([],true);}}else {e.target.checked=false;params.useOPFS=false;settingsStore$1.setItem('useOPFS',false,Infinity);setOPFSUI();}});});function loadOPFSDirectory(){if(navigator&&navigator.storage&&'getDirectory'in navigator.storage){console.debug('Loading the OPFS directory');return navigator.storage.getDirectory().then(function(dir){params.pickedFolder=dir;processNativeDirHandle(dir);setOPFSUI();}).catch(function(err){console.error('Unable to get Origin Private File System!',err);uiUtil.systemAlert('<p>We could not access the Origin Private File System!</p><p>Please try picking a folder instead.</p><p>Reported error: '+err+'</p>');params.useOPFS=false;setOPFSUI();});}else {params.useOPFS=false;settingsStore$1.setItem('useOPFS',false,Infinity);setOPFSUI();return uiUtil.systemAlert('<p>Your browser does not support the Origin Private File System!</p><p>Please try picking a folder instead.</p>');}}function setOPFSUI(){var useOPFS=document.getElementById('useOPFSCheck');var archiveFile=document.getElementById('archiveFile');var archiveFileCol=document.getElementById('archiveFileCol');var archiveFileLabel=document.getElementById('archiveFileLabel');var archiveFiles=document.getElementById('archiveFiles');var archiveFilesCol=document.getElementById('archiveFilesCol');var archiveFilesLabel=document.getElementById('archiveFilesLabel');var btnDeleteOPFSEntry=document.getElementById('btnDeleteOPFSEntry');var btnExportOPFSEntry=document.getElementById('btnExportOPFSEntry');var OPFSQuota=document.getElementById('OPFSQuota');var determinedTheme=params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme;if(params.useOPFS){settingsStore$1.setItem('useOPFS',true,Infinity);useOPFS.checked=true;archiveFiles.style.display='none';archiveFilesLabel.style.display='none';archiveFileLabel.classList.remove('col-xs-6');archiveFileLabel.classList.add('col-xs-12');archiveFileLabel.innerHTML='<p><b>Select file(s) to add to OPFS</b>:</p>';archiveFile.value='Add file(s)';archiveFile.title='Select a single file or multiple files to add to the Origin Private File System. In total, they must not exceed the estimated quota displayed in the OPFS quota panel.';archiveFileCol.classList.remove('col-xs-6');archiveFileCol.classList.add('col-xs-5');archiveFilesCol.classList.remove('col-xs-6');archiveFilesCol.classList.add('col-xs-7');archiveList.style.background=determinedTheme==='dark'?'darkslategray':'lightcyan';OPFSQuota.style.display='';btnDeleteOPFSEntry.style.display='';if('showOpenFilePicker'in window)btnExportOPFSEntry.style.display='';cache.populateOPFSStorageQuota();}else {useOPFS.checked=false;archiveFileCol.classList.remove('col-xs-5');archiveFileCol.classList.add('col-xs-6');archiveFilesCol.classList.remove('col-xs-7');archiveFilesCol.classList.add('col-xs-6');archiveList.style.background='';if(typeof Windows==='undefined'&&typeof window.showOpenFilePicker!=='function'&&!window.dialog&&!params.webkitdirectory){archiveFileLabel.innerHTML='<p><b>Pick ZIM archive(s)</b>:</p>';archiveFileLabel.classList.remove('col-xs-6');archiveFileLabel.classList.add('col-xs-12');archiveFile.title='Select one or more files you wish to access during this session from your device\'s storage. You may load as many files as you wish, and they will be added to the selection list above.';archiveFile.value='Select file(s)';}else {archiveFiles.style.display='';archiveFilesLabel.style.display='';archiveFileLabel.innerHTML='<p><b>Pick a single unsplit archive</b>:</p>';archiveFileLabel.classList.remove('col-xs-12');archiveFileLabel.classList.add('col-xs-6');archiveFile.title='Select a single file from your device\'s storage. For split or multiple files, place the files in a directory and use the "Select folder" button instead.';archiveFile.value='Select file';}OPFSQuota.style.display='none';btnDeleteOPFSEntry.style.display='none';btnExportOPFSEntry.style.display='none';}// Enabling or disabling the OPFS affects the maximum number of search results we should return
  uiUtil.dynamicallySetMaxSearchResults();}// Set the OPFS UI on app launch
  setOPFSUI();document.getElementById('btnExportOPFSEntry').addEventListener('click',function(){params.exportOPFSEntry=!params.exportOPFSEntry;var determinedTheme=params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme;if(params.exportOPFSEntry){params.deleteOPFSEntry=false;archiveList.style.background=determinedTheme==='dark'?'darkgoldenrod':'yellow';}else {setOPFSUI();}// Synchronize the OPFS file list
  if(params.pickedFolder&&params.pickedFolder.kind==='directory'){params.rescan=true;processNativeDirHandle(params.pickedFolder);}});document.getElementById('btnDeleteOPFSEntry').addEventListener('click',function(){params.deleteOPFSEntry=!params.deleteOPFSEntry;var determinedTheme=params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme;if(params.deleteOPFSEntry){params.exportOPFSEntry=false;archiveList.style.background=determinedTheme==='dark'?'firebrick':'pink';}else {setOPFSUI();}// Synchronize the OPFS file list
  if(params.pickedFolder&&params.pickedFolder.kind==='directory'){params.rescan=true;processNativeDirHandle(params.pickedFolder);}});document.getElementById('btnRefresh').addEventListener('click',function(){// Refresh list of archives
  params.rescan=true;var btnArchiveFiles=document.getElementById('archiveFiles');var btnArchiveFile=document.getElementById('archiveFile');// Deselect any selected archive in the archiveList
  archiveList.selectedIndex=-1;if(!params.storedFile&&!params.pickedFolder){if(params.useOPFS||window.showOpenFilePicker){getNativeFSHandle(function(fsHandle){if(fsHandle&&fsHandle.kind==='directory'){if(params.useOPFS)params.rescan=false;processNativeDirHandle(fsHandle);if(params.useOPFS)cache.populateOPFSStorageQuota();}else {btnArchiveFiles.click();}});}else {uiUtil.systemAlert('You need to pick a file or folder before you can rescan it!');}}else if(params.storedFile&&!params.pickedFolder){console.debug('Could not automatically reload '+params.pickedFile);if(!~params.storedFile.indexOf(params.packagedFile)){if(archiveList.length>1&&(params.webkitdirectory||'showDirectoryPicker'in window)){btnArchiveFiles.click();}else {btnArchiveFile.click();}}else uiUtil.systemAlert('You need to pick a file or folder before you can rescan it!');}else if(window.showOpenFilePicker||params.useOPFS){processNativeDirHandle(params.pickedFolder);if(params.useOPFS)cache.populateOPFSStorageQuota();}else if(typeof Windows!=='undefined'){scanUWPFolderforArchives(params.pickedFolder);}else if(window.fs){scanNodeFolderforArchives(params.pickedFolder);}else if(params.webkitdirectory){document.getElementById('archiveFiles').click();}});document.getElementById('downloadTrigger').addEventListener('click',function(){kiwixServe.requestXhttpData(params.kiwixDownloadServer);});document.querySelectorAll('input[name="contentInjectionMode"][type="radio"]').forEach(function(element){element.addEventListener('change',function(){if(this.value==='jquery'&&!params.appCache){uiUtil.systemAlert('You must deselect the "Bypass AppCache" option before switching to Restricted mode!');this.checked=false;document.getElementById('serviceworkerModeRadio').checked=true;return;}var returnDivs=document.getElementsByClassName('returntoArticle');for(var i=0;i<returnDivs.length;i++){returnDivs[i].innerHTML='';}// Do the necessary to enable or disable the Service Worker
  setContentInjectionMode(this.value);/** DEV: PLEASE NOTE THAT "jQuery mode" HAS NOW CHANGED to "Restricted mode", but we still use "jquery" in code */// Actions that must be completed after switch to Restricted mode
  if(this.value==='jquery'){// Hide the source verification option
  document.getElementById('enableSourceVerificationCheck').style.display='none';// If we're in a PWA UWP app, warn the user that this does not disable the PWA
  if(/^http/i.test(window.location.protocol)&&/UWP\|PWA/.test(params.appType)&&params.allowInternetAccess==='true'){uiUtil.systemAlert('<p>Please note that switching content injection mode does not revert to local code.</p>'+'<p>If you wish to exit the PWA, you will need to turn off "Allow Internet access?" above.</p>');}}if(this.value==='serviceworker'&&window.location.protocol!=='ms-appx-web:'){document.getElementById('enableSourceVerificationCheck').style.display='';if(params.sourceVerification&&appstate.selectedArchive.isReady()&&appstate.selectedArchive.file._files[0].name!==params.packagedFile&&!settingsStore$1.getItem('trustedZimFiles').includes(appstate.selectedArchive.file.name)){verifyLoadedArchive(appstate.selectedArchive);}if(params.manipulateImages||params.allowHTMLExtraction){if(!appstate.wikimediaZimLoaded){var message='Please note that we are disabling "Image manipulation" and/or "Download or open current article" features, as these options '+'can interfere with ZIMs that have active content. You may turn them back on, but be aware that they are only '+'recommended for use with Wikimedia ZIMs.';uiUtil.systemAlert(message);if(params.manipulateImages)document.getElementById('manipulateImagesCheck').click();if(params.allowHTMLExtraction)document.getElementById('allowHTMLExtractionCheck').click();}}}params.themeChanged=true;// This will reload the page
  });});document.getElementById('allowInternetAccessCheck').addEventListener('change',function(){document.getElementById('serverResponse').style.display='none';params.allowInternetAccess=this.checked;if(!this.checked){document.getElementById('downloadLinks').style.display='none';if(/^http/i.test(window.location.protocol)){var message;if(!/PWA/.test(params.appType)){message='<p>You are accessing Kiwix JS from a remote server, and it is not possible to disable Internet access fully without exiting the app.</p>'+'<p>Please visit <a href="https://kiwix.github.io/kiwix-js-pwa/app" target="_blank">Kiwix JS UWP/Electron/NWJS</a> to find an app version that will run fully offline.</p>';uiUtil.systemAlert(message);this.checked=true;params.allowInternetAccess=true;return;}else if(!/UWP|Electron/.test(params.appType)){uiUtil.systemAlert("This PWA can run offline, but to be absolutely sure that it won't contact the server to update itself, you should shut "+'off the Internet connection on your computer. By design, the PWA spec allows an offline app to check whether the Service Worker '+'code has changed, and this app cannot override that completely.');}else if(/UWP/.test(params.appType)){message='<p>This will switch to using locally packaged code only. Configuration settings may be lost.</p>'+'<p><b>WARNING:</b> App will re-load in Restricted mode!</p>';var that=this;var launchLocal=function launchLocal(){settingsStore$1.setItem('allowInternetAccess',false,Infinity);var uriParams='?allowInternetAccess=false&contentInjectionMode=jquery';// Commented line below causes crash when there are too many archives
  // uriParams += '&listOfArchives=' + encodeURIComponent(settingsStore.getItem('listOfArchives'));
  uriParams+='&lastSelectedArchive='+encodeURIComponent(params.storedFile);uriParams+='&lastPageVisit='+encodeURIComponent(params.lastPageVisit);// Void the PWA_launch signal so that user will be asked again next time
  params.localUWPSettings.PWA_launch='';window.location.href='ms-appx-web:///www/index.html'+uriParams;console.warn('Beam me down, Scotty!');};uiUtil.systemAlert(message,'Information',true,'Cancel','Reload app').then(function(response){if(response){launchLocal();}else {that.checked=true;params.allowInternetAccess=true;document.getElementById('btnConfigure').click();}});}}}else {// We can check for updates if the user has allowed Internet access
  checkUpdateServer();}settingsStore$1.setItem('allowInternetAccess',params.allowInternetAccess,Infinity);library.style.borderColor='';library.style.borderStyle='';});document.getElementById('cssCacheModeCheck').addEventListener('change',function(){params.cssCache=this.checked;settingsStore$1.setItem('cssCache',params.cssCache,Infinity);params.themeChanged=true;// If we've disabled CSS caching, we need to set cssSource to use the default ZIM style
  if(!params.cssCache&&params.cssSource!=='auto'){uiUtil.systemAlert('Use of ZIM-provided Wikimedia stylesheets will reset the ZIM style (mobile, desktop) to the default.','Warning!',true).then(function(rtn){if(rtn){document.getElementById('cssModeAutoRadio').click();}else {params.cssCache=true;document.getElementById('cssCacheModeCheck').checked=params.cssCache;settingsStore$1.setItem('cssCache',params.cssCache,Infinity);params.themeChanged=false;}});}});document.getElementById('navButtonsPosCheck').addEventListener('change',function(e){params.navButtonsPos=e.target.checked?'top':'bottom';settingsStore$1.setItem('navButtonsPos',params.navButtonsPos,Infinity);uiUtil.systemAlert('This setting will be applied on next app launch');});document.getElementById('imageDisplayModeCheck').addEventListener('change',function(e){if(!this.checked){uiUtil.systemAlert('Please note that some images may still display if the ZIM type requires it (e.g. Zimit ZIMs, PhET, Gutenberg).');}params.imageDisplay=this.checked;params.imageDisplayMode=this.checked?'progressive':'manual';params.themeChanged=params.imageDisplay;// Only reload page if user asked for all images to be displayed
  settingsStore$1.setItem('imageDisplay',params.imageDisplay,Infinity);});document.getElementById('manipulateImagesCheck').addEventListener('click',function(){params.manipulateImages=this.checked;settingsStore$1.setItem('manipulateImages',params.manipulateImages,Infinity);if(this.checked&&!params.displayHiddenBlockElements&&!params.noWarning){if(/UWP/.test(params.appType)){uiUtil.systemAlert('<p><b>WORKAROUND FOR UWP APP:</b> To save an image to disk, please select the '+'"Download or open current article" option below, load the article you require, and export it to a browser window by clicking the breakout icon.</p>'+'<p>You will then be able to right-click or long-press images in the exported page and save them.</p>');}else if(window.nw){uiUtil.systemAlert('Unfortunately there is currently no way to save an image to disk in the NWJS version of this app.<br>You can do this in the PWA version: please visit https://pwa.kiwix.org.');}else if(params.contentInjectionMode==='serviceworker'&&appstate.selectedArchive&&!/wikipedia|wikivoyage|mdwiki|wiktionary/i.test(appstate.selectedArchive.file.name)){uiUtil.systemAlert('Please be aware that Image manipulation can interfere with non-Wikimedia ZIMs (particularly ZIMs that have active content). If you cannot access the articles in such a ZIM, please turn this setting off.');}else if(/PWA/.test(params.appType)&&params.contentInjectionMode==='jquery'){uiUtil.systemAlert('Be aware that this option may interfere with active content if you switch to Service Worker mode.');}}params.themeChanged=true;});['btnReset','btnReset2'].forEach(function(id){document.getElementById(id).addEventListener('click',function(){resetApp.reset();});});document.getElementById('btnRefreshApp').addEventListener('click',function(){window.location.reload();});document.getElementById('bypassAppCacheCheck').addEventListener('change',function(){if(params.contentInjectionMode!=='serviceworker'){uiUtil.systemAlert('This setting can only be used in Service Worker mode!');this.checked=false;}else {params.appCache=!this.checked;settingsStore$1.setItem('appCache',params.appCache,Infinity);resetApp.reset('cacheAPI');}// This will also send any new values to Service Worker
  refreshCacheStatus();});if(window.electronAPI){// DEV to find the callback for this call, search for electronAPI.on('get-store-value' above
  electronAPI.getStoreValue('expressPort');document.getElementById('expressPortInput').addEventListener('change',function(e){// Ensure the port is a number and the value matches a permitted value
  var proposedPort=parseInt(e.target.value);if(proposedPort!==e.target.value&&(proposedPort<1024||proposedPort>65535)){e.target.value=params.expressPort||3000;setTimeout(function(){uiUtil.systemAlert('Please enter a valid port number between 1024 and 65535!');},250);}else {params.expressPort=proposedPort;electronAPI.setStoreValue('expressPort',params.expressPort);setTimeout(function(){uiUtil.systemAlert('Please note that the new port setting will only be applied after restarting the app.');},250);}});// Set the Zoom values for the window
  electronAPI.setZoomLimits(1,3);// External access toggle handler
  var externalAccessCheckbox=document.getElementById('externalAccessCheckbox');// Get initial state when app loads
  electronAPI.getExternalAccessState().then(function(result){externalAccessCheckbox.checked=result.enabled;console.log('Initial external access binding:',result.binding);uiUtil.setExpressServerUI(params.expressPort,result.localIP);});// Handle checkbox toggle
  externalAccessCheckbox.addEventListener('change',function(e){var enable=e.target.checked;if(enable){// Show warning before enabling external access
  var warningMessage='<p>⚠️ Warning⚠️</p>'+'<p>You are about to allow other devices on your network to access this app!</p>'+'<p>Only enable this on trusted networks (home/office). Never enable on public WiFi or unsecured hotspots.'+'This feature will automatically turn OFF when you restart the app.</p>'+'<p>Are you sure you want to continue?</p>';uiUtil.systemAlert(warningMessage,'Enable External Access?',true,'Cancel','Continue').then(function(confirmed){if(confirmed){// User confirmed - proceed with enabling
  performToggle(true,e);}else {// User cancelled - revert checkbox
  e.target.checked=false;}});}else {// Disabling doesn't need confirmation
  performToggle(false,e);}});// Helper function to perform the actual toggle
  function performToggle(enable,event){electronAPI.toggleExternalAccess(enable).then(function(result){if(result.success){console.log('External access toggled. New binding:',result.binding);var appAccessURI='http://'+(result.localIP||'localhost')+':'+params.expressPort;uiUtil.setExpressServerUI(params.expressPort,result.localIP);var message=enable?'External access enabled. Other devices on your network can now access this app at <a href="'+appAccessURI+'" target="_blank">'+appAccessURI+'</a>':'External access disabled. App is now only accessible from localhost.';setTimeout(function(){uiUtil.systemAlert(message,'Server Access Status');},250);}else {event.target.checked=!enable;// Revert checkbox on error
  }}).catch(function(err){console.error('Error toggling external access:',err);event.target.checked=!enable;// Revert checkbox on error
  });}}document.getElementById('libzimSearchType').addEventListener('change',function(e){params.libzimSearchType=e.target.checked?'searchWithSnippets':'search';settingsStore$1.setItem('libzimSearchType',params.libzimSearchType,Infinity);uiUtil.dynamicallySetMaxSearchResults();});document.getElementById('disableDragAndDropCheck').addEventListener('change',function(){params.disableDragAndDrop=!!this.checked;settingsStore$1.setItem('disableDragAndDrop',params.disableDragAndDrop,Infinity);uiUtil.systemAlert('<p>We will now attempt to reload the app to apply the new setting.</p>'+'<p>(If you cancel, then the setting will only be applied when you next start the app.)</p>','Reload app',true).then(function(result){if(result){window.location.reload();}});});// Source verification is only makes sense in SW mode as doing the same in jQuery mode is redundant.
  document.getElementById('enableSourceVerificationCheck').style.display=params.contentInjectionMode===('serviceworker')?'block':'none';document.getElementById('enableSourceVerificationCheck').addEventListener('change',function(){params.sourceVerification=this.checked;settingsStore$1.setItem('sourceVerification',this.checked,Infinity);});document.getElementById('autoUpdatePWACheck').addEventListener('change',function(){params.autoUpdatePWA=this.checked;settingsStore$1.setItem('autoUpdatePWA',params.autoUpdatePWA,Infinity);});document.getElementById('hideActiveContentWarningCheck').addEventListener('change',function(){params.hideActiveContentWarning=this.checked;settingsStore$1.setItem('hideActiveContentWarning',params.hideActiveContentWarning,Infinity);refreshCacheStatus();});document.getElementById('useLibzimReaderCheck').addEventListener('change',function(e){if(params.debugLibzimASM==='disable'){uiUtil.systemAlert('You cannot use the libzim reader if you have disabled it in the dropdown above!');this.checked=false;params.useLibzim=false;}else {params.useLibzim=e.target.checked;}settingsStore$1.setItem('useLibzim',params.useLibzim,Infinity);refreshAPIStatus();});document.getElementById('useLegacyZimitSupportCheck').addEventListener('change',function(e){if(navigator.serviceWorker.controller){params.useLegacyZimitSupport=e.target.checked;refreshAPIStatus();return uiUtil.systemAlert('<p>We need to reload the app to apply the new setting</p>','Reload app',true).then(function(input){if(input){settingsStore$1.setItem('useLegacyZimitSupport',params.useLegacyZimitSupport,Infinity);console.log('Sending message to Service Worker to '+(params.useLegacyZimitSupport?'deisable':'enable')+' Zimit support...');navigator.serviceWorker.controller.postMessage({action:params.useLegacyZimitSupport?'disableReplayWorker':'enableReplayWorker'});window.location.reload();}else {// Revert the checkbox
  e.target.checked=!e.target.checked;params.useLegacyZimitSupport=e.target.checked;refreshAPIStatus();}});}});// Function to restore the fullscreen/orientation lock state on user click in-app
  // This is necessary because the browser will not restore the state without a user gesture
  var refreshFullScreen=function refreshFullScreen(evt){// console.debug('refreshFullScreen starting');
  // Don't react if user is selecting an archive or setting the lock orientation
  if(/archiveFilesLegacy|lockDisplayOrientationDrop/.test(evt.target.id))return;// Don't react when picking archive or directory with the File System Access API (because entering fullscreen blocks the permissions prompt)
  if(evt.target.parentElement&&evt.target.parentElement.id==='archiveList'&&window.showDirectoryPicker)return;if(params.lockDisplayOrientation&&(evt.target.id==='btnAbout'||/glyphicon-(resize-small|fullscreen)/.test(evt.target.className))){if(uiUtil.appIsFullScreen()){// Cancel fullscreen mode
  uiUtil.lockDisplayOrientation().then(function(){setDynamicIcons();});params.lockDisplayOrientation='';settingsStore$1.setItem('lockDisplayOrientation','',Infinity);document.getElementById('lockDisplayOrientationDrop').value='';}else {// Enter fullscreen mode
  uiUtil.lockDisplayOrientation(params.lockDisplayOrientation).then(function(){setDynamicIcons();resizeIFrame();}).catch(function(){setDynamicIcons();resizeIFrame();});}}else {if(params.lockDisplayOrientation)uiUtil.lockDisplayOrientation(params.lockDisplayOrientation).catch(function(){});}};// Add event listener to the app UI
  document.getElementById('search-article').addEventListener('mouseup',refreshFullScreen);// Set the UI for the current fullscreen/orientation lock state
  document.getElementById('lockDisplayOrientationDrop').value=params.lockDisplayOrientation||'';document.getElementById('lockDisplayOrientationDrop').addEventListener('change',function(event){var that=this;if(event.target.value){return uiUtil.lockDisplayOrientation(event.target.value).then(function(rtn){if(rtn==='unsupported'){uiUtil.systemAlert('The Screen Orientation Lock API is not supported on this device!');that.value=params.lockDisplayOrientation||'';}else {params.lockDisplayOrientation=event.target.value||'';settingsStore$1.setItem('lockDisplayOrientation',params.lockDisplayOrientation,Infinity);if(rtn==='click'){uiUtil.systemAlert((!params.PWAInstalled&&/iOS/.test(params.appType)?'<p>In Safari on iOS, consider adding this app to your homescreen (Share --&gt Add to Home), which will give a better experience than full-screen mode.</p>':'')+'<p>Please click the &nbsp;<span class="glyphicon glyphicon-fullscreen"></span>&nbsp; button top-right to enter full-screen mode.</p>');}}setDynamicIcons();}).catch(function(err){// Note that in desktop contexts, the API might reject, but could still work
  if(err.name==='NotSupportedError'){params.lockDisplayOrientation=event.target.value||'';settingsStore$1.setItem('lockDisplayOrientation',params.lockDisplayOrientation,Infinity);that.value=params.lockDisplayOrientation||'';if(params.lockDisplayOrientation){uiUtil.systemAlert('<p>The following error was received (this is expected on Desktop devices):</p>'+'<blockquote><code>'+err.toString()+'</code></blockquote>'+"<p>If screen lock doesn't work, please change setting back to 'Normal' or try a different option.</p>");}}else {uiUtil.systemAlert((!params.PWAInstalled&&/iOS/.test(params.appType)?'<p>In Safari on iOS, consider adding this app to your homescreen (Share --&gt Add to Home) isntead.</p>':'')+'<p>There was an error setting the requested screen state:</p><blockquote><code>'+err.toString()+'</code></blockquote>');that.value=params.lockDisplayOrientation||'';}setDynamicIcons();});}else {params.lockDisplayOrientation='';settingsStore$1.setItem('lockDisplayOrientation','',Infinity);uiUtil.lockDisplayOrientation().then(function(){setDynamicIcons();}).catch(function(){console.log('Error locking screen orientation');});}});document.getElementById('debugLibzimASMDrop').addEventListener('change',function(event){var that=this;var message='<p>App will reload to apply the new setting.</p>';if(event.target.value){message+='<p><i>Please be aware that leaving this override setting on can have anomalous effects, '+'e.g. the app will no longer check whether the OS supports full-text searching and searches may fail silently.</i></p>';}uiUtil.systemAlert(message,'Developer option!',true).then(function(confirm){if(confirm){params.debugLibzimASM=event.target.value||false;// If user disabled use of libzim for search, also turn off libzim for reading
  if(params.debugLibzimASM==='disable'&&params.useLibzim){document.getElementById('useLibzimReaderCheck').click();}settingsStore$1.setItem('debugLibzimASM',params.debugLibzimASM,Infinity);window.location.reload();}else {that.value=params.debugLibzimASM||'';}});});document.getElementById('openExternalLinksInNewTabsCheck').addEventListener('change',function(){params.openExternalLinksInNewTabs=this.checked;settingsStore$1.setItem('openExternalLinksInNewTabs',params.openExternalLinksInNewTabs,Infinity);params.themeChanged=true;});document.getElementById('tabOpenerCheck').addEventListener('click',function(){params.windowOpener=this.checked?'tab':false;if(!params.windowOpener&&!params.noWarning){uiUtil.systemAlert('Please note that due to the Content Secuirty Policy, external links and PDFs always open in a new tab or window, regardless of this setting.');}if(params.windowOpener&&/UWP\|PWA/.test(params.appType)&&params.contentInjectionMode==='jquery'){if(!params.noWarning){uiUtil.systemAlert('<p>In this UWP app, opening a new browsable window only works in Service Worker mode.</p>'+'<p>Your system appears to support SW mode, so please try switching to it in Expert Settings below.</p>'+'<p>If your system does not support SW mode, then use the more basic "Download or open current article" feature below.</p>');}params.windowOpener=false;}else if(params.windowOpener&&/iOS|UWP$/.test(params.appType)){if(!params.noWarning){uiUtil.systemAlert('<p>This option is not currently supported '+(/iOS/.test(params.appType)?'on iOS devices because programmatic opening of windows is forbidden. However, the native long-press feature may work.</p>':'in UWP apps that cannot use Service Worker mode.</p><p>Please try the more basic "Download or open current article" feature below instead.</p>'));}params.windowOpener=false;}settingsStore$1.setItem('windowOpener',params.windowOpener,Infinity);if(params.windowOpener&&params.allowHTMLExtraction){if(!params.noWarning)uiUtil.systemAlert('Enabling this option disables the more basic "Download or open current article" option below.');document.getElementById('allowHTMLExtractionCheck').click();}setWindowOpenerUI();params.themeChanged=true;});document.getElementById('winOpenerCheck').addEventListener('click',function(){var tabCheck=document.getElementById('tabOpenerCheck');params.windowOpener=this.checked?'window':tabCheck.checked?'tab':false;settingsStore$1.setItem('windowOpener',params.windowOpener,Infinity);setWindowOpenerUI();});document.getElementById('dblRightClickCheck').addEventListener('click',function(){var tabCheck=document.getElementById('tabOpenerCheck');params.rightClickType=this.checked?'double':tabCheck.checked?'single':false;settingsStore$1.setItem('rightClickType',params.rightClickType,Infinity);setWindowOpenerUI();});function setWindowOpenerUI(){var woHelp=document.getElementById('winOpenerHelp');var newWin=document.getElementById('openInNewWindow');var tabCheck=document.getElementById('tabOpenerCheck');var winCheck=document.getElementById('winOpenerCheck');var rtClickType=document.getElementById('dblRightClickCheck');if(params.rightClickType==='double')rtClickType.checked=true;if(params.windowOpener==='window'){newWin.style.display='block';woHelp.style.display='block';tabCheck.checked=true;winCheck.checked=true;woHelp.innerHTML='If blocked, allow popups permanently for this app and try again. May not work in mobile contexts.';if(params.rightClickType==='double')woHelp.innerHTML+='<br />Single right-click will open context menu, double right-click will open new window.';}else if(params.windowOpener==='tab'){tabCheck.checked=true;winCheck.checked=false;newWin.style.display='block';woHelp.style.display='block';woHelp.innerHTML='';woHelp.innerHTML='In some cases a window may open regardless of this setting. May not work in mobile contexts.';if(params.rightClickType==='double')woHelp.innerHTML+='<br />Single right-click will open context menu, double right-click will open new tab.';}else {// The options are turned off
  tabCheck.checked=false;winCheck.checked=false;rtClickType.checked=false;woHelp.style.display='none';newWin.style.display='none';}}document.getElementById('showPopoverPreviewsCheck').addEventListener('change',function(e){params.showPopoverPreviews=e.target.checked;settingsStore$1.setItem('showPopoverPreviews',params.showPopoverPreviews,Infinity);params.themeChanged=true;});document.getElementById('allowHTMLExtractionCheck').addEventListener('click',function(e){params.allowHTMLExtraction=e.target.checked;var alertMessage='';if(params.allowHTMLExtraction){if(params.windowOpener)alertMessage='<p>Enabling this option disables the more advanced tab/window opening option above.</p>';if(/iOS/.test(params.appType)){alertMessage='<p><b>This option will only work if you turn off popup blocking in your iOS browser settings.</b><p>';}if(params.contentInjectionMode==='serviceworker'){alertMessage='<p>Please be aware that the "Download or open current article" functionality can interfere badly with non-Wikimedia ZIMs (particularly ZIMs that have active content). '+'If you cannot access the articles in such a ZIM, please turn this setting off.</p>'+alertMessage;}else if(/PWA/.test(params.appType)){alertMessage+='<p>Be aware that this option may interfere with active content if you switch to Service Worker mode.</p>';}uiUtil.systemAlert(alertMessage);params.windowOpener=false;settingsStore$1.setItem('windowOpener',params.windowOpener,Infinity);setWindowOpenerUI();}settingsStore$1.setItem('allowHTMLExtraction',params.allowHTMLExtraction,Infinity);params.themeChanged=true;});document.getElementById('alphaCharTxt').addEventListener('change',function(){params.alphaChar=this.value.length===1?this.value:params.alphaChar;this.value=params.alphaChar;settingsStore$1.setItem('alphaChar',params.alphaChar,Infinity);});document.getElementById('omegaCharTxt').addEventListener('change',function(){params.omegaChar=this.value.length===1?this.value:params.omegaChar;this.value=params.omegaChar;settingsStore$1.setItem('omegaChar',params.omegaChar,Infinity);});var titleSearchRangeVal=document.getElementById('titleSearchRangeVal');document.getElementById('titleSearchRange').addEventListener('change',function(e){settingsStore$1.setItem('maxSearchResultsSize',e.target.value,Infinity);params.maxSearchResultsSize=~~e.target.value;titleSearchRangeVal.innerHTML=e.target.value;});document.getElementById('titleSearchRange').addEventListener('input',function(e){titleSearchRangeVal.innerHTML=e.target.value;});document.getElementById('hideToolbarsCheck').addEventListener('click',function(){// This code implements a tri-state checkbox
  // DEV: You cannot use jQuery to add the click event listener above: it doesn't work properly!
  if(this.readOnly)this.checked=this.readOnly=false;else if(!this.checked)this.readOnly=this.indeterminate=true;// How to reverse the order of the checkbox
  // if (this.readOnly) { this.checked = true; this.readOnly = false; }
  // else if (this.checked) this.readOnly = this.indeterminate = true;
  params.hideToolbars=this.indeterminate?'top':this.checked;document.getElementById('hideToolbarsState').innerHTML=params.hideToolbars==='top'?'top only':params.hideToolbars?'both':'never';settingsStore$1.setItem('hideToolbars',params.hideToolbars,Infinity);checkToolbar();});document.getElementById('interceptBeforeUnloadCheck').addEventListener('change',function(){params.interceptBeforeUnload=this.checked;settingsStore$1.setItem('interceptBeforeUnload',params.interceptBeforeUnload,Infinity);});Array.prototype.slice.call(document.querySelectorAll('.aboutLink')).forEach(function(link){link.addEventListener('click',function(){document.getElementById('btnAbout').click();});});var iframe=document.getElementById('articleContent');function checkToolbar(){if(document.getElementById('row2').style.display==='none'){// Check state of toolbar (this returns it to its original state if it was changed by find-in-article)
  params.hideToolbars=settingsStore$1.getItem('hideToolbars');params.hideToolbars=params.hideToolbars===null?true:params.hideToolbars==='true'?true:params.hideToolbars==='false'?false:params.hideToolbars;}// Get the contentWindow of the iframe to operate on
  var thisArticleWindow=articleWindow;if(articleWindow.document&&articleWindow.document.getElementById('replay_iframe')){thisArticleWindow=articleContainer$1.contentWindow.document.getElementById('replay_iframe').contentWindow;}// Remove and add the scroll event listener to the new article window
  // Note that IE11 doesn't support wheel or touch events on the iframe, but it does support keydown and scroll
  thisArticleWindow.removeEventListener('scroll',uiUtil.scroller);thisArticleWindow.removeEventListener('touchstart',uiUtil.scroller);thisArticleWindow.removeEventListener('touchend',uiUtil.scroller);thisArticleWindow.removeEventListener('wheel',uiUtil.scroller);thisArticleWindow.removeEventListener('keydown',uiUtil.scroller);if(params.hideToolbars){thisArticleWindow.addEventListener('scroll',uiUtil.scroller);thisArticleWindow.addEventListener('touchstart',uiUtil.scroller);thisArticleWindow.addEventListener('touchend',uiUtil.scroller);thisArticleWindow.addEventListener('wheel',uiUtil.scroller);thisArticleWindow.addEventListener('keydown',uiUtil.scroller);}}// Set up hook into Windows ViewManagement uiSettings if needed
  var uiSettings=null;initializeUISettings();function initializeUISettings(){var checkAuto=params.cssUITheme=='auto'||params.cssTheme=='auto';// Support for UWP
  if(checkAuto&&typeof Windows!=='undefined'&&Windows.UI&&Windows.UI.ViewManagement){uiSettings=new Windows.UI.ViewManagement.UISettings();uiSettings.oncolorvalueschanged=function(){params.cssTheme=settingsStore$1.getItem('cssTheme');if(params.cssUITheme=='auto')cssUIThemeGetOrSet('auto');if(params.cssTheme=='auto')switchCSSTheme();};}// Support for other contexts (Firefox, Chromium, Electron, NWJS)
  if(checkAuto&&window.matchMedia('(prefers-color-scheme)').media!=='not all'){uiSettings=window.matchMedia('(prefers-color-scheme:dark)');uiSettings.onchange=function(){params.cssTheme=settingsStore$1.getItem('cssTheme');if(params.cssUITheme=='auto')cssUIThemeGetOrSet('auto');if(params.cssTheme=='auto')switchCSSTheme();};}}// Code below is needed on startup to show or hide the inverted and DarkReader theme checkboxes;
  // similar code also runs in switchCSSTheme(), but that is not evoked on startup
  if(params.cssTheme=='auto')document.getElementById('darkInvert').style.display=cssUIThemeGetOrSet('auto',true)=='light'?'none':'block';if(params.cssTheme=='auto')document.getElementById('darkLegacy').style.display=cssUIThemeGetOrSet('auto',true)=='light'?'none':'block';if(params.cssTheme=='auto')document.getElementById('darkDarkReader').style.display=params.contentInjectionMode==='serviceworker'?cssUIThemeGetOrSet('auto',true)=='light'?'none':'block':'none';document.getElementById('cssUIDarkThemeCheck').addEventListener('click',function(){params.cssThemeOriginal=params.cssTheme;// This code implements a tri-state checkbox
  if(this.readOnly)this.checked=this.readOnly=false;else if(!this.checked)this.readOnly=this.indeterminate=true;// Code below shows how to invert the order
  // if (this.readOnly) {
  //     this.checked = true; this.readOnly = false;
  // } else if (this.checked) this.readOnly = this.indeterminate = true;
  params.cssUITheme=this.indeterminate?'auto':this.checked?'dark':'light';if(!uiSettings)initializeUISettings();settingsStore$1.setItem('cssUITheme',params.cssUITheme,Infinity);document.getElementById('cssUIDarkThemeState').innerHTML=params.cssUITheme;cssUIThemeGetOrSet(params.cssUITheme);// Make subsequent check valid if params.cssTheme is "invert" rather than "dark"
  if(params.cssUITheme!=params.cssTheme)document.getElementById('cssWikiDarkThemeCheck').click();// If the darkReader theme has been turned off or on (and this is a change), then we need to reload the page
  if(params.cssTheme!==params.cssThemeOriginal&&(params.cssTheme==='darkReader'||params.cssThemeOriginal==='darkReader')){params.themeChanged=true;params.lastPageVisit='';}params.cssThemeOriginal=null;});document.getElementById('cssWikiDarkThemeCheck').addEventListener('click',function(){if(this.readOnly)this.checked=this.readOnly=false;else if(!this.checked)this.readOnly=this.indeterminate=true;// Invert order:
  // if (this.readOnly) {
  //     this.checked = true; this.readOnly = false;
  // } else if (this.checked) this.readOnly = this.indeterminate = true;
  params.cssTheme=this.indeterminate?'auto':this.checked?'dark':'light';if(!uiSettings)initializeUISettings();var determinedValue=params.cssTheme;if(params.cssTheme=='auto')determinedValue=cssUIThemeGetOrSet('auto',true);if(determinedValue=='light')document.getElementById('footer').classList.remove('darkfooter');if(params.cssTheme=='light')document.getElementById('cssWikiDarkThemeInvertCheck').checked=false;if(determinedValue=='dark')document.getElementById('footer').classList.add('darkfooter');document.getElementById('darkInvert').style.display=determinedValue=='light'?'none':'block';document.getElementById('darkLegacy').style.display=determinedValue=='light'?'none':'block';document.getElementById('darkDarkReader').style.display=params.contentInjectionMode==='serviceworker'?determinedValue=='light'?'none':'block':'none';params.cssTheme=document.getElementById('cssWikiDarkThemeInvertCheck').checked&&determinedValue=='dark'?'invert':params.cssTheme;document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked=determinedValue=='dark'?appstate.selectedArchive&&/zimit/.test(appstate.selectedArchive.zimType):false;params.cssTheme=document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked?'darkReader':params.cssTheme;document.getElementById('cssWikiDarkThemeState').innerHTML=params.cssTheme;settingsStore$1.setItem('cssTheme',params.cssTheme,Infinity);switchCSSTheme();params.cssThemeOriginal=null;});document.getElementById('cssWikiDarkThemeInvertCheck').addEventListener('change',function(){if(this.checked){params.cssTheme='invert';document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked=false;var customDarkThemeCheckbox=document.getElementById('cssWikiDarkThemeLegacyCheck');if(customDarkThemeCheckbox.checked)customDarkThemeCheckbox.click();}else {var darkThemeCheckbox=document.getElementById('cssWikiDarkThemeCheck');params.cssTheme=darkThemeCheckbox.indeterminate?'auto':darkThemeCheckbox.checked?'dark':'light';}settingsStore$1.setItem('cssTheme',params.cssTheme,Infinity);document.getElementById('cssWikiDarkThemeState').innerHTML=params.cssTheme;switchCSSTheme();params.cssThemeOriginal=null;});document.getElementById('cssWikiDarkThemeLegacyCheck').addEventListener('change',function(){if(this.checked){params.cssTheme='dark';params.customDarkTheme=true;document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked=false;document.getElementById('cssWikiDarkThemeInvertCheck').checked=false;}else {var darkThemeCheckbox=document.getElementById('cssWikiDarkThemeCheck');params.customDarkTheme=false;params.cssTheme=darkThemeCheckbox.indeterminate?'auto':darkThemeCheckbox.checked?'dark':'light';}settingsStore$1.setItem('cssTheme',params.cssTheme,Infinity);settingsStore$1.setItem('customDarkTheme',params.customDarkTheme,Infinity);document.getElementById('cssWikiDarkThemeState').innerHTML=params.cssTheme;switchCSSTheme();params.cssThemeOriginal=null;});document.getElementById('cssWikiDarkThemeDarkReaderCheck').addEventListener('change',function(){params.cssThemeOriginal=params.cssTheme;if(this.checked){params.cssTheme='darkReader';document.getElementById('cssWikiDarkThemeInvertCheck').checked=false;var customDarkThemeCheckbox=document.getElementById('cssWikiDarkThemeLegacyCheck');if(customDarkThemeCheckbox.checked)customDarkThemeCheckbox.click();}else {var darkThemeCheckbox=document.getElementById('cssWikiDarkThemeCheck');params.cssTheme=darkThemeCheckbox.indeterminate?'auto':darkThemeCheckbox.checked?'dark':'light';}settingsStore$1.setItem('cssTheme',params.cssTheme,Infinity);document.getElementById('cssWikiDarkThemeState').innerHTML=params.cssTheme;switchCSSTheme();// If the darkReader theme has been turned off or on (and this is a change), then we need to reload the page
  if(params.cssTheme!==params.cssThemeOriginal&&(params.cssTheme==='darkReader'||params.cssThemeOriginal==='darkReader')){params.themeChanged=true;params.lastPageVisit='';}params.cssThemeOriginal=null;});document.getElementById('triStateThemeRandomBtnCheck').addEventListener('click',function(){if(this.readOnly)this.checked=this.readOnly=false;else if(!this.checked)this.readOnly=this.indeterminate=true;params.displayThemeOrRandomButtons=this.indeterminate?'both':this.checked?'random':'theme';settingsStore$1.setItem('displayThemeOrRandomButtons',params.displayThemeOrRandomButtons,Infinity);document.getElementById('triStateThemeRandomBtnState').innerHTML=params.displayThemeOrRandomButtons;toggleThemeOrRandomButtons();});function toggleThemeOrRandomButtons(){var btnToggleTheme=document.getElementById('btnToggleTheme');var btnRandom=document.getElementById('btnRandomArticle');btnToggleTheme.style.display='inline';btnRandom.style.display='inline';if(params.displayThemeOrRandomButtons==='random'){btnToggleTheme.style.display='none';}else if(params.displayThemeOrRandomButtons==='theme'){btnRandom.style.display='none';}}toggleThemeOrRandomButtons();function cssUIThemeGetOrSet(value,getOnly){if(value==='auto'){value='light';// Default that most people expect
  if(uiSettings){// We need to check the system theme
  if(uiSettings.getColorValue){// Value 0 below is the 'background' constant in array Windows.UI.ViewManagement.UIColorType
  var colour=uiSettings.getColorValue(0);value=colour.b+colour.g+colour.r<=382?'dark':'light';}else {// Generic support for modern browser contexts
  value=uiSettings.matches?'dark':'light';}}}if(getOnly)return value;var elements;if(value=='dark'){document.getElementsByTagName('body')[0].classList.add('dark');archiveFilesLegacy.classList.add('dark');document.getElementById('footer').classList.add('darkfooter');archiveFilesLegacy.classList.remove('btn');document.getElementById('findInArticle').classList.add('dark');prefix.classList.add('dark');elements=document.querySelectorAll('.settings');for(var i=0;i<elements.length;i++){elements[i].style.border='1px solid darkgray';}document.getElementById('kiwixIcon').src=/wikivoyage/i.test(params.storedFile)?'img/icons/wikivoyage-white-32.png':/medicine|mdwiki/i.test(params.storedFile)?'img/icons/wikimed-lightblue-32.png':'img/icons/kiwix-32.png';if(/wikivoyage/i.test(params.storedFile))document.getElementById('kiwixIconAbout').src='img/icons/wikivoyage-90-white.png';}if(value=='light'){document.getElementsByTagName('body')[0].classList.remove('dark');document.getElementById('search-article').classList.remove('dark');document.getElementById('footer').classList.remove('darkfooter');archiveFilesLegacy.classList.remove('dark');archiveFilesLegacy.classList.add('btn');document.getElementById('findInArticle').classList.remove('dark');prefix.classList.remove('dark');elements=document.querySelectorAll('.settings');for(i=0;i<elements.length;i++){elements[i].style.border='1px solid black';}document.getElementById('kiwixIcon').src=/wikivoyage/i.test(params.storedFile)?'img/icons/wikivoyage-black-32.png':/medicine|mdwiki/i.test(params.storedFile)?'img/icons/wikimed-blue-32.png':'img/icons/kiwix-blue-32.png';if(/wikivoyage/i.test(params.packagedFile))document.getElementById('kiwixIconAbout').src='img/icons/wikivoyage-90.png';}refreshCacheStatus();setOPFSUI();return value;}/**
   * Switches the CSS theme for the article content
   *
   * For new Wikipedia ZIMs (October 2024+), this function uses the ZIM's native theme system.
   * For older ZIMs, it applies legacy custom dark stylesheets.
   *
   * DEVELOPER NOTE: To force the legacy custom dark theme on new Wikipedia ZIMs for testing:
   * - Open DevTools console and type: params.customDarkTheme = true
   * - Then navigate to a new article to see the custom theme applied
   */function switchCSSTheme(){// Choose the document, either the iframe contentDocument or else the replay_iframe contentDocument
  var doc=articleContainer$1?articleContainer$1.contentDocument:'';var zimitIframe=doc&&appstate.isReplayWorkerAvailable?doc.getElementById('replay_iframe'):appstate.selectedArchive&&appstate.selectedArchive.zimType==='zimit2'?articleContainer$1:null;doc=zimitIframe?zimitIframe.contentDocument:doc;if(!doc)return;// Detect if this article uses the new Wikipedia theme system (October 2024+)
  var usesProvidedWikipediaTheme=false;if(appstate.wikimediaZimLoaded){var htmlElement=doc.documentElement;if(htmlElement){// First check if we've already detected and marked this article
  if(htmlElement.hasAttribute('data-kiwix-has-skin-theme-clientpref')){usesProvidedWikipediaTheme=htmlElement.getAttribute('data-kiwix-has-skin-theme-clientpref')==='true';}else if(htmlElement.classList){// Initial detection: check if the html element has one of the theme preference classes
  usesProvidedWikipediaTheme=htmlElement.classList.contains('skin-theme-clientpref-night')||htmlElement.classList.contains('skin-theme-clientpref-os');// Remember this detection for subsequent theme switches on the same article
  htmlElement.setAttribute('data-kiwix-has-skin-theme-clientpref',usesProvidedWikipediaTheme?'true':'false');}}console.log('[Theme Detection] Article uses Wikipedia\'s auto theme system:',usesProvidedWikipediaTheme);}var styleSheets=doc.getElementsByTagName('link');// Remove any dark theme, as we don't know whether user switched from light to dark or from inverted to dark, etc.
  for(var i=styleSheets.length-1;i>-1;i--){if(~styleSheets[i].href.search(/-\/s\/style-dark/)){styleSheets[i].disabled=true;styleSheets[i].parentNode.removeChild(styleSheets[i]);}}var determinedWikiTheme=params.cssTheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssTheme;var breakoutLink=doc.getElementById('breakoutLink');// Construct an absolute reference becuase Service Worker needs this
  var locationPrefix=window.location.pathname.replace(/\/[^/]*$/,'');// Handle new Wikipedia theme system if detected
  if(usesProvidedWikipediaTheme){var html=doc.documentElement;// Remove all theme preference classes first
  html.classList.remove('skin-theme-clientpref-night','skin-theme-clientpref-os');// If custom dark theme override is enabled, or we are using the custom mobile style transform, set ZIM to light and fall through to old logic
  if(params.customDarkTheme||params.cssSource==='mobile'){console.log('[Theme] Custom dark theme override enabled - setting ZIM to light mode');// Classes already removed, so ZIM will be in light mode
  // Fall through to apply custom dark stylesheet
  }else {// Apply the appropriate class based on user preference
  if(params.cssTheme==='auto'){// Let the ZIM handle theme via OS preference
  html.classList.add('skin-theme-clientpref-os');console.log('[Theme] Applied OS theme preference to new Wikipedia theme system');}else if(params.cssTheme==='dark'){html.classList.add('skin-theme-clientpref-night');console.log('[Theme] Applied dark theme class to new Wikipedia theme system');}else if(params.cssTheme==='darkReader'||params.cssTheme==='invert'){// For darkReader and invert, set ZIM to light theme and let the old logic handle the rest
  console.log('[Theme] Set ZIM to light for darkReader/invert processing');// Don't return early - fall through to old injection logic
  }else {// For 'light', just leave the classes removed (default is light)
  console.log('[Theme] Applied light theme (removed classes) to new Wikipedia theme system');}// Only return early if we're NOT using darkReader or invert
  if(params.cssTheme!=='darkReader'&&params.cssTheme!=='invert'){// Display the article since we've handled the theme
  if(document.getElementById('configuration').style.display==='none'){articleContainer$1.style.display='';if(zimitIframe)zimitIframe.style.display='';window.dispatchEvent(new Event('resize'));// Force repaint
  }// Still need to handle tooltips and breakout link icon
  var isDark=determinedWikiTheme!=='light';if(breakoutLink){breakoutLink.src=locationPrefix+(isDark?'/img/icons/new_window_lb.svg':'/img/icons/new_window.svg');}// Handle tooltip styles
  popovers.updateTooltipStyles(doc,isDark);// Update UI theme indicators
  // Hide invert/darkReader options when in auto mode or when theme is light
  document.getElementById('darkInvert').style.display=params.cssTheme==='auto'||determinedWikiTheme==='light'?'none':'block';document.getElementById('darkLegacy').style.display=params.cssTheme==='auto'||determinedWikiTheme==='light'?'none':'block';document.getElementById('darkDarkReader').style.display=params.contentInjectionMode==='serviceworker'?params.cssTheme==='auto'||determinedWikiTheme==='light'?'none':'block':'none';return;// Skip the old theme injection logic
  }}// end else (not customDarkTheme)
  }if(determinedWikiTheme!=='light'&&params.cssTheme!=='darkReader'){var link=doc.createElement('link');link.setAttribute('rel','stylesheet');link.setAttribute('type','text/css');link.setAttribute('href',locationPrefix+(determinedWikiTheme=='dark'?'/-/s/style-dark.css':'/-/s/style-dark-invert.css'));link.onload=function(){if(document.getElementById('configuration').style.display==='none'){articleContainer$1.style.display='';if(zimitIframe)zimitIframe.style.display='';window.dispatchEvent(new Event('resize'));// Force repaint
  }};doc.head.appendChild(link);if(doc.defaultView.DarkReader){doc.defaultView.DarkReader.disable();}if(breakoutLink)breakoutLink.src=locationPrefix+'/img/icons/new_window_lb.svg';}else {if(params.contentInjectionMode==='serviceworker'&&params.cssTheme==='darkReader'){var loadDarkReader=function loadDarkReader(){var darkReader=doc.createElement('script');darkReader.onload=function(){doc.defaultView.DarkReader.setFetchMethod(doc.defaultView.fetch);doc.defaultView.DarkReader.enable();if(zimitIframe&&document.getElementById('configuration').style.display==='none'){articleContainer$1.style.display='';setTimeout(function(){zimitIframe.style.display='';window.dispatchEvent(new Event('resize'));// Force repaint
  },350);}};darkReader.type='text/javascript';darkReader.src=locationPrefix+'/js/darkreader.min.js';doc.head.appendChild(darkReader);};// Use setInterval to keep attempting to load darkReader until doc.defaultView.DarkReader is available
  var interval=setInterval(function(){if(doc&&doc.defaultView){if(!doc.defaultView.DarkReader){clearInterval(interval);loadDarkReader();}}else {// Oops, we no longer have a handle on the iframe document, so get it again
  doc=articleContainer$1?articleContainer$1.contentDocument:'';zimitIframe=doc&&appstate.isReplayWorkerAvailable?doc.getElementById('replay_iframe'):appstate.selectedArchive.zimType==='zimit2'?articleContainer$1:null;doc=zimitIframe?zimitIframe.contentDocument:doc;}},100);// If the interval has not succeeded after 3 seconds, give up
  if(zimitIframe&&document.getElementById('configuration').style.display==='none'){setTimeout(function(zimitf,articleC){articleC.style.display='';zimitf.style.display='';clearInterval(interval);window.dispatchEvent(new Event('resize'));// Force repaint
  },3000,zimitIframe,articleContainer$1);}}else if(document.getElementById('configuration').style.display==='none'){// We're dealing with a light style, so we just display it
  articleContainer$1.style.display='';if(zimitIframe)zimitIframe.style.display='';window.dispatchEvent(new Event('resize'));// Force repaint
  }if(breakoutLink)breakoutLink.src=locationPrefix+'/img/icons/new_window.svg';}// Update tooltip styles for the current theme
  popovers.updateTooltipStyles(doc,determinedWikiTheme!=='light');// Hide invert/darkReader options when in auto mode or when theme is light
  document.getElementById('darkInvert').style.display=params.cssTheme==='auto'||determinedWikiTheme==='light'?'none':'block';document.getElementById('darkLegacy').style.display=params.cssTheme==='auto'||determinedWikiTheme==='light'?'none':'block';document.getElementById('darkDarkReader').style.display=params.contentInjectionMode==='serviceworker'?params.cssTheme==='auto'||determinedWikiTheme==='light'?'none':'block':'none';}document.getElementById('resetDisplayOnResizeCheck').addEventListener('click',function(){params.resetDisplayOnResize=this.checked;settingsStore$1.setItem('resetDisplayOnResize',this.checked,Infinity);resizeIFrame(this.checked);});document.getElementById('rememberLastPageCheck').addEventListener('change',function(){params.rememberLastPage=this.checked;settingsStore$1.setItem('rememberLastPage',params.rememberLastPage,Infinity);if(!params.rememberLastPage){settingsStore$1.setItem('lastPageVisit','',Infinity);// DEV: replace this with cache.clear when you have repaired that method
  cache.setArticle(params.lastPageVisit.replace(/.+@kiwixKey@/,''),params.lastPageVisit.replace(/@kiwixKey@.+/,''),'',function(){});params.lastPageHTML='';}});document.getElementById('cachedAssetsModeRadioTrue').addEventListener('change',function(e){if(e.target.checked){settingsStore$1.setItem('assetsCache',true,Infinity);params.assetsCache=true;refreshCacheStatus();}});document.getElementById('cachedAssetsModeRadioFalse').addEventListener('change',function(e){if(e.target.checked){settingsStore$1.setItem('assetsCache',false,Infinity);params.assetsCache=false;// Delete all caches
  cache.clear('all',refreshCacheStatus);}});document.querySelectorAll('input[name=cssInjectionMode]').forEach(function(element){element.addEventListener('click',function(){var originalCssSource=params.cssSource;params.cssSource=this.value;settingsStore$1.setItem('cssSource',params.cssSource,Infinity);var confirmFn=function confirmFn(){if(params.cssSource==='desktop'&&!params.openAllSections){// If the user has selected desktop style, we should ensure all sections are opened by default
  document.getElementById('openAllSectionsCheck').click();}// We have to reload the article to respect user's choice
  params.themeChanged=true;setTab();};if(!params.cssCache&&params.cssSource!=='auto'){uiUtil.systemAlert('Transforming the ZIM style requires the use of locally cached Wikimedia stylesheets, so we need to enable these.','Warning!',true).then(function(rtn){if(rtn){document.getElementById('cssCacheModeCheck').click();}else {params.cssSource=originalCssSource;Array.prototype.slice.call(document.querySelectorAll('input[name=cssInjectionMode]')).forEach(function(radio){radio.checked=false;if(radio.value===params.cssSource){radio.checked=true;}});}confirmFn();});}else {confirmFn();}});});document.getElementById('removePageMaxWidthCheck').addEventListener('click',function(){// This code implements a tri-state checkbox
  if(this.readOnly)this.checked=this.readOnly=false;else if(!this.checked)this.readOnly=this.indeterminate=true;params.removePageMaxWidth=this.indeterminate?'auto':this.checked;document.getElementById('pageMaxWidthState').textContent=params.removePageMaxWidth=='auto'?'auto':params.removePageMaxWidth?'always':'never';settingsStore$1.setItem('removePageMaxWidth',params.removePageMaxWidth,Infinity);params.themeChanged=true;});document.getElementById('displayHiddenBlockElementsCheck').addEventListener('click',function(){if(this.readOnly)this.checked=this.readOnly=false;else if(!this.checked)this.readOnly=this.indeterminate=true;params.displayHiddenBlockElements=this.indeterminate?'auto':this.checked;document.getElementById('displayHiddenElementsState').textContent=params.displayHiddenBlockElements=='auto'?'auto':params.displayHiddenBlockElements?'always':'never';settingsStore$1.setItem('displayHiddenBlockElements',params.displayHiddenBlockElements,Infinity);if(params.contentInjectionMode==='serviceworker'){var message='';if(this.checked&&!params.manipulateImages){message+='We need to turn on "Allow image manipulation" (below) in order to display hidden images. Please be aware that '+'image manipulation can interfere badly with non-Wikimedia ZIMs that contain active content, so please turn it off if '+'you experience problems.';document.getElementById('manipulateImagesCheck').click();}if(this.checked&&/UWP/.test(params.appType)&&params.windowOpener&&params.cssSource!=='desktop'){if(message)message+='\n\n';message+='Please note that hidden elements will not be displayed in any NEW windows or tabs that you open in this UWP app. If you want to see hidden elements in new windows in *Wikimedia* ZIMs, please switch to Desktop style (above), where they are shown by default.';}if(!params.displayHiddenBlockElements&&params.manipulateImages){document.getElementById('manipulateImagesCheck').click();}if(!params.openAllSections&&params.displayHiddenBlockElements==='auto'&&appstate.wikimediaZimLoaded){message+=(message?'\n\n':'')+'Please note that hidden elements are no-longer displayed in auto mode if "Open all headings" is disabled. Either enable "Open all headings" or set "Display hidden block elements" to "always" if you want to see these anyway.';}if(message)uiUtil.systemAlert(message);}// We have to reload the article to respect user's choice
  params.themeChanged=true;});/**
   * Removes the WikiMedia max-page-width restrictions using DOM methods on the articleWindow
   */function removePageMaxWidth(){if(!appstate.wikimediaZimLoaded||!params.removePageMaxWidth)return;// Note that the UWP app has no access to the content of opened windows, so we can't access the DOM of the articleWindow
  if(/UWP/.test(params.appType)&&appstate.target!=='iframe')return;var contentElement;var updatedCssText;var doc=articleWindow.document;if(!doc||!doc.head||!doc.body)return;var body=doc.body;// Remove max-width: 100ex; from the element's style attribute (in ZIMs from mobile html enpoint)
  if(body.style)body.style.maxWidth='';var cssSource=params.cssSource==='auto'?appstate.zimThemeType:params.cssSource;var padding=window.innerWidth>1012&&params.removePageMaxWidth==='auto'?'1em':cssSource==='desktop'?'1em':'0';var paddingAdded=false;var maxWidth=// If removePageMaxWidth is set to 'always' we just use max comfortable width
  params.removePageMaxWidth===true?window.innerWidth<640?'97%':'96%'// Otherwise we use more responsive settings
  :cssSource==='desktop'?'100%':window.innerWidth>1012?'95%':window.innerWidth<640?'97%':'96%';var maxWidthSet;// Ajust max-width and padding from .mw-page-container
  var mwPageContainer=doc.querySelector('.mw-page-container');if(mwPageContainer){if(!maxWidthSet){mwPageContainer.style.setProperty('max-width',maxWidth,'important');maxWidthSet=true;if(cssSource==='desktop'){mwPageContainer.style.border='1px solid lightgrey';}}padding=paddingAdded?'0':padding;mwPageContainer.style.setProperty('padding',padding);paddingAdded=true;}var contentIdList=['content','bodyContent'];for(var _i=0;_i<contentIdList.length;_i++){contentElement=doc.getElementById(contentIdList[_i]);if(!contentElement)continue;if(!contentElement.style)continue;if(contentElement.className==='mw-body'){contentElement.style.padding=paddingAdded?'0':padding;paddingAdded=true;if(cssSource==='desktop'&&!mwPageContainer){contentElement.style.border='1px solid lightgrey';}}updatedCssText=maxWidthSet?'100%':maxWidth;contentElement.style.maxWidth=updatedCssText;contentElement.style.cssText=contentElement.style.cssText.replace(/max-width:[^;]+/i,'max-width: '+updatedCssText+' !important');if(cssSource=='mobile')contentElement.style.border='0';contentElement.style.margin='0 auto';maxWidthSet=true;}// Remove class key "mw-page-container-inner" from any element with that class (for actionparse ZIMs)
  var actionParseRemoveClasses=['mw-page-container-inner',''];for(i=0;i<actionParseRemoveClasses.length;i++){var mwPageContainerClasses=doc.getElementsByClassName(actionParseRemoveClasses[i]);if(mwPageContainerClasses&&mwPageContainerClasses.length){for(var j=0;j<mwPageContainerClasses.length;j++){mwPageContainerClasses[j].classList.remove(actionParseRemoveClasses[i]);}}}// Ensure .mw-body is displayed with block instead of grid
  var mwBody=doc.querySelector('.mw-body');if(mwBody){mwBody.style.display='block';}// Remove padding from body if it is an article list home page
  if(doc.body&&doc.body.classList.contains('article-list-home')){doc.body.style.padding='0';}}document.getElementById('openAllSectionsCheck').addEventListener('click',function(e){params.openAllSections=this.checked;settingsStore$1.setItem('openAllSections',params.openAllSections,Infinity);if(appstate.selectedArchive){if(!params.openAllSections&&params.displayHiddenBlockElements==='auto'&&appstate.wikimediaZimLoaded){var message='Please note that hidden elements are no-longer displayed in auto mode if "Open all headings" is disabled. Either enable "Open all headings" or set "Display hidden block elements" to "always" if you want to see these anyway.';uiUtil.systemAlert(message);}params.themeChanged=true;}});document.getElementById('linkToWikimediaImageFileCheck').addEventListener('click',function(){params.linkToWikimediaImageFile=this.checked;settingsStore$1.setItem('linkToWikimediaImageFile',this.checked,Infinity);params.themeChanged=true;});document.getElementById('useOSMCheck').addEventListener('click',function(){params.mapsURI=this.checked?'https://www.openstreetmap.org/':'bingmaps:';settingsStore$1.setItem('mapsURI',params.mapsURI,Infinity);params.themeChanged=true;});document.querySelectorAll('input[name=useMathJax]').forEach(function(element){element.addEventListener('click',function(){params.useMathJax=/true/i.test(this.value);settingsStore$1.setItem('useMathJax',params.useMathJax,Infinity);params.themeChanged=true;});});var library=document.getElementById('libraryArea');var unhideArchiveLibraryAnchors=document.getElementsByClassName('unhideLibrary');for(var i=0;i<unhideArchiveLibraryAnchors.length;i++){unhideArchiveLibraryAnchors[i].addEventListener('click',function(){if(!params.showFileSelectors)document.getElementById('displayFileSelectorsCheck').click();library.style.borderColor='red';library.style.borderStyle='solid';});}document.getElementById('downloadTrigger').addEventListener('mousedown',function(){library.style.borderColor='';library.style.borderStyle='';});document.getElementById('displayFileSelectorsCheck').addEventListener('change',function(){params.showFileSelectors=this.checked;document.getElementById('rescanStorage').style.display='block';document.getElementById('openLocalFiles').style.display='none';document.getElementById('hideFileSelectors').style.display=params.showFileSelectors?'block':'none';document.getElementById('downloadLinksText').style.display=params.showFileSelectors?'none':'inline';document.getElementById('usage').style.display=params.showFileSelectors?'none':'inline';if(params.packagedFile&&params.storedFile&&params.storedFile!=params.packagedFile){currentArchiveLink.innerHTML=params.storedFile.replace(/\.zim(\w\w)?$/i,'');currentArchiveLink.dataset.archive=params.storedFile;openCurrentArchive.style.display=params.pickedFile||params.pickedFolder?'none':'';currentArchive.style.display=params.showFileSelectors?'none':'block';document.getElementById('downloadLinksText').style.display=params.showFileSelectors?'none':'block';}settingsStore$1.setItem('showFileSelectors',params.showFileSelectors,Infinity);if(params.showFileSelectors)document.getElementById('configuration').scrollIntoView();});document.addEventListener('DOMContentLoaded',function(){// Set initial behaviour (see also init.js)
  cssUIThemeGetOrSet(params.cssUITheme);// DEV this hides file selectors if it is a packaged file -- add your own packaged file test to regex below
  if(params.packagedFile&&!/wikipedia.en.100|ray.charles/i.test(params.fileVersion)){document.getElementById('packagedAppFileSelectors').style.display='block';document.getElementById('hideFileSelectors').style.display='none';// document.getElementById('downloadLinksText').style.display = "none";
  if(params.showFileSelectors){document.getElementById('hideFileSelectors').style.display='block';document.getElementById('downloadLinksText').style.display='inline';}}// Populate version info
  var versionSpans=document.getElementsByClassName('version');for(var i=0;i<versionSpans.length;i++){versionSpans[i].innerHTML=i?params.appVersion:params.appVersion.replace(/\s+.*$/,'');}if(params.fileVersion&&/UWP|Electron/.test(params.appType)){var packagedInfoParas=document.getElementsByClassName('packagedInfo');var fileVersionDivs=document.getElementsByClassName('fileVersion');for(i=0;i<fileVersionDivs.length;i++){packagedInfoParas[i].style.display='block';fileVersionDivs[i].innerHTML=i?params.fileVersion.replace(/\s+.+$/,''):params.fileVersion;}}var appType=document.getElementById('appType');appType.innerHTML=/^(?=.*PWA).*UWP/.test(params.appType)&&/^https:/i.test(location.protocol)?'UWP (PWA) ':/UWP/.test(params.appType)?'UWP ':window.nw?'NWJS ':/Electron/.test(params.appType)?'Electron ':/PWA/.test(params.appType)?'PWA ':'';// Code below triggers display of modal info box if app is run for the first time, or it has been upgraded to new version
  if(settingsStore$1.getItem('appVersion')!==params.appVersion){//  Update the installed version
  if(settingsStore$1.getItem('PWAInstalled')){params.PWAInstalled=params.appVersion;settingsStore$1.setItem('PWAInstalled',params.PWAInstalled);}// One-time cleanup of idxDB files to delete deprecated databases if possible
  cache.idxDB('deleteNonCurrent',function(result){if(result===false)console.log('Unable to delete old idxDB databases (this is normal in non-Chromium browsers');else console.log('Deleted '+result+' deprecated database(s).');});var noPackagedZIM=document.getElementById('noPackagedZIM');if(params.packagedFile&&/medicine|wikivoyage|mdwiki/i.test(params.packagedFile)){noPackagedZIM.style.display='none';}// We remove splashScreenDismissed from the settingsStore to ensure that the modal is displayed after an autorefresh if user didn't consciously dismiss it
  settingsStore$1.removeItem('splashScreenDismissed');// On some platforms, bootstrap's jQuery functions have not been injected yet, so we have to run in a timeout
  setTimeout(function(){uiUtil.systemAlert(' ','',false,null,null,null,'myModal').then(function(){settingsStore$1.setItem('splashScreenDismissed',true,Infinity);// We need to delay any attempt to launch the UWP Service Worker till after the bootstrap modal is displayed
  // or else app is left in an anomalous situation whereby it's not possible to exit the modal in some cases
  if(appstate.launchUWPServiceWorker){launchUWPServiceWorker();return;}if(params.isUWPStoreApp)return;// It's a UWP app installed from the Store, so it will self update
  if(!params.allowInternetAccess){var updateServer=params.updateServer.url.replace(/^([^:]+:\/\/[^/]+).*/,'$1');uiUtil.systemAlert('<p>Do you want this app to check for updates on startup?<br />(this will allow access to <i>'+updateServer+'</i>)</p>'+'<p><i>If you change your mind, use the <b>"Allow Internet Access"</b> option in Configuration to turn on or off.</i></p>','Updates check disabled!',true).then(function(response){if(response)document.getElementById('allowInternetAccessCheck').click();});}});settingsStore$1.setItem('appVersion',params.appVersion,Infinity);},1000);}else if(appstate.launchUWPServiceWorker){launchUWPServiceWorker();}else {if(!settingsStore$1.getItem('splashScreenDismissed')){// It looks like the user never dismissed the splash screen, so we need to display it
  setTimeout(function(){uiUtil.systemAlert(' ','',false,null,null,null,'myModal').then(function(){settingsStore$1.setItem('splashScreenDismissed',true,Infinity);});},1200);}}});/**
   * Displays or refreshes the API status shown to the user
   */function refreshAPIStatus(){var messageChannelStatus=document.getElementById('messageChannelStatus');var serviceWorkerStatus=document.getElementById('serviceWorkerStatus');var apiStatusPanel=document.getElementById('apiStatusDiv');apiStatusPanel.classList.remove('panel-success','panel-warning','panel-danger');var apiPanelClass='panel-success';if(isMessageChannelAvailable()){messageChannelStatus.textContent='MessageChannel API available';messageChannelStatus.classList.remove('apiAvailable');messageChannelStatus.classList.remove('apiUnavailable');messageChannelStatus.classList.add('apiAvailable');}else {apiPanelClass='panel-warning';messageChannelStatus.textContent='MessageChannel API unavailable';messageChannelStatus.classList.remove('apiAvailable');messageChannelStatus.classList.remove('apiUnavailable');messageChannelStatus.classList.add('apiUnavailable');}if(isServiceWorkerAvailable()){if(isServiceWorkerReady()){serviceWorkerStatus.textContent='ServiceWorker API available, and registered';serviceWorkerStatus.classList.remove('apiAvailable');serviceWorkerStatus.classList.remove('apiUnavailable');serviceWorkerStatus.classList.add('apiAvailable');}else {apiPanelClass='panel-warning';serviceWorkerStatus.textContent='ServiceWorker API available, but not registered';serviceWorkerStatus.classList.remove('apiAvailable');serviceWorkerStatus.classList.remove('apiUnavailable');serviceWorkerStatus.classList.add('apiUnavailable');}}else {apiPanelClass='panel-warning';serviceWorkerStatus.textContent='ServiceWorker API unavailable';serviceWorkerStatus.classList.remove('apiAvailable');serviceWorkerStatus.classList.remove('apiUnavailable');serviceWorkerStatus.classList.add('apiUnavailable');}// Update Settings Store section of API panel with API name
  var settingsStoreStatusDiv=document.getElementById('settingsStoreStatus');var apiName=params.storeType==='cookie'?'Cookie':params.storeType==='local_storage'?'Local Storage':'None';settingsStoreStatusDiv.innerHTML='Settings Storage API in use: '+apiName;settingsStoreStatusDiv.classList.remove('apiAvailable','apiUnavailable');settingsStoreStatusDiv.classList.add(params.storeType==='none'?'apiUnavailable':'apiAvailable');apiPanelClass=params.storeType==='none'?'panel-warning':apiPanelClass;// Update Decompressor API section of panel
  var decompAPIStatusDiv=document.getElementById('decompressorAPIStatus');apiName=params.useLibzim?'LIBZIM':params.decompressorAPI.assemblerMachineType;if(apiName&&params.decompressorAPI.decompressorLastUsed){apiName+=' [&nbsp;'+(params.useLibzim?params.debugLibzimASM||'default':params.decompressorAPI.decompressorLastUsed)+'&nbsp;]';}apiPanelClass=params.decompressorAPI.errorStatus?'panel-danger':apiName?apiPanelClass:'panel-warning';decompAPIStatusDiv.className=apiName?params.decompressorAPI.errorStatus?'apiBroken':'apiAvailable':'apiUnavailable';apiName=params.decompressorAPI.errorStatus||apiName||'Not initialized';decompAPIStatusDiv.innerHTML='Decompressor API: '+apiName;// Update Search Provider
  uiUtil.reportSearchProviderToAPIStatusPanel(params.searchProvider);// Update PWA origin
  var pwaOriginStatusDiv=document.getElementById('pwaOriginStatus');pwaOriginStatusDiv.className='apiAvailable';pwaOriginStatusDiv.innerHTML='PWA Origin: '+window.location.origin;// Add a warning colour to the API Status Panel if any of the above tests failed
  apiStatusPanel.classList.add(apiPanelClass);// Set visibility of UI elements according to mode
  document.getElementById('bypassAppCacheDiv').style.display=params.contentInjectionMode==='serviceworker'?'block':'none';// Set colour of contentInjectionMode div
  var contentInjectionDiv=document.getElementById('contentInjectionModeDiv');contentInjectionDiv.classList.remove('parnel-warning');contentInjectionDiv.classList.remove('panel-danger');if(params.contentInjectionMode==='serviceworker')contentInjectionDiv.classList.add('panel-warning');else contentInjectionDiv.classList.add('panel-danger');refreshCacheStatus();}/**
   * Refreshes the UI (Configuration) with the cache attributes obtained from getCacheAttributes()
   */function refreshCacheStatus(){// Update radio buttons and checkbox
  document.getElementById('cachedAssetsModeRadio'+(params.assetsCache?'True':'False')).checked=true;// Get cache attributes, then update the UI with the obtained data
  cache.count(function(c){document.getElementById('cacheUsed').innerHTML=c.description;document.getElementById('assetsCount').innerHTML=c.count;var cacheSettings=document.getElementById('performanceSettingsDiv');var cacheStatusPanel=document.getElementById('cacheStatusPanel');[cacheSettings,cacheStatusPanel].forEach(function(card){// IE11 cannot remove more than one class from a list at a time
  card.classList.remove('panel-warning');card.classList.remove('panel-danger');if(params.assetsCache)card.classList.add('panel-warning');else card.classList.add('panel-danger');});});if(params.appCache){scrollbox.style.removeProperty('background');prefix.style.removeProperty('background');}else {scrollbox.style.background=/^dark/.test(document.body.className)?'#300000':'mistyrose';prefix.style.setProperty('background',/^dark/.test(document.body.className)?'#200000':'lavenderblush','important');}var expertSettings=document.getElementById('expertSettingsDiv');expertSettings.classList.remove('panel-warning');expertSettings.classList.remove('panel-danger');if(!params.appCache||params.hideActiveContentWarning||params.debugLibzimASM||params.useLibzim||params.useLegacyZimitSupport){expertSettings.classList.add('panel-danger');}else {expertSettings.classList.add('panel-warning');}}var serviceWorkerRegistration=null;/**
   * Sends an 'init' message to the ServiceWorker and inititalizes the onmessage event
   * It is called when the Service Worker is first activated, and also when a new archive is loaded
   * When a message is received, it will provide a MessageChannel port to respond to the ServiceWorker
   */function initServiceWorkerMessaging(){if(!(isServiceWorkerAvailable()&&isMessageChannelAvailable())){console.warn('Cannot initiate ServiceWorker messaging, because one or more API is unavailable!');return;}navigator.serviceWorker.onmessage=function(event){if(event.data.error){console.error('Error in MessageChannel',event.data.error);throw event.data.error;}else if(event.data.action==='acknowledge'){// The Service Worker is acknowledging receipt of init message
  console.log('SW acknowledged init message');serviceWorkerRegistration=true;refreshAPIStatus();}else if(event.data.action==='askForContent'){// The Service Worker is asking for content. Check we have a loaded ZIM in this instance.
  // DEV: This can happen if there are various instances of the app open in different tabs or windows, and no archive has been selected in this instance.
  if(!appstate.selectedArchive){console.warn('Message from SW received, but no archive is selected!');return;}// See below for explanation of this exception
  var videoException=appstate.selectedArchive.zimType==='zimit'&&/\/\/youtubei.*player/.test(event.data.title);// Check that the zimFileId in the messageChannel event data is the same as the one in the currently open archive
  // Because the SW broadcasts its request to all open tabs or windows, we need to check that the request is for this instance
  if(event.data.zimFileName!==appstate.selectedArchive.file.name&&!videoException);else {if(videoException){// DEV: This is a hack to allow YouTube videos to play in Zimit archives:
  // Because links are embedded in a nested iframe, the SW cannot identify the top-level window from which to request the ZIM content
  // Until we find a way to tell where it is coming from, we allow the request through on all controlled clients and try to load the content
  console.warn('>>> Allowing passthrough of SW request to process Zimit video <<<');}if(params.useLibzim){handleMessageChannelForLibzim(event);}else {handleMessageChannelMessage(event);}}}else if(event.data.msg_type){// Messages received from the ReplayWorker
  if(event.data.msg_type==='colAdded'){console.debug('ReplayWorker added a collection');}}else {console.error('Invalid message received',event.data);}};// Send the init message to the ServiceWorker
  if(navigator.serviceWorker.controller){console.log('Initializing SW messaging...');navigator.serviceWorker.controller.postMessage({action:'init'});}else if(serviceWorkerRegistration){// If this is the first time we are initiating the SW, allow Promises to complete by delaying potential reload till next tick
  console.warn('The Service Worker needs more time to load, or else the app was force-refreshed...');serviceWorkerRegistration=null;setTimeout(initServiceWorkerMessaging,3000);}else if(params.contentInjectionMode==='serviceworker'){console.error('The Service Worker is not controlling the current page! We have to reload.');// Turn off failsafe, as this is a controlled reboot
  settingsStore$1.setItem('lastPageLoad','rebooting',Infinity);if(!appstate.preventAutoReboot)window.location.reload();}else if(/^https/.test(window.location.protocol)&&navigator&&navigator.serviceWorker&&!navigator.serviceWorker.controller){if(!params.noPrompts){uiUtil.systemAlert('<p>No Service Worker is registered, meaning this app will not currently work offline!</p><p>Would you like to switch to ServiceWorker mode?</p>','Offline use is disabled!',true).then(function(response){if(response){setContentInjectionMode('serviceworker');if(appstate.selectedArchive){setTimeout(function(){params.themeChanged=true;document.getElementById('btnHome').click();},800);}}});}}}/**
   * Sets the given injection mode.
   * This involves registering (or re-enabling) the Service Worker if necessary
   * It also refreshes the API status for the user afterwards.
   *
   * @param {String} value The chosen content injection mode : 'jquery' or 'serviceworker'
   */function setContentInjectionMode(value){params.contentInjectionMode=value;if(value==='jquery'){// Because the Service Worker must still run in a PWA app so that it can work offline, we don't actually disable the SW in this context,
  // but it will no longer be intercepting requests for ZIM assets (only requests for the app's own code)
  if('serviceWorker'in navigator){serviceWorkerRegistration=null;}// User has switched to Restricted mode, so no longer needs ASSETS_CACHE on SW side (it will still be used app-side)
  // if ('caches' in window && isMessageChannelAvailable()) {
  //     if (isServiceWorkerAvailable() && navigator.serviceWorker.controller) {
  //         var channel = new MessageChannel();
  //         navigator.serviceWorker.controller.postMessage({
  //             action: { assetsCache: 'disable' }
  //         }, [channel.port2]);
  //     }
  //     caches.delete(cache.ASSETS_CACHE);
  // }
  refreshAPIStatus();}else if(value==='serviceworker'){if(!isServiceWorkerAvailable()){uiUtil.systemAlert('The ServiceWorker API is not available on your device. Falling back to Restricted mode').then(function(){setContentInjectionMode('jquery');});return;}if(!isMessageChannelAvailable()){uiUtil.systemAlert('The MessageChannel API is not available on your device. Falling back to Restricted mode').then(function(){setContentInjectionMode('jquery');});return;}if(window.nw&&nw.process.versions.nw==='0.14.7'){uiUtil.systemAlert('Service Worker mode is not available in the XP version of this app, due to the age of the Chromium build. Falling back to Restricted mode...').then(function(){setContentInjectionMode('jquery');});return;}// Reset params.assetsCache in case it was changed when loading a Zimit ZIM in Restricted mode
  params.assetsCache=settingsStore$1.getItem('assetsCache')!=='false';if(!isServiceWorkerReady()){var serviceWorkerStatus=document.getElementById('serviceWorkerStatus');serviceWorkerStatus.textContent='ServiceWorker API available : trying to register it...';if(navigator.serviceWorker.controller){console.log('Active Service Worker found, no need to register');serviceWorkerRegistration=true;// Remove any jQuery hooks from a previous jQuery session
  while(articleContainer$1.firstChild){articleContainer$1.removeChild(articleContainer$1.firstChild);}// Create the MessageChannel and send 'init'
  // initOrKeepAliveServiceWorker();
  refreshAPIStatus();}else {navigator.serviceWorker.register('../service-worker.js').then(function(reg){var _this=this;// The ServiceWorker is registered
  console.log('Service worker is registered with a scope of '+reg.scope);serviceWorkerRegistration=reg;// Process registration waiting for immediate load
  // navigator.serviceWorker.ready.then(registration => {
  //     if (registration.waiting) {
  //         registration.waiting.postMessage('skipWaiting');
  //     }
  // });
  // Controller change listener to reload the page
  navigator.serviceWorker.addEventListener('controllerchange',function(){_newArrowCheck(this,_this);window.location.reload();}.bind(this));// We need to wait for the ServiceWorker to be activated
  // before sending the first init message
  var serviceWorker=reg.installing||reg.waiting||reg.active;serviceWorker.addEventListener('statechange',function(statechangeevent){if(statechangeevent.target.state==='activated'){// Remove any jQuery hooks from a previous jQuery session
  while(articleContainer$1.firstChild){articleContainer$1.removeChild(articleContainer$1.firstChild);}// Create the MessageChannel and send the 'init' message to the ServiceWorker
  // initOrKeepAliveServiceWorker();
  // We need to refresh cache status here on first activation because SW was inaccessible till now
  // We also initialize the ASSETS_CACHE constant in SW here
  refreshCacheStatus();setWindowOpenerUI();refreshAPIStatus();}});if(serviceWorker.state==='activated');refreshAPIStatus();}).catch(function(err){console.error('Error while registering serviceWorker',err);refreshAPIStatus();var message='The ServiceWorker could not be properly registered. Switching back to Restricted mode. Error message : '+err;var protocol=window.location.protocol;if(protocol==='ms-appx-web:'){// We can't launch straight away if the app is starting, because the large modal could be showing
  if(params.appIsLaunching){appstate.launchUWPServiceWorker=true;}else {launchUWPServiceWorker();}message='';}else if(protocol==='moz-extension:'){message+='\n\nYou seem to be using kiwix-js through a Firefox extension : ServiceWorkers are disabled by Mozilla in extensions.';message+='\nPlease vote for https://bugzilla.mozilla.org/show_bug.cgi?id=1344561 so that some future Firefox versions support it';}else if(protocol==='file:'){message+='\n\nYou seem to be opening kiwix-js with the file:// protocol. You should open it through a web server : either through a local one (http://localhost/...) or through a remote one (but you need SSL : https://webserver/...)';}appstate.preventAutoReboot=true;if(message)uiUtil.systemAlert(message,'Information');setContentInjectionMode('jquery');});}}else {// We need to set this variable earlier else the Service Worker does not get reactivated
  params.contentInjectionMode=value;// initOrKeepAliveServiceWorker();
  }}var radioButtons=document.querySelectorAll('input[name=contentInjectionMode]');radioButtons.forEach(function(button){button.checked=false;if(button.value===value){button.checked=true;}});// Save the value in the Settings Store, so that to be able to keep it after a reload/restart
  settingsStore$1.setItem('contentInjectionMode',value,Infinity);setWindowOpenerUI();// Even in Restricted mode, the PWA needs to be able to serve the app in offline mode
  setTimeout(initServiceWorkerMessaging,3000);}/**
   * Detects whether the ServiceWorker API is available
   * https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker
   * @returns {Boolean}
   */function isServiceWorkerAvailable(){return 'serviceWorker'in navigator;}/**
   * Detects whether the MessageChannel API is available
   * https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel
   * @returns {Boolean}
   */function isMessageChannelAvailable(){try{var dummyMessageChannel=new MessageChannel();if(dummyMessageChannel)return true;}catch(e){return false;}return false;}/**
   * Tells if the ServiceWorker is registered, and ready to capture HTTP requests
   * and inject content in articles.
   * @returns {Boolean}
   */function isServiceWorkerReady(){// Return true if the serviceWorkerRegistration is not null and not undefined
  return serviceWorkerRegistration;}function launchUWPServiceWorker(){delete appstate.launchUWPServiceWorker;var message='<p>To enable the Service Worker, we need one-time access to our secure server '+'so that the app can re-launch as a Progressive Web App (PWA).</p>'+'<p>The PWA will be able to run offline, but will auto-update periodically when online '+'as per the Service Worker spec.</p>'+'<p>You can switch back any time by toggling <i>Allow Internet access?</i> off.</p>'+'<p><b>WARNING:</b> This will attempt to access the following server: <i>'+params.PWAServer+'</i></p>'+'<p><b>*** Screen may flash between black and white. ***</b></p>'+'<p>Note: If the app crashes, simply relaunch it.</p>';var launchPWA=function launchPWA(){settingsStore$1.setItem('contentInjectionMode','serviceworker',Infinity);// This is needed so that we get passthrough on subsequent launches
  settingsStore$1.setItem('allowInternetAccess',true,Infinity);var uriParams='?allowInternetAccess=true';// We are using allowInternetAccess as a passthrough, so we don't force a switch to SW mode on the server
  // except on first launch of SW mode
  uriParams+=params.allowInternetAccess?'':'&contentInjectionMode=serviceworker';uriParams+='&manipulateImages=false&allowHTMLExtraction=false';// Commented line below causes crash if there are too many archives
  // uriParams += '&listOfArchives=' + encodeURIComponent(settingsStore.getItem('listOfArchives'));
  uriParams+='&lastSelectedArchive='+encodeURIComponent(params.storedFile);uriParams+=params.packagedFile?'&packagedFile='+encodeURIComponent(params.packagedFile):'';uriParams+=params.fileVersion?'&fileVersion='+encodeURIComponent(params.fileVersion):'';// Signal failure of PWA until it has successfully launched (in init.js it will be changed to 'success')
  params.localUWPSettings.PWA_launch='fail';window.location.href=params.PWAServer+'www/index.html'+uriParams;// throw 'Beam me up, Scotty!';
  };var checkPWAIsOnline=function checkPWAIsOnline(){uiUtil.checkServerIsAccessible(params.PWAServer+'www/img/icons/kiwix-32.png',launchPWA,function(){uiUtil.systemAlert('<p>The server is not currently accessible!</p>'+'<p>(Kiwix needs one-time access to the server to cache the PWA).</p>'+'<p>Please try again when you have a stable Internet connection.</p>','Error!');});};if(settingsStore$1.getItem('allowInternetAccess')==='true'&&params.localUWPSettings.PWA_launch&&params.localUWPSettings.PWA_launch!=='fail'){if(params.localUWPSettings.PWA_launch==='success')launchPWA();else checkPWAIsOnline();}else {if(params.localUWPSettings.PWA_launch==='fail'){message='<p>The PWA MAY have failed to launch on the last attempt '+'(we show this information to prevent a boot loop).</p>'+'<p>Please try again by selecting "Access server":</p>';}uiUtil.systemAlert(message,'Information',true,'Cancel','Access server').then(function(confirm){if(confirm)launchPWA();else {var allowAccessCheck=document.getElementById('allowInternetAccessCheck');if(allowAccessCheck.checked)allowAccessCheck.click();}});}}/**
   *
   * @type Array.<StorageFirefoxOS>
   */var storages=[];function searchForArchivesInPreferencesOrStorage(displayOnly){// First see if the list of archives is stored in the cookie
  var listOfArchivesFromCookie=settingsStore$1.getItem('listOfArchives');if(listOfArchivesFromCookie){var directories=listOfArchivesFromCookie.split('|');populateDropDownListOfArchives(directories,displayOnly);}else {if(storages.length||params.localStorage){searchForArchivesInStorage();}else {displayFileSelect();if(document.getElementById('archiveFiles').files&&document.getElementById('archiveFiles').files.length>0){// Archive files are already selected,
  setLocalArchiveFromFileSelect();}else {var btnConfigure=document.getElementById('btnConfigure');if(!btnConfigure.classList.contains('active'))btnConfigure.click();}}}}function searchForArchivesInStorage(){// If DeviceStorage is available, we look for archives in it
  document.getElementById('btnConfigure').click();if(params.localStorage&&typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'){scanUWPFolderforArchives(params.localStorage);}else {zimArchiveLoader.scanForArchives(storages,populateDropDownListOfArchives,function(){// callbackError function is called in case of an error
  uiUtil.systemAlert().then(populateDropDownListOfArchives(null));});}}// Check if there are files in the launch queue to be handled by the File Handling API
  if('launchQueue'in window&&'files'in LaunchParams.prototype){console.log('File Handling API is available');launchQueue.setConsumer(function(launchParams){// Nothing to do when the queue is empty.
  if(!launchParams.files.length){console.debug('Launch Queue is empty');}else {// User launched app by double-clicking on file
  console.debug('Processing NativeFileHandle for '+launchParams);// Turn off OPFS if it is on, because we are using the File Handling API instead
  params.useOPFS=false;params.pickedFolder='';params.storedFile='';setOPFSUI();processNativeFileHandle(launchParams.files[0]);}});}// @STORAGE AUTOLOAD STARTS HERE
  if(navigator.getDeviceStorages&&typeof navigator.getDeviceStorages==='function'){// The method getDeviceStorages is available (FxOS>=1.1)
  storages=Array.from(navigator.getDeviceStorages('sdcard')).map(function(s){return new abstractFilesystemAccess.StorageFirefoxOS(s);});}if(storages!==null&&storages.length>0||typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'||typeof window.fs!=='undefined'||typeof window.showOpenFilePicker==='function'||params.webkitdirectory||params.useOPFS){if(window.fs&&!(params.pickedFile||params.pickedFolder)){// Below we compare the prefix of the files, i.e. the generic filename without date, so we can smoothly deal with upgrades
  if(params.packagedFile&&params.storedFile.replace(/(^[^-]+all).+/,'$1')===params.packagedFile.replace(/(^[^-]+all).+/,'$1')){// We're in Electron / NWJS and we need to load the packaged app, so we are forced to use the .fs code
  params.pickedFile=params.packagedFile;params.storedFile=params.packagedFile;}else if(!params.storedFile){// If there is no last selected archive, we need to use the .fs code anyway
  params.pickedFile=params.packagedFile;}else if(/\/archives\//.test(params.storedFilePath)&&~params.storedFilePath.indexOf(params.storedFile)){// We're in an Electron / NWJS app, and there is a stored file in the archive, but it's not the packaged archive!
  // Probably there is more than one archive in the archive folder, so we are forced to use .fs code
  console.warn('There may be more than one archive in the directory '+params.storedFilePath.replace(/[^\\/]+$/,''));params.pickedFile=params.storedFile;}}if(!params.pickedFile&&!params.pickedFolder||params.useOPFS){var btnConfigure=document.getElementById('btnConfigure');// If we are using OPFS, we should can load the entries directly
  if(params.useOPFS){if(!params.storedFile)btnConfigure.click();loadOPFSDirectory();}else if(params.storedFile&&navigator&&navigator.storage&&'getDirectory'in navigator.storage){getNativeFSHandle();}else {// We are in an app that cannot open files auotomatically, so populate archive list and show file pickers
  document.getElementById('btnRescanDeviceStorage').click();btnConfigure.click();searchForArchivesInPreferencesOrStorage(true);}}else if(typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'){console.log('Loading picked file for UWP app...');if(params.pickedFile)processPickedFileUWP(params.pickedFile);else searchForArchivesInPreferencesOrStorage();}else if(!window.fs){// This should run, e.g., if we have params.webkitdirectory but not windows.fs, and also if we're using legacy file picking
  searchForArchivesInPreferencesOrStorage(true);// If we're not in Configuration, click
  btnConfigure=document.getElementById('btnConfigure');if(!btnConfigure.classList.contains('active'))btnConfigure.click();}else {// @AUTOLOAD packaged archive in Electron and NWJS packaged apps
  // We need to read the packaged file using the node File System API (so user doesn't need to pick it on startup)
  console.log('Loading packaged ZIM or last selected archive for Electron or NWJS...');// If we're in an AppImage package and the storedFilePath points to the packaged archive, then the storedFilePath will be invalid,
  // because a new path is established each time the image's filesystem is mounted. So we reset to default.
  var archiveFilePath=params.storedFilePath;if(params.storedFile===params.packagedFile){// If the app is packed inside an asar archive, or is Electron running from localhost, we need to alter the archivePath to point outside the asar directory
  if(window.electronAPI&&window.electronAPI.__dirname){archiveFilePath=electronAPI.__dirname.replace(/[/\\]app\.asar/,'');}archiveFilePath=archiveFilePath+'/'+params.archivePath+'/'+params.packagedFile;if(~params.storedFilePath.indexOf(archiveFilePath)){params.storedFilePath=archiveFilePath;}}var archiveDirectory=archiveFilePath.replace(/[\\/][^\\/]+$/,'');readNodeDirectoryAndCreateNodeFileObjects(archiveDirectory,params.storedFile).then(function(archiveFiles){var pickedFileset=archiveFiles[0],archivesInFolder=archiveFiles[1];params.pickedFolder=archiveDirectory;params.pickedfile='';setLocalArchiveFromFileList(pickedFileset);if(!params.rescan)populateDropDownListOfArchives(archivesInFolder,true);document.getElementById('hideFileSelectors').style.display=params.showFileSelectors?'inline':'none';}).catch(function(err){console.error('There was an error reading the directory!',err);// Attempts to load the file seem to have failed: maybe it has moved or been deleted
  // Let's see if we can open the packaged ZIM instead (if this isn't the packaged ZIM)
  settingsStore$1.removeItem('lastSelectedArchive');settingsStore$1.removeItem('lastSelectedArchivePath');if(params.packagedFile&&params.storedFile!==params.packagedFile){createFakeFileObjectNode(params.packagedFile,params.archivePath+'/'+params.packagedFile,function(fakeFileList){var fakeFile=fakeFileList[0];if(fakeFile&&fakeFile.size){params.pickedFile=fakeFile;setLocalArchiveFromFileList([params.pickedFile]);}else {// This shouldn't happen!
  params.showFileSelectors=true;document.getElementById('hideFileSelectors').style.display='inline';document.getElementById('btnConfigure').click();setTimeout(function(){uiUtil.systemAlert('The packaged file cannot be loaded!\nPlease check that it is in the "'+params.archivePath+'" folder\nor pick a new ZIM file.');},10);}});}else {params.showFileSelectors=true;document.getElementById('hideFileSelectors').style.display='inline';document.getElementById('btnConfigure').click();var message=params.packagedFile?'The packaged file cannot be found!\nPlease check that it is in the "'+params.archivePath+'" folder\nor pick a new ZIM file.':'The previously picked file cannot be found!\nPlease pick a new ZIM file.';setTimeout(function(){uiUtil.systemAlert(message);},10);}});document.getElementById('hideFileSelectors').style.display=params.showFileSelectors?'inline':'none';}}else {// If DeviceStorage is not available, we display the file select components
  document.getElementById('btnRescanDeviceStorage').click();if(document.getElementById('archiveFilesLegacy').files&&document.getElementById('archiveFilesLegacy').files.length>0){// Archive files are already selected,
  setLocalArchiveFromFileSelect();}else {document.getElementById('btnConfigure').click();searchForArchivesInPreferencesOrStorage(true);}}// Display the article when the user goes back in the browser history
  var historyPop=function historyPop(event){if(event.state){var title=event.state.title;var titleSearch=event.state.titleSearch;appstate.target=event.target.kiwixType;// Select the correct window to which to write the popped history in case the user
  // siwtches to a tab and navigates history without first clicking on a link
  if(appstate.target==='window')articleWindow=event.target;prefix.value='';document.getElementById('welcomeText').style.display='none';uiUtil.clearSpinner();document.getElementById('configuration').style.display='none';document.getElementById('articleListWithHeader').style.display='none';var articleContent=document.getElementById('articleContent');var articleContentDoc=articleContent?articleContent.contentDocument:null;while(articleContentDoc.firstChild)articleContentDoc.removeChild(articleContentDoc.firstChild);if(title&&!(title==='')){goToArticle(title);}else if(titleSearch&&titleSearch!==''){prefix.value=titleSearch;if(titleSearch!==appstate.search.prefix){searchDirEntriesFromPrefix(titleSearch);}else {prefix.focus();}}}};window.onpopstate=historyPop;/**
   * Populate the drop-down list of archives with the given list
   * @param {Array.<String>} archiveDirectories
   */function populateDropDownListOfArchives(archiveDirectories,displayOnly){document.getElementById('chooseArchiveFromLocalStorage').style.display='';document.getElementById('rescanStorage').style.display=params.rescan?'none':'block';document.getElementById('openLocalFiles').style.display=params.rescan?'block':'none';var plural='s';plural=archiveDirectories.length===1?'':plural;document.getElementById('archiveNumber').innerHTML='<b>'+archiveDirectories.length+'</b> Archive'+plural+' found in selected location';var usage=document.getElementById('usage');archiveList.options.length=0;for(var i=0;i<archiveDirectories.length;i++){var archiveDirectory=archiveDirectories[i];if(archiveDirectory==='/'){uiUtil.systemAlert('It looks like you have put some archive files at the root of your sdcard (or internal storage). Please move them in a subdirectory');}else {archiveList.options[i]=new Option(archiveDirectory,archiveDirectory);}}// Store the list of archives in settingsStore, to avoid rescanning at each start
  settingsStore$1.setItem('listOfArchives',archiveDirectories.join('|'),Infinity);if(!/Android|iOS/.test(params.appType)){archiveList.size=archiveList.length>15?15:archiveList.length;if(archiveList.length>1)archiveList.removeAttribute('multiple');if(archiveList.length===1)archiveList.setAttribute('multiple','1');}if(archiveList.options.length>0){// If we're doing a rescan, then don't attempt to jump to the last selected archive, but leave selectors open
  var lastSelectedArchive=params.rescan?'':params.storedFile;if(lastSelectedArchive){// console.debug('Last selected archive: ' + lastSelectedArchive);
  // Attempt to select the corresponding item in the list, if it exists
  var success=false;var arrayOfOptionValues=Array.apply(null,archiveList.options).map(function(el){return el.text;});// console.debug('Archive list: ' + arrayOfOptionValues);
  if(~arrayOfOptionValues.indexOf(lastSelectedArchive)){archiveList.value=lastSelectedArchive;success=true;settingsStore$1.setItem('lastSelectedArchive',lastSelectedArchive,Infinity);}if(displayOnly)return;// Set the localArchive as the last selected (if none has been selected previously, wait for user input)
  if(success){setLocalArchiveFromArchiveList(lastSelectedArchive);}else {// We can't find lastSelectedArchive in the archive list
  // Warn user that the file they wanted is no longer available
  var message='<p>We could not find the archive <b>'+lastSelectedArchive+'</b>!</p><p>Please select its location...</p>';if(params.webkitdirectory&&!window.fs||typeof Windows!=='undefined'&&typeof Windows.Storage!=='undefined'){message+='<p><i>Note:</i> If you drag-drop '+(window.showOpenFilePicker?'a <b>split</b>':'an')+' archive into this app, then it will have to be dragged again each time you launch the app. Try ';message+=typeof Windows!=='undefined'?'double-clicking on the archive instead, or ':'';message+='selecting it using the controls on this page.</p>';}if(document.getElementById('configuration').style.display==='none'){document.getElementById('btnConfigure').click();}uiUtil.systemAlert(message).then(function(){displayFileSelect();});}}usage.style.display='none';}else {usage.style.display='block';// No ZIM files, so if Configuration is not displayed, display it and open file selectors
  setTimeout(function(){if(document.getElementById('configuration').style.display==='none'){document.getElementById('btnConfigure').click();}displayFileSelect();},250);}}/**
   * Sets the localArchive from the selected archive in the drop-down list
   */function setLocalArchiveFromArchiveList(archive){params.rescan=false;archive=archive||document.getElementById('archiveList').value;if(archive&&archive.length>0){// Now, try to find which DeviceStorage has been selected by the user
  // It is the prefix of the archive directory
  var regexpStorageName=/^\/([^/]+)\//;var regexpResults=regexpStorageName.exec(archive);var selectedStorage=null;if(regexpResults&&regexpResults.length>0){var selectedStorageName=regexpResults[1];for(var i=0;i<storages.length;i++){var storage=storages[i];if(selectedStorageName===storage.storageName){// We found the selected storage
  selectedStorage=storage;}}if(selectedStorage===null){uiUtil.systemAlert('Unable to find which device storage corresponds to archive '+archive);}}else {// This happens when the archive is not prefixed by the name of the storage
  // (in the Simulator, or with FxOs 1.0, or probably on devices that only have one device storage)
  // In this case, we use the first storage of the list (there should be only one)
  if(storages.length===1){selectedStorage=storages[0];}else {// IT'S NOT FREAKIN FFOS!!!!!!!!!!
  // Patched for UWP support:
  if(!params.pickedFile&&params.pickedFolder&&typeof MSApp!=='undefined'){var query=params.pickedFolder.createFileQuery();query.getFilesAsync().done(function(files){var file;var fileset=[];if(files){for(var i=0;i<files.length;i++){if(files[i].name==archive){file=files[i];break;}}if(file){if(/\.zim\w\w$/i.test(file.name)){var genericFileName=file.name.replace(/(\.zim)\w\w$/i,'$1');var testFileName=new RegExp(genericFileName+'\\w\\w$');for(i=0;i<files.length;i++){if(testFileName.test(files[i].name)){// This converts a UWP storage file object into a standard JavaScript web file object
  fileset.push(MSApp.createFileFromStorageFile(files[i]));}}}else {// This converts a UWP storage file object into a standard JavaScript web file object
  fileset.push(MSApp.createFileFromStorageFile(file));}}}if(fileset.length){setLocalArchiveFromFileList(fileset,true);}else {console.error('The picked file could not be found in the selected folder!\n'+params.pickedFile);var archiveList=[];for(i=0;i<files.length;i++){if(/\.zim(aa)?$/i.test(files[i].name)){archiveList.push(files[i].name);}}populateDropDownListOfArchives(archiveList);document.getElementById('btnConfigure').click();}});return;}else if(!params.pickedFile&&params.pickedFolder&&params.pickedFolder.kind){// Native FS support
  return cache.verifyPermission(params.pickedFolder).then(function(permission){if(!permission){console.log('User denied permission to access the folder');openCurrentArchive.style.display='inline';return;}else if(params.pickedFolder.kind==='directory'){return processNativeDirHandle(params.pickedFolder,function(files){processDirectoryOfFiles(files,archive);});}openCurrentArchive.style.display='none';}).catch(function(){openCurrentArchive.style.display='inline';});}else if(window.fs){if(params.pickedFile){setLocalArchiveFromFileList([params.pickedFile],true);}else {if(params.pickedFolder){readNodeDirectoryAndCreateNodeFileObjects(params.pickedFolder,archive).then(function(fileset){var selectedFiles=fileset[0];if(appstate.selectedArchive&&appstate.selectedArchive.file._files[0].name===selectedFiles[0].name){document.getElementById('btnHome').click();}else {setLocalArchiveFromFileList(selectedFiles);}}).catch(function(err){console.error(err);});}else {// If we are here, it means that the user has not selected a file or folder
  // or else that a user gesture is needed to access the file system (this happens with recent versions of Electron)
  if(!window.fs){uiUtil.systemAlert('We could not find the location of the file '+archive+'. This can happen if you dragged and dropped a file into the app. Please use the file or folder pickers instead.');}if(document.getElementById('configuration').style.display==='none'){document.getElementById('btnConfigure').click();}displayFileSelect();}}return;}else if(params.pickedFolder&&params.webkitdirectory||archiveDirLegacy.files.length){processDirectoryOfFiles(archiveDirLegacy.files,archive);return;}else {// Check if user previously picked a specific file rather than a folder
  if(params.pickedFile&&typeof MSApp!=='undefined'){try{selectedStorage=MSApp.createFileFromStorageFile(params.pickedFile);setLocalArchiveFromFileList([selectedStorage],true);}catch(err){// Probably user has moved or deleted the previously selected file
  uiUtil.systemAlert('The previously picked archive can no longer be found!');console.error('Picked archive not found: '+err);}return;}else if(params.pickedFile&&typeof window.showOpenFilePicker==='function'){// Native FS API for single file
  setLocalArchiveFromFileList([params.pickedFile],true);return;}else if(params.pickedFile&&params.webkitdirectory){// Webkitdirectory API for single file
  setLocalArchiveFromFileList(archiveFilesLegacy.files,true);return;}}// There was no picked file or folder, so we'll try setting the default localStorage
  // if (!params.pickedFolder) {
  // This gets called, for example, if the picked folder or picked file are in FutureAccessList but now are
  // no longer accessible. There will be a (handled) error in cosole log, and params.pickedFolder and params.pickedFile will be blank
  if(params.localStorage){scanUWPFolderforArchives(params.localStorage);}else if(params.pickedFile&&params.pickedFile.name){// We already have a file handle, which means the file is already loaded or can be loaded
  if(!appstate.selectedArchive){setLocalArchiveFromFileList([params.pickedFile],true);}else {document.getElementById('btnHome').click();}}else if(archiveFilesLegacy.files.length){// There are files already loaded, so see if the selected file is one of those
  setLocalArchiveFromFileList(archiveFilesLegacy.files,true);}else {var btnConfigure=document.getElementById('btnConfigure');if(!btnConfigure.classList.contains('active'))btnConfigure.click();document.getElementById('archiveFile').click();}return;// }
  }}// Show spinner with archive name
  uiUtil.pollSpinner('Loading '+archive+'...',true);zimArchiveLoader.loadArchiveFromDeviceStorage(selectedStorage,archive,archiveReadyCallback,function(message,label){// callbackError which is called in case of an error
  uiUtil.systemAlert(message,label);});}}/**
   * Processes all the given fileHandles (which should be the fileHandles of the ZIM files in a directory) and matches them to the requested archive.
   * In particular, it deals with split archives, gathering all the file parts. Intended for use with the File System API.
   *
   * @param {Array<FileSystemHandle>} fileHandles A set of fileHandles in a directory
   * @param {String} archive The name of the archive to be loaded, or of the first split part (.zimaa)
   */function processDirectoryOfFiles(fileHandles,archive){var fileHandle;var fileset=[];if(fileHandles){for(var i=0;i<fileHandles.length;i++){if(fileHandles[i].name===archive){fileHandle=fileHandles[i];break;}}if(fileHandle){// Deal with split archives
  if(/\.zim\w\w$/i.test(fileHandle.name)){var genericFileName=fileHandle.name.replace(/(\.zim)\w\w$/i,'$1');var testFileName=new RegExp(genericFileName+'\\w\\w$');for(i=0;i<fileHandles.length;i++){if(testFileName.test(fileHandles[i].name)){if(fileHandles[i].getFile){// This gets a JS File object from a file handle
  fileset.push(fileHandles[i].getFile().then(function(file){return file;}));}else {fileset.push(fileHandles[i]);}}}}else {// Deal with single unslpit archive
  if(fileHandle.getFile){fileset.push(fileHandle.getFile().then(function(file){return file;}));}else {fileset.push(fileHandle);}}if(fileset.length){// Wait for all getFile Promises to resolve
  Promise.all(fileset).then(function(resolvedFiles){setLocalArchiveFromFileList(resolvedFiles,true);});}else {console.error('There was an error reading the picked file(s)!');}}else {console.error('The picked file could not be found in the selected folder!');var archiveList=[];for(i=0;i<fileHandles.length;i++){if(/\.zim(aa)?$/i.test(fileHandles[i].name)){archiveList.push(fileHandles[i].name);}}populateDropDownListOfArchives(archiveList);document.getElementById('btnConfigure').click();}}else {console.log('There was an error obtaining the file handle(s).');}}/**
   * Displays the zone to select files from the archive
   */function displayFileSelect(){document.getElementById('openLocalFiles').style.display='block';document.getElementById('rescanStorage').style.display='none';}/** Drag and Drop handling for ZIM files (see kiwix-js#1245 by @D3V-D) **/// Set a global drop zone, so that whole page is enabled for drag and drop
  var globalDropZone=document.getElementById('search-article');// Keep track of entrance event so we only fire the correct leave event
  var enteredElement;// Add drag-and-drop event listeners
  if(!params.disableDragAndDrop){globalDropZone.addEventListener('dragover',handleGlobalDragover);globalDropZone.addEventListener('dragleave',handleGlobalDragleave);globalDropZone.addEventListener('drop',handleFileDrop);globalDropZone.addEventListener('dragenter',handleGlobalDragenter);}function handleGlobalDragenter(e){e.preventDefault();// Disable pointer-events on children so they don't interfere with dragleave events
  globalDropZone.classList.add('dragging-over');enteredElement=e.target;}function handleGlobalDragover(e){e.preventDefault();if(hasType(e.dataTransfer.types,'Files')&&!hasInvalidType(e.dataTransfer.types)){e.dataTransfer.dropEffect='link';globalDropZone.classList.add('dragging-over');globalDropZone.style.border='3px dashed red';if(document.getElementById('configuration').style.display==='none'){btnConfigure.click();}}}function handleGlobalDragleave(e){e.preventDefault();globalDropZone.style.border='';if(enteredElement===e.target){globalDropZone.classList.remove('dragging-over');// Only return to page if a ZIM is actually loaded
  if(appstate.selectedArchive!==null&&appstate.selectedArchive.isReady()){setTab();}}}function handleIframeDragover(e){e.preventDefault();if(hasType(e.dataTransfer.types,'Files')&&!hasInvalidType(e.dataTransfer.types)){globalDropZone.classList.add('dragging-over');e.dataTransfer.dropEffect='link';document.getElementById('btnConfigure').click();}}function handleIframeDrop(e){e.preventDefault();e.stopPropagation();}// Add type check for chromium browsers, since they count images on the same page as files
  function hasInvalidType(typesList){for(var i=0;i<typesList.length;i++){// Use indexOf() instead of startsWith() for IE11 support. Also, IE11 uses Text instead of text (and so does Opera).
  // This is not comprehensive, but should cover most cases.
  if(typesList[i].indexOf('image')===0||typesList[i].indexOf('text')===0||typesList[i].indexOf('Text')===0||typesList[i].indexOf('video')===0){return true;}}return false;}// IE11 doesn't support .includes(), so custom function to check for presence of types
  function hasType(typesList,type){for(var i=0;i<typesList.length;i++){if(typesList[i]===type){return true;}}return false;}function handleFileDrop(packet){appstate.filesDropped=true;packet.stopPropagation();packet.preventDefault();globalDropZone.style.border='';globalDropZone.classList.remove('dragging-over');var items=packet.dataTransfer.items;// Turn off OPFS if it is on
  if(params.useOPFS){document.getElementById('useOPFSCheck').click();params.pickedFolder='';params.storedFile='';}// When dropping multiple files (e.g. a split archive), we cannot use the File System Access API
  if(items&&items.length===1&&items[0].kind==='file'&&typeof items[0].getAsFileSystemHandle!=='undefined'){items[0].getAsFileSystemHandle().then(function(handle){if(handle.kind==='file'){processNativeFileHandle(handle);}else if(handle.kind==='directory'){processNativeDirHandle(handle);}});}else {var files=packet.dataTransfer.files;// Try to store the dragged files (in at least IE11, this is read only, so we have to wrap in try ... catch)
  try{archiveFilesLegacy.files=files;}catch(err){console.warn('Unable to store dropped files in legacy file picker, so selecting first file if not split',err);if(!/\.zim\w\w$/i.test(files[0].name)&&files.length>1){uiUtil.systemAlert('You have dropped multiple files, but in older browsers only the first can be loaded. Please drop only one file at a time in this browser, or use the file picker to pick more.');files=[files[0]];}}document.getElementById('openLocalFiles').style.display='none';document.getElementById('rescanStorage').style.display='block';document.getElementById('usage').style.display='none';// We have to void the previous picked folder, because dragged files don't have a folder
  // This also prevents a file-not-found alert to the user when picking a new directory
  params.pickedFolder=null;settingsStore$1.setItem('pickedFolder','',Infinity);params.pickedFile=null;params.storedFile=null;params.rescan=false;setLocalArchiveFromFileList(files);// Delete any previous file system handle (as otherwise, it will get inadvertienly reloaded)
  cache.idxDB('delete','pickedFSHandle',function(){});}}function pickFileUWP(){// Support UWP FilePicker [kiwix-js-pwa #3]
  // Create the picker object and set options
  var filePicker=new Windows.Storage.Pickers.FileOpenPicker();filePicker.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.downloads;// Filter folder contents
  filePicker.fileTypeFilter.replaceAll(['.zim']);filePicker.pickSingleFileAsync().then(processPickedFileUWP);}function pickFileNativeFS(){return window.showOpenFilePicker({multiple:false}).then(function(fileHandle){return processNativeFileHandle(fileHandle[0]);}).catch(function(err){// This is normal if the user is starting the app for the first time
  console.warn('User cancelled file picker, or else it is not possible to access the file system programmatically',err);});}// Electron file pickers
  if(window.dialog){dialog.on('file-dialog',function(fullPath){console.log('Path: '+fullPath);fullPath=fullPath.replace(/\\/g,'/');var pathParts=fullPath.match(/^(.+[/\\])([^/\\]+)$/i);params.rescan=false;createFakeFileObjectNode(pathParts[2],fullPath,processFakeFile);});dialog.on('dir-dialog',function(fullPath){console.log('Path: '+fullPath);fullPath=fullPath.replace(/\\/g,'/');scanNodeFolderforArchives(fullPath);});}function processFakeFile(fakeFileList){var fakeFile=fakeFileList[0];if(fakeFile.size){params.pickedFile=fakeFile;params.storedFile=fakeFile.name;params.storedFilePath=fakeFile.path;settingsStore$1.removeItem('pickedFolder');params.pickedFolder='';if(window.nw&&window.showOpenFilePicker){populateDropDownListOfArchives([fakeFile.name]);}else {populateDropDownListOfArchives([fakeFile.name]);if(!params.rescan)setLocalArchiveFromFileList([fakeFile]);}}else {// This shouldn't happen!
  params.showFileSelectors=true;document.getElementById('hideFileSelectors').style.display='inline';document.getElementById('btnConfigure').click();setTimeout(function(){uiUtil.systemAlert('The packaged file cannot be loaded!\nPlease check that it is in the "'+params.archivePath+'" folder\nor pick a new ZIM file.');},10);}}function pickFolderNativeFS(){window.showDirectoryPicker().then(function(dirHandle){// Do not attempt to jump to file if permission is needed (we have to let user choose)
  if(params.useOPFS)params.rescan=false;else params.rescan=true;return processNativeDirHandle(dirHandle);}).catch(function(err){console.error('Error reading directory',err);});}function processNativeFileHandle(fileHandle){// console.debug('Processing Native File Handle for: ' + fileHandle.name + ' and storedFile: ' + params.storedFile);
  var handle=fileHandle;// Serialize fileHandle to indexedDB
  cache.idxDB('pickedFSHandle',fileHandle,function(val){console.debug('IndexedDB responded with '+val);});settingsStore$1.setItem('lastSelectedArchive',fileHandle.name,Infinity);params.storedFile=fileHandle.name;params.pickedFolder=null;return fileHandle.getFile().then(function(file){file.handle=handle;params.pickedFile=file;params.rescan=false;populateDropDownListOfArchives([file.name]);});}function processPickedFileUWP(file){if(file){if(params.falFolderToken&&/\.zim\w\w$/i.test(file.name)){// This is a split file in a picked folder, so we need to process differently
  params.pickedFile='';setLocalArchiveFromArchiveList([file]);return;}// Cache file so the contents can be accessed at a later time
  Windows.Storage.AccessCache.StorageApplicationPermissions.futureAccessList.addOrReplace(params.falFileToken,file);params.pickedFile=file;if(params.pickedFolder)Windows.Storage.AccessCache.StorageApplicationPermissions.futureAccessList.remove(params.falFolderToken);params.pickedFolder='';settingsStore$1.setItem('lastSelectedArchive',file.name,Infinity);params.storedFile=file.name;// Since we've explicitly picked a file, we should jump to it
  params.rescan=false;populateDropDownListOfArchives([file.name],true);setLocalArchiveFromArchiveList([file.name]);}else {// The picker was dismissed with no selected file
  console.log('User closed folder picker without picking a file');}}function pickFolderUWP(){// Support UWP FilePicker [kiwix-js-pwa #3]
  var folderPicker=new Windows.Storage.Pickers.FolderPicker();folderPicker.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.downloads;folderPicker.fileTypeFilter.replaceAll(['.zim','.dat','.idx','.txt','.zimaa']);folderPicker.pickSingleFolderAsync().done(function(folder){if(folder){scanUWPFolderforArchives(folder);}});}function processNativeDirHandle(dirHandle,callback){// console.debug('Processing Native Directory Handle for: ' + dirHandle + ' and storedFile: ' + params.storedFile);
  // Serialize dirHandle to indexedDB
  cache.idxDB('pickedFSHandle',dirHandle,function(val){console.debug('IndexedDB responded with '+val);});params.pickedFolder=dirHandle;params.pickedFile='';var archiveDisplay=document.getElementById('chooseArchiveFromLocalStorage');archiveDisplay.style.display='block';var iterableEntryList=dirHandle.entries();return cache.iterateAsyncDirEntries(iterableEntryList,[],!!callback).then(function(archiveList){var noZIMFound=document.getElementById('noZIMFound');var hasArchives=archiveList.length>0;if(!hasArchives)console.warn('No archives found in directory '+dirHandle.name);if(callback){callback(archiveList);}else {noZIMFound.style.display=hasArchives?'none':'block';populateDropDownListOfArchives(archiveList,!hasArchives);}}).catch(function(err){uiUtil.systemAlert('<p>We could not find your archive! Is the location or file still available? Try picking the file or folder again.</p>'+'<p>[System error message: '+err.message+']</p>','Error!');});}function scanNodeFolderforArchives(folder,callback){// var stackTrace = Error().stack;
  // console.debug('Stack trace: ' + stackTrace);
  if(folder){window.fs.readdir(folder,function(err,files){if(err)console.error('There was an error reading files in the folder: '+err.message,err);else {params.pickedFolder=folder;settingsStore$1.setItem('pickedFolder',params.pickedFolder,Infinity);params.pickedFile='';processFilesArray(files,callback);}});}else {// The picker was dismissed with no selected file
  console.log('User closed folder picker without picking a file');}}function scanUWPFolderforArchives(folder){if(folder){// Application now has read/write access to all contents in the picked folder (including sub-folder contents)
  // Cache folder so the contents can be accessed at a later time
  Windows.Storage.AccessCache.StorageApplicationPermissions.futureAccessList.addOrReplace(params.falFolderToken,folder);params.pickedFolder=folder;// Query the folder.
  var query=folder.createFileQuery();query.getFilesAsync().done(function(files){processFilesArray(files,function(resolvedFiles){// If there is only one file in the folder, we should load it
  if((resolvedFiles.length===1||params.storedFile)&&!params.rescan){var fileToLoad=params.storedFile||resolvedFiles[0].name;setLocalArchiveFromArchiveList(fileToLoad);}});});}else {// The picker was dismissed with no selected file
  console.log('User closed folder picker without picking a file');}}function processFilesArray(files,callback){// Display file list
  var archiveDisplay=document.getElementById('chooseArchiveFromLocalStorage');if(files){var archiveList=[];files.forEach(function(file){if(/\.zim(aa)?$/i.test(file.fileType)||/\.zim(aa)?$/i.test(file)||/\.zim(aa)?$/i.test(file.name)){archiveList.push(file.name||file);}});if(archiveList.length){document.getElementById('noZIMFound').style.display='none';populateDropDownListOfArchives(archiveList,true);if(callback)callback(files,archiveList);return;}}archiveDisplay.style.display='block';document.getElementById('noZIMFound').style.display='block';document.getElementById('archiveList').options.length=0;document.getElementById('archiveList').size=0;document.getElementById('archiveNumber').innerHTML='<b>0</b> Archives found in local storage (tap "Select storage" to select an archive location)';if(/UWP/.test(params.appType))Windows.Storage.AccessCache.StorageApplicationPermissions.futureAccessList.remove(params.falFolderToken);}/**
   * Sets the local archive from an array of File objects
   * @param {Array<File>} files An array of File objects
   * @param {Boolean} fromArchiveList Indicates that the file was picked from the archive list, so don't re-populate list
   * @returns A callback function that resolves when the archive is loaded
   */function setLocalArchiveFromFileList(files,fromArchiveList){if(!files.length){if(document.getElementById('configuration').style.display=='none'){document.getElementById('btnConfigure').click();}displayFileSelect();return;}// Check for usable file types
  var firstSplitFileIndex=null;var storedFileIndex=null;var fileNames=[];for(var i=files.length;i--;){// DEV: you can support other file types by adding (e.g.) '|dat|idx' after 'zim\w{0,2}'
  if(!/\.(?:zim\w{0,2})$/i.test(files[i].name)){uiUtil.systemAlert('One or more files does not appear to be a ZIM file!');return;}// Add file names to array
  if(/\.zim(aa)?$/i.test(files[i].name))fileNames.push(files[i].name);// Note the index of any .zimaa file
  firstSplitFileIndex=/\.zimaa$/i.test(files[i].name)?i:firstSplitFileIndex;// Note the index of the stored file
  storedFileIndex=files[i].name===params.storedFile?i:storedFileIndex;// Allow reading with electron if we have the path info
  if(typeof window.fs!=='undefined'&&files[i].path){files[i].readMode='electron';console.log('File path is: '+files[i].path);if(files.length===1||~firstSplitFileIndex){params.pickedFile=files[i].path;settingsStore$1.setItem('pickedFile',params.pickedFile,Infinity);}}}var noZIMFound=document.getElementById('noZIMFound');if(fileNames.length){noZIMFound.style.display='none';}else {noZIMFound.style.display='';}// If there was only one file chosen (or set of split ZIMs, but we only store zimaa), select it
  if(fileNames.length===1||firstSplitFileIndex!==null)storedFileIndex=firstSplitFileIndex||0;// Populate the list of archives with the newly selected file(s)
  if(!fromArchiveList)populateDropDownListOfArchives(fileNames,true);// Check that user hasn't picked just part of split ZIM
  if(fileNames.length===1&&firstSplitFileIndex&&files.length===1){return uiUtil.systemAlert('<p>You have picked only part of a split archive!</p><p>Please select its folder in Config, '+'or drag and drop <b>all</b> of its parts into Config.</p>').then(function(){if(document.getElementById('configuration').style.display==='none'){document.getElementById('btnConfigure').click();}displayFileSelect();});}// If a picked file name is already in the archive list, try to select it in the list
  if(archiveList&&files[storedFileIndex]){archiveList.value=files[storedFileIndex].name;}// We should not proceed if there is no selected archive
  if(!archiveList.value){return;}// If we only picked one archive, display it
  if(fileNames.length===1){params.rescan=false;}// If the number of files is greater than one and the user hasn't selected a split archive, then set files to the selected file index
  if(files.length>1&&firstSplitFileIndex===null){files=[files[storedFileIndex]];}// Show the spinner
  uiUtil.pollSpinner('Loading archive '+files[0].name+'...',true);// TODO: Turn this into a Promise
  zimArchiveLoader.loadArchiveFromFiles(files,archiveReadyCallback,function(message,label){// callbackError which is called in case of an error
  uiUtil.systemAlert(message,label);});}/**
   * Verifies the given archive and switches contentInjectionMode accourdingly
   * Code to undertake the verification adapted from kiwix/kiwix-js #1192 kindly authored by @Greeshmanth1909
   *
   * @param {Object} archive The archive that needs verification
   *
   */function verifyLoadedArchive(archive){var _this2=this;return uiUtil.systemAlert('<p><b>Is this ZIM archive from a trusted source?</b> If in doubt, we strongly recommend you open it in Restricted mode.</p><p style="border: 1px solid;padding:5px;">'+'Name:&nbsp;<b>'+archive.file.name+'</b><br />'+'Creator:&nbsp;<b>'+archive.creator+'</b><br />'+'Publisher:&nbsp;<b>'+archive.publisher+'</b><br />'+'Scraper:&nbsp;<b>'+archive.scraper+'</b><br />'+'</p><p><b><i>Warning: above data can easily be spoofed!</i></b></p>'+'</p><p><i>If you mark the file as trusted, this alert will not show again.</i> (Security checks can be disabled in Expert Settings.)</p>','Security alert!',true,'Open in Restricted mode','Trust source').then(function(response){_newArrowCheck(this,_this2);if(response){params.contentInjectionMode='serviceworker';var trustedZimFiles=settingsStore$1.getItem('trustedZimFiles');var updatedTrustedZimFiles=trustedZimFiles+archive.file.name+'|';settingsStore$1.setItem('trustedZimFiles',updatedTrustedZimFiles,Infinity);// Change radio buttons accordingly
  document.getElementById('serviceworkerModeRadio').checked=true;}else {// Switch to Restricted mode
  params.contentInjectionMode='jquery';document.getElementById('jQueryModeRadio').checked=true;}}.bind(this));}/**
   * Functions to be run immediately after the archive is loaded
   *
   * @param {ZIMArchive} archive The ZIM archive
   */function archiveReadyCallback(archive){appstate.selectedArchive=archive;// A blob cache significantly speeds up the loading of CSS files
  appstate.selectedArchive.cssBlobCache=new Map();// As a new ZIM only opens in the iframe, we need to reset the pointers in case they were changed
  articleContainer$1=document.getElementById('articleContent');articleContainer$1.kiwixType='iframe';articleWindow=articleContainer$1.contentWindow;uiUtil.clearSpinner();// When a new ZIM is loaded, we turn this flag to null, so that we don't get false positive attempts to use the Worker
  // It will be defined as false or true when the first article is loaded
  appstate.isReplayWorkerAvailable=null;// Initialize the Service Worker
  if(params.contentInjectionMode==='serviceworker'){initServiceWorkerMessaging();}// Ensure that the new ZIM output is initially sent to the iframe (e.g. if the last article was loaded in a window)
  // (this only affects Restricted mode)
  appstate.target='iframe';appstate.wikimediaZimLoaded=/wikipedia|wikivoyage|mdwiki|wiktionary/i.test(archive.file.name);appstate.zimThemeType='desktop';appstate.pureMode=false;// Reset params.assetsCache in case it was changed below
  params.assetsCache=settingsStore$1.getItem('assetsCache')!=='false';params.imageDisplayMode=params.imageDisplay?'progressive':'manual';// These ZIM types have so much dynamic content that we have to allow all images
  if(/gutenberg|phet|(?:^|_)ted_/i.test(archive.file.name)||// params.isLandingPage ||
  /kolibri/i.test(archive.creator)||archive.zimType!=='open'){if(params.imageDisplay)params.imageDisplayMode='all';if(params.zimType!=='zimit'){// For some archive types (zimit2, Gutenberg, PhET, Kolibri at least), we have to get out of the way and allow the Service Worker
  // to act as a transparent passthrough (this key will be read in the handleMessageChannelMessage function)
  console.debug('*** Activating pureMode for ZIM: '+archive.file.name+' ***');appstate.pureMode=true;}// Turn off the assetsCache for now in Restricted mode
  // @TODO: Check why it works better with it off for Zimit archives in Restricted mode!
  if(/zimit/.test(archive.zimType)){params.assetsCache=params.contentInjectionMode!=='jquery';}}if(params.contentInjectionMode==='serviceworker'){if(!appstate.wikimediaZimLoaded){if(params.manipulateImages)document.getElementById('manipulateImagesCheck').click();if(settingsStore$1.getItem('displayHiddenBlockeElements')==='auto')params.displayHiddenBlockElements=false;if(params.allowHTMLExtraction)document.getElementById('allowHTMLExtractionCheck').click();// Set defaults that allow for greatest compabitibility with Zimit ZIM types
  if(/zimit/.test(params.zimType)){var determinedTheme=params.cssTheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssTheme;// Originally we only selected darkReader if auto had been selected, but this is confusing, so
  // we now always select it if the theme is dark and the ZIM type is zimit (1 or 2)
  // if (params.cssTheme === 'auto' && determinedTheme !== 'light' && !/UWP/.test(params.appType)) {
  if(determinedTheme!=='light'&&!/UWP/.test(params.appType)){params.cssTheme='darkReader';document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked=true;}if(!params.windowOpener){params.noWarning=true;document.getElementById('tabOpenerCheck').click();params.noWarning=false;}}}else {params.noWarning=true;if(!params.manipulateImages)document.getElementById('manipulateImagesCheck').click();if(settingsStore$1.getItem('displayHiddenBlockeElements')==='auto')params.displayHiddenBlockElements='auto';params.noWarning=false;params.cssTheme=settingsStore$1.getItem('cssTheme')||'light';// if (params.cssTheme === 'auto') {
  document.getElementById('cssWikiDarkThemeDarkReaderCheck').checked=false;// }
  }}// The archive is set : go back to home page to start searching
  params.storedFile=archive.file._files[0].name;params.storedFilePath=archive.file._files[0].path?archive.file._files[0].path:'';settingsStore$1.setItem('lastSelectedArchive',params.storedFile,Infinity);settingsStore$1.setItem('lastSelectedArchivePath',params.storedFilePath,Infinity);if(!~params.lastPageVisit.indexOf(params.storedFile.replace(/\.zim(\w\w)?$/,''))){// The archive has changed, so we must blank the last page
  params.lastPageVisit='';params.lastPageHTML='';}// If we have dragged and dropped files into an Electron app, we should have access to the path, so we should store it
  if(appstate.filesDropped&&params.storedFilePath){params.pickedFolder=null;params.pickedFile=params.storedFilePath;settingsStore$1.setItem('pickedFolder','',Infinity);settingsStore$1.setItem('pickedFile',params.pickedFile,Infinity);populateDropDownListOfArchives([params.storedFile],true);settingsStore$1.setItem('listOfArchives',encodeURI(params.storedFile),Infinity);// We have to remove the file handle to prevent it from launching next time
  cache.idxDB('delete','pickedFSHandle',function(){console.debug('File handle deleted');});appstate.filesDropped=false;}var reloadLink=document.getElementById('reloadPackagedArchive');if(reloadLink){if(params.packagedFile!=params.storedFile){reloadLink.style.display='inline';reloadLink.removeEventListener('click',loadPackagedArchive);reloadLink.addEventListener('click',loadPackagedArchive);document.getElementById('usage').style.display='none';}else {reloadLink.style.display='none';currentArchive.style.display='none';document.getElementById('usage').style.display='inline';}}// This ensures the correct icon is set for the newly loaded archive
  cssUIThemeGetOrSet(params.cssUITheme);var displayArchive=function displayArchive(){if(params.rescan){document.getElementById('btnConfigure').click();setTimeout(function(){document.getElementById('btnConfigure').click();params.rescan=false;},100);}else {if(typeof Windows==='undefined'&&typeof window.showOpenFilePicker!=='function'&&!params.useOPFS&&!window.dialog){document.getElementById('instructions').style.display='none';}else {document.getElementById('openLocalFiles').style.display='none';document.getElementById('rescanStorage').style.display='block';}document.getElementById('usage').style.display='none';if(~params.lastPageVisit.indexOf(params.storedFile.replace(/\.zim(\w\w)?$/,''))){var lastPage=params.lastPageVisit.replace(/@kiwixKey@.+/,'');goToArticle(lastPage);}else {document.getElementById('btnHome').click();}}};// Set contentInjectionMode to serviceWorker when opening a new archive in case the user switched to Restricted mode/jQuery Mode when opening the previous archive
  if(params.contentInjectionMode==='jquery'){params.contentInjectionMode=settingsStore$1.getItem('contentInjectionMode');// Change the radio buttons accordingly
  switch(settingsStore$1.getItem('contentInjectionMode')){case 'serviceworker':document.getElementById('serviceworkerModeRadio').checked=true;// In case we atuo-switched off assetsCache due to switch to Restricted mode, we need to reset
  params.assetsCache=settingsStore$1.getItem('asetsCache')!=='false';break;case 'serviceworkerlocal':document.getElementById('serviceworkerLocalModeRadio').checked=true;break;}}if(settingsStore$1.getItem('trustedZimFiles')===null){settingsStore$1.setItem('trustedZimFiles','',Infinity);}if(params.sourceVerification&&window.location.protocol!=='ms-appx-web:'&&/^serviceworker/.test(params.contentInjectionMode)){// Check if source of the zim file can be trusted and that it is not a packaged archive
  if(!settingsStore$1.getItem('trustedZimFiles').includes(archive.file.name)&&archive.file._files[0].name!==params.packagedFile&&// And it's not an Electron-accessed file inside the app's package
  !(window.electronAPI&&archive.file._files[0].path&&archive.file._files[0].path.indexOf(electronAPI.__dirname.replace(/[\\/]+(?:app\.asar)?$/,'')+'/'+params.archivePath)===0)){verifyLoadedArchive(archive).then(function(){displayArchive();});return;}}displayArchive();}function loadPackagedArchive(){// Reload any ZIM files in local storage (whcih the user can't otherwise select with the filepicker)
  // Reset params.packagedFile to its original value, in case we manipulated it previously
  params.packagedFile=params.originalPackagedFile;params.pickedFile='';settingsStore$1.removeItem('pickedFolder');if(params.localStorage){params.pickedFolder=params.localStorage;params.storedFile=params.packagedFile||'';scanUWPFolderforArchives(params.localStorage);}else if(typeof window.fs!=='undefined'){// We're in an Electron packaged app
  settingsStore$1.removeItem('lastSelectedArchive');settingsStore$1.removeItem('lastSelectedArchivePath');params.lastPageVisit='';if(params.packagedFile&&params.storedFile!==params.packagedFile){// If we're in an AppImage package and the storedFilePath points to the packaged archive, then the storedFilePath will be invalid,
  // because a new path is established each time the image's filesystem is mounted. So we reset to default.
  var archiveFilePrefix=params.storedFilePath;// If the app is packed inside an asar archive, or is Electron running from localhost, we need to alter the archivePath to point outside the asar directory
  if(window.electronAPI&&window.electronAPI.__dirname){archiveFilePrefix=electronAPI.__dirname.replace(/[/\\]app\.asar/,'');}var archiveDirectory=archiveFilePrefix+'/'+params.archivePath+'/'+params.packagedFile;if(~params.storedFilePath.indexOf(archiveFilePrefix)){params.storedFilePath=archiveFilePrefix;}archiveDirectory=archiveDirectory.replace(/[\\/][^\\/]+$/,'');readNodeDirectoryAndCreateNodeFileObjects(archiveDirectory,params.packagedFile).then(function(fileset){var fileObjects=fileset[0],fileNames=fileset[1];// params.pickedFile = params.packagedFile;
  params.pickedFolder=params.archivePath;settingsStore$1.setItem('pickedFolder',params.pickedFolder,Infinity);params.storedFile=params.packagedFile;setLocalArchiveFromFileList(fileObjects);populateDropDownListOfArchives(fileNames,true);}).catch(function(err){console.error(err);});// createFakeFileObjectNode(params.packagedFile, params.archivePath + '/' + params.packagedFile, processFakeFile);
  }}}/**
   * Sets the localArchive from the File selects populated by user
   */function setLocalArchiveFromFileSelect(){setLocalArchiveFromFileList(archiveFilesLegacy.files);params.rescan=false;}/**
   * Creates a fake file object from the given filename and filepath. This can only be used if the app is running
   * in the Electron framework.
   *
   * @param {String} filename The name of the file to be represented
   * @param {String} filepath The path of the file to be represented
   * @param {Function} callback The function to call back with the constructed file
   */function createFakeFileObjectNode(filename,filepath,callback){var file={};// For Electron, we need to set an absolute filepath in case the file was launched from a shortcut (and if it's not already absolute)
  if(filepath===params.archivePath+'/'+filename&&/^file:/i.test(window.location.protocol)){filepath=decodeURIComponent(window.location.href.replace(/www\/[^/?#]+(?:[?#].*)?$/,'')+filepath);}// DEV if you get pesky Electron error 'The "path" argument must be one of type string, Buffer, or URL', try commenting below
  // if (/^file:/i.test(filepath)) filepath = new URL(filepath);
  // and uncomment comment line below (seems to depend on node and fs versions) - this line conditionally turns the URL into a filepath string for Windows only
  filepath=/^file:\/+\w:[/\\]/i.test(filepath)?filepath.replace(/^file:\/+/i,''):filepath.replace(/^file:\/\//i,'');// Remove any drive letter (incompatible with Emscripten NODERAWFS)
  // filepath = filepath.replace(/^\w:/, '');
  file.name=filename;file.path=filepath;file.readMode='electron';// Get file size
  window.fs.stat(file.path,function(err,stats){if(err){file.size=null;console.error('File cannot be found!',err);uiUtil.systemAlert('The archive you are attempting to load ('+file.path+') cannot be found. Perhaps it has moved?');document.getElementById('btnConfigure').click();}else {file.size=stats.size;console.log('Stored file size is: '+file.size);}callback([file]);});}/**
   * Reads a directory using the Node File System API and creates a file object or objects for the requested file or split fileset
   * @param {String} folder The directory path to read
   * @param {String|Array} file The file or split file array to match in the folder (only file[0] will be tested if it is an array)
   * @returns {Promise<Array>} A Promise for the Array of files matching the requested file
   */function readNodeDirectoryAndCreateNodeFileObjects(folder,file){return new Promise(function(resolve,reject){var selectedFileSet=[],selectedFileNamesSet=[];var count=0;var fileHandle=typeof file==='string'?file:file[0];// Electron may need to handle the path differently
  if(folder===params.archivePath&&/^file:/i.test(window.location.protocol)){folder=decodeURIComponent(window.location.href.replace(/www\/[^/?#]+(?:[?#].*)?$/,'')+folder);}// Check for a Windows-style path and process accordingly to create absolute path appropriate to fs
  folder=/^file:\/+\w:[/\\]/i.test(folder)?folder.replace(/^file:\/+/i,''):folder.replace(/^file:\/\//i,'');window.fs.readdir(folder,function(err,fileNames){if(err){reject(err);}else if(fileNames){// Deal with split archives
  if(/\.zim\w{0,2}$/i.test(fileHandle)){var genericFileName=fileHandle.replace(/(\.zim)\w\w$/i,'$1');var fileFilter=new RegExp(genericFileName+'\\w\\w$');if(/\.zim$/i.test(fileHandle)){fileFilter=new RegExp(genericFileName);}for(var i=0;i<fileNames.length;i++){// Filter filenames so we only get zim or zimaa
  if(/\.zim(aa)?$/i.test(fileNames[i])){selectedFileNamesSet.push(fileNames[i]);}if(fileFilter.test(fileNames[i])){count++;// This gets a pseudo File object from a file handle
  createFakeFileObjectNode(fileNames[i],folder+'/'+fileNames[i],function(file){selectedFileSet.push(file[0]);if(count===selectedFileSet.length){resolve([selectedFileSet,selectedFileNamesSet]);}});}}if(!selectedFileNamesSet.length){reject(new Error('The requested archive is not in the archive folder '+folder+'!'));}else if(!count){// It looks like we don't have a matching file, so we should try to load the first one we found
  createFakeFileObjectNode(selectedFileNamesSet[0],folder+'/'+selectedFileNamesSet[0],function(file){selectedFileSet.push(file[0]);resolve([selectedFileSet,selectedFileNamesSet]);});}}else {reject(new Error('The requested archive does not appear to be a ZIM file!'));}}else {// Folder was empty...
  // createFakeFileObjectNode(fileHandle, folder + '/' + fileHandle, setLocalArchiveFromFileList);
  reject(new Error('No files were found in the folder!'));}});});}// Set up the event listener for return to article links
  var returnDivs=document.getElementsByClassName('returntoArticle');for(i=0;i<returnDivs.length;i++){returnDivs[i].addEventListener('click',setTab);}/**
   * Reads a remote archive with given URL, and returns the response in a Promise.
   * This function is used by setRemoteArchives below, for UI tests
   *
   * @param {String} url The URL of the archive to read
   * @returns {Promise<Blob>} A promise for the requested file (blob)
   */function readRemoteArchive(url){return new Promise(function(resolve,reject){var request=new XMLHttpRequest();request.open('GET',url);request.responseType='blob';request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE){if(request.status>=200&&request.status<300||request.status===0){// Hack to make this look similar to a file
  request.response.name=url;resolve(request.response);}else {reject(new Error('HTTP status '+request.status+' when reading '+url));}}};request.onabort=request.onerror=reject;request.send();});}/**
   * This is used in the testing interface to inject remote archives
   * @returns {Promise<Array>} A Promise for an array of archives
   */window.setRemoteArchives=function(){var readRequests=[];Array.prototype.slice.call(arguments).forEach(function(arg){readRequests.push(readRemoteArchive(arg));});return Promise.all(readRequests).then(function(arrayOfArchives){setLocalArchiveFromFileList(arrayOfArchives);}).catch(function(e){console.error('Unable to load remote archive(s)',e);});};/**
   * Handle key input in the prefix input zone
   * @param {Event} evt The event data to handle
   */function onKeyUpPrefix(evt){// Use a timeout, so that very quick typing does not cause a lot of overhead
  // It is also necessary for the words suggestions to work inside Firefox OS
  if(window.timeoutKeyUpPrefix){window.clearTimeout(window.timeoutKeyUpPrefix);}window.timeoutKeyUpPrefix=window.setTimeout(function(){// Don't process anything if it's the same prefix as recently entered (this prevents searching
  // if user is simply using arrow key to correct something typed).
  if(!/^\s/.test(prefix.value)&&prefix.value===appstate.tempPrefix)return;if(prefix.value&&prefix.value.length>0){appstate.tempPrefix=prefix.value;document.getElementById('searchArticles').click();}},1000);}// Listen to keyboard events for navigation, search, and print
  function listenForKeyboardEvents(controlWindow){// We may have a replay_iframe inside articleWindow if we are using the ReplayWorker
  if(appstate.isReplayWorkerAvailable){var replayIframe=articleWindow.document.getElementById('replay_iframe');if(replayIframe){controlWindow=replayIframe.contentWindow;}}// Single keyup listener for all keyup events
  var keyupListener=function keyupListener(e){// Alt-F (and Alt-Shift-F) for search in article, also patches Ctrl-F and Ctrl-Shift-F for apps that do not have access to browser search
  if((e.ctrlKey||e.altKey||e.metaKey)&&e.key.toLowerCase()==='f'){e.stopPropagation();document.getElementById('findText').click();}// Ctrl-L / Alt-D / Cmd-L for search bar (address bar analogy) - only fires if browser doesn't handle it (e.g., in PWA/Electron mode)
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='l'||e.altKey&&e.key.toLowerCase()==='d'){if(!/(input|textarea)/i.test(e.target.tagName)){e.stopPropagation();uiUtil.showSlidingUIElements();prefix.focus();prefix.setSelectionRange(prefix.value.length,prefix.value.length);}}};// Single keydown listener for all keydown events
  var keydownListener=function keydownListener(e){// Navigation: Ctrl/Alt/Cmd-Left for back
  if(/^(Arrow)?Left$/.test(e.key)&&(e.ctrlKey||e.altKey||e.metaKey)){e.preventDefault();e.stopPropagation();articleWindow.history.back();return;}// Navigation: Ctrl/Alt/Cmd-Right for forward
  if(/^(Arrow)?Right$/.test(e.key)&&(e.ctrlKey||e.altKey||e.metaKey)){e.preventDefault();e.stopPropagation();articleWindow.history.forward();return;}// Ctrl-P to patch printing support, so iframe gets printed
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='p'){e.preventDefault();e.stopPropagation();printIntercept();}// Focus the prefix if user types a / (but not in an input or other selectable field)
  if(e.key=='/'&&!e.ctrlKey&&!e.metaKey&&!/(input|textarea|select)/i.test(e.target.tagName)&&!e.target.isContentEditable&&e.target.getAttribute('role')!=='textbox'){e.preventDefault();e.stopPropagation();uiUtil.showSlidingUIElements();prefix.focus();prefix.setSelectionRange(prefix.value.length,prefix.value.length);}// Ctrl-K / Cmd-K for search bar (modern app convention)
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='k'&&!/(input|textarea)/i.test(e.target.tagName)){e.preventDefault();e.stopPropagation();uiUtil.showSlidingUIElements();prefix.focus();prefix.setSelectionRange(prefix.value.length,prefix.value.length);}// Home key for search bar (semantic "start here")
  if(e.key==='Home'&&!e.ctrlKey&&!e.metaKey&&!/(input|textarea|select)/i.test(e.target.tagName)&&!e.target.isContentEditable&&e.target.getAttribute('role')!=='textbox'){e.preventDefault();e.stopPropagation();uiUtil.showSlidingUIElements();prefix.focus();prefix.setSelectionRange(prefix.value.length,prefix.value.length);}};// Remove any existing listeners before adding new ones to prevent duplicates
  controlWindow.removeEventListener('keyup',keyupListener);controlWindow.removeEventListener('keydown',keydownListener,true);// Add the listeners
  controlWindow.addEventListener('keyup',keyupListener);controlWindow.addEventListener('keydown',keydownListener,true);}/**
   * Search the index for DirEntries with title that start with the given prefix (implemented
   * with a binary search inside the index file)
   * @param {String} prefix The string that must appear at the start of any title searched for
   * @param {Boolean} searchTitleIndex If true, the search will only be done in the title index, otherwise with fulltext index as well
   * @param {Number} size The number of results to return (default is params.maxSearchResultsSize)
   */function searchDirEntriesFromPrefix(prefix,searchTitleIndex,size){if(appstate.selectedArchive!==null&&appstate.selectedArchive.isReady()){// Cancel the old search (zimArchive search object will receive this change)
  appstate.search.status='cancelled';// Initiate a new search object and point appstate.search to it (the zimArchive search object will continue to point to the old object)
  appstate.search={prefix:prefix,status:'init',type:'',size:size||params.maxSearchResultsSize,searchTitleIndex:searchTitleIndex||false};uiUtil.hideActiveContentWarning();if(!prefix||/^\s/.test(prefix)){var sel=prefix?prefix.replace(/^\s(.*)/,'$1'):'';if(sel.length){sel=sel.replace(/^(.)(.*)/,function(p0,p1,p2){return p1.toUpperCase()+p2;});}showZIMIndex(null,sel);}else {appstate.selectedArchive.findDirEntriesWithPrefix(appstate.search,populateListOfArticles);}}else {uiUtil.clearSpinner();// We have to remove the focus from the search field,
  // so that the keyboard does not stay above the message
  document.getElementById('searchArticles').focus();uiUtil.systemAlert('Archive not set: please select an archive!');document.getElementById('btnConfigure').click();}}/**
   * Extracts and displays in htmlArticle the first params.maxSearchResultsSize articles beginning with start
   * @param {String} start Optional index number to begin the list with
   * @param {String} search Optional search prefix from which to start an alphabetical search
   */function showZIMIndex(start,search){var searchUrlIndex=/^[-ABCHIJMUVWX]?\//.test(search);// If we're searching by title index number (other than 0 or null), we should ignore any prefix
  if(isNaN(start)){search=search||'';}else {search=start>0?'':search;}appstate.search={prefix:search,state:'',searchUrlIndex:searchUrlIndex,size:params.maxSearchResultsSize,window:params.maxSearchResultsSize};if(appstate.selectedArchive!==null&&appstate.selectedArchive.isReady()){appstate.selectedArchive.findDirEntriesWithPrefixCaseSensitive(search,appstate.search,function(dirEntryArray,nextStart){var docBody=document.getElementById('mymodalVariableContent');var newHtml='';for(var i=0;i<dirEntryArray.length;i++){var dirEntry=dirEntryArray[i];// NB Ensure you use double quotes for HTML attributes below - see comment in populateListOfArticles
  newHtml+='\n<a  class="list-group-item" href="#" dirEntryId="'+encodeURIComponent(dirEntry.toStringId())+'" role="option">'+(appstate.search.searchUrlIndex?dirEntry.namespace+'/'+dirEntry.url:''+dirEntry.getTitleOrUrl())+'</a>';}start=start||0;var back=start?'<a href="#" data-start="'+(start-params.maxSearchResultsSize)+'" class="continueAnchor">&lt;&lt; Previous '+params.maxSearchResultsSize+'</a>':'';var next=dirEntryArray.length===params.maxSearchResultsSize?'<a href="#" data-start="'+nextStart+'" class="continueAnchor">Next '+params.maxSearchResultsSize+' &gt;&gt;</a>':'';var backNext=back?next?back+' | '+next:back:next;// Only construct the ZIM Index if it is not already displayed
  if(document.getElementById('myModal').style.display!=='block'){backNext='<div class="backNext" style="float:right;">'+backNext+'</div>\n';var alphaSelector=[];// Set up the alphabetic selector
  var lower=params.alphaChar.charCodeAt();var upper=params.omegaChar.charCodeAt();if(appstate.search.searchUrlIndex){lower='-'.charCodeAt();upper='X'.charCodeAt();}if(upper<=lower){alphaSelector.push('<a href="#" class="alphaSelector" data-sel="A">PLEASE SELECT VALID START AND END ALPHABET CHARACTERS IN CONFIGURATION</a>');}else {for(i=lower;i<=upper;i++){var char=String.fromCharCode(i);if(appstate.search.searchUrlIndex){// In URL search mode, we only show namespaces in alphabet
  if(!/^[-ABCHIJMUVWX]/.test(char))continue;char=char+'/';}alphaSelector.push('<a href="#" class="alphaSelector" data-sel="'+char+'">'+char+'</a>');}}// Add selectors for diacritics, etc. for Roman alphabet
  if(String.fromCharCode(lower)==='A'&&String.fromCharCode(upper)=='Z'){alphaSelector.push('<a href="#" class="alphaSelector" data-sel="¡">¡¿ÀÑ</a>');alphaSelector.unshift('<a href="#" class="alphaSelector" data-sel="!">!#123</a>');// Add way of selecting a non-Roman alphabet
  var switchAlphaButton=document.getElementById('extraModalFooterContent');// Don't re-add button and event listeners if they already exist
  if(!/button/.test(switchAlphaButton.innerHTML)){switchAlphaButton.innerHTML='<button class="btn btn-primary" style="float:left;" type="button">Switch to non-Roman alphabet</button>';switchAlphaButton.addEventListener('click',function(){var alphaLabel=document.getElementById('alphaCharTxt').parentNode;var panelBody=util.closest(alphaLabel,'.panel-body');if(panelBody&&panelBody.style.display==='none'){var panelHeading=util.getClosestBack(panelBody,function(el){return /panel-heading/.test(el.className);});if(panelHeading)panelHeading.click();}alphaLabel.style.borderColor='red';alphaLabel.style.borderStyle='solid';alphaLabel.addEventListener('mousedown',function(){this.style.borderColor='';this.style.borderStyle='';});document.getElementById('mycloseMessage').click();document.getElementById('btnConfigure').click();window.location.href='#otherSettingsDiv';});}}// Add diacritics for Greek alphabet
  if(params.alphaChar==='Α'&&params.omegaChar=='Ω'){alphaSelector.push('<a href="#" class="alphaSelector" data-sel="Ϊ">ΪΫά</a>');alphaSelector.unshift('<a href="#" class="alphaSelector" data-sel="΄">ΆΈΉ</a>');}var alphaString='<div style="text-align:center">'+(appstate.search.searchUrlIndex?'ZIM Namespaces: ':'')+'[ '+alphaSelector.join(' | \n')+' ]</div>\n';docBody.innerHTML='<div style="font-size:120%;"><br />\n'+alphaString+'<br />'+backNext+'</div>\n'+'<h2>ZIM '+(appstate.search.searchUrlIndex?'URL':'Archive')+' Index</h2>\n'+'<div id="zimDirEntryIndex" class="list-group">'+newHtml+'\n</div>\n'+'<div style="font-size:120%">\n'+backNext+'<br /><br />'+alphaString+'</div>\n';alphaSelector=docBody.querySelectorAll('.alphaSelector');Array.prototype.slice.call(alphaSelector).forEach(function(selector){selector.addEventListener('click',function(event){event.preventDefault();var char=selector.dataset.sel;prefix.value=' '+char;showZIMIndex(null,char);});});uiUtil.clearSpinner();document.getElementById('articleListWithHeader').style.display='none';var modalTheme=document.getElementById('modalTheme');modalTheme.classList.remove('dark');var determinedTheme=params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme;if(determinedTheme==='dark')modalTheme.classList.add('dark');}else {// If the ZIM Index is already displayed, just update the list of articles
  var zimIndex=document.getElementById('zimDirEntryIndex');if(zimIndex)zimIndex.innerHTML=newHtml;var backNextBlocks=document.querySelectorAll('.backNext');if(backNextBlocks){Array.prototype.slice.call(backNextBlocks).forEach(function(block){block.innerHTML=backNext;});}}// This is content that must be changed each time the list of articles changes
  var continueAnchors=docBody.querySelectorAll('.continueAnchor');Array.prototype.slice.call(continueAnchors).forEach(function(anchor){anchor.addEventListener('click',function(event){event.preventDefault();var start=~~anchor.dataset.start;showZIMIndex(start,appstate.search.searchUrlIndex?'/':'');});});var indexEntries=docBody.querySelectorAll('.list-group-item');Array.prototype.slice.call(indexEntries).forEach(function(index){index.addEventListener('click',function(event){event.preventDefault();handleTitleClick(event);document.getElementById('mycloseMessage').click();});});if(document.getElementById('myModal').style.display!=='block'){uiUtil.systemAlert(' ','',null,null,null,null,'myModal');}},start);}}/**
   * Display the list of articles with the given array of DirEntry
   * @param {Array} dirEntryArray The array of dirEntries returned from the binary search
   * @param {Object} reportingSearch The reporting search object
   */function populateListOfArticles(dirEntryArray,reportingSearch){// Do not allow cancelled searches to report
  if(reportingSearch.status==='cancelled')return;var stillSearching=appstate.search.status==='interim';var articleListHeaderMessageDiv=document.getElementById('articleListHeaderMessage');var nbDirEntry=dirEntryArray?dirEntryArray.length:0;var message;if(stillSearching){message='Searching ['+appstate.search.type+']... found: '+nbDirEntry+'...'+(reportingSearch.scanCount?' [scanning '+reportingSearch.scanCount+' titles] <a href="#" id="stopScan">stop</a>':'');}else if(nbDirEntry>=reportingSearch.size){message='First '+reportingSearch.size+(reportingSearch.searchUrlIndex?' assets':' articles')+' found: refine your search.';}else if(reportingSearch.status==='error'){message='Incorrect search syntax! See <a href="#searchSyntaxError" id="searchSyntaxLink">Search syntax</a> in About!';}else {message='Finished. '+(nbDirEntry||'No')+' articles found'+(appstate.search.type==='basic'?': try fewer words for full search.':'.');}if(!stillSearching&&reportingSearch.scanCount){message+=' [scanned '+reportingSearch.scanCount+' titles] '+'<a href="#" id="getMoreResults">[ Get more ]</a>'+(/^fulltext/.test(params.searchProvider)?appstate.search.searchTitleIndex?' <a href="#" id="full">[ full search? ]</a>':' <a href="#" id="titleOnly">[ title only? ]</a>':'');}articleListHeaderMessageDiv.innerHTML=message;// Add event listener for stopScan link
  var stopScanElement=document.getElementById('stopScan');if(stopScanElement&&!stopScanElement.hasAttribute('data-listener-added')){stopScanElement.addEventListener('mousedown',function(e){e.preventDefault();appstate.search.status='complete';populateListOfArticles(dirEntryArray,appstate.search);});stopScanElement.setAttribute('data-listener-added','true');}// Add event listener for getMoreResults link
  var getMoreResultsElement=document.getElementById('getMoreResults');if(getMoreResultsElement&&!getMoreResultsElement.hasAttribute('data-listener-added')){getMoreResultsElement.addEventListener('mousedown',function(e){e.preventDefault();// Temporarily increase the search window by params.maxSearchResultsSize
  var temporarySearchSize=appstate.search.size+params.maxSearchResultsSize;// If title search only, we should pass that to the new search
  var isTitleOnly=appstate.search.searchTitleIndex;// Rerun the search with the current prefix
  searchDirEntriesFromPrefix(appstate.search.prefix,isTitleOnly,temporarySearchSize);});getMoreResultsElement.setAttribute('data-listener-added','true');}// Add event listener for full search link
  var fullSearchElement=document.getElementById('full');if(fullSearchElement&&!fullSearchElement.hasAttribute('data-listener-added')){fullSearchElement.addEventListener('mousedown',function(e){e.preventDefault();// Rerun the search with the current prefix
  searchDirEntriesFromPrefix(appstate.search.prefix,false,appstate.search.size);});fullSearchElement.setAttribute('data-listener-added','true');}// Add event listener for titleOnly link
  var titleOnlyElement=document.getElementById('titleOnly');if(titleOnlyElement&&!titleOnlyElement.hasAttribute('data-listener-added')){titleOnlyElement.addEventListener('mousedown',function(e){e.preventDefault();// Rerun the search with the current prefix
  searchDirEntriesFromPrefix(appstate.search.prefix,true,appstate.search.size);});titleOnlyElement.setAttribute('data-listener-added','true');}if(stillSearching&&reportingSearch.countReport)return;var articleListDiv=document.getElementById('articleList');var articleListDivHtml='';var listLength=dirEntryArray.length<reportingSearch.size?dirEntryArray.length:reportingSearch.size;for(var i=0;i<listLength;i++){var dirEntry=dirEntryArray[i];// NB We use encodeURIComponent rather than encodeURI here because we know that any question marks in the title are not querystrings,
  // and should be encoded [kiwix-js #806]. DEV: be very careful if you edit the dirEntryId attribute below, because the contents must be
  // inside double quotes (in the final HTML string), given that dirEntryStringId may contain bare apostrophes
  // Info: encodeURIComponent encodes all characters except  A-Z a-z 0-9 - _ . ! ~ * ' ( )
  var dirEntryStringId=encodeURIComponent(dirEntry.toStringId());// DEV: Some titles may contain malformed HTML characters like '&lt;i>' for '<i>', so we transform only bold and italics for display
  // @TODO: Remove when [openzim/mwoffliner #1797] is fixed
  var dirEntryTitle=dirEntry.title||dirEntry.getTitleOrUrl();dirEntryTitle=dirEntryTitle.replace(/&lt;([ib])>([^&]+)&lt;\/\1>/g,'<$1>$2</$1>');// Make title bold if entry has a snippet
  if(dirEntry.snippet){dirEntryTitle='<strong>'+dirEntryTitle+'</strong>';}articleListDivHtml+='<a href="#" dirEntryId="'+dirEntryStringId+'" class="list-group-item"" role="option">'+(reportingSearch.searchUrlIndex?dirEntry.namespace+'/'+dirEntry.url:''+dirEntryTitle)+'</a>';}// Set the innerHTML once
  articleListDiv.innerHTML=articleListDivHtml;// Now add snippets and event listeners in a single loop
  var articleLinks=articleListDiv.querySelectorAll('a[dirEntryId]');uiUtil.createSnippetElements(dirEntryArray,articleLinks,listLength);// Add event listeners to article links
  uiUtil.attachArticleListEventListeners(findDirEntryFromDirEntryIdAndLaunchArticleRead,appstate);if(!stillSearching)uiUtil.clearSpinner();document.getElementById('articleListWithHeader').style.display='';if(reportingSearch.status==='error'){document.getElementById('searchSyntaxLink').addEventListener('click',function(){setTab('about');document.getElementById('btnAbout').click();});}}/**
   * Handles the click on the title of an article in search results
   * @param {Event} event The click event to handle
   * @returns {Boolean} Always returns false for JQuery event handling
   */function handleTitleClick(event){event.preventDefault();// User may have clicked on a child element of the list item if it contains HTML (for example, italics),
  // so we may need to find the closest list item
  var target=event.target;if(target.className!=='list-group-item'){console.warn('User clicked on child element of list item, looking for parent...');while(target&&target.className!=='list-group-item'){target=target.parentNode;}if(!target){// No list item found, so we can't do anything
  console.warn('No list item could be found for clicked event!');return;}}var dirEntryId=decodeURIComponent(target.getAttribute('dirEntryId'));findDirEntryFromDirEntryIdAndLaunchArticleRead(dirEntryId);}/**
   * Creates an instance of DirEntry from given dirEntryId (including resolving redirects),
   * and call the function to read the corresponding article
   * @param {String} dirEntryId The stringified Directory Entry to parse and launch
   */function findDirEntryFromDirEntryIdAndLaunchArticleRead(dirEntryId){if(appstate.selectedArchive.isReady()){var dirEntry=appstate.selectedArchive.parseDirEntryId(dirEntryId);// Remove focus from search field to hide keyboard and to allow navigation keys to be used
  document.getElementById('articleContent').contentWindow.focus();// Ensure selected search item is displayed in the iframe, not a new window or tab
  appstate.target='iframe';uiUtil.pollSpinner();if(dirEntry.isRedirect()){appstate.selectedArchive.resolveRedirect(dirEntry,readArticle);}else {params.isLandingPage=false;readArticle(dirEntry);}}else {uiUtil.systemAlert('Data files not set');}}/**
   * Check whether the given URL from given dirEntry equals the expectedArticleURLToBeDisplayed
   * @param {DirEntry} dirEntry The directory entry of the article to read
   * @returns {Boolean} Returns false if the current article does not match the expected article
   */function isDirEntryExpectedToBeDisplayed(dirEntry){var curArticleURL=dirEntry.namespace+'/'+dirEntry.url;if(appstate.expectedArticleURLToBeDisplayed!==curArticleURL){console.debug('url of current article :'+curArticleURL+', does not match the expected url :'+appstate.expectedArticleURLToBeDisplayed);return false;}return true;}/**
   * Read the article corresponding to the given dirEntry
   * @param {DirEntry} dirEntry The directory entry of the article to read
   */function readArticle(dirEntry){// Reset search prefix to allow users to search the same string again if they want to
  appstate.search.prefix='';// Only update for expectedArticleURLToBeDisplayed.
  appstate.expectedArticleURLToBeDisplayed=dirEntry.namespace+'/'+dirEntry.url;params.pagesLoaded++;// Select the correct target window for the article, defaulting to the iframe
  articleContainer$1=appstate.target==='window'?articleWindow:iframe;// We must remove focus from UI elements in order to deselect whichever one was clicked (in both Restricted and SW modes),
  if(!params.isLandingPage&&articleContainer$1.contentWindow)articleContainer$1.contentWindow.focus();uiUtil.pollSpinner();// Show the spinner with a loading message
  var message=dirEntry.url.match(/(?:^|\/)([^/]{1,13})[^/]*?$/);message=message?message[1]+'...':'...';uiUtil.pollSpinner('Loading '+message);var mimeType=dirEntry.getMimetype();// For Zimit ZIMS and pureMode, we need to go straight to article loading, and not look for cached content
  if(params.contentInjectionMode==='serviceworker'&&(appstate.pureMode||appstate.selectedArchive.zimType==='zimit'&&appstate.isReplayWorkerAvailable!==false)){// We will need the encoded URL on article load so that we can set the iframe's src correctly,
  // but we must not encode the '/' character or else relative links may fail [kiwix-js #498]
  var encodedUrl=dirEntry.url.replace(/[^/]+/g,function(matchedSubstring){return encodeURIComponent(matchedSubstring);});// Set up article onload handler
  articleLoader(dirEntry,mimeType);if(!isDirEntryExpectedToBeDisplayed(dirEntry)){return;}// Zimit archives contain content that is blocked in a local Chromium extension (on every page), so we must fall back to Restricted mode
  if(/zimit/.test(appstate.selectedArchive.zimType)&&window.location.protocol==='chrome-extension:'&&!window.nw){return handleUnsupportedReplayWorker(dirEntry);}// If we are dealing with a classic Zimit ZIM, we need to instruct Replay to add the file as a new collection
  if(appstate.selectedArchive.zimType==='zimit'&&appstate.isReplayWorkerAvailable===null){if(params.useLegacyZimitSupport){navigator.serviceWorker.controller.postMessage({action:'disableZimitSupport'});return handleUnsupportedReplayWorker(dirEntry);}var archiveName=appstate.selectedArchive.file.name.replace(/\.zim\w{0,2}$/i,'');var cns=appstate.selectedArchive.getContentNamespace();// Support type 0 and type 1 Zimit archives
  var replayCns=cns==='C'?'/C/A/':'/A/';var base=window.location.href.replace(/^(.*?\/)www\/.*$/,'$1');var prefix=base+appstate.selectedArchive.file.name+replayCns;// Open a new message channel to the ServiceWorker
  var zimitMessageChannel=new MessageChannel();zimitMessageChannel.port1.onmessage=function(event){if(event.data.error){console.error('Reading Zimit archives with the Replay system is not supported in this browser',event.data.error);return handleUnsupportedReplayWorker(dirEntry);}else if(event.data.success){// For now Electron apps cannot use the Replay Worker because of the file:// protocol
  if(document.location.protocol!=='file:'&&!params.useLegacyZimitSupport){appstate.isReplayWorkerAvailable=true;// Make sure the configuration panel is closed
  if(document.getElementById('configuration').style.display!=='none'){btnConfigure.click();}// We put the ZIM filename as a prefix in the URL, so that browser caches are separate for each ZIM file
  articleContainer$1.src='../'+appstate.selectedArchive.file.name+'/'+dirEntry.namespace+'/'+encodedUrl;}else {return handleUnsupportedReplayWorker(dirEntry);}}};// If we are dealing with a Zimit ZIM, we need to instruct Replay to add the file as a new collection
  if(!navigator.serviceWorker.controller){uiUtil.clearSpinner();return;}navigator.serviceWorker.controller.postMessage({msg_type:'addColl',name:archiveName,prefix:prefix,file:{sourceUrl:'proxy:'+prefix},root:true,skipExisting:false,extraConfig:{// prefix: prefix, // If not set, Replay will use the proxy URL (without the 'proxy:' prefix)
  sourceType:'kiwix',notFoundPageUrl:'./404.html'/*,
                      baseUrl: base + selectedArchive.file.name + '/',
                      baseUrlHashReplay: false */},topTemplateUrl:'./www/topFrame.html'},[zimitMessageChannel.port2]);}else {// We put the ZIM filename as a prefix in the URL, so that browser caches are separate for each ZIM file
  articleContainer$1.src='../'+appstate.selectedArchive.file.name+'/'+dirEntry.namespace+'/'+encodedUrl;}}else if(dirEntry.isRedirect()){appstate.selectedArchive.resolveRedirect(dirEntry,readArticle);}else {// TESTING//
  console.log('Initiating '+mimeType+' load of '+dirEntry.namespace+'/'+dirEntry.url+'...');uiUtil.hideActiveContentWarning();// Set startup parameter to guard against boot loop
  if(settingsStore$1.getItem('lastPageLoad')!=='rebooting')settingsStore$1.setItem('lastPageLoad','failed',Infinity);// Void the localSearch variable to prevent invalid DOM references remainining [kiwix-js-pwa #56]
  localSearch={};// Calculate the current article's ZIM baseUrl to use when processing relative links
  params.baseURL=encodeURI(dirEntry.namespace+'/'+dirEntry.url.replace(/[^/]+$/,''));// URI-encode anything that is not a '/'
  // .replace(/[^/]+/g, function(m) {
  //     return encodeURIComponent(m);
  // });
  if(!/\bx?html\b/i.test(mimeType)){// If the selected article isn't HTML, e.g. it might be a PDF, we can either download it if we recognize the type, or ask the SW to deal with it
  if((params.zimType==='zimit'||appstate.search.searchUrlIndex)&&/\/(plain|.*javascript|css|csv|.*officedocument|.*opendocument|epub|pdf|zip|png|jpeg|webp|svg|gif|tiff|mp4|webm|mpeg|mp3|octet-stream|warc-headers)/i.test(mimeType)){return appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,content){var filename=dirEntry.title||dirEntry.url;if(/^text|\/.*javascript|\/warc-headers/i.test(mimeType)){var contentString=content;if(typeof content!=='string')contentString=utf8$1.parse(content);displayArticleContentInContainer(fileDirEntry,contentString);// Provide a download link for js and css asset types at least
  if(!/plain|warc-headers/i.test(mimeType)){uiUtil.displayFileDownloadAlert(filename,false,mimeType,content);}}else {uiUtil.displayFileDownloadAlert(filename,true,mimeType,content);}uiUtil.clearSpinner();});}else if(params.contentInjectionMode==='serviceworker'){articleContainer$1=window.open('../'+appstate.selectedArchive.file.name+'/'+dirEntry.namespace+'/'+encodeURIComponent(dirEntry.url),params.windowOpener==='tab'?'_blank':encodeURIComponent(dirEntry.title|mimeType),params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);if(articleContainer$1){appstate.target='window';articleContainer$1.kiwixType=appstate.target;articleWindow=articleContainer$1;}uiUtil.clearSpinner();return;}}// Load cached start page if it exists and we have loaded the packaged file
  var htmlContent=0;var zimName=appstate.selectedArchive.file.name.replace(/\.[^.]+$/,'').replace(/_\d+-\d+$/,'');if(params.isLandingPage&&params.cachedStartPages[zimName]){htmlContent=-1;// @TODO: Why are we double-encoding here????? Clearly we double-decode somewhere...
  // var encURL = encodeURIComponent(encodeURIComponent(params.cachedStartPages[zimName]).replace(/%2F/g, '/')).replace(/%2F/g, '/');
  var encURL=params.cachedStartPages[zimName];uiUtil.XHR(encURL,'text',function(responseTxt,status){htmlContent=/<html[^>]*>/.test(responseTxt)?responseTxt:0;if(htmlContent){console.log('Article retrieved from storage cache...');// Alter the dirEntry url and title parameters in case we are overriding the start page
  dirEntry.url=params.cachedStartPages[zimName].replace(/[AC]\//,'');var title=htmlContent.match(/<title[^>]*>((?:[^<]|<(?!\/title))+)/);dirEntry.title=title?title[1]:dirEntry.title;appstate.selectedArchive.landingPageUrl=params.cachedStartPages[zimName];displayArticleContentInContainer(dirEntry,htmlContent);}else {appstate.selectedArchive.readUtf8File(dirEntry,function(fileDirEntry,data){if(fileDirEntry.zimitRedirect)goToArticle(fileDirEntry.zimitRedirect);else displayArticleContentInContainer(fileDirEntry,data);});}});}// Load lastPageVisit if it is the currently requested page
  if(!htmlContent){var lastPage='';// NB code below must be able to run async, hence it is a function
  var goToRetrievedContent=function goToRetrievedContent(html){if(/<html[^>]*>/i.test(html)){console.log('Fast article retrieval from localStorage: '+lastPage);if(/<html[^>]*islandingpage/i.test(html)){params.isLandingPage=true;appstate.selectedArchive.landingPageUrl=dirEntry.namespace+'/'+dirEntry.url;}setTimeout(function(){displayArticleContentInContainer(dirEntry,html);},0);}else {// if (params.contentInjectionMode === 'jquery') {
  // In Restricted mode, we read the article content in the backend and manually insert it in the iframe
  appstate.selectedArchive.readUtf8File(dirEntry,function(fileDirEntry,data){if(fileDirEntry&&fileDirEntry.zimitRedirect){goToArticle(fileDirEntry.zimitRedirect);}else {if(!data){var requestedURL=dirEntry.zimitRedirect?dirEntry.zimitRedirect:dirEntry.namespace+'/'+dirEntry.url;uiUtil.systemAlert('<p>The requested page <b>'+requestedURL+'</b> does not appear to be an article!</p>'+'<p>Try searching for content in the search bar, or type a <b><i>space</i></b> for the ZIM '+'index, or <b><i>space /</i></b> for the URL index.</p>').then(function(){prefix.focus();});}fileDirEntry=fileDirEntry||dirEntry;displayArticleContentInContainer(fileDirEntry,data);}});// This is needed so that the html is cached in displayArticleInForm
  params.lastPageVisit='';params.lastPageHTML='';// }
  }};if(params.lastPageVisit)lastPage=params.lastPageVisit.replace(/@kiwixKey@.+/,'');// If we have the HTML of the last loaded page, use it to save lookups
  if(dirEntry.namespace+'/'+dirEntry.url===lastPage){if(!params.lastPageHTML){// DEV: Timout is needed here to allow time for cache capability to be tested before calling it
  // otherwise the app will return only a memory capibility for apps that use indexedDB
  setTimeout(function(){cache.getArticle(params.lastPageVisit.replace(/.*@kiwixKey@/,''),lastPage,function(html){params.lastPageHTML=html;htmlContent=params.lastPageHTML||htmlContent;goToRetrievedContent(htmlContent);});},250);}else {htmlContent=params.lastPageHTML;goToRetrievedContent(htmlContent);}// } else if (params.zimType === 'zimit' && params.contentInjectionMode === 'serviceworker' && !messageChannelWaiting) {
  //     // DEF: If the messageChannel isn't waiting for transformed HTML, we could instruct the SW to load this article
  //     // It uses more CPU, as it starts the lookups all over again, but it is arguably a "purer" method especially for Zimit
  //     var newLocation = '../' + appstate.selectedArchive.file.name + '/' + dirEntry.namespace + '/' + dirEntry.url + '?isKiwixHref';
  //     loaded = false;
  //     articleWindow.location.href = newLocation;
  }else {goToRetrievedContent(htmlContent);}}}}var previousReplayDocLocation='';/**
   * Selects the iframe to which to attach the onload event, and attaches it
   */function articleLoader(entry,mimeType){if(/warc-headers/i.test(mimeType))return;if(appstate.selectedArchive.zimType==='zimit'){var doc=articleContainer$1.contentDocument||null;if(doc){var replayIframe=doc.getElementById('replay_iframe');if(!replayIframe)return;// Add a failsafe to ensure that the iframe is displayed after 1.5 seconds
  if(replayIframe.timeout)clearTimeout(replayIframe.timeout);replayIframe.timeout=setTimeout(function(){replayIframe.style.display='';// Only show the sliding UI elements if the iframe window has not already been scrolled
  if(replayIframe.contentWindow&&!replayIframe.contentWindow.scrollFired){uiUtil.showSlidingUIElements();}},1500);// Don't set up listeners for the Header type, as it is not a real article
  if(/warc-headers/i.test(mimeType))return;var replayDoc=replayIframe&&replayIframe.contentDocument||null;if(!replayDoc||!replayDoc.readyState||replayDoc.readyState==='loading')return;if(replayDoc.location.href!==previousReplayDocLocation){// console.debug('Previous replayDoc location: ' + previousReplayDocLocation);
  // console.debug('New replayDoc location: ' + replayDoc.location.href);
  previousReplayDocLocation=replayDoc.location.href;setTimeout(function(){_articleLoadedSW(entry,replayIframe);switchCSSTheme();},100);}}}else {articleContainer$1.onload=function(){_articleLoadedSW(entry,articleContainer$1);};}}// Add event listener to iframe window to check for links to external resources
  function filterClickEvent(event){// console.debug('filterClickEvent fired');
  // Ignore click if we are dealing with an image that has not yet been extracted
  if(event.target.dataset&&event.target.dataset.kiwixhidden)return;// Find the closest enclosing A tag (if any)
  var clickedAnchor=uiUtil.closestAnchorEnclosingElement(event.target);// If the anchor has a passthrough property, then we have already checked it is safe, so we can return
  if(clickedAnchor&&clickedAnchor.passthrough){clickedAnchor.passthrough=false;return;}// Remove any Kiwix Popovers that may be hanging around
  popovers.removeKiwixPopoverDivs(event.target.ownerDocument);// Trap clicks in the iframe to restore Fullscreen mode
  if(params.lockDisplayOrientation)refreshFullScreen(event);if(clickedAnchor){// Get the window of the clicked anchor
  articleWindow=clickedAnchor.ownerDocument.defaultView;// Select the correct target window for the article, defaulting to the iframe
  articleContainer$1=articleWindow.self===articleWindow.top?articleWindow:iframe;appstate.target=articleContainer$1===articleWindow?'window':'iframe';if(params.contentInjectionMode==='jquery')return;// This prevents any popover from being displayed when the user clicks on a link
  clickedAnchor.articleisloading=true;// Check for Zimit links that would normally be handled by the Replay Worker
  // DEV: '__WB_pmw' is a function inserted by wombat.js, so this detects links that have been rewritten in zimit2 archives
  // however, this misses zimit2 archives where the framework doesn't support wombat.js, so monitor if always processing zimit2 links
  // causes any adverse effects @TODO
  if(appstate.isReplayWorkerAvailable||'__WB_pmw'in clickedAnchor||appstate.selectedArchive.zimType==='zimit2'&&articleWindow.location.href.replace(/[#?].*$/,'')!==clickedAnchor.href.replace(/[#?].*$/,'')&&!clickedAnchor.hash){return handleClickOnReplayLink(event,clickedAnchor);}// DEV: The href returned below is the href as written in the HTML, which may be relative
  var href=clickedAnchor.getAttribute('href');// We assume that, if an absolute http(s) link is hardcoded inside an HTML string, it means it's a link to an external website
  // (this assumption is only safe for non-Replay archives, but we deal with those separately above: they are routed to handleClickOnReplayLink).
  // Additionally, by comparing the protocols, we can filter out protocols such as `mailto:`, `tel:`, `skype:`, etc. (these should open in a new window).
  // DEV: The test for a protocol of ':' may no longer be needed. It needs careful testing in all browsers (particularly in Edge Legacy), and if no
  // longer triggered, it can be removed.
  if(/^http/i.test(href)||clickedAnchor.protocol&&clickedAnchor.protocol!==':'&&articleWindow.location.protocol!==clickedAnchor.protocol){console.debug('filterClickEvent opening external link in new tab');clickedAnchor.newcontainer=true;uiUtil.warnAndOpenExternalLinkInNewTab(event,clickedAnchor);}else if(/\.pdf([?#]|$)/i.test(href)&&params.zimType!=='zimit'&&!/UWP/.test(params.appType)){// Not currently supported in UWP app
  // Due to the iframe sandbox, we have to prevent the PDF viewer from opening in the iframe and instead open it in a new tab
  event.preventDefault();event.stopPropagation();console.debug('filterClickEvent opening new window for PDF');clickedAnchor.newcontainer=true;window.open(clickedAnchor.href,params.windowOpener==='tab'?'_blank':clickedAnchor.title,params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);// Make sure that the last saved page is not a PDF, or else we'll have a CSP exception on restarting the app
  // @TODO - may not be necessary because params.lastPageVisit is only set when HTML is loaded
  }else {var decHref=decodeURIComponent(href);if(!/^(?:#|javascript|null)/i.test(decHref)){uiUtil.pollSpinner('Loading '+decHref.replace(/([^/]+)$/,'$1').substring(0,18)+'...');// Tear down contents of previous document -- this is needed when a link in a ZIM link in an external window hasn't had
  // an event listener attached. For example, links in popovers in external windows. UWP doesn't allow access to the contents
  // of the external window, so we can't clear it.
  if(!/UWP/.test(params.appType)&&articleWindow&&articleWindow.document&&articleWindow.document.body){articleWindow.document.body.innerHTML='';}}}}}var loaded=false;var unhideArticleTries=12;// Set up a repeasting loop 12 times (= 6 seconds max) to attempt to unhide the article container
  // Function to unhide a hidden article
  var unhideArticleContainer=function unhideArticleContainer(){// console.debug('Unhiding article container...');
  if(articleWindow.document){articleWindow.document.bgcolor='';if(appstate.target==='iframe')iframe.style.display='';if(articleWindow.document.body&&articleWindow.document.body.style){articleWindow.document.body.style.display='block';// Some contents need this to be able to display correctly (e.g. masonry landing pages)
  iframe.style.height='auto';resizeIFrame();// Scroll down and up to kickstart lazy loading which might not happen if brower has been slow to display the content
  setTimeout(function(){if(!(/zimit/.test(params.zimType)||appstate.pureMode)){articleWindow.scrollBy(0,5);setTimeout(function(){articleWindow.scrollBy(0,-5);unhideArticleTries=12;// Reset counter
  },250);}},100);}}};/**
   * Applies fixes for Wikimedia ZIMs, including reference marker display fixes
   * and language direction corrections for mobile transformed content
   * @param {Document} doc The document to apply fixes to
   */function applyWikimediaZimFixes(doc){if(appstate.wikimediaZimLoaded&&params.cssCache){// Fix reference marker display issues in ActionParse ZIMs transformed to mobile
  if(params.cssSource==='mobile'&&/skins.vector.styles.css/.test(doc.head.innerHTML)){// Override the display: none rule for reference link text
  var style=doc.createElement('style');style.textContent='span.mw-reflink-text { display: inline !important;}.mw-ref a:after { display: none !important; }';doc.head.appendChild(style);}// Fix hardcoded language direction
  var contentText=doc.getElementById('mw-content-text');var langDirection=contentText?contentText.style?contentText.style.direction:'':'';if(langDirection){doc.documentElement.setAttribute('dir',langDirection);var contentContainer=doc.querySelector('.mw-content-container');if(contentContainer){contentContainer.style.direction=langDirection;}}}}// The main article loader for Service Worker mode
  var _articleLoadedSW=function articleLoadedSW(dirEntry,container){// console.debug('Checking if article loaded... ' + loaded);
  if(loaded){// Last-ditch attempt to unhide
  unhideArticleContainer();return;}loaded=true;// Get the container windows
  articleWindow=container.contentWindow||container;uiUtil.showSlidingUIElements();var doc=articleWindow?articleWindow.document:null;articleDocument=articleWindow.document.documentElement;var mimeType=params.useLibzim?dirEntry.mimeType:dirEntry.getMimetype();// If we've successfully loaded an HTML document...
  if(doc&&/\bx?html/i.test(mimeType)){// console.debug('HTML appears to be available...');
  params.lastPageVisit=dirEntry.namespace+'/'+dirEntry.url+'@kiwixKey@'+appstate.selectedArchive.file.name;// Turn off failsafe for SW mode
  settingsStore$1.setItem('lastPageLoad','OK',Infinity);settingsStore$1.setItem('lastPageVisit',params.rememberLastPage?params.lastPageVisit:'',Infinity);// Set or clear the ZIM store of last page
  var lastPage=params.rememberLastPage?dirEntry.namespace+'/'+dirEntry.url:'';settingsStore$1.setItem(appstate.selectedArchive.file.name,lastPage,Infinity);}var docBody=doc?doc.body:null;if(docBody&&docBody.innerHTML){// docBody must contain contents, otherwise we haven't loaded an article yet
  // console.debug('We appear to have a document body with HTML...');
  // Trap clicks in the iframe to enable us to work around the sandbox when opening external links and PDFs
  articleWindow.onclick=filterClickEvent;// Ensure the window target is permanently stored as a property of the articleWindow (since appstate.target can change)
  articleWindow.kiwixType=appstate.target;if(appstate.target==='iframe'){// Deflect drag-and-drop of ZIM file on the iframe to Config
  if(!params.disableDragAndDrop){docBody.addEventListener('dragover',handleIframeDragover);docBody.addEventListener('drop',handleIframeDrop);}setupTableOfContents();listenForKeyboardEvents(articleWindow);}// Note that switchCSSTheme() requires access to params.lastPageVisit
  if(!appstate.isReplayWorkerAvailable)switchCSSTheme();// Gets called in articleLoader for replay_iframe
  if(appstate.selectedArchive.zimType==='open'){// Set relative font size + Stackexchange-family multiplier
  setArticleZoom(params.relativeFontSize);// Only manipulate sections if we are not on a landing page
  if(!params.isLandingPage){// And if an ActionParse ZIM is loaded and we're not on mobile style, we should not manipulate sections
  if(!(/skins.vector.styles.css/.test(doc.head.innerHTML)&&params.cssSource!=='mobile')){openOrCloseAllSections();}}}checkToolbar();// Set page width according to user preference
  removePageMaxWidth();setupHeadings();applyWikimediaZimFixes(doc);if(!appstate.isReplayWorkerAvailable){// We need to keep tabs on the opened tabs or windows if the user wants right-click functionality, and also parse download links
  // We need to set a timeout so that dynamically generated URLs are parsed as well (e.g. in Gutenberg ZIMs)
  if((params.windowOpener||appstate.wikimediaZimLoaded)&&!appstate.pureMode&&!params.useLibzim&&dirEntry){setTimeout(function(){parseAnchorsJQuery(dirEntry);},1500);}if((params.zimType==='open'||params.manipulateImages)&&/manual|progressive/.test(params.imageDisplayMode)&&!params.useLibzim){images.prepareImagesServiceWorker(articleWindow);}else {setTimeout(function(){images.loadMathJax(articleWindow);},1000);}if(params.allowHTMLExtraction&&appstate.target==='iframe'){var determinedTheme=params.cssTheme=='auto'?cssUIThemeGetOrSet('auto'):params.cssTheme;uiUtil.insertBreakoutLink(determinedTheme);}// Trap any clicks on the iframe to detect if mouse back or forward buttons have been pressed (Chromium does this natively)
  if(/UWP/.test(params.appType))docBody.addEventListener('pointerup',onPointerUp);// The content is ready : we can hide the spinner
  setTab();// If the body is not yet displayed, we need to wait for it to be displayed before we can unhide the article container
  var intervalId=setInterval(function(){docBody=articleWindow.document.body;unhideArticleTries--;unhideArticleContainer();// Check that the contents of docBody aren't empty and that the unhiding worked
  if(unhideArticleTries<1||docBody.innerHTML&&docBody.style.display==='block'){// console.debug('Attempt ' + (12 - unhideArticleTries) + ' to unhide article container...');
  clearInterval(intervalId);}},500);}uiUtil.clearSpinner();// If we reloaded the page to print the desktop style, we need to return to the printIntercept dialogue
  if(params.printIntercept)printIntercept();// Jump to any anchor parameter
  if(anchorParameter){var target=articleWindow.document.getElementById(anchorParameter);if(target){setTimeout(function(){target.scrollIntoView();},1000);}anchorParameter='';}var title=params.useLibzim?dirEntry.url:dirEntry.getTitleOrUrl();if(dirEntry)uiUtil.makeReturnLink(title);if(appstate.wikimediaZimLoaded&&params.showPopoverPreviews){var darkTheme=(params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme)!=='light';popovers.attachKiwixPopoverCss(doc,darkTheme);}params.isLandingPage=false;}else if(unhideArticleTries>0){// If we havent' loaded a text-type document, we probably haven't finished loading
  loaded=false;unhideArticleTries--;// Try again...
  // console.debug('Attempt ' + (12 - unhideArticleTries) + ' to process loaded article...');
  setTimeout(_articleLoadedSW,250,dirEntry,container);}// Show spinner when the article unloads
  // DEV: Note that this doesn't fire on the Replay iframe, because the src is set programmatically
  container.onunload=function(){if(articleWindow.kiwixType==='iframe'){uiUtil.pollSpinner();}};};// Handles a click on a Zimit link that has been processed by Wombat
  function handleClickOnReplayLink(ev,anchor){var basePath=window.location.href.replace(/^(.*?\/)www\/.*$/,'$1');var pathToZim=basePath+appstate.selectedArchive.file.name+'/';var pseudoNamespace=appstate.selectedArchive.zimitPseudoContentNamespace;var pseudoDomainPath=(anchor.hostname===window.location.hostname?appstate.selectedArchive.zimitPrefix.replace(/\/$/,''):anchor.hostname)+anchor.pathname;var containingDocDomainPath=anchor.ownerDocument.location.hostname+anchor.ownerDocument.location.pathname;// Normalize the protocols of the clicked anchor and the document, because some PDFs are served with a protocol of http: instead of https:
  var normalizedAnchorProtocol=anchor.protocol?anchor.protocol.replace(/s:/,':'):'';var normalizedDocumentProtocol=document.location.protocol.replace(/s:/,':');// If the paths are identical, then we are dealing with a link to an anchor in the same document
  if(pseudoDomainPath===containingDocDomainPath)return;// If it's for a different protocol (e.g. javascript:) we may need to handle that, or if the user has pressed the ctrl or command key, the document
  // will open in a new window anyway, so we can return.
  if(normalizedAnchorProtocol&&normalizedAnchorProtocol!==normalizedDocumentProtocol){// DEV: Monitor whether you need to handle /blob:|data:|file:/ as well (probably not, as they would be blocked by the sandbox if loaded into iframe)
  if(/about:|javascript:/i.test(anchor.protocol)||ev.ctrlKey||ev.metaKey||ev.button===1)return;// So it's probably a URI scheme or protocol like mailto: that would violate the CSP, so we need to open it explicitly in a new tab
  ev.preventDefault();ev.stopPropagation();console.debug('handleClickOnReplayLink opening custom protocol '+anchor.protocol+' in new tab');uiUtil.warnAndOpenExternalLinkInNewTab(ev,anchor);return;}var zimUrl;// If it starts with the path to the ZIM file, then we are dealing with an untransformed absolute local ZIM link
  if(!anchor.href.indexOf(pathToZim)){zimUrl=anchor.href.replace(pathToZim,'');// If it is the same as the pseudoDomainPath, then we are dealing with an untransformed pseuodo relative link that looks like an absolute https:// link
  // (this probably only applies to zimit2 without Wombat)
  }else if(anchor.href.replace(/^[^:]+:\/\//,'')===pseudoDomainPath&&/\.zim\/[CA]\//.test(anchor.href)){zimUrl=anchor.href.replace(/^(?:[^.]|\.(?!zim\/[CA]\/))+\.zim\//,'');}else {zimUrl=pseudoNamespace+pseudoDomainPath+anchor.search;}// It is necessary to fully decode zimit2, as these archives follow OpenZIM spec
  if(params.zimType==='zimit2'){zimUrl=decodeURIComponent(zimUrl);}// We need to test the ZIM link
  if(zimUrl){ev.preventDefault();ev.stopPropagation();// Note that true in the fourth argument instructs getDirEntryByPath to follow redirects by looking up the Header
  return appstate.selectedArchive.getDirEntryByPath(zimUrl,null,null,true).then(function(dirEntry){var processDirEntry=function processDirEntry(dirEntry){var pathToArticleDocumentRoot=document.location.href.replace(/www\/index\.html.*$/,appstate.selectedArchive.file.name+'/');var mimetype=dirEntry.getMimetype();// Due to the iframe sandbox, we have to prevent the PDF viewer from opening in the iframe and instead open it in a new tab
  // Note that some Replay PDFs have html mimetypes, or can be redirects to PDFs, we need to check the URL as well
  if(/pdf/i.test(mimetype)||/\.pdf(?:[#?]|$)/i.test(anchor.href)||/\.pdf(?:[#?]|$)/i.test(dirEntry.url)){if(/Android/.test(params.appType)||window.nw){// User is on an Android device, where opening a PDF in a new tab is not sufficient to evade the sandbox
  // so we need to download the PDF instead
  var readAndDownloadBinaryContent=function readAndDownloadBinaryContent(zimUrl){return appstate.selectedArchive.getDirEntryByPath(zimUrl).then(function(dirEntry){if(dirEntry){appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,content){var mimetype=fileDirEntry.getMimetype();uiUtil.displayFileDownloadAlert(zimUrl,true,mimetype,content);uiUtil.clearSpinner();});}else {return uiUtil.systemAlert('We could not find a PDF document at '+zimUrl,'PDF not found');}});};// If the document is in fact an html redirect, we need to follow it first till we get the underlying PDF document
  if(/\bx?html\b/.test(mimetype)){appstate.selectedArchive.readUtf8File(dirEntry,function(fileDirEntry,data){var redirectURL=data.match(/<meta[^>]*http-equiv="refresh"[^>]*content="[^;]*;url='?([^"']+)/i);if(redirectURL){redirectURL=redirectURL[1];var contentUrl=pseudoNamespace+redirectURL.replace(/^[^/]+\/\//,'');return readAndDownloadBinaryContent(contentUrl);}else {return readAndDownloadBinaryContent(zimUrl);}});}else {return readAndDownloadBinaryContent(zimUrl);}}else {window.open(pathToArticleDocumentRoot+zimUrl,params.windowOpener==='tab'?'_blank':dirEntry.title,params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);}}else {clearFindInArticle();if(/\bx?html\b/i.test(mimetype)){// We need to remember this page as the last-visted page
  params.lastPageVisit=dirEntry.namespace+'/'+dirEntry.url+'@kiwixKey@'+appstate.selectedArchive.file.name;if(params.rememberLastPage){settingsStore$1.setItem('lastPageVisit',params.lastPageVisit,Infinity);settingsStore$1.setItem(appstate.selectedArchive.file.name,dirEntry.namespace+'/'+dirEntry.url,Infinity);}}// Handle middle-clicks and ctrl-clicks
  if(ev.ctrlKey||ev.metaKey||ev.button===1){var encodedTitle=encodeURIComponent(dirEntry.getTitleOrUrl());articleWindow=window.open(pathToArticleDocumentRoot+zimUrl,params.windowOpener==='tab'?'_blank':encodedTitle,params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);// Conditional, because opening a new window can be blocked by the browser
  if(articleWindow){appstate.target='window';// This throws in the UWP app
  if(!/UWP/.test(params.appType)){articleWindow.kiwixType=appstate.target;}articleContainer$1=articleWindow;}uiUtil.clearSpinner();}else {// Let Replay handle this link
  anchor.passthrough=true;articleContainer$1=document.getElementById('articleContent');articleWindow=articleContainer$1.contentWindow;appstate.target='iframe';articleContainer$1.kiwixType=appstate.target;if(appstate.selectedArchive.zimType==='zimit2'){// Since we know the URL works, normalize the href (this is needed for zimit2 relative links)
  // NB We mustn't do this for zimit classic because it breaks wombat rewriting of absolute links!
  anchor.href=pathToArticleDocumentRoot+zimUrl;}anchor.click();// Poll spinner with abbreviated title
  uiUtil.pollSpinner('Loading '+dirEntry.getTitleOrUrl().replace(/([^/]+)$/,'$1').substring(0,18)+'...');var zimitIframe=appstate.selectedArchive.zimType==='zimit'?articleContainer$1.contentDocument.getElementById('replay_iframe'):appstate.selectedArchive.zimType==='zimit2'?articleContainer$1:null;if(params.cssTheme==='darkReader'&&zimitIframe){// articleContainer.style.display = 'none';
  zimitIframe.style.display='none';uiUtil.hideSlidingUIElements();}}}};if(dirEntry){processDirEntry(dirEntry);}else {// If URL has final slash, we need to try it without the slash
  if(/\/$/.test(zimUrl)){zimUrl=zimUrl.replace(/\/$/,'');return appstate.selectedArchive.getDirEntryByPath(zimUrl).then(function(dirEntry){if(dirEntry){processDirEntry(dirEntry);}else {// If dirEntry was still not-found, it's probably an external link, so warn user before opening a new tab/window
  uiUtil.warnAndOpenExternalLinkInNewTab(null,anchor);}});}else {// It's probably an external link, so warn user before opening a new tab/window
  uiUtil.warnAndOpenExternalLinkInNewTab(null,anchor);}}}).catch(function(err){console.error('Error getting dirEntry for '+zimUrl,err);uiUtil.systemAlert('There was an error looking up '+zimUrl,'Error reading direcotry entry!');});}}function handleUnsupportedReplayWorker(unhandledDirEntry){appstate.isReplayWorkerAvailable=false;// params.originalContentInjectionMode = params.contentInjectionMode;
  // params.contentInjectionMode = 'jquery';
  readArticle(unhandledDirEntry);if(!params.hideActiveContentWarning){uiUtil.displayActiveContentWarning();return uiUtil.systemAlert('<p>You are attempting to open a Zimit (classic) archive, '+'which is not fully supported by your browser in ServiceWorker(Local) mode.</p><p>We are using a legacy '+'fallback method to read this archive, but some highly dynamic content may not work.</p>','Legacy support for Zimit archives');}}/**
   * Function that handles a messaging from the Service Worker when using libzim as the backend.
   * It tries to read the content in the backend, and sends it back to the ServiceWorker
   *
   * @param {Event} event The event object of the message channel
   */function handleMessageChannelForLibzim(event){if(appstate.selectedArchive.libzimReady!=='ready'){return uiUtil.systemAlert("We're sorry, but the experimental libzim file reader isn't ready yet. Please wait a few seconds and try again, or reload the app.");}// The ServiceWorker asks for some content
  loaded=false;var title=event.data.title;var messagePort=event.ports[0];return appstate.selectedArchive.callLibzimWorker({action:'getEntryByPath',path:title,follow:false}).then(function(dirEntry){if(dirEntry===null){console.error('Title '+title+' not found in archive.');messagePort.postMessage({action:'giveContent',title:title,content:''});}else if(dirEntry.isRedirect){var redirectPath=dirEntry.redirectPath;// Ask the ServiceWorker to send an HTTP redirect to the browser.
  messagePort.postMessage({action:'sendRedirect',title:title,redirectUrl:redirectPath});// We have to prevent a null load event from firing, or else we get CORS errors blocking the app
  // loaded = true;
  }else {dirEntry.url=title.replace(/^[-ABCHIJMUVWX]\//,'');// DEV: Unlike with custom backend, libzim dirEntries contain a mimetype string rather than a function
  var message={action:'giveContent',title:title,content:dirEntry.content,mimetype:dirEntry.mimetype,origin:'libzim'};if(/\bx?html\b/i.test(dirEntry.mimetype)&&!dirEntry.isAsset){if(articleContainer$1.kiwixType==='iframe')articleContainer$1.style.display='none';articleContainer$1.onload=function(){// if (loaded) return;
  // articleContainer.style.display = '';
  // resizeIFrame();
  // // Trap clicks in the iframe to enable us to work around the sandbox when opening external links and PDFs
  // articleWindow.removeEventListener('click', filterClickEvent, true);
  // articleWindow.addEventListener('click', filterClickEvent, true);
  _articleLoadedSW(dirEntry,articleContainer$1);};}messagePort.postMessage(message);}}).catch(function(){messagePort.postMessage({action:'giveContent',title:title,content:new Uint8Array()});});}var loadingArticle='';/**
   * Function that handles a message of the messageChannel.
   * It tries to read the content in the backend, and sends it back to the ServiceWorker
   *
   * @param {Event} event The event object of the message channel
   */function handleMessageChannelMessage(event){// We received a message from the ServiceWorker
  loaded=false;var title=event.data.title;if(appstate.isReplayWorkerAvailable){// Zimit ZIMs store assets with the querystring, so we need to add it!
  title=title+event.data.search;}else {// Zimit1 (classic) archives store URLs encoded, and also need the URI component (search parameter) if any
  if(params.zimType==='zimit'){title=encodeURI(event.data.title)+event.data.search;}// If it's an asset, we have to mark the dirEntry so that we don't load it if it has an html MIME type
  var titleIsAsset=/\.(png|gif|jpe?g|svg|css|js|mpe?g|webp|webm|woff2?|eot|mp[43])(\?|$)/i.test(title);// For Zimit archives, articles will have a special parameter added to the URL to help distinguish an article from an asset
  if(params.zimType==='zimit'){titleIsAsset=titleIsAsset||!/\??isKiwixHref/.test(title);}title=title.replace(/\??isKiwixHref/,'');// Only applies to Zimit archives (added in transformZimit.js)
  }if(appstate.selectedArchive.landingPageUrl===title)params.isLandingPage=true;var messagePort=event.ports[0];if(!anchorParameter&&event.data.anchorTarget)anchorParameter=event.data.anchorTarget;// Intercept landing page if already transformed (because this might have a fake dirEntry)
  // Note that due to inconsistencies in Zimit archives, we need to test the encoded and the decoded version of the title
  if(transformedHTML&&transDirEntry&&(title===transDirEntry.namespace+'/'+transDirEntry.url||decodeURIComponent(title)===transDirEntry.namespace+'/'+transDirEntry.url)){var message={action:'giveContent',title:title,mimetype:'text/html'};postTransformedHTML(message,messagePort,transDirEntry);return;}var readFile=function readFile(dirEntry){if(dirEntry===null){console.warn('Title '+title.replace(/^(.{1,160}).*/,'$1...')+' not found in archive.');if(!titleIsAsset&&appstate.selectedArchive.zimType==='zimit'&&!appstate.isReplayWorkerAvailable){// Use special routine to handle not-found titles for Zimit
  goToArticle(decodeURI(title));}else if(title===loadingArticle){goToMainArticle();}else {// DEV: We send null for the content, so that the ServiceWorker knows that the article was not found (as opposed to being merely empty)
  messagePort.postMessage({action:'giveContent',title:title,content:null,zimType:appstate.selectedArchive.zimType});}}else if(dirEntry.isRedirect()){appstate.selectedArchive.resolveRedirect(dirEntry,function(resolvedDirEntry){var redirectURL=resolvedDirEntry.namespace+'/'+resolvedDirEntry.url;// Ask the ServiceWork to send an HTTP redirect to the browser.
  // We could send the final content directly, but it is necessary to let the browser know in which directory it ends up.
  // Else, if the redirect URL is in a different directory than the original URL,
  // the relative links in the HTML content would fail. See #312
  messagePort.postMessage({action:'sendRedirect',title:title,redirectUrl:redirectURL});});// Bypass all processing if we're using the Replay Worker
  }else if(appstate.isReplayWorkerAvailable){// Let's read the content in the ZIM file
  appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,content){var mimetype=fileDirEntry.getMimetype();// Show the spinner
  var shortTitle=dirEntry.getTitleOrUrl().replace(/^.*?([^/]{3,18})[^/]*\/?$/,'$1 ...');if(!/moved/i.test(shortTitle)&&!/javascript|image|woff|warc-headers|jsonp?/.test(mimetype)){uiUtil.pollSpinner(shortTitle);}// Let's send the content to the ServiceWorker
  var buffer=content.buffer?content.buffer:content;var message={action:'giveContent',title:title,content:buffer,mimetype:mimetype,zimType:appstate.selectedArchive.zimType};messagePort.postMessage(message);// Ensure the article onload event gets attached to the right iframe
  articleLoader(dirEntry,mimetype);});}else {var mimetype=dirEntry.getMimetype();var imageDisplayMode=params.imageDisplayMode;if(/\b(css|javascript|video|vtt|webm)\b/i.test(mimetype)){var shortTitle=dirEntry.url.replace(/[^/]+\//g,'').substring(0,18);uiUtil.pollSpinner('Getting '+shortTitle+'...');}// If it's an HTML type and not an asset, and we're not using pureMode, then we load it in a new page instance
  if(/\bx?html\b/i.test(mimetype)&&!appstate.pureMode&&!dirEntry.isAsset&&!/\.(png|gif|jpe?g|svg|css|js|mpe?g|webp|webm|woff2?|eot|mp[43])(\?|$)/i.test(dirEntry.url)){loadingArticle=title;// Intercept files of type html and apply transformations
  var message={action:'giveContent',title:title,mimetype:mimetype,imageDisplay:imageDisplayMode};if(!transformedHTML){// It's an unstransformed html file, so we need to do some content transforms and wait for the HTML to be available
  if(!~params.lastPageVisit.indexOf(dirEntry.url))params.lastPageVisit='';// Tell the read routine that the request comes from a messageChannel
  messageChannelWaiting=true;readArticle(dirEntry);setTimeout(postTransformedHTML,300,message,messagePort,dirEntry);}else {postTransformedHTML(message,messagePort,dirEntry);}return;}else {loadingArticle='';}var cacheKey=appstate.selectedArchive.file.name+'/'+title;cache.getItemFromCacheOrZIM(appstate.selectedArchive,cacheKey,dirEntry).then(function(content){if(params.zimType==='zimit'&&(loadingArticle||/\bx?html/.test(mimetype)&&/window._WBWombat/.test(content))){// We need to work around the redirection script in all Zimit HTML files in case we're loading the HTML in a frame
  // or as a new window
  content=content.replace(/!(window._WBWombat)/,'$1');}// Let's send the content to the ServiceWorker
  var buffer=content.buffer?content.buffer:content;var message={action:'giveContent',title:title,mimetype:mimetype,imageDisplay:imageDisplayMode,content:buffer};if(dirEntry.nullify){message.content='';}else if(!params.windowOpener&&/\/pdf\b/.test(mimetype)){// This is a last gasp attempt to avoid a CSP violation with PDFs. If windowOpener is set, then they should open
  // in a new window, but if user has turned that off, we need to offer PDFs as a download
  uiUtil.displayFileDownloadAlert(title,true,mimetype,content);uiUtil.clearSpinner();return;}messagePort.postMessage(message);});}};if(params.zimType==='zimit'&&!appstate.isReplayWorkerAvailable){title=title.replace(/^([^?]+)(\?[^?]*)?$/,function(m0,m1,m2){// Note that Zimit ZIMs store ZIM URLs encoded, but SOME incorrectly encode using encodeURIComponent, instead of encodeURI!
  return m1.replace(/[&]/g,'%26').replace(/,/g,'%2C')+(m2||'');});}// Intercept YouTube video requests
  if(params.zimType==='zimit'&&!appstate.isReplayWorkerAvailable&&/youtubei.*player/.test(title)){var cns=appstate.selectedArchive.getContentNamespace();var newTitle=(cns==='C'?'C/':'')+'A/'+'youtube.com/embed/'+title.replace(/^[^?]+\?key=([^&]+).*/,'$1');newTitle='videoembed/'+newTitle;// This is purely to match the regex in transformZimit
  transformZimit.transformVideoUrl(newTitle,articleDocument,function(newVideoUrl){// NB this will intentionally fail, as we don't want to look up content yet
  return newVideoUrl;});return;}appstate.selectedArchive.getDirEntryByPath(title).then(function(dirEntry){if(dirEntry)dirEntry.isAsset=titleIsAsset;return readFile(dirEntry);}).catch(function(err){console.error('Failed to read '+title,err);messagePort.postMessage({action:'giveContent',title:title,content:new Uint8Array(),zimType:appstate.selectedArchive.zimType});});}function postTransformedHTML(thisMessage,thisMessagePort,thisDirEntry){if(transformedHTML&&/<html[^>]*>/i.test(transformedHTML)){// Because UWP app window can only be controlled from the Service Worker, we have to allow all images
  // to be called from any external windows. NB messageChannelWaiting is only true when user requested article from a UWP window
  if(/UWP/.test(params.appType)&&(appstate.target==='window'||messageChannelWaiting)&&params.imageDisplay){thisMessage.imageDisplay='all';}// We need to do the same for Gutenberg and PHET ZIMs
  if(params.imageDisplay&&/gutenberg|phet/i.test(appstate.selectedArchive.file.name)// || params.isLandingPage
  ){thisMessage.imageDisplay='all';}// Let's send the content to the ServiceWorker
  thisMessage.content=transformedHTML;transformedHTML='';transDirEntry=null;loaded=false;// If loading the iframe, we can hide the frame for UWP apps (for others, the doc should already be hidden)
  // NB Test for messageChannelWaiting filters out requests coming from a UWP window
  if(articleContainer$1.kiwixType==='iframe'&&!messageChannelWaiting){if(/UWP/.test(params.appType)){articleContainer$1.style.display='none';setTimeout(function(){if(!loaded)_articleLoadedSW(thisDirEntry,articleContainer$1);},800);}articleContainer$1.onload=function(){if(!loaded)_articleLoadedSW(thisDirEntry,articleContainer$1);};}else {// New windows do not respect the onload event because they've been pre-populated,
  // so we have to simulate this event (note potential for race condition if timeout is too short)
  // NB The UWP app cannot control the opened window, so it can only be controlled by the Service Worker
  setTimeout(function(){uiUtil.clearSpinner();},2000);if(!/UWP/.test(params.appType)){setTimeout(function(){if(!loaded)_articleLoadedSW(thisDirEntry,articleContainer$1);},400);}}thisMessagePort.postMessage(thisMessage);messageChannelWaiting=false;// Failsafe to turn off spinner
  setTimeout(function(){uiUtil.clearSpinner();},5000);}else if(messageChannelWaiting){setTimeout(postTransformedHTML,500,thisMessage,thisMessagePort,thisDirEntry);}}// Compile some regular expressions needed to modify links
  params.regexpZIMUrlWithNamespace=/^[./]*([-ABCHIJMUVWX]\/.+)$/;// The case-insensitive regex below finds images, scripts, and stylesheets with ZIM-type metadata and image namespaces.
  // It first searches for <img, <script, <link, etc., then scans forward to find, on a word boundary, either src=["'] or href=["']
  // (ignoring any extra whitespace), and it then tests the path of the URL with a non-capturing negative lookahead (?!...) that excludes
  // absolute URIs with protocols that conform to RFC 3986 (e.g. 'http:', 'data:'). It then captures the whole of the URL up until any
  // querystring (? character) which (if it is exists) is captured with its contents in another group. The regex then tests for the end
  // of the URL with the opening delimiter (" or ', which is capture group \3) or a hash character (#). When the regex is used below, it
  // will be further processed to calculate the ZIM URL from the relative path. This regex can cope with legitimate single quote marks (') in the URL.
  params.regexpTagsWithZimUrl=/(<(?:img|script|link)\b[^>]*?\s)(?:src|href)(\s*=\s*(["']))(?![a-z][a-z0-9+.-]+:)(.+?)(\?.*?)?(?=\3|#)([\s\S]*?>)/ig;// Similar to above, but tailored for Zimit links
  // params.regexpZimitLinks = /(<(?:a|img|script|link|track)\b[^>]*?\s)(?:src|href)(=(["']))(?!#)(.+?)(?=\3|\?|#)([\s\S]*?>)/ig;
  // Regex below tests the html of an article for active content [kiwix-js #466]
  // It inspects every <script> block in the html and matches in the following cases: 1) the script is of type "module"; 2) the script
  // loads a UI application called app.js, init.js, or other common scripts found in unsupported ZIMs; 3) the script block has inline
  // content that does not contain "importScript()", "toggleOpenSection" or an "articleId" assignment (these strings are used widely in our
  // fully supported wikimedia ZIMs, so they are excluded); 4) the script block is not of type "math" (these are MathJax markup scripts used
  // extensively in Stackexchange ZIMs). Note that the regex will match ReactJS <script type="text/html"> markup, which is common in unsupported
  // packaged UIs, e.g. PhET ZIMs.
  var regexpActiveContent=/<script\b(?:(?![^>]+src\b)|(?=[^>]*type=["']module["'])|(?=[^>]+src\b=["'][^"']*?\b(?:app|init|ractive|l1[08]9)\.js))(?![^<]+(?:importScript\(\)|toggleOpenSection|articleId\s?=\s?['"]|window.NREUM))(?![^>]+type\s*=\s*["'](?:math\/|[^"']*?math))/i;// DEV: The regex below matches ZIM links (anchor hrefs) that should have the html5 "donwnload" attribute added to
  // the link. This is currently the case for epub and pdf files in Project Gutenberg ZIMs -- add any further types you need
  // to support to this regex. The "zip" has been added here as an example of how to support further filetypes
  var regexpDownloadLinks=/^.*?\.epub([?#]|$)|^.*?\.pdf([?#]|$)|^.*?\.odt([?#]|$)|^.*?\.zip([?#]|$)/i;// This matches the data-kiwixurl of all <link> tags containing rel="stylesheet" or "...icon" in raw HTML unless commented out
  var regexpSheetHref=/(<link\s+(?=[^>]*rel\s*=\s*["'](?:stylesheet|[^"']*icon))[^>]*(?:href|data-kiwixurl)\s*=\s*["'])([^"']+)(["'][^>]*>)(?!\s*--\s*>)/ig;// A string to hold any anchor parameter in clicked ZIM URLs (as we must strip these to find the article in the ZIM)
  var anchorParameter;params.containsMathTexRaw=false;params.containsMathTex=false;params.containsMathSVG=false;/**
   * Display the the given HTML article in the web page,
   * and convert links to javascript calls
   * NB : in some error cases, the given title can be null, and the htmlArticle contains the error message
   * @param {DirEntry} dirEntry The Directory Entry of the article
   * @param {String} htmlArticle The decoded HTML of the article
   */function displayArticleContentInContainer(dirEntry,htmlArticle){// if (! isDirEntryExpectedToBeDisplayed(dirEntry)) {
  //    return;
  // }
  // TESTING
  console.log('** HTML received for article '+dirEntry.url+' **');if(!/\bx?html\b/.test(dirEntry.getMimetype())){// Construct an HTML document to wrap the content
  htmlArticle='<html><body style="color:yellow;background:darkblue;"><pre>'+htmlArticle+'</pre></body></html>';// Ensure the window target is permanently stored as a property of the articleWindow (since appstate.target can change)
  articleWindow.kiwixType=appstate.target;// Scroll the old container to the top
  articleWindow.scrollTo(0,0);var articleDoc=articleWindow.document;articleDoc.open();articleDoc.write(htmlArticle);articleDoc.close();return;}// If we find a stylesheet beginning with a root-relative link ('/something.css'), then we're in a very old legacy ZIM
  params.isLegacyZIM=false;if(params.zimType==='open'){params.isLegacyZIM=/<link\b[^>]+href\s*=\s*["']\/[^."']+\.css["']/i.test(htmlArticle);}params.isLandingPage=appstate.selectedArchive.landingPageUrl===dirEntry.namespace+'/'+dirEntry.url?true:params.isLandingPage;// Due to fast article retrieval algorithm, we need to embed a reference to the landing page in the html
  if(params.isLandingPage&&!/<html[^>]*islandingpage/i.test(htmlArticle)){htmlArticle=htmlArticle.replace(/(<html[^>]*)>/i,'$1 data-kiwixid="islandingpage">');}// Display Bootstrap warning alert if the landing page contains active content
  if(!params.hideActiveContentWarning&&(params.isLandingPage||appstate.selectedArchive.zimitStartPage===dirEntry.namespace+'/'+dirEntry.url)&&(params.contentInjectionMode==='jquery'||params.manipulateImages||params.allowHTMLExtraction||/zimit/.test(appstate.selectedArchive.zimType))){if(params.isLegacyZIM||regexpActiveContent.test(htmlArticle)){// Exempted scripts: active content warning will not be displayed if any listed script is in the html [kiwix-js #889]
  if(params.isLegacyZIM||!/<script\b[^'"]+['"][^'"]*?mooc\.js/i.test(htmlArticle)){setTimeout(function(){uiUtil.displayActiveContentWarning(params.isLegacyZIM?'legacy':params.zimType);},1500);}if(params.isLegacyZIM&&params.contentInjectionMode==='serviceworker'){// Pop up a dialogue box to warn the user about the legacy ZIM
  uiUtil.systemAlert('<p>To view this legacy ZIM archive with its correct stylesheets, you will need to switch to Restricted mode.</p>'+"<p>Don't forget to switch back afterwards!</p>",'Legacy ZIM file');}}}// App appears to have successfully launched
  params.appIsLaunching=false;// Calculate the current article's ZIM baseUrl to use when processing relative links
  // (duplicated because we sometimes bypass readArticle above)
  params.baseURL=encodeURI(dirEntry.namespace+'/'+dirEntry.url.replace(/[^/]+$/,''));// URI-encode anything that is not a '/'
  // .replace(/[^/]+/g, function(m) {
  //     return encodeURIComponent(m);
  // });
  // Since page has been successfully loaded, store it in the browser history
  if(params.contentInjectionMode==='jquery')pushBrowserHistoryState(dirEntry.namespace+'/'+dirEntry.url);// Store for fast retrieval
  params.lastPageVisit=dirEntry.namespace+'/'+dirEntry.url+'@kiwixKey@'+appstate.selectedArchive.file.name;settingsStore$1.setItem('lastPageVisit',params.rememberLastPage?params.lastPageVisit:'',Infinity);cache.setArticle(appstate.selectedArchive.file.name,dirEntry.namespace+'/'+dirEntry.url,htmlArticle,function(){});params.htmlArticle=htmlArticle;// Get the page theme type (desktop / mobile)
  appstate.zimThemeType=/<link\b[^>]+(?:minerva|mobile)/i.test(htmlArticle)?'mobile':'desktop';appstate.zimThemeType=/<link\b[^>]+(?:-\/s\/style\.css|vector)/i.test(htmlArticle)?'desktop':appstate.zimThemeType;// Replaces ZIM-style URLs of img, script, link and media tags with a data-kiwixurl to prevent 404 errors [kiwix-js #272 #376]
  // This replacement also processes the URL relative to the page's ZIM URL so that we can find the ZIM URL of the asset
  // with the correct namespace (this works for old-style -,I,J namespaces and for new-style C namespace)
  if(params.linkToWikimediaImageFile&&!params.isLandingPage&&/(?:wikipedia|wikivoyage|wiktionary|mdwiki)_/i.test(appstate.selectedArchive.file.name)){var wikiLang=appstate.selectedArchive.file.name.replace(/(?:wikipedia|wikivoyage|wiktionary|mdwiki)_([^_]+).+/i,'$1');var wikimediaZimFlavour=appstate.selectedArchive.file.name.replace(/_.+/,'');}var newBlock;var assetZIMUrlEnc;var indexRoot=window.location.pathname.replace(/[^/]+$/,'')+encodeURI(appstate.selectedArchive.file.name)+'/';if(params.contentInjectionMode=='jquery'){htmlArticle=htmlArticle.replace(params.regexpTagsWithZimUrl,function(match,blockStart,equals,quote,relAssetUrl,querystring,blockClose){// Don't process data URIs (yet)
  if(/data:image/i.test(relAssetUrl))return match;// We need to save the query string if any for Zimit-style archives
  querystring=querystring||'';if(/zimit/.test(params.zimType)){assetZIMUrlEnc=relAssetUrl.replace(indexRoot,'');assetZIMUrlEnc=assetZIMUrlEnc+querystring;}if(params.zimType!=='zimit'){// DEV: Note that deriveZimUrlFromRelativeUrl produces a *decoded* URL (and incidentally would remove any URI component
  // if we had captured it). We therefore re-encode the URI with encodeURI (which does not encode forward slashes) instead
  // of encodeURIComponent.
  assetZIMUrlEnc=encodeURI(uiUtil.deriveZimUrlFromRelativeUrl(relAssetUrl,params.baseURL));}newBlock=blockStart+'data-kiwixurl'+equals+assetZIMUrlEnc+blockClose;// Replace any srcset with data-kiwixsrcset
  newBlock=newBlock.replace(/\bsrcset\s*=/,'data-kiwixsrcset=');// For Wikipedia archives, hyperlink the image to the File version
  if(wikiLang&&/^<img/i.test(blockStart)&&!/usemap=|math-fallback-image/i.test(match)){newBlock='<a href="https://'+(wikimediaZimFlavour!=='mdwiki'?wikiLang+'.':'')+wikimediaZimFlavour+'.org/wiki/File:'+assetZIMUrlEnc.replace(/^.+\/([^/]+?\.(?:jpe?g|svg|png|gif))[^/]*$/i,'$1')+'" target="_blank">'+newBlock+'</a>';}return newBlock;});// We also need to process data:image/webp if the browser needs the WebPMachine
  if(webpMachine)htmlArticle=htmlArticle.replace(/(<img\b[^>]*?\s)src(\s*=\s*["'])(?=data:image\/webp)([^"']+)/ig,'$1data-kiwixurl$2$3');// Remove any empty media containers on page (they can cause layout issue in Restricted mode)
  htmlArticle=htmlArticle.replace(/(<(audio|video)\b(?:[^<]|<(?!\/\2))+<\/\2>)/ig,function(p0){return /(?:src|data-kiwixurl)\s*=\s*["']/.test(p0)?p0:'';});}else if(wikiLang||params.manipulateImages){htmlArticle=htmlArticle.replace(params.regexpTagsWithZimUrl,function(match,blockStart,equals,quote,relAssetUrl,querystring,blockClose){// Don't process data URIs (yet)
  if(/data:image/i.test(relAssetUrl))return match;newBlock=match;// Add the kiwix-display directive so that the SW sends a dummy image instead
  if(params.manipulateImages&&params.imageDisplay!=='all'&&/^<img/i.test(blockStart)){newBlock=newBlock.replace(relAssetUrl,relAssetUrl+'?kiwix-display');}if(wikiLang){// For Wikipedia archives, hyperlink the image to the File version
  var assetZIMUrl=decodeURIComponent(relAssetUrl);if(/^<img/i.test(blockStart)&&!/usemap=|math-fallback-image/i.test(match)){newBlock='<a href="https://'+(wikimediaZimFlavour!=='mdwiki'?wikiLang+'.':'')+wikimediaZimFlavour+'.org/wiki/File:'+assetZIMUrl.replace(/^.+\/([^/]+?\.(?:jpe?g|svg|png|gif))[^/]*$/i,'$1')+'" target="_blank">'+newBlock+'</a>';}}return newBlock;});}if(params.zimType==='open'){// Some documents (e.g. Ray Charles Index) can't be scrolled to the very end, as some content remains benath the footer
  // so add some whitespace at the end of the document
  htmlArticle=htmlArticle.replace(/(<\/body>)/i,'\r\n<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>\r\n$1');htmlArticle=htmlArticle.replace(/(dditional\s+terms\s+may\s+apply\s+for\s+the\s+media\s+files[^<]+<\/div>\s*)/i,'$1\r\n<h1></h1><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>\r\n');var i;// Dirty patches that improve performance or layout with Wikimedia ZIMs. DEV: review regularly and remove when no longer needed.
  if(appstate.wikimediaZimLoaded&&params.cssCache){// Reduce weight of unused JS archives for mediawiki ZIMs and troublesome JS in mobile-html endpoint ZIMs. This patch also removes mediawiki.page.ready.js which breakds the iframe kiwix-js #972
  htmlArticle=htmlArticle.replace(/<script\b[^<]+src=["'][^"']*(mediawiki|wikimedia|jquery|configvars|startup|visibilitytoggles|site|enhancements|scribunto|ext\.math|\.player|webp(?:Handler|Hero))[^"']*\.js\b[^<]+<\/script>/gi,'');// Hide title on landing pages
  if(params.isLandingPage){// Remove the main title if it contains kiwix or popo
  htmlArticle=htmlArticle.replace(/<h1\s(?:[^<]|<(?!\/h1>))+?(?:kiwix|popo)(?:[^<]|<(?!\/h1>))+?<\/h1>\s?/i,'');// Remove any User:Popo spans
  htmlArticle=htmlArticle.replace(/<span\b[^>]+>[^/]*?User:Popo[^<]+<\/span>\s*/i,'');// Remove any initial div containing user:.*kiwix
  htmlArticle=htmlArticle.replace(/<div\b(?:[^<]|<(?!div|\/div>))+?user:[^<]*kiwix(?:[^<]|<(?!\/div>))+?<\/div>/i,'');// Remove landing page scripts that don't work in SW mode
  htmlArticle=htmlArticle.replace(/<script\b[^>]+-\/[^>]*((?:images_loaded|masonry)\.min|article_list_home)\.js"[^<]*<\/script>/gi,'');}// Remove wm_mobile_override script that intercepts all clicks and causes CORS errors
  htmlArticle=htmlArticle.replace(/<script\b[^>]+wm_mobile_override_script\.js[^<]*<\/script>/i,'');// Edit sidebar style to make it an infobox
  htmlArticle=htmlArticle.replace(/(<table\s+class=["'][^"']*)sidebar\s/gi,'$1infobox ');// Remove the script.js that closes top-level sections if user requested this
  if(params.openAllSections)htmlArticle=htmlArticle.replace(/<script\b[^>]+-\/(j\/js_modules\/)?script\.js"[^<]*<\/script>/i,'');// Deal with incorrectly sized masonry pages
  htmlArticle=htmlArticle.replace(/(<body\b[^<]+<div\b[^>]+?id=['"]container['"][^>]*)/i,'$1 style="height:auto;"');// @TODO Remove when fixed in https://github.com/openzim/mwoffliner/issues/1662
  // Put site.js in the correct position
  htmlArticle=htmlArticle.replace(/(<script\b[^>]+\/site\.js["']><\/script>\s*)((?:[^<]|<(?!\/body))+)/,'$2$1');// @TODO Remove when fixed in https://github.com/openzim/mwoffliner/issues/1872
  // Add missing title to WikiMedia articles for post June 2023 scrapes, also post-June 2025
  htmlArticle=!params.isLandingPage&&!/<h1\b[^>]+(?:section-heading|section-title|article-header|first-heading)/i.test(htmlArticle)?htmlArticle.replace(/(<section\sdata-mw-section-id="0"[^>]+>\s*)/i,'$1<h1 style="margin:10px 0">'+dirEntry.getTitleOrUrl().replace(/&lt;/g,'<')+'</h1>'):htmlArticle;// Remove hard-coded image widths for new mobile-html endpoint ZIMs
  htmlArticle=htmlArticle.replace(/(<div\s+class=['"]thumb\stright['"][^<]+?<div\s+class=['"]thumbinner['"]\s+style=['"])width:\s*642px([^<]+?<img\s[^>]+?width=)[^>]+?height=['"][^'"]+?['"]/ig,'$1$2"320px"');htmlArticle=htmlArticle.replace(/(<img\s[^>]+(?:min-width:\s*|width=['"]))(\d+px)([^>]+>\s*<div\b[^>]+style=['"])/ig,'$1$2$3max-width: $2; ');// Remove reference to unusued pcs scripts (onBodyStart and onBodyEnd) in mobile-html endpoint ZIMs (causes unhandled type error)
  htmlArticle=htmlArticle.replace(/<script[^>]*>[^<]*pcs\.c1\.Page\.onBody[^<]+<\/script>\s*/ig,'');// Remove hard-coded width of 1em in table.infobox
  htmlArticle=htmlArticle.replace(/(<table\s[^>]*class=["']infobox[^>]+?style=["'][^"']*width:\s*)1(em;?)([^"']*?["'])/i,'$116$2$3');// Convert section tags to details tags if we're not on the landing page and if the ZIM style is mobile
  if(!params.isLandingPage&&(appstate.zimThemeType==='mobile'||params.cssSource==='mobile')&&(/<section\b[^>]*data-mw-section-id=["'][1-9]/i.test(htmlArticle)||/<div\sclass=["']mw-heading[^>]*>/i.test(htmlArticle))){// We have to loop because regex only matches innermost <section>...</section>
  if(/<section\b[^>]*data-mw-section-id=["'][1-9]/i.test(htmlArticle)){for(i=5;i--;){htmlArticle=htmlArticle.replace(/<section\b([^>]*data-mw-section-id=["'][1-9][^>]*)>((?:(?=([^<]+))\3|<(?!section\b[^>]*>))*?)<\/section>/ig,function(m0,m1,m2){var summary=m2.replace(/(?:<div\s+class=["'](?:pcs-edit|mw-heading)[^>]+>)?(<(h[2-9])\b[^>]*>(?:[^<]|<(?!\2))+?<\/\2>)(?:<\/div>)?/i,'<summary class="section-heading collapsible-heading">$1</summary>');return '<details '+m1+'>'+summary+'</details>';});// We can stop iterating if all sections are consumed
  if(!/<section\b[^>]*data-mw-section-id=["'][1-9]/i.test(htmlArticle))break;}}else {// We're dealing with an ActionParse ZIM that doesn't have section tags, so we convert the divs with mw-heading class to details-summary
  htmlArticle=htmlArticle.replace(/<div class=["']mw-heading[^>]*>\s*(<h([2-9])(?:[^<]|<(?!\/h\2))+?<\/h\2>)(\s*<\/div>)((?:[^<]|<(?!div class=['"]mw-heading|\/div>\s*<!--htdig_noindex))+)/ig,'<details><summary class="section-heading collapsible-heading">$1</summary>$4\r\n</details>\r\n');}}}else if(appstate.wikimediaZimLoaded&&params.openAllSections){// Remove incompatible webP handler that breaks on some Edge Legacy and conflicts with own webP handler
  // @TODO It appears webpHandler is loaded by script.js, so this line and equivalent in block above may be redundant. Check for latest ZIMs.
  // Maybe older ZIMs loaded them direct?
  htmlArticle=htmlArticle.replace(/<script\b[^>]+src=["'][^"']*(webp(?:Handler|Hero))[^"']*\.js\b[^<]+<\/script>/gi,'');htmlArticle=htmlArticle.replace(/<script\b[^>]+-\/(j\/js_modules\/)?script\.js"[^<]*<\/script>/i,'');}// Add a fake favicon to prevent the browser making a useless search for one
  if(!/<link\s[^>]*rel=["']icon["']/.test(htmlArticle))htmlArticle=htmlArticle.replace(/(<head\b[^>]*>)(\s*)/i,'$1<link rel="icon" href="data:,">$2');// Gutenberg ZIMs try to initialize before all assets are fully loaded. Affect UWP app.
  htmlArticle=htmlArticle.replace(/(<body\s[^<]*onload=(['"]))([^'"]*init\([^'"]+showBooks\([^'"]+)\2/i,'$1setTimeout(function () {$3}, 300);$2');if(appstate.zimThemeType==='mobile'){// Put misplaced hatnote headers inside <h1> block back in correct position @TODO remove this when fixed in mw-offliner
  var hatnote;var hatnotes=[];do{hatnote=util.matchOuter(htmlArticle,'<div\\b[^>]+\\b(?:hatnote|homonymie|dablink)\\b','</div>\\s*','i');if(hatnote&&hatnote.length){// Ensure the next matching hatnote is under h1
  if(/<h1\b(?:[^<]|<(?!h2))+<div\b[^>]+\b(?:hatnote|homonymie|dablink)\b/i.test(htmlArticle)){htmlArticle=htmlArticle.replace(hatnote[0],'');hatnotes.push(hatnote[0]);}else {break;}}}while(hatnote.length);// Ensure we replace them in the right order
  for(i=hatnotes.length;i--;){htmlArticle=htmlArticle.replace(/(<\/h1>\s*)/i,'$1'+hatnotes[i].replace(/(<div\s+)/i,'$1style="padding-top:10px;" '));}// Put misplaced disambiguation header back in its correct position @TODO remove this when fixed in mw-offliner
  var noexcerpt=htmlArticle.match(/<h1\b(?:[^<]|<(?!h2))+?(<dl\b(?:[^<]|<(?!\/dl>)){1,50}?(?:For\sother\s.{5,20}\swith\s|Not\sto\sbe\sconfused\swith|mw-redirect[^<]+travel\stopic|This\sarticle\sis\sa|See\salso:)(?:[^<]|<(?!\/dl>))+<\/dl>\s*)/i);if(noexcerpt&&noexcerpt[1]&&noexcerpt[1].length){htmlArticle=htmlArticle.replace(noexcerpt[1],'');htmlArticle=htmlArticle.replace(/(<\/h1>\s*)/i,'$1'+noexcerpt[1]);}}// Remove white background colour (causes flashes in dark mode)
  htmlArticle=htmlArticle.replace(/(<body\b[^>]+style=["'][^"']*)background-color\s*:\s*[^;]+;\s*/i,'$1');htmlArticle=htmlArticle.replace(/(<div\b(?=[^>]+class=\s*["'][^"']*mw-body)[^>]+style=["'][^"']*)background-color\s*:\s*[^;]+;\s*/i,'$1');// Display IPA pronunciation info erroneously hidden in some ZIMs
  htmlArticle=htmlArticle.replace(/(<span\b[^>]+?class\s*=\s*"[^"]+?mcs-ipa[^>]+?display:\s*)none/i,'$1inline');// Remove any background:url statements in style blocks as they cause the system to attempt to load them
  htmlArticle=htmlArticle.replace(/background:url\([^)]+\)[^;}]*/ig,'');// Remove the details polyfill: it's poor and doesn't recognize Edgium
  htmlArticle=htmlArticle.replace(/<script\b[^<]+details[^"']*polyfill\.js[^<]+<\/script>\s*/i,'');// Remove article.js on youtube ZIMs as it erroneously hides description
  htmlArticle=/<video\b/i.test(htmlArticle)?htmlArticle.replace(/<script\b[^<]+assets\/article\.js[^<]+<\/script>\s*/i,''):htmlArticle;// Remove empty div that causes layout issues in desktop style (but don't remove in SW mode, as they are dynamically filled)
  if(params.contentInjectionMode==='jquery')htmlArticle=htmlArticle.replace(/<div\b[^>]*?>\s*<\/div>\s*/,'');// Remove erroneous scrape of MDWiki owid iframes @TODO remove this when fixed in mw-offliner
  htmlArticle=htmlArticle.replace(/<iframe\b[^>]+class=["'][^"']*?owid-frame(?:[^<]|<(?!\/iframe>))+<\/iframe>\s*/ig,'');}if(params.contentInjectionMode=='jquery'){// Neutralize all inline scripts for now (later use above), excluding math blocks or react templates
  htmlArticle=htmlArticle.replace(/<(script\b(?![^>]+type\s*=\s*["'](?:math\/|text\/html|[^"']*?math))(?![^<]*darkreader\.)(?:[^<]|<(?!\/script>))+<\/script)>/ig,function(p0,p1){return '<!-- '+p1+' --!>';});// Neutralize onload events, as they cause a crash in ZIMs with proprietary UIs
  htmlArticle=htmlArticle.replace(/(<[^>]+?)onload\s*=\s*["'][^"']+["']\s*/ig,'$1');// Neutralize onclick events
  htmlArticle=htmlArticle.replace(/(<[^>]+?)onclick\s*=\s*["'][^"']+["']\s*/ig,'$1');// Neutralize href="javascript:" links
  htmlArticle=htmlArticle.replace(/href\s*=\s*["']javascript:[^"']+["']/gi,'href=""');// } else if (/journals\.openedition\.org/i.test(params.zimitPrefix)) {
  //     // Neutralize all inline scripts, excluding math blocks or react templates, as they cause a loop on loading article
  //     htmlArticle = htmlArticle.replace(/<(script\b(?![^>]+type\s*=\s*["'](?:math\/|text\/html|[^"']*?math))(?:[^<]|<(?!\/script>))+<\/script)>/ig, function (p0, p1) {
  //         return '<!-- ' + p1 + ' --!>';
  //     });
  }/**
       * MathML detection
       */// Get out of the way if Service Worker mode and there is an existing MathJax installation
  params.useMathJax=params.contentInjectionMode==='serviceworker'&&/<script\b[^>]+MathJax\.js/i.test(htmlArticle)?false:params.useMathJax;// Detect raw MathML on page for certain ZIMs that are expected to have it
  params.containsMathTexRaw=params.useMathJax&&/stackexchange|askubuntu|superuser|stackoverflow|mathoverflow|serverfault|stackapps|proofwiki/i.test(appstate.selectedArchive.file.name)?/[^\\](\$\$?)((?:\\\$|(?!\1)[\s\S])+)\1/.test(htmlArticle):false;// if (params.containsMathTexRaw) {
  //    //Replace undefined \size controlscript with \normalsize (found on proofwiki)
  //    htmlArticle = htmlArticle.replace(/(\\)size\b/g, '$1normalsize');
  // }
  // Replace all TeX SVGs with MathJax scripts
  if(params.useMathJax&&appstate.wikimediaZimLoaded){// Make any Wikimedia MathJax compatible with KaTeX
  htmlArticle=htmlArticle.replace(/<img\s+(?=[^>]+?math-fallback-image)[^>]*?alt\s*=\s*(['"])((?:[^"']|(?!\1)[\s\S])+)[^>]+>/ig,function(p0,p1,math){// Remove any rogue ampersands in MathJax due to double escaping (by Wikipedia)
  math=math.replace(/&amp;/g,'&');// Change any mbox commands to fbox (because KaTeX doesn't support mbox)
  math=math.replace(/mbox{/g,'fbox{');return '<script type="math/tex">'+math+'</script>';});}params.containsMathTex=params.useMathJax?/<(script|span)\s+(type|class)\s*=\s*['"]\s*(math\/tex|latex)\s*['"]/i.test(htmlArticle):false;params.containsMathSVG=params.useMathJax?/<img\s+(?=[^>]+?math-fallback-image)[^>]*?alt\s*=\s*['"][^'"]+[^>]+>/i.test(htmlArticle):false;// Add CSP to prevent external scripts and content - note that any existing CSP can only be hardened, not loosened
  htmlArticle=htmlArticle.replace(/(<head\b[^>]*>)\s*/,'$1\n    <meta http-equiv="Content-Security-Policy" content="default-src \'self\' data: file: blob: bingmaps: about: \'unsafe-inline\' \'unsafe-eval\';"></meta>\n    ');// Maker return links
  uiUtil.makeReturnLink(dirEntry.getTitleOrUrl());if(params.zimType==='open'){// Adapt German Wikivoyage POI data format
  var regexpGeoLocationDE=/<span\s+class="[^"]+?listing-coordinates[\s\S]+?latitude">([^<]+)[\s\S]+?longitude">([^<]+)<[\s\S]+?(<bdi\s[^>]+?listing-name[^>]+>(?:<a\b\s+href[^>]+>)?([^<]+))/ig;htmlArticle=htmlArticle.replace(regexpGeoLocationDE,function(match,latitude,longitude,href,id){var html;if(/bingmaps/.test(params.mapsURI)){html='<a href="'+params.mapsURI+'?collection=point.'+latitude+'_'+longitude+'_'+encodeURIComponent(id.replace(/_/g,' '))+'">\r\n';}if(/openstreetmap/.test(params.mapsURI)){html='<a href="'+params.mapsURI+'?mlat='+latitude+'&mlon='+longitude+'#map=18/'+latitude+'/'+longitude+'">\r\n';}html+='<img alt="Map marker" title="Diesen Ort auf einer Karte zeigen" src="app:///www/img/icons/map_marker-30px.png" width="18px" style="position:relative !important;top:-5px !important;margin-top:5px !important" />\r\n</a>'+href;return html;});// Adapt English Wikivoyage POI data format
  var regexpGeoLocationEN=/(href\s?=\s?")geo:([^,]+),([^"]+)("[^>]+?(?:data-zoom[^"]+"([^"]+))?[^>]+>)[^<]+(<\/a>[\s\S]+?<span\b(?=[^>]+listing-name)[\s\S]+?id\s?=\s?")([^"]+)/ig;var mapPin30='<img alt="Map marker" title="Show this place on a map" src="app:///www/img/icons/map_marker-30px.png" width="18px" style="position:relative !important;top:-5px !important;" />';htmlArticle=htmlArticle.replace(regexpGeoLocationEN,function(match,hrefAttr,latitude,longitude,p4,p5,p6,id){var html;if(/bingmaps/.test(params.mapsURI)){html=hrefAttr+params.mapsURI+'?collection=point.'+latitude+'_'+longitude+'_'+encodeURIComponent(id.replace(/_/g,' ')).replace(/\.(\w\w)/g,'%$1')+(p5?'&lvl='+p5:'')+p4.replace(/style=["']\s?background:[^"']+["']/i,'');}if(/openstreetmap/.test(params.mapsURI)){html=hrefAttr+params.mapsURI+'?mlat='+latitude+'&mlon='+longitude+'#map=18/'+latitude+'/'+longitude+p4.replace(/style=["']\s?background:[^"']+["']/i,'');}html+=mapPin30+p6+id;return html;});// Clean up remaining geo: links
  var mapPin18='<img alt="Map marker" title="Show this place on a map" src="app:///www/img/icons/map_marker-18px.png" width="12px" />';if(/bingmaps:/.test(params.mapsURI)){htmlArticle=htmlArticle.replace(/href=['"]geo:([\d.-]+),([\d.-]+)[^"']*([^>]+>)/ig,'href="'+params.mapsURI+'?collection=point.$1_$2_'+encodeURIComponent(dirEntry.getTitleOrUrl())+'$3'+mapPin18+'&nbsp;');}if(/openstreetmap/.test(params.mapsURI)){htmlArticle=htmlArticle.replace(/href=['"]geo:([\d.-]+),([\d.-]+)[^"']*([^>]+>)/ig,'href="'+params.mapsURI+'?mlat=$1&mlon=$2#map=18/$1/$2$3'+mapPin18+'&nbsp;');}// Process any app:// links (these are always from the app payload) to match the current protocol
  htmlArticle=htmlArticle.replace(/(['"])app:\/\//g,function(p0,p1){var appRootDir=window.location.href.replace(/\/www\/.*$/i,'');return p1+appRootDir;});// Remove erroneous caption on maps that displaces the location marker in at least German Wikivoyage
  htmlArticle=htmlArticle.replace(/(<table\b(?=[^>]+class=["']locationMap)(?:[^<]|<(?!\/table>))+?<img\b[^>]+>)<div\s+class=['"]thumbcaption(?:[^<]|<(?!\/div>))+<\/div>((?:[^<]|<(?!\/table>))+?<div\s+style=['"]position:\s*absolute)/ig,'$1$2');// Setup endnote backlinks if the ZIM doesn't have any
  htmlArticle=htmlArticle.replace(/<li\b[^>]+id=["']cite[-_]note[-_]([^"']+)[^>]+>(?![^/]+?[↑^])/ig,function(match,id){var fnReturnMatch='';try{var fnSearchRegxp=new RegExp('id=["'+"'](cite[-_]ref[-_]"+id.replace(/[-_()+?]/g,'[-_()]+?')+'[^"'+"']*)",'i');fnReturnMatch=htmlArticle.match(fnSearchRegxp);}catch(err){console.error('Error constructiong regular expression in app.js',err);}var fnReturnID=fnReturnMatch?fnReturnMatch[1]:'';return match+'\r\n<a href="#'+fnReturnID+'">^&nbsp;</a>';});// Exempt Nautilus and YouTube based ZIMs from stylesheet preloading
  var nautilus=params.contentInjectionMode==='serviceworker'?htmlArticle.match(/<script\b[^>]+['"][^'"]*(?:nautilus|zim_prefix)\.js[^'"]*[^>]*>[^<]*<\/script>\s*/i):null;}if(params.zimType==='open'&&!nautilus){// Preload stylesheets [kiwix-js #149]
  console.log('Loading stylesheets...');// Set up blobArray of promises
  window.location.pathname.replace(/\/[^/]*$/,'');var cssArray=htmlArticle.match(regexpSheetHref);var blobArray=[];var cssSource=params.cssSource;var cssCache=params.cssCache;var zimType='';if(cssArray){getBLOB(cssArray);}else {injectHTML();}}else {// Zimit ZIMs, or nautilus, should not manipulate styles
  injectHTML();}// Extract CSS URLs from given array of links
  function getBLOB(arr){var testCSS=arr.join();zimType=/-\/static\/main\.css|statc\/css\/sotoki.css/i.test(testCSS)?'desktop-stx':zimType;// Support stackexchange
  zimType=/gutenberg\.css/i.test(testCSS)?'desktop-gtb':zimType;// Support Gutenberg
  zimType=/minerva|mobile/i.test(testCSS)?'mobile':zimType;zimType=/-\/s\/style\.css|vector/i.test(testCSS)?'desktop':zimType;cssSource=cssSource=='auto'?zimType:cssSource;// Default to in-built zimType if user has selected automatic detection of styles
  // Report ZIM style to config #zimstyle
  document.getElementById('zimtype').innerHTML='current ZIM style: <b>'+zimType+'</b>';if(/minerva|inserted.style|pcs\.css/i.test(testCSS)&&(cssCache||zimType!=cssSource)){// Substitute ridiculously long style name TODO: move this code to transformStyles
  for(var i=arr.length;i--;){// TODO: move to transfromStyles
  arr[i]=/minerva/i.test(arr[i])?'<link '+(params.contentInjectionMode=='jquery'?'data-kiwixurl':'href')+'="-/s/style-mobile.css" rel="stylesheet" type="text/css">':arr[i];// Delete stylesheet if will be inserted via minerva anyway (avoid linking it twice)
  if(/inserted.style/i.test(arr[i])&&/minerva/i.test(testCSS)||// We also remove the new pcs.css style as it is causing issues
  /pcs\.css/i.test(arr[i])){arr.splice(i,1);}}}for(i=0;i<arr.length;i++){var zimLink=arr[i].match(/(?:href|data-kiwixurl)\s*=\s*['"]([^'"]+)/i);zimLink=zimLink?/zimit/.test(params.zimType)?zimLink[1]:decodeURIComponent(uiUtil.removeUrlParameters(zimLink[1])):'';/* zl = zimLink; zim = zimType; cc = cssCache; cs = cssSource; i  */var filteredLink=transformStyles.filterCSS(zimLink,zimType,cssCache,cssSource,i);if(filteredLink.rtnFunction=='injectCSS'){blobArray[i]=filteredLink.zl;injectCSS();}else {resolveCSS(filteredLink.zl);}}}function resolveCSS(title,index){if(appstate.selectedArchive.cssBlobCache.has(title)){console.log('*** cssBlobCache hit ***');blobArray.push([title,appstate.selectedArchive.cssBlobCache.get(title)]);injectCSS();}else {var cacheKey=appstate.selectedArchive.file.name+'/'+title;cache.getItemFromCacheOrZIM(appstate.selectedArchive,cacheKey).then(function(content){// DEV: Uncomment line below and break on next to capture cssContent for local filesystem cache
  // var cssContent = util.uintToString(content);
  var mimetype=/\.ico$/i.test(title)?'image':'text/css';var cssBlob;if(content){cssBlob=new Blob([content],{type:mimetype});}var newURL=cssBlob?[title,URL.createObjectURL(cssBlob)]:[title,''];blobArray.push(newURL);appstate.selectedArchive.cssBlobCache.set(newURL[0],newURL[1]);injectCSS();// DO NOT move this: it must run within .then function to pass correct values
  }).catch(function(err){console.error(err);var newURL=[title,''];blobArray.push(newURL);appstate.selectedArchive.cssBlobCache.set(newURL[0],newURL[1]);injectCSS();});}}function injectCSS(){// We have to count the blobArray elements because some may have been spliced out
  // See https://stackoverflow.com/questions/28811911/find-array-length-in-javascript
  var blobArrayLength=blobArray.filter(function(){return true;}).length;if(blobArrayLength>=cssArray.length){// If all promised values have been obtained
  var resultsArray=[];var testBlob;for(var i in cssArray){// Put them back in the correct order
  var match=0;for(var j in blobArray){// Iterate the blobArray to find the matching entry
  // console.log("blobArray[j]: " + blobArray[j] + "\r\nblobArray[j][0]: " + blobArray[j][0]);
  testBlob=blobArray[j][0].length==1?blobArray[j]:blobArray[j][0];// What a kludge! TODO: fix this ugly mixing of arrays and strings
  if(~cssArray[i].indexOf(testBlob)){match=1;break;}}testBlob=match&&/blob:/i.test(blobArray[j][1])?blobArray[j][1]:blobArray[i];// Whoa!!! Steady on!
  resultsArray[i]=cssArray[i].replace(/(?:data-kiwixurl|href)\s*=\s*["']([^"']+)/i,'href="'+testBlob+'" data-kiwixhref="$1');// Store the original URL for later use
  // DEV note: do not attempt to add onload="URL.revokeObjectURL...)": see [kiwix.js #284]
  // DEBUG:
  // console.log("BLOB CSS #" + i + ": " + resultsArray[i] + "\nshould correspond to: " + testBlob);
  }cssArray=resultsArray;htmlArticle=htmlArticle.replace(regexpSheetHref,'');// Void existing stylesheets
  var cssArray$='\r\n'+cssArray.join('\r\n')+'\r\n';if(~cssSource.indexOf('mobile')&&zimType==='desktop'){// If user has selected mobile display mode...
  var mobileCSS=transformStyles.toMobileCSS(htmlArticle,zimType,cssCache,cssSource,cssArray$);htmlArticle=mobileCSS.html;cssArray$=mobileCSS.css;}if(~cssSource.indexOf('desktop')&&zimType==='mobile'){// If user has selected desktop display mode...
  var desktopCSS=transformStyles.toDesktopCSS(htmlArticle,zimType,cssCache,cssSource,cssArray$);htmlArticle=desktopCSS.html;cssArray$=desktopCSS.css;}// Remove any voided styles
  cssArray$=cssArray$.replace(/<link\shref="#"[^>]+>\s*/g,'');// Ensure all headings are open
  // htmlArticle = htmlArticle.replace(/class\s*=\s*["']\s*client-js\s*["']\s*/i, "");
  htmlArticle=htmlArticle.replace(/\s*(<\/head>)/i,cssArray$+'$1');console.log('All CSS resolved');injectHTML();// Pass the revised HTML to the image and JS subroutine...
  }}// End of preload stylesheets code
  function injectHTML(){// For articles loaded in the iframe, we need to set the articleWindow (but if the user is opening a new tab/window,
  // then the articleWindow has already been set in the click event of the ZIM link)
  if(appstate.target==='iframe'){// Tell jQuery we're removing the iframe document: clears jQuery cache and prevents memory leaks [kiwix-js #361]
  while(articleContainer$1.firstChild){articleContainer$1.removeChild(articleContainer$1.firstChild);}articleContainer$1=document.getElementById('articleContent');articleContainer$1.kiwixType='iframe';articleWindow=articleContainer$1.contentWindow;}// We can't access the DOM of a new Window in the UWP app
  if(!(/UWP/.test(params.appType)&&appstate.target!=='iframe')){articleDocument=articleWindow.document.documentElement;}// Inject htmlArticle into iframe
  // uiUtil.pollSpinner(); //Void progress messages
  // Extract any css classes from the html tag (they will be stripped when injected in iframe with .innerHTML)
  var htmlCSS;if(params.contentInjectionMode==='jquery')htmlCSS=htmlArticle.match(/<html[^>]*class\s*=\s*["']\s*([^"']+)/i);htmlCSS=htmlCSS?htmlCSS[1].replace(/\s+/g,' ').split(' '):'';// Hide any alert box that was activated in uiUtil.displayFileDownloadAlert function
  var downloadAlert=document.getElementById('downloadAlert');if(downloadAlert)downloadAlert.style.display='none';// Code below will run after we have written the new article to the articleContainer
  var articleLoaded=function articleLoaded(){if(params.contentInjectionMode==='serviceworker')return;// Set a global error handler for articleWindow
  articleWindow.onerror=function(msg,url,line,col,error){console.error('Error caught in ZIM contents ['+url+':'+line+']:\n'+msg,error);return true;};uiUtil.showSlidingUIElements();uiUtil.clearSpinner();if(appstate.target==='iframe'&&!articleContainer$1.contentDocument&&window.location.protocol==='file:'){uiUtil.systemAlert("<p>You seem to be opening kiwix-js with the file:// protocol, which blocks access to the app's iframe. "+'We have tried to open your article in a separate window. You may be able to use it with limited functionality.</p>'+'<p>The easiest way to run this app fully is to download and run it as a browser extension (from the vendor store). '+'Alternatively, you can open it through a web server: either use a local one (http://localhost/...) '+'or a remote one. For example, you can try your ZIM out right now with our online version of the app: '+"<a href='https://kiwix.github.io/kiwix-js/'>https://kiwix.github.io/kiwix-js/</a>.</p>"+'<p>Another option is to force your browser to accept file access (a potential security breach): '+'on Chrome, you can start it with the <code>--allow-file-access-from-files</code> command-line argument; on Firefox, '+'you can set <code>privacy.file_unique_origin</code> to <code>false</code> in about:config.</p>');articleContainer$1=window.open('',dirEntry.title,'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1');if(articleContainer$1){params.windowOpener='window';appstate.target='window';articleContainer$1.kiwixType=appstate.target;articleWindow=articleContainer$1;}}// Ensure the window target is permanently stored as a property of the articleWindow (since appstate.target can change)
  articleWindow.kiwixType=appstate.target;// Scroll the old container to the top
  articleWindow.scrollTo(0,0);articleDocument=articleWindow.document.documentElement;// ** Write article html to the new article container **
  articleDocument.innerHTML=htmlArticle;var docBody=articleDocument.querySelector('body');if(articleWindow.kiwixType==='iframe'){// Add any missing classes stripped from the <html> tag
  if(htmlCSS){htmlCSS.forEach(function(cl){docBody.classList.add(cl);});}if(!params.disableDragAndDrop){// Deflect drag-and-drop of ZIM file on the iframe to Config
  docBody.addEventListener('dragover',handleIframeDragover);docBody.addEventListener('drop',handleIframeDrop);}listenForKeyboardEvents(articleWindow);// Trap clicks in the iframe to restore Fullscreen mode
  if(params.lockDisplayOrientation)articleWindow.addEventListener('mousedown',refreshFullScreen,true);setupTableOfContents();}// Set relative font size
  setArticleZoom(params.relativeFontSize);// Set page width according to user preference
  removePageMaxWidth();setupHeadings();// if (appstate.target === 'iframe') uiUtil.initTouchZoom(articleDocument, docBody);
  // Process endnote references (so they open the reference block if closed)
  var refs=docBody.getElementsByClassName('mw-reflink-text');if(refs){for(var l=0;l<refs.length;l++){var reference=refs[l].parentElement;if(reference){reference.addEventListener('click',function(obj){var refID=obj.target.hash||obj.target.parentNode.hash;if(!refID)return;var refLocation=docBody.querySelector(refID);if(!refLocation)return;// In some ZIMs the id is in the parent node or in the parent of the parent
  var returnID=obj.target.id||obj.target.parentNode.id||obj.target.parentNode.parentNode.id;// Add backlink to refLocation if missing
  if(returnID&&!~refLocation.innerHTML.indexOf('#'+returnID)){var returnLink=document.createElement('a');returnLink.href='#'+returnID;returnLink.innerHTML='↑';refLocation.insertBefore(returnLink,refLocation.firstChild);}var refNext=util.getClosestBack(refLocation,function(el){return /^(H2|DETAILS)$/.test(el.tagName);});if(refNext){if(/DETAILS/.test(refNext.tagName)){refNext.open=true;return;}refNext.classList.add('open-block');// refNext.innerHTML = refNext.innerHTML.replace(/<br\s*\/?>$/i, "");
  refNext=refNext.nextElementSibling;while(refNext&&refNext.classList.contains('collapsible-block')){refNext.classList.add('open-block');refNext=refNext.nextElementSibling;}}});}}}var doc=articleWindow.document;// Only manipulate sections if we are not on a landing page
  if(!params.isLandingPage){// And if an ActionParse ZIM is loaded and we're not on mobile style, we should not manipulate sections
  if(!(/skins.vector.styles.css/.test(doc.head.innerHTML)&&params.cssSource!=='mobile')){openOrCloseAllSections();}}applyWikimediaZimFixes(doc);parseAnchorsJQuery(dirEntry);switchCSSTheme();loadCSSJQuery();images.prepareImagesJQuery(articleWindow);if(appstate.wikimediaZimLoaded&&params.showPopoverPreviews){var darkTheme=(params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme)!=='light';popovers.attachKiwixPopoverCss(articleWindow.document,darkTheme);}var determinedTheme=params.cssTheme==='auto'?cssUIThemeGetOrSet('auto'):params.cssTheme;if(params.allowHTMLExtraction&&appstate.target==='iframe'){uiUtil.insertBreakoutLink(determinedTheme);}// Trap any clicks on the iframe to detect if mouse back or forward buttons have been pressed (Chromium does this natively)
  if(/UWP/.test(params.appType))docBody.addEventListener('pointerup',onPointerUp);// Document has loaded except for images, so we can now change the startup failsafe [see init.js]
  settingsStore$1.setItem('lastPageLoad','OK',Infinity);// If we reloaded the page to print the desktop style, we need to return to the printIntercept dialogue
  if(params.printIntercept)printIntercept();// Make sure the article area is displayed
  setTab();checkToolbar();// Show the article
  unhideArticleContainer();// Jump to any anchor parameter
  if(anchorParameter){var target=articleWindow.document.getElementById(anchorParameter);if(target){setTimeout(function(){target.scrollIntoView();},1000);}anchorParameter='';}// Trap clicks in the iframe (currently only used for removing popovers in Restricted mode)
  articleWindow.onclick=filterClickEvent;params.isLandingPage=false;};// Hide the document to avoid display flash before stylesheets are loaded; also improves performance during loading of
  // assets in most browsers
  // DEV: We cannot do `articleWindow.document.documentElement.hidden = true;` because documentElement gets overwritten
  // during the document.write() process (if used); and since the latter is synchronous, we get slow display rewrites before it is
  // effective if we do it after document.close().
  // Note that UWP apps cannot communicate to a newly opened window except via postmessage, but Service Worker can still
  // control the Window. Additionally, Edge Legacy cannot build the DOM for a completely hidden document, hence we catch
  // these browser types with 'MSBlobBuilder' (and also IE11).
  if(!(/UWP/.test(params.appType)&&(appstate.target==='window'||messageChannelWaiting))){htmlArticle=htmlArticle.replace(/(<html\b[^>]*)>/i,'$1 bgcolor="'+(cssUIThemeGetOrSet(params.cssTheme,true)!=='light'?'grey':'whitesmoke')+'">');// NB Don't hide the document body if we don't have any window management, because native loading of documents in a new tab is slow, and we can't
  // guarantee to unhide the document in time
  if(!('MSBlobBuilder'in window)&&params.windowOpener)htmlArticle=htmlArticle.replace(/(<body\b[^>]*)/i,'$1 style="display: none;"');}// Display any hidden block elements, with a timeout, so as not to interfere with image loading
  if(params.displayHiddenBlockElements&&settingsStore$1.getItem('appVersion')===params.appVersion&&!(/UWP/.test(params.appType)&&appstate.target!=='iframe')){setTimeout(function(){if(appstate.wikimediaZimLoaded||params.displayHiddenBlockElements===true){// Do nothing if user selected auto and we're displaying mobile style and all sections are closed
  if(params.displayHiddenBlockElements==='auto'&&appstate.zimThemeType!=='mobile'&&params.cssSource!=='desktop'&&!params.openAllSections)return;displayHiddenBlockElements(articleWindow,articleDocument);}},1200);}// Calculate the current article's encoded ZIM baseUrl to use when processing relative links (also needed for SW mode when params.windowOpener is set)
  params.baseURL=encodeURI(dirEntry.namespace+'/'+dirEntry.url.replace(/[^/]+$/,''));// URI-encode anything that is not a '/'
  //     .replace(/[^/]+/g, function(m) {
  //         return encodeURIComponent(m);
  // });
  if(params.contentInjectionMode==='serviceworker'){// For UWP apps, we need to add the Zoom level to the HTML if we are opening in external window
  if(/UWP/.test(params.appType)&&appstate.target==='window'){htmlArticle=htmlArticle.replace(/(<html\b[^>]+?style=['"])/i,'$1zoom:'+params.relativeFontSize+'%; ');htmlArticle=htmlArticle.replace(/(<html\b(?![^>]+?style=['"])\s)/i,'$1style="zoom:'+params.relativeFontSize+'%;" ');}// Add darkreader script to article
  var determinedWikiTheme=params.cssTheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssTheme;if(determinedWikiTheme!=='light'&&params.cssTheme==='darkReader'){htmlArticle=htmlArticle.replace(/(<\/head>)/i,'<script type="text/javascript" src="'+document.location.pathname.replace(/index\.html/i,'js/darkreader.min.js')+'"></script>\r\n'+'<script>DarkReader.setFetchMethod(window.fetch);\r\nDarkReader.enable();</script>\r\n$1');}// Prevent the script that detects whether wombat is loaded from running
  if(params.zimType==='zimit')htmlArticle=htmlArticle.replace(/!(window._WBWombat)/,'$1');// Add doctype if missing so that scripts run in standards mode
  // (quirks mode prevents katex from running, and is incompatible with jQuery)
  transformedHTML=!/^\s*(?:<!DOCTYPE|<\?xml)\s+/i.test(htmlArticle)?'<!DOCTYPE html>\n'+htmlArticle:htmlArticle;transDirEntry=dirEntry;// We will need the encoded URL on article load so that we can set the iframe's src correctly,
  // but we must not encode the '/' character or else relative links may fail [kiwix-js #498]
  var encodedUrl=dirEntry.url.replace(/[^/]+/g,function(matchedSubstring){return encodeURIComponent(matchedSubstring);});// If the request was not initiated by an existing controlled window, we instantiate the request here
  if(!messageChannelWaiting){// We put the ZIM filename as a prefix in the URL, so that browser caches are separate for each ZIM file
  var newLocation='../'+appstate.selectedArchive.file.name+'/'+dirEntry.namespace+'/'+encodedUrl+(params.zimType==='zimit'?'?isKiwixHref':'');if(navigator.serviceWorker.controller){loaded=false;articleWindow.location.href=newLocation;}else {console.warn('No Service Worker controller found while waiting for transformed HTML to be loaded! Let\'s wait...');setTimeout(function(){document.getElementById('btnHome').click();},1800);}}return;}// Write article html to the article container
  // articleWindow.document.open('text/html', 'replace');
  // articleWindow.document.write(htmlArticle);
  // articleWindow.document.close();
  if(appstate.target==='iframe'){// Store the frame article's target in the top-level window, so that when we retrieve the window with
  // history manipulation, we'll know where to place the iframe contentWindow
  window.kiwixType=appstate.target;articleContainer$1.onload=articleLoaded;articleContainer$1.src='article.html';}else {// Attempt to establish an independent history record for windows (Restricted / window-tab mode)
  articleWindow.onpopstate=historyPop;// The articleWindow has already been set in the click event of the ZIM link and the dummy article was loaded there
  // (to avoid popup blockers). Firefox loads windows asynchronously, so we need to wait for onclick load to be fully
  // cleared, or else Firefox overwrites the window immediately after we load the html content into it.
  setTimeout(articleLoaded,400);}// Failsafe for spinner
  setTimeout(function(){uiUtil.clearSpinner();},6000);}// End of injectHtml
  }// End of displayArticleInForm()
  function parseAnchorsJQuery(dirEntry){var currentProtocol=articleWindow.location.protocol;currentProtocol=currentProtocol==='about:'?':':currentProtocol;var currentHost=articleWindow.location.host;// Percent-encode dirEntry.url and add regex escape character \ to the RegExp special characters - see https://www.regular-expressions.info/characters.html;
  // NB dirEntry.url can also contain path separator / in some ZIMs (Stackexchange). } and ] do not need to be escaped as they have no meaning on their own.
  var escapedUrl=encodeURIComponent(dirEntry.url).replace(/([\\$^.|?*+/()[{])/g,'\\$1');// Pattern to match a local anchor in an href even if prefixed by escaped url; will also match # on its own
  // Note that we exclude any # with a semicolon between it and the end of the string, to avoid accidentally matching e.g. &#39;
  var regexpLocalAnchorHref=new RegExp('^(?:#|'+escapedUrl+'#)([^#;]*$)');Array.prototype.slice.call(articleDocument.querySelectorAll('a, area')).forEach(function(anchor){// Attempts to access any properties of 'this' with malformed URLs causes app crash in Edge/UWP [kiwix-js #430]
  try{var testHref=anchor.href;}catch(err){console.error('Malformed href caused error:'+err.message);return;}var href=anchor.getAttribute('href');if(href===null||href===undefined||/^javascript:/i.test(anchor.protocol))return;var anchorTarget=href.match(regexpLocalAnchorHref);if(href.length===0);else if(anchorTarget){// It's a local anchor link : remove escapedUrl if any (see above)
  anchor.setAttribute('href','#'+anchorTarget[1]);}else if(anchor.protocol&&anchor.protocol!==currentProtocol||anchor.host&&anchor.host!==currentHost){// It's an external URL : we should open it in a new tab
  anchor.addEventListener('click',function(event){if(anchor.protocol==='bingmaps:'){anchor.removeAttribute('target');event.preventDefault();window.location=href;}else {// Find the closest enclosing A tag
  var clickedAnchor=uiUtil.closestAnchorEnclosingElement(event.target);uiUtil.warnAndOpenExternalLinkInNewTab(event,clickedAnchor);}});}else {// Intercept YouTube videos in Zimit archives
  if(params.zimType==='zimit'&&/youtu(?:be(?:-nocookie)?\.com|\.be)\//i.test(href)){transformZimit.transformVideoUrl(href,articleDocument,function(transHref){addListenersToLink(anchor,transHref,params.baseURL);});}else {addListenersToLink(anchor,href,params.baseURL);}}});// Add event listeners to the main heading so user can open current document in new tab or window by clicking on it
  if(articleWindow.document.body){var h1=articleWindow.document.body.querySelector('h1');if(h1&&dirEntry)addListenersToLink(h1,encodeURIComponent(dirEntry.url.replace(/[^/]+\//g,'')),params.baseURL);}}function loadCSSJQuery(){// Ensure all sections are open for clients that lack JavaScript support, or that have some restrictive CSP [kiwix-js #355].
  // This is needed only for some versions of ZIM files generated by mwoffliner (at least in early 2018), where the article sections are closed by default on small screens.
  // These sections can be opened by clicking on them, but this is done with some javascript.
  // The code below is a workaround we still need for compatibility with ZIM files generated by mwoffliner in 2018.
  // A better fix has been made for more recent ZIM files, with the use of noscript tags : see https://github.com/openzim/mwoffliner/issues/324
  var collapsedBlocks=articleDocument.querySelectorAll('.collapsible-block:not(.open-block), .collapsible-heading:not(.open-block)');// Using decrementing loop to optimize performance : see https://stackoverflow.com/questions/3520688
  for(var i=collapsedBlocks.length;i--;){collapsedBlocks[i].classList.add('open-block');}var cssCount=0;var cssFulfilled=0;Array.prototype.slice.call(articleDocument.querySelectorAll('link[data-kiwixurl]')).forEach(function(link){cssCount++;var linkUrl=link.getAttribute('data-kiwixurl');var url=decodeURIComponent(/zimit/.test(appstate.selectedArchive.zimType)?linkUrl:uiUtil.removeUrlParameters(linkUrl));// See if we can get asset from cache. However, if we don't have the link type, the assets cache can fail, so we had better extract the asset instead of getting it from the cache
  if(assetsCache.has(url)&&link.type){var nodeContent=assetsCache.get(url);uiUtil.feedNodeWithBlob(link,'href',nodeContent,link.type,true);cssFulfilled++;}else {if(params.assetsCache)document.getElementById('cachingAssets').style.display='';appstate.selectedArchive.getDirEntryByPath(url).then(function(dirEntry){if(!dirEntry){assetsCache.set(url,'');// Prevent repeated lookups of this unfindable asset
  throw new Error('DirEntry '+_typeof(dirEntry));}var mimetype=dirEntry.getMimetype();var readFile=/^text\//i.test(mimetype)?appstate.selectedArchive.readUtf8File:appstate.selectedArchive.readBinaryFile;return readFile(dirEntry,function(fileDirEntry,content){var fullUrl=fileDirEntry.namespace+'/'+fileDirEntry.url;if(params.assetsCache)assetsCache.set(fullUrl,content);uiUtil.feedNodeWithBlob(link,'href',content,mimetype,true);cssFulfilled++;renderIfCSSFulfilled(fileDirEntry.url);});}).catch(function(e){console.error('Could not find DirEntry for link element: '+url,e);cssCount--;renderIfCSSFulfilled();});}});renderIfCSSFulfilled();// Some pages are extremely heavy to render, so we prevent rendering by keeping the iframe hidden
  // until all CSS content is available [kiwix-js #381]
  function renderIfCSSFulfilled(title){if(cssFulfilled>=cssCount){uiUtil.clearSpinner();document.getElementById('articleContent').style.display='';// We have to resize here for devices with On Screen Keyboards when loading from the article search list
  resizeIFrame();}}}/**
   * Add event listeners to a hyperlinked element to extract the linked article or file from the ZIM instead
   * of following links
   * @param {Node} a The anchor or other linked element to which event listeners will be attached
   * @param {String} href The href of the linked element
   * @param {String} baseUrl The baseUrl against which relative links will be calculated
   */function addListenersToLink(a,href,baseUrl){appstate.baseUrl=baseUrl;var uriComponent=uiUtil.removeUrlParameters(href);// var namespace = baseUrl.replace(/^([-ABCIJMUVWX])\/.+/, '$1');
  var loadingContainer=false;var contentType;var downloadAttrValue;// Some file types need to be downloaded rather than displayed (e.g. *.epub)
  // The HTML download attribute can be Boolean or a string representing the specified filename for saving the file
  // For Boolean values, getAttribute can return any of the following: download="" download="download" download="true"
  // So we need to test hasAttribute first: see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute
  // However, we cannot rely on the download attribute having been set, so we also need to test for known download file types
  var isDownloadableLink=a.hasAttribute('download')||regexpDownloadLinks.test(href);if(isDownloadableLink){// if (!/UWP/.test(params.appType) && params.contentInjectionMode === 'serviceworker') return;
  downloadAttrValue=a.getAttribute('download');// Normalize the value to a true Boolean or a filename string or true if there is no download attribute
  downloadAttrValue=/^(download|true|\s*)$/i.test(downloadAttrValue)||downloadAttrValue||true;contentType=a.getAttribute('type');}// DEV: We need to use the '#' location trick here for cross-browser compatibility with opening a new tab/window
  // if (params.windowOpener && a.tagName !== 'IFRAME') a.setAttribute('href', '#' + href);
  // Store the current values, as they may be changed if user switches to another tab before returning to this one
  var kiwixTarget=appstate.target;var thisWindow=articleWindow;var thisContainer=articleContainer$1;var reset=function reset(){if(appstate.target==='window'){// By delaying unblocking of the touch event, we prevent multiple touch events launching the same window
  a.touched=false;a.newcontainer=false;}loadingContainer=false;a.articleisloading=false;a.dataset.touchevoked=false;a.popoverisloading=false;};var onDetectedClick=function onDetectedClick(e){// Restore original values for this window/tab
  appstate.target=kiwixTarget;articleWindow=thisWindow;articleContainer$1=thisContainer;var isNautilusPopup=a.dataset.popup&&!/0|false/i.test(a.dataset.popup);if(a.tagName==='H1'||isNautilusPopup){// We have registered a click on the header or on a dynamic link (e.g. in Nautilus archives)
  if(isNautilusPopup){// Pop-up window sometimes opens out of view, so we have to scroll into view
  iframe.contentWindow.scrollTo({top:'0',behavior:'smooth'});}if(!a.newcontainer)return;// A new tab wasn't requested, so ignore
  }if(params.windowOpener){// This processes Ctrl-click, Command-click, the long-press event, and middle-click
  if(a.newcontainer){// We open the new window immediately so that it is a direct result of user action (click)
  // and we'll populate it later - this avoids most popup blockers
  loadingContainer=true;articleContainer$1=window.open('article.html',params.windowOpener==='tab'?'_blank':a.title,params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);appstate.target='window';// We have to make this conditional, because sometimes this action is blocked by the browser
  if(articleContainer$1){articleContainer$1.kiwixType=appstate.target;articleWindow=articleContainer$1;}}}e.preventDefault();e.stopPropagation();anchorParameter=href.match(/#([^#;]+)$/);anchorParameter=anchorParameter?anchorParameter[1]:'';var indexRoot=window.location.pathname.replace(/[^/]+$/,'')+encodeURI(appstate.selectedArchive.file.name)+'/';var zimRoot=indexRoot.replace(/^.+?\/www\//,'/');var zimUrl=href;var zimUrlFullEncoding;// Some URLs are incorrectly given with spaces at the beginning and end, so we remove these
  zimUrl=zimUrl.replace(/^\s+|\s+$/g,'');if(/zimit/.test(params.zimType)){// Deal with root-relative URLs in zimit ZIMs
  if(!zimUrl.indexOf(indexRoot)){// If begins with indexRoot
  zimUrl=zimUrl.replace(indexRoot,'').replace('#'+anchorParameter,'');}else if(!zimUrl.indexOf(zimRoot)){// If begins with zimRoot
  zimUrl=zimUrl.replace(zimRoot,'').replace('#'+anchorParameter,'');}else if(/^\//.test(zimUrl)){zimUrl=zimUrl.replace(/^\//,appstate.selectedArchive.zimitPseudoContentNamespace+appstate.selectedArchive.zimitPrefix.replace(/^A\//,''));}else if(!~zimUrl.indexOf(appstate.selectedArchive.zimitPseudoContentNamespace)){// Doesn't begin with pseudoContentNamespace
  // Zimit ZIMs store URLs percent-encoded and with querystring and
  // deriveZimUrlFromRelativeUrls strips any querystring and decodes
  var zimUrlToTransform=zimUrl;zimUrl=encodeURI(uiUtil.deriveZimUrlFromRelativeUrl(zimUrlToTransform,baseUrl))+href.replace(uriComponent,'').replace('#'+anchorParameter,'');zimUrlFullEncoding=encodeURI(uiUtil.deriveZimUrlFromRelativeUrl(zimUrlToTransform,baseUrl)+href.replace(uriComponent,'').replace('#'+anchorParameter,''));}}else {zimUrl=uiUtil.deriveZimUrlFromRelativeUrl(uriComponent,baseUrl);}// @TODO: We are getting double activations of the click event. This needs debugging. For now, we use a flag to prevent this.
  // a.newcontainer = true; // Prevents double activation
  // uiUtil.showSlidingUIElements();
  // Tear down contents of articleWindow.document
  if(!/UWP/.test(params.appType)&&articleWindow&&articleWindow.document&&articleWindow.document.body){articleWindow.document.body.innerHTML='';}goToArticle(zimUrl,downloadAttrValue,contentType,zimUrlFullEncoding);setTimeout(reset,1400);};var darkTheme=(params.cssUITheme=='auto'?cssUIThemeGetOrSet('auto',true):params.cssUITheme)!=='light';/* Event processing */a.addEventListener('touchstart',function(e){// console.debug('a.touchstart');
  var timeout=500;if(!appstate.wikimediaZimLoaded||!params.showPopoverPreviews){if(!params.windowOpener||a.touched)return;loadingContainer=true;}else {timeout=200;}a.touched=true;var event=e;// The link will be clicked if the user long-presses for more than 500ms (if the option is enabled), or 200ms for popover
  setTimeout(function(){// DEV: appstate.startVector indicates that the app is processing a touch zoom event, so we cancel any new windows
  // see uiUtil.pointermove_handler
  if(!a.touched||a.newcontainer||appstate.startVector)return;if(appstate.wikimediaZimLoaded&&params.showPopoverPreviews){a.dataset.touchevoked=true;popovers.populateKiwixPopoverDiv(event,a,appstate,darkTheme,appstate.selectedArchive);}else {a.newcontainer=true;onDetectedClick(event);}event.preventDefault();},timeout);},{passive:false});a.addEventListener('touchend',function(){// console.debug('a.touchend');
  a.touched=false;a.newcontainer=false;loadingContainer=false;// Cancel any popovers because user has clicked
  a.articleisloading=true;setTimeout(reset,1000);});// This detects right-click in all browsers (only if the option is enabled)
  a.addEventListener('contextmenu',function(e){// console.debug('contextmenu');
  if(appstate.wikimediaZimLoaded&&params.showPopoverPreviews){e.preventDefault();e.stopPropagation();// console.debug('suppressed contextmenu because processing popovers');
  var kiwixPopover=e.target.ownerDocument.querySelector('.kiwixtooltip');if(kiwixPopover);else if(!a.touched){a.touched=true;popovers.populateKiwixPopoverDiv(e,a,appstate,darkTheme,appstate.selectedArchive);}}else {if(!params.windowOpener)return;if(params.rightClickType==='double'&&!a.touched){a.touched=true;setTimeout(function(){a.touched=false;},700);}else {if(a.newcontainer)return;// Prevent accidental double activation
  e.preventDefault();e.stopPropagation();a.newcontainer=true;a.touched=false;onDetectedClick(e);}}});// This traps the middle-click event before tha auxclick event fires
  a.addEventListener('mousedown',function(e){// console.debug('a.mousedown');
  a.dataset.touchevoked=true;// This is needed to simulate touch events in UWP app
  if(!params.windowOpener)return;e.preventDefault();e.stopPropagation();if(a.touched||a.newcontainer)return;// Prevent double activations
  if(e.ctrlKey||e.metaKey||e.which===2||e.button===4){a.newcontainer=true;onDetectedClick(e);}});a.addEventListener('mouseup',function(e){setTimeout(reset,1400);// Needed for UWP app which doesn't have touch events, so touchevoked simulates them
  });// This detects the middle-click event that opens a new tab in recent Firefox and Chrome
  // See https://developer.mozilla.org/en-US/docs/Web/API/Element/auxclick_event
  a.addEventListener('auxclick',function(e){// console.debug('a.auxclick');
  if(!params.windowOpener)return;e.preventDefault();e.stopPropagation();});// The popover feature requires as a minimum that the browser supports the css matches function
  // (having this condition prevents very erratic popover placement in IE11, for example, so the feature is disabled)
  if(appstate.wikimediaZimLoaded&&params.showPopoverPreviews&&'matches'in Element.prototype){// Prevent accidental selection of the anchor text in some contexts
  if(a.style.userSelect===undefined&&appstate.wikimediaZimLoaded&&params.showPopoverPreviews){// This prevents selection of the text in a touched link in iOS Safari
  a.style.webkitUserSelect='none';a.style.msUserSelect='none';}a.addEventListener('mouseover',function(e){// console.debug('a.mouseover');
  if(a.dataset.touchevoked==='true')return;popovers.populateKiwixPopoverDiv(e,a,appstate,darkTheme,appstate.selectedArchive);});a.addEventListener('mouseout',function(e){if(a.dataset.touchevoked==='true')return;popovers.removeKiwixPopoverDivs(e.target.ownerDocument);setTimeout(reset,1000);});a.addEventListener('focus',function(e){setTimeout(function(){// Delay focus event so touchstart can fire first
  // console.debug('a.focus');
  if(a.touched)return;a.focused=true;popovers.populateKiwixPopoverDiv(e,a,appstate,darkTheme,appstate.selectedArchive);},200);});a.addEventListener('blur',function(e){// console.debug('a.blur');
  a.focused=false;setTimeout(reset,1400);});}// The main click routine (called by other events above as well)
  a.addEventListener('click',function(e){console.log('a.click',e);// Cancel any popovers because user has clicked
  a.articleisloading=true;// Prevent opening multiple windows
  if(loadingContainer||a.touched){e.preventDefault();e.stopPropagation();}else {onDetectedClick(e);}});}/**
   * Unhides all hidden divs or tables, for use in Wikimedia mobile display style, which hides some crucial
   * elements that users want optionally to be able to access
   */function displayHiddenBlockElements(win,doc){if(!doc)return;console.debug('Searching for hidden block elements to display...');Array.prototype.slice.call(doc.querySelectorAll('table, div')).forEach(function(element){if(win.getComputedStyle(element).display==='none'){element.style.setProperty('display','block','important');if(!params.noHiddenElementsWarning){var message;if(!appstate.wikimediaZimLoaded){message='<p>The <i>Display hidden block elements setting</i> is currently set '+'to <b>always</b>, so it will apply to <i>any</i> ZIM type. This can have unexpected effects in non-Wikipedia ZIMs.</p>'+'<p>We strongly recommend that you change this setting to <b>auto</b> in Configuration. This setting allows the '+'app to decide when to apply the setting. If you never want to see hidden elements, even in Wikimedia ZIMs, change the '+'setting to <b>never</b>.</p>';}if(message){message+='<p><i>This message will not be displayed again, unless you reset the app.</i></p>';params.noHiddenElementsWarning=true;uiUtil.systemAlert(message,'One-time message!').then(function(){settingsStore$1.setItem('noHiddenElementsWarning',true,Infinity);});}}}});// Ensure images are picked up by lazy loading
  win.scrollBy(0,5);win.scrollBy(0,-5);}var dropup=document.getElementById('dropup');dropup.addEventListener('click',function(){var ToCList=document.getElementById('ToCList');ToCList.style.display=ToCList.style.display==='block'?'none':'block';});function setupTableOfContents(){var iframe=document.getElementById('articleContent');var innerDoc=iframe.contentDocument;// Create a table of contents object and get all headings from the document
  var tableOfContents=new uiUtil.ToC(innerDoc);var headings=tableOfContents.getHeadingObjects();// If there are no headings, hide the dropup element and return
  var dropupElement=document.getElementById('dropup');if(headings.length<=1){dropupElement.classList.remove('btn-default');dropupElement.style.pointerEvents='none';dropupElement.innerHTML='<b>&nbsp;ToC&nbsp;</b>';document.getElementById('ToCList').style.visibility='hidden';return;}else {dropupElement.classList.add('btn-default');dropupElement.style.pointerEvents='auto';dropupElement.innerHTML='<b>&nbsp;ToC&nbsp;</b><span class="caret"></span>';document.getElementById('ToCList').style.visibility='visible';}dropup.style.fontSize=~~(params.relativeUIFontSize*0.14)+'px';var dropupHtml='';headings.forEach(function(heading){if(/^h1$/i.test(heading.tagName)){dropupHtml+='<li style="font-size:'+params.relativeFontSize+'%;"><a href="#" data-heading-id="'+heading.id+'">'+heading.textContent+'</a></li>';}else if(/^h2$/i.test(heading.tagName)){dropupHtml+='<li style="font-size:'+~~(params.relativeFontSize*0.9)+'%;"><a href="#" data-heading-id="'+heading.id+'">'+heading.textContent+'</a></li>';}else if(/^h3$/i.test(heading.tagName)){dropupHtml+='<li style="font-size:'+~~(params.relativeFontSize*0.8)+'%;"><a href="#" data-heading-id="'+heading.id+'">'+heading.textContent+'</a></li>';}else if(/^h4$/i.test(heading.tagName)){dropupHtml+='<li style="font-size:'+~~(params.relativeFontSize*0.7)+'%;"><a href="#" data-heading-id="'+heading.id+'">'+heading.textContent+'</a></li>';}// Skip smaller headings (if there are any) to avoid making list too long
  });var ToCList=document.getElementById('ToCList');ToCList.style.maxHeight=~~(window.innerHeight*0.75)+'px';ToCList.style.marginLeft=~~(window.innerWidth/2)-~~(window.innerWidth*0.16)+'px';ToCList.innerHTML=dropupHtml;Array.prototype.slice.call(ToCList.getElementsByTagName('a')).forEach(function(listElement){listElement.addEventListener('click',function(){var sectionEle=innerDoc.getElementById(this.dataset.headingId);var csec=util.closest(sectionEle,'details, section');csec=csec&&/DETAILS|SECTION/.test(csec.parentElement.tagName)?csec.parentElement:csec;openOrCloseAllSections(true,csec);// Scroll to element
  sectionEle.scrollIntoView();// Scrolling up then down ensures that the toolbars show according to user settings
  iframe.contentWindow.scrollBy(0,-5);setTimeout(function(){iframe.contentWindow.scrollBy(0,5);iframe.contentWindow.focus();},250);ToCList.style.display='none';});});}/**
   * Sets the state of collapsible sections for the iframe document, or for the given node
   * @param {Boolean} override An optional value that overrides params.openAllSections (true to open, false to close)
   * @param {Node} node An optional node within which elements will be opened or closed (this will normally be a details element)
   */// Sets state of collapsible sections
  function openOrCloseAllSections(override,node){if(!appstate.wikimediaZimLoaded)return;var open=override===false?false:override||params.openAllSections;var container=node||articleDocument;if(container){var blocks=container.querySelectorAll('details, section:not([data-mw-section-id="0"]), .collapsible-block, .collapsible-heading');if(node)processSection(open,node);for(var x=blocks.length;x--;){processSection(open,blocks[x]);}}}function processSection(open,node){if(/DETAILS|SECTION/.test(node.tagName)){if(open){node.setAttribute('open','');node.style.display='';}else {node.removeAttribute('open');}if(typeof HTMLDetailsElement==='undefined'||node.tagName==='SECTION'){var children=node.children;for(var y=children.length;y--;){if(/SUMMARY|H\d/.test(children[y].tagName))continue;if(open){if(/DETAILS|SECTION/.test(children[y].tagName))children[y].setAttribute('open','');children[y].style.removeProperty('display');}else {if(/DETAILS|SECTION/.test(children[y].tagName))children[y].removeAttribute('open');children[y].style.display='none';}}}}else {if(open)node.classList.add('open-block');else node.classList.remove('open-block');}}// Attach listeners to headers to open-close following sections
  function setupHeadings(){var headings=articleDocument.querySelectorAll('h2, h3, h4, h5');for(var i=headings.length;i--;){// Prevent heading from being selected when user clicks on it
  headings[i].style.userSelect='none';headings[i].style.msUserSelect='none';headings[i].addEventListener('click',function(e){// Override the built-in simplistic polyfill
  e.preventDefault();var that=e.currentTarget;var detailsEl=util.closest(that,'details, section');if(detailsEl){var toggle=!detailsEl.hasAttribute('open');openOrCloseAllSections(toggle,detailsEl);}});}}params.preloadAllImages=function(){if(params.preloadingAllImages!==true){setTimeout(function(){if(params.preloadingAllImages){uiUtil.pollSpinner('Extracting images...');}},1000);params.preloadingAllImages=true;if(params.imageDisplay){params.contentInjectionMode==='jquery'?images.prepareImagesJQuery(articleWindow,true):images.prepareImagesServiceWorker(articleWindow,true);}return;}// All images should now be loaded, or else user did not request loading images
  uiUtil.clearSpinner();uiUtil.extractHTML();uiUtil.clearSpinner();};/**
   * Changes the URL of the browser page, so that the user might go back to it
   *
   * @param {String} title The title of the article to store (if storing an article)
   * @param {String} titleSearch The title of the search (if storing a search)
   */function pushBrowserHistoryState(title,titleSearch){// DEV: Note that appstate.target will always be 'iframe' for title searches, so we do not need to account for that
  var targetWin=appstate.target==='iframe'?window:articleWindow;var stateObj={};var urlParameters;var stateLabel;if(title&&!(title==='')){// Prevents creating a double history for the same page (wrapped to prevent exception in IE and Edge Legacy for tabs)
  try{if(targetWin.history.state&&targetWin.history.state.title===title)return;}catch(err){console.error('Unable to access History for this window',err);return;}stateObj.title=title;urlParameters='?title='+title;stateLabel='Wikipedia Article : '+title;}else if(titleSearch&&!(titleSearch==='')){stateObj.titleSearch=titleSearch;urlParameters='?titleSearch='+titleSearch;stateLabel='Wikipedia search : '+titleSearch;}else return;// Edge Legacy and IE cannot push history state to another window/tab and produce an exception;
  // independent navigation history is therefore disabled for these browsers
  try{targetWin.history.pushState(stateObj,stateLabel,urlParameters);}catch(error){history.pushState(stateObj,stateLabel,urlParameters);}}/**
   * Extracts the content of the given article pathname, or a downloadable file, from the ZIM
   *
   * @param {String} path The pathname (namespace + filename) to the article or file to be extracted
   * @param {Boolean|String} download A Bolean value that will trigger download of title, or the filename that should
   *     be used to save the file in local FS (in HTML5 spec, a string value for the download attribute is optional)
   * @param {String} contentType The mimetype of the downloadable file, if known
   * @param {String} pathEnc The fully encoded version of the path for use with some Zimit archives
   */function goToArticle(path,download,contentType,pathEnc){var pathForServiceWorker=path;path=path.replace(/\??isKiwixHref/,'');appstate.expectedArticleURLToBeDisplayed=path;// This removes any search highlighting
  clearFindInArticle();var shortTitle=path.replace(/[^/]+\//g,'').substring(0,18);uiUtil.pollSpinner('Loading '+shortTitle);var zimName=appstate.selectedArchive.file.name.replace(/\.[^.]+$/,'').replace(/_\d+-\d+$/,'');if(~path.indexOf(params.cachedStartPages[zimName])){goToMainArticle();return;}appstate.selectedArchive.getDirEntryByPath(path).then(function(dirEntry){var mimetype=contentType||dirEntry?dirEntry.getMimetype():'';if(dirEntry===null||dirEntry===undefined){uiUtil.clearSpinner();console.error('Article with title '+path+' not found in the archive');if(params.zimType==='zimit'){if(pathEnc){// We failed to get path, so we should try the fully encoded version instead
  goToArticle(pathEnc,download,contentType);}else {var anchor={href:path.replace(/^(C\/)?A\//,''),target:'_blank'};uiUtil.warnAndOpenExternalLinkInNewTab(null,anchor);setTab();}}else {uiUtil.systemAlert('<p>Sorry, but we couldn\'t find the article:</p><p><i>'+path+'</i></p><p>in this archive!</p>');}}else if(download||/\/(epub|pdf|zip|.*opendocument|.*officedocument|tiff|mp4|webm|mpeg|octet-stream)\b/i.test(mimetype)){// PDFs can be treated as a special case, as they can be displayed directly in a browser window or tab in most browsers (but not UWP)
  if(!/UWP/.test(params.appType)&&params.contentInjectionMode==='serviceworker'&&(/\/pdf\b/.test(mimetype)||/\.pdf([?#]|$)/i.test(dirEntry.url))){window.open(document.location.pathname.replace(/[^/]+$/,'')+appstate.selectedArchive.file.name+'/'+pathForServiceWorker,params.windowOpener==='tab'?'_blank':'Download PDF',params.windowOpener==='window'?'toolbar=0,location=0,menubar=0,width=800,height=600,resizable=1,scrollbars=1':null);}else {download=true;appstate.selectedArchive.readBinaryFile(dirEntry,function(fileDirEntry,content){uiUtil.displayFileDownloadAlert(path,download,mimetype,content);uiUtil.clearSpinner();});}}else {// params.isLandingPage = false;
  document.querySelectorAll('.alert').forEach(function(el){el.style.display='none';});document.getElementById('welcomeText').style.display='none';resizeIFrame();readArticle(dirEntry);}}).catch(function(e){console.error('Error reading article with title '+path,e);if(params.appIsLaunching)goToMainArticle();// Line below prevents bootloop
  params.appIsLaunching=false;});}function goToRandomArticle(){if(appstate.selectedArchive!==null&&appstate.selectedArchive.isReady()){uiUtil.pollSpinner();appstate.selectedArchive.getRandomDirEntry(function(dirEntry){if(dirEntry===null||dirEntry===undefined){uiUtil.clearSpinner();uiUtil.systemAlert('Error finding random article','Error finding article');}else {// We fall back to the old A namespace to support old ZIM files without a text/html MIME type for articles
  // DEV: If minorVersion is 1, then we are using a v1 article-only title listing. By definition,
  // all dirEntries in an article-only listing must be articles.
  if(appstate.selectedArchive.file.minorVersion>=1||/text\/html\b/i.test(dirEntry.getMimetype())||params.zimType!=='zimit'&&dirEntry.namespace==='A'){params.isLandingPage=false;uiUtil.hideActiveContentWarning();readArticle(dirEntry);}else {// If the random title search did not end up on an article,
  // we try again, until we find one
  goToRandomArticle();}}});}else {// Showing the relevant error message and redirecting to config page for adding the ZIM file
  uiUtil.systemAlert('Archive not set: please select an archive','No archive selected').then(function(){document.getElementById('btnConfigure').click();});}}function goToMainArticle(){uiUtil.pollSpinner();params.isLandingPage=true;appstate.selectedArchive.getMainPageDirEntry(function(dirEntry){if(dirEntry===null||dirEntry===undefined){params.isLandingPage=false;console.error('Error finding main article.');uiUtil.clearSpinner();document.getElementById('welcomeText').style.display='';uiUtil.systemAlert('We cannot find the landing page!<br />'+'Please check that this ZIM archive is valid. You may be able to search for other pages in the ZIM above.','Main page not found!');}else {// DEV: see comment above under goToRandomArticle()
  var setMainPage=function setMainPage(dirEntry){params.isLandingPage=true;appstate.selectedArchive.landingPageUrl=dirEntry.namespace+'/'+dirEntry.url;readArticle(dirEntry);};if(dirEntry.redirect){appstate.selectedArchive.resolveRedirect(dirEntry,setMainPage);}else if(/text/.test(dirEntry.getMimetype())||dirEntry.namespace==='A'){setMainPage(dirEntry);}else {params.isLandingPage=false;console.error('The main page of this archive does not seem to be an article');uiUtil.clearSpinner();document.getElementById('welcomeText').style.display='';uiUtil.systemAlert('The main page of this archive does not seem to be an article!<br />'+'Please check that this ZIM archive is valid. You may be able to search for other pages in the ZIM above.','Invalid article!');}}});}var app = {};

  return app;

})();
